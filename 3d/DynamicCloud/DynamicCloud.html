<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no" />
    <title>Identify</title>
    <style>
        html,
        body,
        #mapcontainer {
            padding: 0;
            margin: 0;
            width: 100%;
            height: 100%;
        }

        .mapbuttoncontainergroup {
            width: 40%;
            height: 50%;
            position: absolute;
            display: flex;
            flex-flow: column;
        }

        .mapbuttoncontainer {
            width: 100%;
            display: flex;
            flex-flow: row;
            top: 5px;
            left: 10px;
            display: block;
        }


        .mapbuttoncontainer .mapbutton {
            width: 100px;
            height: 40px;
            margin-right: 15px;
            margin-bottom: 15px;
            float: left;
        }
    </style>
    <script id="vertexShader" type="x-shader/x-vertex">
        void main() {
        gl_Position = vec4( position, 1.0 );
    }
</script>
    <script id="fragmentShader" type="x-shader/x-fragment">
        uniform vec2 u_resolution;
  uniform vec2 u_mouse;
  uniform float u_time;
  uniform sampler2D u_noise;
  uniform sampler2D u_bg;
  uniform float u_scroll;
  
  const vec3 cloudcolour = vec3(.07,0.0,.24);
  const vec3 lightcolour = vec3(.25,0.6,1.);
  
  float mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}
  vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}
  vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}

  float noise(vec3 p){
      vec3 a = floor(p);
      vec3 d = p - a;
      d = d * d * (3.0 - 2.0 * d);

      vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
      vec4 k1 = perm(b.xyxy);
      vec4 k2 = perm(k1.xyxy + b.zzww);

      vec4 c = k2 + a.zzzz;
      vec4 k3 = perm(c);
      vec4 k4 = perm(c + 1.0);

      vec4 o1 = fract(k3 * (1.0 / 41.0));
      vec4 o2 = fract(k4 * (1.0 / 41.0));

      vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
      vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);

      return o4.y * d.y + o4.x * (1.0 - d.y);
  }

  void main() {
    vec2 uv = (gl_FragCoord.xy - 0.5 * u_resolution.xy) / min(u_resolution.y, u_resolution.x);
    
    float noise1 = noise(vec3(uv * 3. * noise(vec3(uv * 3. + 100., u_time * 3. + 10.)), u_time * 2.))  * 2.;
    
    float noise2 = noise(vec3(uv + 2.35, u_time * 1.357 - 10.));
    
    uv.y -= u_scroll * .0001;
    
    uv += texture2D(u_bg, uv * vec2(.5, 1.) - vec2(u_time * .05, 1.) - .5 * .05).rg * 0.08 + noise1 * .008 * (1. - clamp(noise1 * noise1 * 2. + .2, 0., 1.));
    
    vec3 tex = texture2D(u_bg, uv * vec2(.5, 1.) - vec2(u_time * .02, 1.) - .5).rgb;
    
    uv.y -= u_scroll * .0001;
    vec3 tex1 = texture2D(u_bg, uv * vec2(.5, 1.) - vec2(u_time * .08, 1.)).rgb;
    
    uv.y -= u_scroll * .0001;
    vec3 tex2 = texture2D(u_bg, (uv * .8 + .5) * vec2(.5, 1.) - vec2(u_time * .1, 1.)).rgb;
    
    vec3 fragcolour = tex;
    
    float shade = tex.r;
    shade *= clamp(noise1 * noise2 * sin(u_time * 3.), .2, 10.);
    shade += shade * shade * 3.;
    shade -= (1. - clamp(tex1 * 4., 0., 1.).r) * .2;
    shade -= (1. - clamp(tex2 * 4., 0., 1.).r) * .1;
    
    fragcolour = mix(cloudcolour, lightcolour, shade);

    gl_FragColor = vec4(fragcolour, 1.);
  }
</script>
    <script src="../../library/common/jquery-2.2.3.min.js"></script>
    <script src="../../library/smap/xuhui/SMap.min.js"></script>
    <script src="../../library/smap/xuhui/Plugins.min.js"></script>
    <script src="../../library/common/ccapture.js"></script>
       <script type="module">
           import * as THREE from '../../library/common/three.module.js';
             window.THREERenderer =THREE;
     </script>
    <script>
        const smap = new SMap.Map('mapcontainer', {
            viewMode: '3D',
            center: [0, 0],
            zoom: 3,
            zooms: [0, 11],
            pitch: 60,
            mapStyle: 'smap://styles/dark',
            showBuildingBlock: true
        })

        smap.on(SMap.MapEvent.click, function (view, eventParamter) {
            console.log(eventParamter)
            console.log(view.camera)
        })
        let meshLinerenderer = null

        $(function () {
            $("#addcompasscontrol").click(function () {
                    const compass = new SMap.Compass({
                        visible: true,
                        position: 'top-right'
                    })
                    smap.addControl(compass)
                }),
                $("#addlayercontrol").click(function () {
                    const layerListControl = new SMap.LayerListControl({
                        visible: true,
                        position: 'top-right',
                        collapse: true
                    })
                    smap.addControl(layerListControl)
                }),

                $("#addbasemaptoggle").click(function () {
                    const basemapToggle = new SMap.BasemapToggle({
                        visible: true,
                        position: 'top-right'
                    })
                    smap.addControl(basemapToggle)
                }),

                $("#addUndergroundSwitch").click(function () {
                    const undergroundSwitch = new SMap.UndergroundSwitch({
                        visible: true,
                        position: 'top-right'
                    })
                    smap.addControl(undergroundSwitch)
                })

            $("#btnaddTilelayer").click(function () {
                const SHCTiledMapServiceLayerparam = {
                    layerType: 'TileLayer',
                    layerUrl: "http://10.201.37.222/arcgis/rest/services/maskboundary/xh_maskboundary/MapServer",
                    layerTitle: "XHGQ",
                    layerId: "XHGQ",
                    layerOpacity: 1,
                    layerVisible: true
                }
                smap.addLayer(SHCTiledMapServiceLayerparam)
            })
            $("#btnaddCylinderFence").click(function () {
                meshLinerenderer = new Plugins.DynamicCloud(smap.view)
                const Aurorarenderer = {
                    center: [0, 0],
                    radius: 400,
                    noiseurl: "../../resources/images/noise.png",
                    cloudurl: "../../resources/images/cloud.jpg",
                }
                meshLinerenderer.add(Aurorarenderer)
            })
            $("#btnremoveCylinderFence").click(function () {
                meshLinerenderer.remove()
            })
        })
    </script>
</head>

<body>
    <div id="mapcontainer"></div>
    <div class="mapbuttoncontainergroup">
        <div class="mapbuttoncontainer">
            <button class="mapbutton" id="addcompasscontrol"> 添加罗盘控件</button>
            <button class="mapbutton" id="addlayercontrol"> 添加图层控件</button>
            <button class="mapbutton" id="addbasemaptoggle"> 添加底图切换按钮</button>
            <button class="mapbutton" id="addUndergroundSwitch"> 添加地上地下切换控件</button>
            <button class="mapbutton" id="btnaddCylinderFence"> add CylinderFence</button>
            <button class="mapbutton" id="btnremoveCylinderFence"> remove CylinderFence</button>
            <button class="mapbutton" id="btnaddTilelayer"> add Tilelayer</button>
        </div>
    </div>
</body>

</html>
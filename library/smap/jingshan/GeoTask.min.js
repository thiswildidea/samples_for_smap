!function (e, t) { "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : e.GeoTask = t() }(this, function () { "use strict"; var e = (t.prototype._addListener = function (e, t, r) { if (this.emit("newListener", e, t), this.events.has(e)) { var n = this.events.get(e); r ? n.unshift(t) : n.push(t) } else this.events.set(e, [t]); var i = this.getMaxListeners(); if (0 < i && this.listenerCount(e) > i) { var o = new Error("Possible EventEmitter memory leak detected.\n         " + this.listenerCount(e) + " " + e.toString() + " listeners.\n         Use emitter.setMaxListeners() to increase limit"); o.name = "MaxListenersExceededWarning", console.warn(o) } return this }, t.prototype.addListener = function (e, t) { return this._addListener(e, t, !1) }, t.prototype.emit = function (e) { for (var t = [], r = 1; r < arguments.length; r++)t[r - 1] = arguments[r]; if (this.events.has(e)) { for (var n = 0, i = this.events.get(e).slice(); n < i.length; n++) { var o = i[n]; try { o.apply(this, t) } catch (e) { this.emit("error", e) } } return !0 } if ("error" === e) throw 0 < t.length ? t[0] : Error("Unhandled error."); return !1 }, t.prototype.eventNames = function () { return Array.from(this.events.keys()) }, t.prototype.getMaxListeners = function () { return this.maxListeners || t.defaultMaxListeners }, t.prototype.listenerCount = function (e) { return this.events.has(e) ? this.events.get(e).length : 0 }, t.prototype._listeners = function (e, t, r) { if (!e.events.has(t)) return []; var n = e.events.get(t); return r ? this.unwrapListeners(n) : n.slice(0) }, t.prototype.unwrapListeners = function (e) { for (var t = new Array(e.length), r = 0; r < e.length; r++)t[r] = e[r].listener || e[r]; return t }, t.prototype.listeners = function (e) { return this._listeners(this, e, !0) }, t.prototype.rawListeners = function (e) { return this._listeners(this, e, !1) }, t.prototype.off = function (e, t) { return this.removeListener(e, t) }, t.prototype.on = function (e, t) { return this.addListener(e, t) }, t.prototype.once = function (e, t) { var r = this.onceWrap(e, t); return this.on(e, r), this }, t.prototype.onceWrap = function (e, t) { function r() { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t]; this.context.removeListener(this.eventName, this.rawListener), this.listener.apply(this.context, e) } var n = { eventName: e, listener: t, rawListener: r, context: this }, i = r.bind(n); return (n.rawListener = i).listener = t, i }, t.prototype.prependListener = function (e, t) { return this._addListener(e, t, !0) }, t.prototype.prependOnceListener = function (e, t) { var r = this.onceWrap(e, t); return this.prependListener(e, r), this }, t.prototype.removeAllListeners = function (e) { var t = this; if (void 0 === this.events) return this; if (this.events.has(e)) { var r = this.events.get(e).slice(); this.events.delete(e); for (var n = 0, i = r; n < i.length; n++) { var o = i[n]; this.emit("removeListener", e, o) } } else this.eventNames().map(function (e) { t.removeAllListeners(e) }); return this }, t.prototype.removeListener = function (e, t) { if (this.events.has(e)) { var r = this.events.get(e); -1 !== r.indexOf(t) && (r.splice(r.indexOf(t), 1), this.emit("removeListener", e, t), 0 === r.length && this.events.delete(e)) } return this }, t.prototype.setMaxListeners = function (e) { return this.maxListeners = e, this }, t.defaultMaxListeners = 50, t); function t() { this.events = new Map } var d = (r.jsapi ="http://31.8.11.75/smiapi/arcgis",r.jsapiversion4X="4.15",r);function r(){}var s=d.jsapiversion4X,i="next";function o(e){if(null===e&&(e=s),e.toString().toLowerCase()===i)return i;var t=e&&e.match(/^(\d)\.(\d+)/);return t&&{major:parseInt(t[1],10),minor:parseInt(t[2],10)}}function a(e){return void 0===e&&(e=s),d.jsapi+"/"+e+"/init.js"}function u(e){var t=document.createElement("link");return t.rel="stylesheet",t.href=e,t}function l(e,t){if(t){var r=document.querySelector(t);r.parentNode.insertBefore(e,r)}else document.head.appendChild(e)}function c(e){return document.querySelector('link[href*="'+e+'"]')}function p(e){return!e||o(e)?function(e){void 0===e&&(e=s),null===e&&(e=s);var t=a(e),r=t.substring(0,t.indexOf("init.js")),n=o(e);return n===i||3!==n.major?r+"esri/themes/light/main.css":r+(n.minor<=10?"js/":"")+"esri/css/esri.css"}(e):e}function f(e,t){var r=p(e),n=c(r);if(n||l(n=u(r),t),4===function(e){null===e&&(e=s);var t=e&&e.match(/^(\d)\.(\d+)/);return t&&{major:parseInt(t[1],10),minor:parseInt(t[2],10)}}(e).major){var i=r.substring(0,r.indexOf("esri/themes/"))+"esri/themes/gis/css/gis.css",o=c(i);o||l(o=u(i),t)}return n}var n={Promise:"undefined"!=typeof window?window.Promise:void 0},h={};function y(e,t,r){var n,i,o,s;r&&(o=r,s=function(e){o(e.error||new Error("There was an error attempting to load "+i.src)),i.removeEventListener("error",s,!1)},(i=e).addEventListener("error",s,!1),n=s);var a=function(){t(e),e.removeEventListener("load",a,!1),n&&e.removeEventListener("error",n,!1)};e.addEventListener("load",a,!1)}function v(){return document.querySelector("script[data-shsmi]")}function m(){var e=window.require;return e&&e.on}function w(e){void 0===e&&(e={});var u={};[h,e].forEach(function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(u[t]=e[t])});var l=u.version,c=u.url||a(l);return new n.Promise(function(e,t){var r,n,i=v();if(i){var o=i.getAttribute("src");o!==c?t(new Error("The ArcGIS API for JavaScript is already loaded ("+o+").")):m()?e(i):y(i,e,t)}else if(m())t(new Error("The ArcGIS API for JavaScript is already loaded."));else{var s=u.css;if(s)f(!0===s?l:s,u.insertCssBefore);else f(null,u.insertCssBefore);if(u.dojoConfig)window.dojoConfig=u.dojoConfig;else{var a={async:!0,packages:[{location:d.jsapi+"/extensions",name:"smiapi"},{location:d.jsapi+"/extensions/geolocation",name:"geolocate",main:"geolocate"}],deps:["@dojo/framework/shim/main"],has:{"esri-promise-compatibility":1,"esri-featurelayer-webgl":1}};window.dojoConfig=a}r=c,(n=document.createElement("script")).type="text/javascript",n.src=r,n.setAttribute("data-shsmi","loading"),y(i=n,function(){i.setAttribute("data-shsmi","loaded"),e(i)},t),document.head.appendChild(i)}})}function L(t){return new n.Promise(function(r,e){var n=window.require.on("error",e);window.require(t,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];n.remove(),r(e)})})}function g(e,t){if(void 0===t&&(t={}),m())return L(e);var r=v(),n=r&&r.getAttribute("src");return!t.url&&n&&(t.url=n),w(t).then(function(){return L(e)})}var b=(x.prototype.S4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},x.prototype.get_uuid=function(){return this.S4()+this.S4()+"-"+this.S4()+"-"+this.S4()+"-"+this.S4()+"-"+this.S4()+this.S4()+this.S4()},x);function x(){this.uuid=this.get_uuid()}var I,j,k=(I=function(e,t){return(I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}I(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),_=function(e,s,a,u){return new(a=a||Promise)(function(r,t){function n(e){try{o(u.next(e))}catch(e){t(e)}}function i(e){try{o(u.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?r(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(n,i)}o((u=u.apply(e,s||[])).next())})},S=function(r,n){var i,o,s,e,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(r,a)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},q=(k(P,j=e),P.prototype.MapService=function(d){return _(this,void 0,void 0,function(){var c,t=this;return S(this,function(e){switch(e.label){case 0:return c=null,[4,g(["esri/layers/GraphicsLayer","esri/Graphic","esri/tasks/IdentifyTask","esri/tasks/support/IdentifyParameters"]).then(function(e){var s=e[0],a=e[1],u=e[2],l=e[3];return _(t,void 0,void 0,function(){var t,r,n,i,o=this;return S(this,function(e){switch(e.label){case 0:return this.view?(t=null,d.layerUniqueId?(r=this.view.map.findLayerById(d.layerUniqueId))&&(t=r.url):t=d.url,t?(n=new u(t),(i=new l).tolerance=void 0===d.tolerance?20:d.tolerance,i.layerIds=void 0===d.layerIds?["*"]:d.layerIds,i.geometry=d.geometry,i.mapExtent=this.view.extent,i.returnGeometry=!0,[4,n.execute(i).then(function(e){if(0<e.results.length){var n=o.view.map.findLayerById(o.displayedLayerid);void 0===n&&(n=new s({title:o.displayedLayerid+"查询结果",id:o.displayedLayerid,listMode:"hide"}),o.view.map.add(n)),e.results.map(function(e){var t=null;t="point"===e.feature.geometry.type?{type:"simple-marker",style:"square",color:[255,0,0,0],size:"8px",outline:{color:[255,0,0,0],width:1}}:"polyline"===e.feature.geometry.type?{type:"simple-line",color:[255,0,0,0],width:"2px",style:"short-dot"}:{type:"simple-fill",color:[255,255,255,0],outline:{color:[255,0,0,1],width:"5px"}},e.feature.geometry.spatialReference=o.view.spatialReference;var r=new a({geometry:e.feature.geometry,attributes:e.feature.attributes,symbol:t});n.add(r)})}c=e})]):[2]):[2];case 1:return e.sent(),[2]}})})})];case 1:return e.sent(),[2,new n.Promise(function(e,t){e(c)})]}})})},P.prototype.remove=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e)},P.prototype.show=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!0)},P.prototype.hide=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!1)},P.prototype.init=function(t){return _(this,void 0,void 0,function(){var n=this;return S(this,function(e){return this.displayedLayerid=(new b).uuid,this.view=t,this.view.on("click",function(r){n.view.hitTest(r).then(function(t){return _(n,void 0,void 0,function(){return S(this,function(e){return 0<t.results.length&&t.results[0].graphic.layer.id===this.displayedLayerid&&this.emit("click",t.results[0].graphic,r.mapPoint),[2]})})})}),[2]})})},P);function P(e){var t=j.call(this)||this;return t.view=null,t.displayedLayerid="",t.init(e),t}var E=(B.shqxboundary="qx_boundary",B.shjdboundary="jd_boundary",B.shjwhboundary="jwh_boundary",B);function B(){}var O,A,G=(O=function(e,t){return(O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}O(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),M=function(e,s,a,u){return new(a=a||Promise)(function(r,t){function n(e){try{o(u.next(e))}catch(e){t(e)}}function i(e){try{o(u.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?r(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(n,i)}o((u=u.apply(e,s||[])).next())})},C=function(r,n){var i,o,s,e,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(r,a)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},T=(G(F,A=e),F.prototype.featureLayer=function(u){return void 0===u&&(u={}),M(this,void 0,void 0,function(){var a,t=this;return C(this,function(e){switch(e.label){case 0:return a=null,[4,g(["esri/layers/GraphicsLayer","esri/Graphic","esri/layers/FeatureLayer"]).then(function(e){var o=e[0],s=e[1],n=e[2];return M(t,void 0,void 0,function(){var t,r,i=this;return C(this,function(e){switch(e.label){case 0:return this.view?(u.layerUniqueId?t=this.view.map.findLayerById(u.layerUniqueId):u.queryurl&&(t=new n({url:u.queryurl})),t?((r=t.createQuery()).where=u.queryDefinition,r.outFields=void 0===u.outFields?["*"]:u.outFields,[4,t.queryFeatures(r).then(function(e){if(0<e.features.length){var r,n=i.view.map.findLayerById(i.displayedLayerid);void 0===n&&(n=new o({title:i.displayedLayerid+"查询结果",id:i.displayedLayerid,listMode:"hide"}),i.view.map.add(n)),u.displayed&&(u.symbol?r=u.symbol:"polygon"===u.type?r={type:"simple-fill",color:[255,255,255,0],outline:{color:[255,0,0,1],width:"5px"}}:"polyline"===u.type?r={type:"simple-line",color:[255,0,0,0],width:"2px",style:"short-dot"}:"point"===u.type&&(r={type:"simple-marker",style:"square",color:[255,0,0,0],size:"8px",outline:{color:[255,0,0,0],width:1}}),e.features.map(function(e){e.geometry.spatialReference=i.view.spatialReference;var t=new s({geometry:e.geometry,attributes:e.attributes,symbol:r});n.add(t)})),a=e}})]):[2]):[2];case 1:return e.sent(),[2]}})})})];case 1:return e.sent(),[2,new n.Promise(function(e,t){e(a)})]}})})},F.prototype.mapImageLayer=function(d){return void 0===d&&(d={}),M(this,void 0,void 0,function(){var c,t=this;return C(this,function(e){switch(e.label){case 0:return c=null,[4,g(["esri/layers/GraphicsLayer","esri/Graphic","esri/tasks/QueryTask","esri/tasks/support/Query"]).then(function(e){var s=e[0],a=e[1],u=e[2],l=e[3];return M(t,void 0,void 0,function(){var t,r,n,i,o=this;return C(this,function(e){switch(e.label){case 0:return d.layerUniqueId?(r=this.view.map.findLayerById(d.layerUniqueId))&&(t=r.url):t=d.queryurl,d.layerId?(n=new u({url:t+"/"+d.layerId}),(i=new l).returnGeometry=!0,i.outFields=void 0===d.outFields?["*"]:d.outFields,[4,n.execute(i).then(function(e){if(0<e.features.length){var r,n=o.view.map.findLayerById(o.displayedLayerid);void 0===n&&(n=new s({title:o.displayedLayerid+"查询结果",id:o.displayedLayerid,listMode:"hide"}),o.view.map.add(n)),d.displayed&&(d.symbol?r=d.symbol:"polygon"===d.type?r={type:"simple-fill",color:[255,255,255,0],outline:{color:[255,0,0,1],width:"5px"}}:"polyline"===d.type?r={type:"simple-line",color:[255,0,0,0],width:"2px",style:"short-dot"}:"point"===d.type&&(r={type:"simple-marker",style:"square",color:[255,0,0,0],size:"8px",outline:{color:[255,0,0,0],width:1}}),e.features.map(function(e){e.geometry.spatialReference=o.view.spatialReference;var t=new a({geometry:e.geometry,attributes:e.attributes,symbol:r});n.add(t)})),c=e}})]):[2];case 1:return e.sent(),[2]}})})})];case 1:return e.sent(),[2,new n.Promise(function(e,t){e(c)})]}})})},F.prototype.remove=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e)},F.prototype.show=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!0)},F.prototype.hide=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!1)},F.prototype.init=function(t){return M(this,void 0,void 0,function(){var n=this;return C(this,function(e){return this.displayedLayerid=(new b).uuid,this.view=t,this.view.on("click",function(r){n.view.hitTest(r).then(function(t){return M(n,void 0,void 0,function(){return C(this,function(e){return 0<t.results.length&&t.results[0].graphic.layer.id===this.displayedLayerid&&this.emit("click",t.results[0].graphic,r.mapPoint),[2]})})})}),[2]})})},F);function F(e){var t=A.call(this)||this;return t.view=null,t.displayedLayerid="",t.init(e),t}return{load:g,Layers:E,Identify:q,Query:T}});
//# sourceMappingURL=GeoTask.min.js.map

!function (e, t) { "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : e.Plugins = t() }(this, function () { "use strict"; var e = (t.prototype._addListener = function (e, t, i) { if (this.emit("newListener", e, t), this.events.has(e)) { var r = this.events.get(e); i ? r.unshift(t) : r.push(t) } else this.events.set(e, [t]); var o = this.getMaxListeners(); if (0 < o && this.listenerCount(e) > o) { var n = new Error("Possible EventEmitter memory leak detected.\n         " + this.listenerCount(e) + " " + e.toString() + " listeners.\n         Use emitter.setMaxListeners() to increase limit"); n.name = "MaxListenersExceededWarning", console.warn(n) } return this }, t.prototype.addListener = function (e, t) { return this._addListener(e, t, !1) }, t.prototype.emit = function (e) { for (var t = [], i = 1; i < arguments.length; i++)t[i - 1] = arguments[i]; if (this.events.has(e)) { for (var r = 0, o = this.events.get(e).slice(); r < o.length; r++) { var n = o[r]; try { n.apply(this, t) } catch (e) { this.emit("error", e) } } return !0 } if ("error" === e) throw 0 < t.length ? t[0] : Error("Unhandled error."); return !1 }, t.prototype.eventNames = function () { return Array.from(this.events.keys()) }, t.prototype.getMaxListeners = function () { return this.maxListeners || t.defaultMaxListeners }, t.prototype.listenerCount = function (e) { return this.events.has(e) ? this.events.get(e).length : 0 }, t.prototype._listeners = function (e, t, i) { if (!e.events.has(t)) return []; var r = e.events.get(t); return i ? this.unwrapListeners(r) : r.slice(0) }, t.prototype.unwrapListeners = function (e) { for (var t = new Array(e.length), i = 0; i < e.length; i++)t[i] = e[i].listener || e[i]; return t }, t.prototype.listeners = function (e) { return this._listeners(this, e, !0) }, t.prototype.rawListeners = function (e) { return this._listeners(this, e, !1) }, t.prototype.off = function (e, t) { return this.removeListener(e, t) }, t.prototype.on = function (e, t) { return this.addListener(e, t) }, t.prototype.once = function (e, t) { var i = this.onceWrap(e, t); return this.on(e, i), this }, t.prototype.onceWrap = function (e, t) { function i() { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t]; this.context.removeListener(this.eventName, this.rawListener), this.listener.apply(this.context, e) } var r = { eventName: e, listener: t, rawListener: i, context: this }, o = i.bind(r); return (r.rawListener = o).listener = t, o }, t.prototype.prependListener = function (e, t) { return this._addListener(e, t, !0) }, t.prototype.prependOnceListener = function (e, t) { var i = this.onceWrap(e, t); return this.prependListener(e, i), this }, t.prototype.removeAllListeners = function (e) { var t = this; if (void 0 === this.events) return this; if (this.events.has(e)) { var i = this.events.get(e).slice(); this.events.delete(e); for (var r = 0, o = i; r < o.length; r++) { var n = o[r]; this.emit("removeListener", e, n) } } else this.eventNames().map(function (e) { t.removeAllListeners(e) }); return this }, t.prototype.removeListener = function (e, t) { if (this.events.has(e)) { var i = this.events.get(e); -1 !== i.indexOf(t) && (i.splice(i.indexOf(t), 1), this.emit("removeListener", e, t), 0 === i.length && this.events.delete(e)) } return this }, t.prototype.setMaxListeners = function (e) { return this.maxListeners = e, this }, t.defaultMaxListeners = 50, t); function t() { this.events = new Map } var c = (i.jsapi ="http://31.8.11.75/smiapi/arcgis",i.jsapiversion4X="4.15",i);function i(){}var a=c.jsapiversion4X,o="next";function n(e){if(null===e&&(e=a),e.toString().toLowerCase()===o)return o;var t=e&&e.match(/^(\d)\.(\d+)/);return t&&{major:parseInt(t[1],10),minor:parseInt(t[2],10)}}function l(e){return void 0===e&&(e=a),c.jsapi+"/"+e+"/init.js"}function s(e){var t=document.createElement("link");return t.rel="stylesheet",t.href=e,t}function d(e,t){if(t){var i=document.querySelector(t);i.parentNode.insertBefore(e,i)}else document.head.appendChild(e)}function y(e){return document.querySelector('link[href*="'+e+'"]')}function p(e){return!e||n(e)?function(e){void 0===e&&(e=a),null===e&&(e=a);var t=l(e),i=t.substring(0,t.indexOf("init.js")),r=n(e);return r===o||3!==r.major?i+"esri/themes/light/main.css":i+(r.minor<=10?"js/":"")+"esri/css/esri.css"}(e):e}function u(e,t){var i=p(e),r=y(i);if(r||d(r=s(i),t),4===function(e){null===e&&(e=a);var t=e&&e.match(/^(\d)\.(\d+)/);return t&&{major:parseInt(t[1],10),minor:parseInt(t[2],10)}}(e).major){var o=i.substring(0,i.indexOf("esri/themes/"))+"esri/themes/gis/css/gis.css",n=y(o);n||d(n=s(o),t)}return r}var r={Promise:"undefined"!=typeof window?window.Promise:void 0},f={};function v(e,t,i){var r,o,n,a;i&&(n=i,a=function(e){n(e.error||new Error("There was an error attempting to load "+o.src)),o.removeEventListener("error",a,!1)},(o=e).addEventListener("error",a,!1),r=a);var l=function(){t(e),e.removeEventListener("load",l,!1),r&&e.removeEventListener("error",r,!1)};e.addEventListener("load",l,!1)}function h(){return document.querySelector("script[data-shsmi]")}function m(){var e=window.require;return e&&e.on}function b(e){void 0===e&&(e={});var s={};[f,e].forEach(function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(s[t]=e[t])});var d=s.version,y=s.url||l(d);return new r.Promise(function(e,t){var i,r,o=h();if(o){var n=o.getAttribute("src");n!==y?t(new Error("The ArcGIS API for JavaScript is already loaded ("+n+").")):m()?e(o):v(o,e,t)}else if(m())t(new Error("The ArcGIS API for JavaScript is already loaded."));else{var a=s.css;if(a)u(!0===a?d:a,s.insertCssBefore);else u(null,s.insertCssBefore);if(s.dojoConfig)window.dojoConfig=s.dojoConfig;else{var l={async:!0,packages:[{location:c.jsapi+"/extensions",name:"smiapi"},{location:c.jsapi+"/extensions/geolocation",name:"geolocate",main:"geolocate"}],deps:["@dojo/framework/shim/main"],has:{"esri-promise-compatibility":1,"esri-featurelayer-webgl":1}};window.dojoConfig=l}i=y,(r=document.createElement("script")).type="text/javascript",r.src=i,r.setAttribute("data-shsmi","loading"),v(o=r,function(){o.setAttribute("data-shsmi","loaded"),e(o)},t),document.head.appendChild(o)}})}function w(t){return new r.Promise(function(i,e){var r=window.require.on("error",e);window.require(t,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.remove(),i(e)})})}function L(e,t){if(void 0===t&&(t={}),m())return w(e);var i=h(),r=i&&i.getAttribute("src");return!t.url&&r&&(t.url=r),b(t).then(function(){return w(e)})}var x=(g.prototype.S4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},g.prototype.get_uuid=function(){return this.S4()+this.S4()+"-"+this.S4()+"-"+this.S4()+"-"+this.S4()+"-"+this.S4()+this.S4()+this.S4()},g);function g(){this.uuid=this.get_uuid()}var k=(z.maploaded="maploaded",z.zoomchanged="zoomchanged",z.extentchanged="extentchanged",z.centerchanged="centerchanged",z.blur="blur",z.click="click",z.doubleclick="doubleclick",z.drag="drag",z.focus="focus",z.hold="hold",z.keydown="key-down",z.keyup="key-up",z.mousewheel="mouse-wheel",z.pointerdown="pointer-down",z.pointerenter="pointer-enter",z.pointerleave="pointer-leave",z.pointermove="pointer-move",z.pointerup="pointer-up",z.resize="pointer-up",z.popupvisible="popup-visible",z);function z(){}var R,C,I=(R=function(e,t){return(R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}R(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),S=function(e,a,l,s){return new(l=l||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,o)}n((s=s.apply(e,a||[])).next())})},A=function(i,r){var o,n,a,e,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,n&&(a=2&t[0]?n.return:t[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,t[1])).done)return a;switch(n=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,n=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){l.label=t[1];break}if(6===t[0]&&l.label<a[1]){l.label=a[1],a=t;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(t);break}a[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(i,l)}catch(e){t=[6,e],n=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},B=(I(E,C=e),E.prototype.add=function(a){var l=this;void 0===a&&(a={}),L(["esri/layers/GraphicsLayer","esri/Graphic","esri/layers/FeatureLayer"]).then(function(e){var t=e[0],o=e[1],i=e[2];if(l.view){var r=null;if(a.boundaryType&&(r=l.view.map.findLayerById(a.boundaryType)),r||a.url&&(r=new i({url:a.url,id:a.boundaryType,title:a.boundaryType,visible:!1}),l.view.map.add(r)),r){var n=r.createQuery();n.where=a.boundaryDefinition,r.queryFeatures(n).then(function(e){if(0<e.features.length){var i,r=l.view.map.findLayerById(l.displayedLayerid);void 0===r&&(r=new t({title:l.displayedLayerid+"边界",id:l.displayedLayerid,listMode:"hide"}),l.view.map.add(r)),i=void 0!==a.symbol?a.symbol:{type:"simple-fill",color:[255,255,255,0],outline:{color:[255,255,0,1],width:"5px"}},e.features.map(function(e){var t=new o({geometry:e.geometry,symbol:i,attributes:e.attributes});r.add(t)})}})}}}).catch(function(e){console.error(e)})},E.prototype.remove=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e)},E.prototype.show=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!0)},E.prototype.hide=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!1)},E.prototype.init=function(t){return S(this,void 0,void 0,function(){var r=this;return A(this,function(e){return this.displayedLayerid=(new x).uuid,this.view=t,this.view.on(k.click,function(i){r.view.hitTest(i).then(function(t){return S(r,void 0,void 0,function(){return A(this,function(e){return 0<t.results.length&&t.results[0].graphic.layer.id===this.displayedLayerid&&this.emit(k.click,t.results[0].graphic,i.mapPoint),[2]})})})}),this.view.on(k.pointermove,function(i){r.view.hitTest(i).then(function(t){return S(r,void 0,void 0,function(){return A(this,function(e){return 0<t.results.length&&t.results[0].graphic.layer.id===this.displayedLayerid&&this.emit(k.pointermove,t.results[0].graphic,i.mapPoint),[2]})})})}),[2]})})},E);function E(e){var t=C.call(this)||this;return t.displayedLayerid="",t.view=null,t.init(e),t}var P,_,M=(P=function(e,t){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}P(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),F=function(e,a,l,s){return new(l=l||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,o)}n((s=s.apply(e,a||[])).next())})},j=function(i,r){var o,n,a,e,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,n&&(a=2&t[0]?n.return:t[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,t[1])).done)return a;switch(n=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,n=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){l.label=t[1];break}if(6===t[0]&&l.label<a[1]){l.label=a[1],a=t;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(t);break}a[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(i,l)}catch(e){t=[6,e],n=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},O=(M(W,_=e),W.prototype.drawcircle=function(){var c=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Point","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],a=e[1],i=e[2],l=e[3],s=e[4];c.emit("drawbegin","circle"),c.drawtool=new t({view:c.view}),c.drawtool.reset();var d=c.view.map.findLayerById(c.displayedLayerid);null==d&&(d=new i({id:c.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),c.view.map.add(d));var r=(new x).uuid,y=c.view.map.findLayerById(r);y||(y=new i({id:c.displayedLayerid,title:"画圆显示层",listMode:"hide"}),c.view.map.add(y));var o=c.drawtool.create("circle",{mode:"click"});c.view.focus(),o.on("vertex-add",function(e){if(2===e.vertices.length){y.removeAll();var t=new l({x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:c.view.spatialReference}),i=new l({x:e.vertices[1][0],y:e.vertices[1][1],spatialReference:c.view.spatialReference}),r=s.distance(t,i,"meters"),o=s.buffer(t,r,"meters"),n=new a({geometry:o,symbol:c.polygonsymbol});y.add(n)}}),o.on("vertex-remove",function(e){console.log(e)}),o.on("cursor-update",function(e){if(2===e.vertices.length){y.removeAll();var t=new l({x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:c.view.spatialReference}),i=new l({x:e.vertices[1][0],y:e.vertices[1][1],spatialReference:c.view.spatialReference}),r=s.distance(t,i,"meters"),o=s.buffer(t,r,"meters"),n=new a({geometry:o,symbol:c.polygonsymbol});y.add(n)}}),o.on("redo",function(e){console.log(e)}),o.on("undo",function(e){console.log(e)}),o.on("draw-complete",function(e){if(2===e.vertices.length){var t=new l({x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:c.view.spatialReference}),i=new l({x:e.vertices[1][0],y:e.vertices[1][1],spatialReference:c.view.spatialReference}),r=s.distance(t,i,"meters"),o=s.buffer(t,r,"meters"),n=new a({geometry:o,symbol:c.polygonsymbol});c.view.map.remove(y),d.add(n),c.emit("drawcomplete",n,"circle")}})})},W.prototype.drawrectangle=function(){var c=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Polygon"]).then(function(e){var t=e[0],l=e[1],i=e[2],s=e[3];c.emit("drawbegin","rectangle"),c.drawtool=new t({view:c.view}),c.drawtool.reset();var d=c.view.map.findLayerById(c.displayedLayerid);d||(d=new i({id:c.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),c.view.map.add(d));var r=(new x).uuid,y=c.view.map.findLayerById(r);null==y&&(y=new i({id:c.displayedLayerid,title:"画矩形追踪显示层",listMode:"hide"}),c.view.map.add(y));var o=c.drawtool.create("rectangle",{mode:"click"});c.view.focus(),o.on("vertex-add",function(e){if(2===e.vertices.length){y.removeAll();var t=e.vertices[0][0]>e.vertices[1][0]?e.vertices[1][0]:e.vertices[0][0],i=e.vertices[0][1]>e.vertices[1][1]?e.vertices[1][1]:e.vertices[0][1],r=e.vertices[0][0]>e.vertices[1][0]?e.vertices[0][0]:e.vertices[1][0],o=e.vertices[0][1]>e.vertices[1][1]?e.vertices[0][1]:e.vertices[1][1],n=new s({hasZ:!0,hasM:!0,rings:[[[t,i],[r,i],[r,o],[t,o],[t,i]]],spatialReference:c.view.spatialReference}),a=new l({geometry:n,symbol:c.polygonsymbol});y.add(a)}}),o.on("vertex-remove",function(e){console.log(e)}),o.on("cursor-update",function(e){if(2===e.vertices.length){y.removeAll();var t=e.vertices[0][0]>e.vertices[1][0]?e.vertices[1][0]:e.vertices[0][0],i=e.vertices[0][1]>e.vertices[1][1]?e.vertices[1][1]:e.vertices[0][1],r=e.vertices[0][0]>e.vertices[1][0]?e.vertices[0][0]:e.vertices[1][0],o=e.vertices[0][1]>e.vertices[1][1]?e.vertices[0][1]:e.vertices[1][1],n=new s({hasZ:!0,hasM:!0,rings:[[[t,i],[r,i],[r,o],[t,o],[t,i]]],spatialReference:c.view.spatialReference}),a=new l({geometry:n,symbol:c.polygonsymbol});y.add(a)}}),o.on("redo",function(e){console.log(e)}),o.on("undo",function(e){console.log(e)}),o.on("draw-complete",function(e){if(2===e.vertices.length){var t=e.vertices[0][0]>e.vertices[1][0]?e.vertices[1][0]:e.vertices[0][0],i=e.vertices[0][1]>e.vertices[1][1]?e.vertices[1][1]:e.vertices[0][1],r=e.vertices[0][0]>e.vertices[1][0]?e.vertices[0][0]:e.vertices[1][0],o=e.vertices[0][1]>e.vertices[1][1]?e.vertices[0][1]:e.vertices[1][1],n=new s({hasZ:!0,hasM:!0,rings:[[[t,i],[r,i],[r,o],[t,o],[t,i]]],spatialReference:c.view.spatialReference}),a=new l({geometry:n,symbol:c.polygonsymbol});c.view.map.remove(y),d.add(a),c.emit("drawcomplete",a,"rectangle")}})})},W.prototype.drawPoint=function(){var s=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer"]).then(function(e){var t=e[0],r=e[1],i=e[2];s.emit("drawbegin","point"),s.drawtool=new t({view:s.view}),s.drawtool.reset();var o=s.view.map.findLayerById(s.displayedLayerid);o||(o=new i({id:s.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),s.view.map.add(o));var n=(new x).uuid,a=s.view.map.findLayerById(n);null==a&&(a=new i({id:s.displayedLayerid,title:"画点移动追踪显示层",listMode:"hide"}),s.view.map.add(a));var l=s.drawtool.create("point",{mode:"click"});s.view.focus(),l.on("vertex-add",function(e){console.log(e)}),l.on("vertex-remove",function(e){console.log(e)}),l.on("cursor-update",function(e){a.removeAll();var t={type:"point",x:e.coordinates[0],y:e.coordinates[1],spatialReference:s.view.spatialReference},i=new r({geometry:t,symbol:s.marksymbol});a.add(i)}),l.on("redo",function(e){console.log(e)}),l.on("undo",function(e){console.log(e)}),l.on("draw-complete",function(e){var t={type:"point",x:e.coordinates[0],y:e.coordinates[1],spatialReference:s.view.spatialReference},i=new r({geometry:t,symbol:s.marksymbol});s.view.map.remove(a),o.add(i),s.emit("drawcomplete",i,"point")})})},W.prototype.drawMultipoint=function(){var y=this;L(["esri/views/draw/Draw","esri/views/draw/PointDrawAction","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Polygon","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],o=(e[1],e[2]),i=e[3];e[4],e[5],y.emit("drawbegin","multipoint"),y.drawtool=new t({view:y.view}),y.drawtool.reset();var n=y.view.map.findLayerById(y.displayedLayerid);n||(n=new i({id:y.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),y.view.map.add(n));var r=(new x).uuid,a=y.view.map.findLayerById(r);null==a&&(a=new i({id:y.displayedLayerid,title:"画多点显示层",listMode:"hide"}),y.view.map.add(a));var l=(new x).uuid,s=y.view.map.findLayerById(l);null==s&&(s=new i({id:y.displayedLayerid,title:"移动追踪点显示层",listMode:"hide"}),y.view.map.add(s));var d=y.drawtool.create("multipoint",{mode:"click"});y.view.focus(),d.on("vertex-add",function(e){a.removeAll(),e.vertices.map(function(e){var t={type:"point",x:e[0],y:e[1],spatialReference:y.view.spatialReference},i=new o({geometry:t,symbol:y.marksymbol});a.add(i)})}),d.on("vertex-remove",function(e){console.log(e)}),d.on("cursor-update",function(e){s.removeAll(),e.vertices.map(function(e){var t={type:"point",x:e[0],y:e[1],spatialReference:y.view.spatialReference},i=new o({geometry:t,symbol:y.marksymbol});s.add(i)})}),d.on("redo",function(e){console.log(e)}),d.on("undo",function(e){console.log(e)}),d.on("draw-complete",function(e){var r=[];e.vertices.map(function(e){var t={type:"point",x:e[0],y:e[1],spatialReference:y.view.spatialReference},i=new o({geometry:t,symbol:y.marksymbol});r.push(i),n.add(i)}),y.view.map.remove(a),y.view.map.remove(s),y.emit("drawcomplete",r,"multipoint")})})},W.prototype.drawPolyline=function(){var y=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],a=e[1],i=e[2],l=e[3];y.emit("drawbegin","polyline"),y.drawtool=new t({view:y.view}),y.drawtool.reset();var s=y.view.map.findLayerById(y.displayedLayerid);s||(s=new i({id:y.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),y.view.map.add(s));var r=(new x).uuid,d=y.view.map.findLayerById(r);null==d&&(d=new i({id:y.displayedLayerid,title:"画线显示层",listMode:"hide"}),y.view.map.add(d));var o=y.drawtool.create("polyline");y.view.focus(),o.on(["vertex-add","vertex-remove","cursor-update","redo","undo"],function(e){if(1<e.vertices.length){var t=e.vertices;d.removeAll();var i=new a({geometry:{type:"polyline",paths:t,spatialReference:y.view.spatialReference},symbol:y.polylinesymbol}),r=function(e){var t=e.clone(),i=t.removePoint(0,t.paths[0].length-1),r=t.getPoint(0,t.paths[0].length-1);return{type:"polyline",spatialReference:y.view.spatialReference,hasZ:!1,paths:[[[r.x,r.y],[i.x,i.y]]]}};if(function(e){if(!(e.paths[0].length<3)){var t=e.clone(),i=r(e);return t.removePoint(0,t.paths[0].length-1),l.crosses(i,t)}}(i.geometry)){var o=new a({geometry:r(i.geometry),symbol:y.polylinesymbol});o&&d.addMany([i,o]),o&&e.preventDefault()}else d.add(i)}}),o.on("draw-complete",function(e){if(1<e.vertices.length){var t=e.vertices;d.removeAll();var i=new a({geometry:{type:"polyline",paths:t,spatialReference:y.view.spatialReference},symbol:y.polylinesymbol}),r=function(e){var t=e.clone(),i=t.removePoint(0,t.paths[0].length-1),r=t.getPoint(0,t.paths[0].length-1);return{type:"polyline",spatialReference:y.view.spatialReference,hasZ:!1,paths:[[[r.x,r.y],[i.x,i.y]]]}},o=null;if(function(e){if(!(e.paths[0].length<3)){var t=e.clone(),i=r(e);return t.removePoint(0,t.paths[0].length-1),l.crosses(i,t)}}(i.geometry)){var n=new a({geometry:r(i.geometry),symbol:y.polylinesymbol});n&&(s.addMany([i,n]),o=new a({geometry:l.union(i.geometry,n.geometry),symbol:y.polylinesymbol})),n&&e.preventDefault()}else o=i,s.add(i);y.view.map.remove(d),y.emit("drawcomplete",o,"polyline")}})})},W.prototype.drawPolygon=function(){var s=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],o=e[1],i=e[2];e[3],s.emit("drawbegin","polygon"),s.drawtool=new t({view:s.view}),s.drawtool.reset();var n=s.view.map.findLayerById(s.displayedLayerid);n||(n=new i({id:s.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),s.view.map.add(n));var r=(new x).uuid,a=s.view.map.findLayerById(r);null==a&&(a=new i({id:s.displayedLayerid,title:"画面显示层",listMode:"hide"}),s.view.map.add(a));var l=s.drawtool.create("polygon");s.view.focus(),l.on(["vertex-add","vertex-remove","cursor-update","redo","undo"],function(e){var t=e.vertices;a.removeAll();var i={type:"polygon",rings:t,spatialReference:s.view.spatialReference},r=new o({geometry:i,symbol:s.polygonsymbol});a.add(r)}),l.on("draw-complete",function(e){var t=e.vertices;a.removeAll();var i={type:"polygon",rings:t,spatialReference:s.view.spatialReference},r=new o({geometry:i,symbol:s.polygonsymbol});s.view.map.remove(a),n.add(r),s.emit("drawcomplete",r,"polygon")})})},W.prototype.reset=function(){this.drawtool&&this.drawtool.reset()},W.prototype.clean=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e)},W.prototype.show=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!0)},W.prototype.hide=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!1)},W.prototype.init=function(i){return F(this,void 0,void 0,function(){var t=this;return j(this,function(e){return this.displayedLayerid=(new x).uuid,this.view=i,"2d"===this.view.type?(this.polygonsymbol={type:"simple-fill",color:[255,255,255,.6],style:"solid",outline:{color:[255,255,0,.8],width:2}},this.polylinesymbol={type:"simple-line",color:[255,255,255,.6],width:"4px",style:"solid"},this.marksymbol={type:"simple-marker",style:"circle",color:[255,255,0,.6],size:"24px",outline:{color:[255,255,0,.8],width:2}}):(this.polygonsymbol={type:"polygon-3d",symbolLayers:[{type:"extrude",castShadows:!1,size:100,material:{color:[255,255,255,.4]},edges:{type:"solid",color:[50,50,50,.5]}}]},this.polylinesymbol={type:"line-3d",symbolLayers:[{type:"path",anchor:"center",Values:"center",profile:"quad",width:2,height:10,material:{color:[255,255,255,.4]},cap:"square",join:"miter",castShadows:!1,profileRotation:"heading"}]},this.marksymbol={type:"point-3d",symbolLayers:[{type:"object",width:20,height:20,depth:20,resource:{primitive:"sphere"},material:{color:[0,0,255,.8]}}],verticalOffset:{screenLength:60,maxWorldLength:1e3,minWorldLength:20},callout:{type:"line",size:1.5,color:"white",border:{color:"black"}}}),this.view.on(k.click,function(e){t.view.hitTest(e).then(function(e){return F(t,void 0,void 0,function(){return j(this,function(e){return[2]})})})}),this.view.on(k.pointermove,function(e){t.view.hitTest(e).then(function(e){return F(t,void 0,void 0,function(){return j(this,function(e){return[2]})})})}),[2]})})},W);function W(e){var t=_.call(this)||this;return t.marksymbol=null,t.polylinesymbol=null,t.polygonsymbol=null,t.displayedLayerid="",t.view=null,t.drawtool=null,t.drawlayerscollection=[],t.init(e),t}var G,T,H=(G=function(e,t){return(G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}G(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Z=function(e,a,l,s){return new(l=l||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,o)}n((s=s.apply(e,a||[])).next())})},D=function(i,r){var o,n,a,e,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,n&&(a=2&t[0]?n.return:t[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,t[1])).done)return a;switch(n=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,n=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){l.label=t[1];break}if(6===t[0]&&l.label<a[1]){l.label=a[1],a=t;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(t);break}a[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(i,l)}catch(e){t=[6,e],n=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},q=(H(J,T=e),J.prototype.add=function(a){var l=this;L(["esri/layers/echartsLayer"]).then(function(e){var t=e[0],i=document.getElementsByClassName("esri-view-surface")[0],r=document.getElementById(l.displayedLayerid);null!==r&&i.removeChild(r);var o=[];l.datas=a.datas,a.datas.forEach(function(e,t){o.push({name:"Top10",type:"effectScatter",coordinateSystem:"arcgis",zlevel:2,showEffectOn:"render",rippleEffect:{brushType:"stroke"},legendHoverLink:!0,hoverAnimation:!0,symbol:null==e.symbol||void 0===e.symbol?"diamond":e.symbol,cursor:"pointer",label:{normal:{show:!0,position:null==e.labelposition||void 0===e.labelposition?"right":e.labelposition,formatter:"{b}"}},tooltip:{padding:10,backgroundColor:"#222",borderColor:"#777",borderWidth:1},symbolSize:function(e){return e[2]/8},itemStyle:{normal:{color:e.color,shadowBlur:10,shadowColor:"#333"}},data:[{name:e.name,value:[e.x,e.y].concat([e.value])}]})});var n={title:{text:"",subtext:"",left:"center",textStyle:{color:"#fff"}},series:o};new t(l.view,"",l.displayedLayerid).setChartOption(n)})},J.prototype.update=function(a){var l=this;L(["esri/layers/echartsLayer"]).then(function(e){var t=e[0],i=document.getElementsByClassName("esri-view-surface")[0],r=document.getElementById(l.displayedLayerid);null!==r&&i.removeChild(r);var o=[];l.datas=a.datas,a.datas.forEach(function(e,t){o.push({name:"Top10",type:"effectScatter",coordinateSystem:"arcgis",zlevel:2,showEffectOn:"render",rippleEffect:{brushType:"stroke"},legendHoverLink:!0,hoverAnimation:!0,symbol:null==e.symbol||void 0===e.symbol?"diamond":e.symbol,cursor:"pointer",label:{normal:{show:!0,position:null==e.labelposition||void 0===e.labelposition?"right":e.labelposition,formatter:"{b}"}},tooltip:{padding:10,backgroundColor:"#222",borderColor:"#777",borderWidth:1},symbolSize:function(e){return e[2]/8},itemStyle:{normal:{color:e.color,shadowBlur:10,shadowColor:"#333"}},data:[{name:e.name,value:[e.x,e.y].concat([e.value])}]})});var n={title:{text:"",subtext:"",left:"center",textStyle:{color:"#fff"}},series:o};new t(l.view,"",l.displayedLayerid).setChartOption(n)})},J.prototype.delete=function(){var e=document.getElementsByClassName("esri-view-surface")[0],t=document.getElementById(this.displayedLayerid);null!==t&&e.removeChild(t)},J.prototype.init=function(t){return Z(this,void 0,void 0,function(){var s=this;return D(this,function(e){return this.view=t,this.displayedLayerid=(new x).uuid,L(["esri/geometry/Point","esri/geometry/SpatialReference","esri/geometry/support/webMercatorUtils"]).then(function(e){var a=e[0],l=e[1];e[2],s.view.on(k.click,function(r){if(s.datas.length){var i=s.datas.map(function(e){var t=new a({x:e.x,y:e.y,spatialReference:l.WebMercator}),i=s.view.toScreen(t);return Math.sqrt((i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y))}),o=0;i.forEach(function(e,t){e<i[o]&&(o=t)}),35<i[o]||s.emit(k.click,s.datas[o],r.mapPoint)}}),s.view.on(k.doubleclick,function(r){if(s.datas.length){var i=s.datas.map(function(e){var t=new a({x:e.x,y:e.y,spatialReference:l.WebMercator}),i=s.view.toScreen(t);return Math.sqrt((i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y))}),o=0;i.forEach(function(e,t){e<i[o]&&(o=t)}),35<i[o]||s.emit(k.doubleclick,s.datas[o],r.mapPoint)}}),s.view.on(k.pointermove,function(n){s.view.hitTest(n).then(function(t){return Z(s,void 0,void 0,function(){var i,r,o=this;return D(this,function(e){if(0<t.results.length&&t.results[0].graphic.layer.id===this.displayedLayerid){if(!this.datas.length)return[2];if(i=this.datas.map(function(e){var t=new a({x:e.x,y:e.y,spatialReference:l.WebMercator}),i=o.view.toScreen(t);return Math.sqrt((i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y))}),r=0,i.forEach(function(e,t){e<i[r]&&(r=t)}),35<i[r])return[2];this.emit(k.pointermove,this.datas[r],this.view.toMap({x:n.x,y:n.y}))}return[2]})})})})}),[2]})})},J);function J(e){var t=T.call(this)||this;return t.displayedLayerid="",t.view=null,t.datas=null,t.init(e),t}var N,X,Y=(N=function(e,t){return(N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}N(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),V=function(e,a,l,s){return new(l=l||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,o)}n((s=s.apply(e,a||[])).next())})},U=function(i,r){var o,n,a,e,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,n&&(a=2&t[0]?n.return:t[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,t[1])).done)return a;switch(n=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,n=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){l.label=t[1];break}if(6===t[0]&&l.label<a[1]){l.label=a[1],a=t;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(t);break}a[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(i,l)}catch(e){t=[6,e],n=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},Q=(Y($,X=e),$.prototype.createFeatureGroup=function(v){var h=this,e=this.view.map.findLayerById(this.displayedLayerid);e&&(this.view.map.remove(e),this.mapoverlayersflayer=[]),L(["esri/layers/FeatureLayer","esri/layers/support/LabelClass","esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol"]).then(function(e){var t=e[0],i=e[1],r=e[2],o=e[3];if(e[4],"group"===v.type){var n,a=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}];if(a.push({name:"style",alias:"样式",type:"string"}),v.datafiled.forEach(function(e){a.push(e)}),"marker"===v.overlaytype.toLowerCase()){v.renderer?n=v.renderer:(n={type:"unique-value",field:"style",uniqueValueInfos:[]},v.style.forEach(function(e){"3d"===h.view.type?n.uniqueValueInfos.push({value:e.style,label:e.style,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:e.size.height,resource:{href:e.url}}]}}):n.uniqueValueInfos.push({value:e.style,label:e.style,symbol:{type:"picture-marker",url:e.url,width:e.size.width,height:e.size.height}})}));var l=new t({id:h.displayedLayerid,title:h.displayedLayerid,objectIdField:"objectId",geometryType:"point",renderer:n,screenSizePerspectiveEnabled:"3d"===h.view.type,popupEnabled:!1,popupTemplate:!1,fields:a,source:[],spatialReference:h.view.spatialReference});if(v.elevationInfo&&(l.elevationInfo=v.elevationInfo),h.view.map.add(l),v.overlayers.forEach(function(e){if(e.attributes&&e.position){e.attributes.uuid=e.uuid;var t=new r({geometry:new o({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:h.view.spatialReference}),attributes:e.attributes});l.source.add(t),h.mapoverlayersflayer.push([v.uuid,e.uuid,t])}}),100<l.source.items.length&&null!=v.frreduction&&(l.featureReduction={type:v.frreduction.type,clusterRadius:v.frreduction.clusterRadius}),v.label.visible){var s=void 0;if(v.label.labelingInfo)s=v.label.labelingInfo,l.labelingInfo=s;else{var d=new i({labelExpressionInfo:{expression:"$feature.NAME"},symbol:s="2d"===h.view.type?{type:v.label.type,text:v.label.text,color:v.label.color,angle:v.label.angle,backgroundColor:v.label.backgroundColor,borderLineColor:v.label.borderLineColor,borderLineSize:v.label.borderLineSize,kerning:v.label.kerning,lineHeight:v.label.lineHeight,lineWidth:v.label.lineWidth,rotated:v.label.rotated,haloColor:v.label.haloColor,haloSize:v.label.haloSize,xoffset:v.label.xoffset,yoffset:v.label.yoffset,verticalAlignment:v.label.verticalAlignment,horizontalAlignment:v.label.horizontalAlignment,font:{size:v.label.size,family:"Josefin Slab",weight:v.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:v.label.color},size:v.label.size,halo:{color:v.label.haloColor,size:v.label.haloSize}}]},labelPlacement:v.label.placement,minScale:v.label.minScale,maxScale:v.label.maxScale});l.labelingInfo=[d]}}}}else if("element"===v.type&&"marker"===v.overlaytype.toLowerCase()){var y=void 0;y=v.renderer?v.renderer:"3d"===h.view.type?{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:v.icon.size.width,resource:{href:v.icon.image}}]}}:{type:"simple",symbol:{type:"picture-marker",url:v.icon.image,width:v.icon.size.width,height:v.icon.size.height}};var c=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}];Object.keys(v.attributes).forEach(function(e){c.push({name:e,alias:e,type:"string"})});var p=new t({id:h.displayedLayerid,title:h.displayedLayerid,objectIdField:"objectId",geometryType:"point",renderer:y,screenSizePerspectiveEnabled:!0,popupEnabled:!1,popupTemplate:!1,fields:c,source:[],spatialReference:h.view.spatialReference});if(v.elevationInfo&&(p.elevationInfo=v.elevationInfo),v.position&&v.attributes){var u=v.attributes;u.uuid=v.uuid;var f=new r({geometry:new o({x:v.position[0],y:v.position[1],z:void 0===v.position[2]?0:v.position[2],spatialReference:h.view.spatialReference}),attributes:u});p.source.add(f),h.mapoverlayersflayer.push([v.uuid,v.uuid,f])}h.view.map.add(p),v.label.visible&&(s=void 0,v.label.labelingInfo?(s=v.label.labelingInfo,p.labelingInfo=s):(d=new i({labelExpressionInfo:{expression:"$feature.NAME"},symbol:s="2d"===h.view.type?{type:v.label.type,text:v.label.text,color:v.label.color,angle:v.label.angle,backgroundColor:v.label.backgroundColor,borderLineColor:v.label.borderLineColor,borderLineSize:v.label.borderLineSize,kerning:v.label.kerning,lineHeight:v.label.lineHeight,lineWidth:v.label.lineWidth,rotated:v.label.rotated,haloColor:v.label.haloColor,haloSize:v.label.haloSize,xoffset:v.label.xoffset,yoffset:v.label.yoffset,verticalAlignment:v.label.verticalAlignment,horizontalAlignment:v.label.horizontalAlignment,font:{size:v.label.size,family:"Josefin Slab",weight:v.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:v.label.color},size:v.label.size,halo:{color:v.label.haloColor,size:v.label.haloSize}}]},labelPlacement:v.label.placement,minScale:v.label.minScale,maxScale:v.label.maxScale}),p.labelingInfo=[d]))}})},$.prototype.addfeature=function(l){var s=this;L(["esri/layers/FeatureLayer","esri/layers/support/LabelClass","esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol"]).then(function(e){e[0],e[1];var r=e[2],o=e[3],t=(e[4],s.view.map.findLayerById(s.displayedLayerid));if(t)if(l instanceof Array){var n=[];l.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var t=e.attributes;t.uuid=e.uuid;var i=new r({geometry:new o({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:s.view.spatialReference}),attributes:t});n.push(i),s.mapoverlayersflayer.push([e.uuid,e.uuid,i])}}),t.applyEdits({addFeatures:n}).then(function(e){})}else if("marker"===l.overlaytype.toLowerCase()){var i=l.attributes;i.uuid=l.uuid;var a=new r({geometry:new o({x:l.position[0],y:l.position[1],z:void 0===l.position[2]?0:l.position[2],spatialReference:s.view.spatialReference}),attributes:i});t.applyEdits({addFeatures:[a]}).then(function(e){}),s.mapoverlayersflayer.push([l.uuid,l.uuid,a])}})},$.prototype.updatefeature=function(a){var l=this;L(["esri/layers/FeatureLayer","esri/layers/support/LabelClass","esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){e[0],e[1],e[2];var o=e[3];if(e[4],e[5],e[6],l.view.map.findLayerById(l.displayedLayerid))if(a instanceof Array){var r=[];a.forEach(function(t){var i=l.mapoverlayersflayer.filter(function(e){return e[1]===t.uuid});if(1===i.length){var e=new o({x:t.position[0],y:t.position[1],z:void 0===t.position[2]?0:t.position[2],spatialReference:l.view.spatialReference});i[0][2].geometry=e,Object.keys(t.attributes).map(function(e){"objectId"!==e&&i[0][2].setAttribute(e,t.attributes[e])}),r.push(i[0][2])}}),(t=l.view.map.findLayerById(l.displayedLayerid))&&r.length&&t.applyEdits({updateFeatures:r}).then(function(e){})}else if("group"===a.type){var t,n=[];a.overlayers.forEach(function(t){var i=l.mapoverlayersflayer.filter(function(e){return e[1]===t.uuid});if(1===i.length){var e=new o({x:t.position[0],y:t.position[1],z:void 0===t.position[2]?0:t.position[2],spatialReference:l.view.spatialReference});i[0][2].geometry=e,Object.keys(t.attributes).map(function(e){"objectId"!==e&&i[0][2].setAttribute(e,t.attributes[e])}),n.push(i[0][2])}}),(t=l.view.map.findLayerById(l.displayedLayerid))&&n.length&&t.applyEdits({updateFeatures:n}).then(function(e){})}else"element"===a.type&&l.mapoverlayersflayer.filter(function(e){return e[1]===a.uuid}).forEach(function(t){var e=[];a.attributes.uuid=a.uuid;var i=new o({x:a.position[0],y:a.position[1],z:void 0===a.position[2]?0:a.position[2],spatialReference:l.view.spatialReference});t[2].geometry=i,Object.keys(a.attributes).map(function(e){"objectId"!==e&&t[2].setAttribute(e,a.attributes[e])}),e.push(t[2]);var r=l.view.map.findLayerById(l.displayedLayerid);r&&e.length&&r.applyEdits({updateFeatures:e}).then(function(e){})})})},$.prototype.removefeature=function(t){var e=this;if(this.view.map.findLayerById(this.displayedLayerid))if(t instanceof Array){var i=[];t.forEach(function(t){e.mapoverlayersflayer.filter(function(e){return e[1]===t.uuid}).forEach(function(e){i.push(e[2])}),e.mapoverlayersflayer=e.mapoverlayersflayer.filter(function(e){return e[1]!==t.uuid})}),(n=this.view.map.findLayerById(this.displayedLayerid))&&i.length&&n.applyEdits({deleteFeatures:i}).then(function(e){})}else if("group"===t.type){var r=this.mapoverlayersflayer.filter(function(e){return e[0]===t.uuid}),o=[];r.forEach(function(e){o.push(e[2])}),(n=this.view.map.findLayerById(this.displayedLayerid))&&o.length&&n.applyEdits({deleteFeatures:o}).then(function(e){}),this.mapoverlayersflayer=this.mapoverlayersflayer.filter(function(e){return e[0]!==t.uuid})}else if("element"===t.type){r=this.mapoverlayersflayer.filter(function(e){return e[1]===t.uuid});var n,a=[];r.forEach(function(e){a.push(e[2])}),(n=this.view.map.findLayerById(this.displayedLayerid))&&a.length&&n.applyEdits({deleteFeatures:a}).then(function(e){}),this.mapoverlayersflayer=this.mapoverlayersflayer.filter(function(e){return e[1]!==t.uuid})}},$.prototype.removeAll=function(){var t=this,e=this.view.map.findLayerById(this.displayedLayerid);if(e){var i=[];this.mapoverlayersflayer.forEach(function(e){i.push(e[2])}),e.applyEdits({deleteFeatures:i}).then(function(e){t.mapoverlayersflayer=[]})}},$.prototype.delete=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(this.view.map.remove(e),this.mapoverlayersflayer=[])},$.prototype.show=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!0)},$.prototype.hide=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!1)},$.prototype.init=function(i){return V(this,void 0,void 0,function(){var t=this;return U(this,function(e){return this.displayedLayerid=(new x).uuid,this.view=i,this.view.on(k.click,function(n){t.view.hitTest(n).then(function(o){return V(t,void 0,void 0,function(){var t,i,r=this;return U(this,function(e){return 0<o.results.length&&o.results[0].graphic.layer.id===this.displayedLayerid&&(t=o.results[0].graphic.attributes.objectId,(i=o.results[0].graphic.layer.createQuery()).where="objectId ="+t,o.results[0].graphic.layer.queryFeatures(i).then(function(e){0<e.features.length&&r.emit(k.click,e.features,n,n.mapPoint)})),[2]})})})}),this.view.on(k.pointermove,function(a){t.view.hitTest(a).then(function(n){return V(t,void 0,void 0,function(){var t,i,r,o=this;return U(this,function(e){if(0<n.results.length)n.results[0].graphic.layer.id===this.displayedLayerid&&(t=n.results[0].graphic.attributes.objectId,(i=n.results[0].graphic.layer.createQuery()).where="objectId ="+t,n.results[0].graphic.layer.queryFeatures(i).then(function(e){0<e.features.length&&(o.eventResult=e.features,o.emit(k.pointermove,e.features,a,o.view.toMap({x:a.x,y:a.y})))}));else{if(null===this.eventResult)return[2];r=this.eventResult,this.eventResult=null,this.emit(k.pointerleave,r,a,this.view.toMap({x:a.x,y:a.y}))}return[2]})})})}),[2]})})},$);function $(e){var t=X.call(this)||this;return t.displayedLayerid="",t.view=null,t.mapoverlayersflayer=[],t.eventResult=null,t.init(e),t}var K,ee,te=(K=function(e,t){return(K=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}K(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ie=function(e,a,l,s){return new(l=l||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,o)}n((s=s.apply(e,a||[])).next())})},re=function(i,r){var o,n,a,e,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,n&&(a=2&t[0]?n.return:t[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,t[1])).done)return a;switch(n=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,n=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){l.label=t[1];break}if(6===t[0]&&l.label<a[1]){l.label=a[1],a=t;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(t);break}a[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(i,l)}catch(e){t=[6,e],n=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},oe=(te(ne,ee=e),ne.prototype.add=function(o){var n=this;L(["smiapi/utils/FlashPoint3DLayer","esri/geometry/Point","esri/views/3d/externalRenderers"]).then(function(e){var t=e[0],i=e[1],r=e[2];n.falshpoint3DRenderer=new t({nring:o.nring,spead:o.spead,size:o.size,color:o.color,view:o.view,points:o.points},function(e){var t=null;null!=e&&(t=new i({x:e.x,y:e.y,spatialReference:{wkid:102100}})),n.emit(k.click,e,t)},function(e){var t=null;null!=e&&(t=new i({x:e.x,y:e.y,spatialReference:{wkid:102100}})),n.emit(k.pointermove,e,t)}),r.add(n.view,n.falshpoint3DRenderer)})},ne.prototype.remove=function(){var t=this;L(["esri/views/3d/externalRenderers"]).then(function(e){e[0].remove(t.view,t.falshpoint3DRenderer)})},ne.prototype.init=function(t){return ie(this,void 0,void 0,function(){return re(this,function(e){return this.view=t,[2]})})},ne);function ne(e){var t=ee.call(this)||this;return t.view=null,t.falshpoint3DRenderer=null,t.init(e),t}var ae,le,se=(ae=function(e,t){return(ae=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}ae(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),de=function(e,a,l,s){return new(l=l||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,o)}n((s=s.apply(e,a||[])).next())})},ye=function(i,r){var o,n,a,e,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,n&&(a=2&t[0]?n.return:t[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,t[1])).done)return a;switch(n=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,n=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){l.label=t[1];break}if(6===t[0]&&l.label<a[1]){l.label=a[1],a=t;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(t);break}a[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(i,l)}catch(e){t=[6,e],n=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},ce=(se(pe,le=e),pe.prototype.add=function(R){var C=this;L(["esri/Graphic","esri/geometry/Point","esri/layers/GraphicsLayer","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){var g=e[0],L=e[1],t=e[2],x=(e[3],e[4]),k=e[5],i=C.view.map.findLayerById(C.displayedLayerid);if(i||(i=new t({id:C.displayedLayerid,title:C.displayedLayerid}),C.view.map.add(i)),R instanceof Array)R.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var t=void 0;t=e.symbol?e.symbol:"2d"===C.view.type?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]};var i=e.attributes;i.uuid=e.uuid;var r=new g({geometry:new L({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:C.view.spatialReference}),symbol:t,attributes:i});if(C.mapoverlayers.push(["smap-default",e.uuid,r]),(h=C.view.map.findLayerById(C.displayedLayerid))&&h.add(r),e.label.visible){var o=null;o=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}};var n=new g({geometry:new L({x:"3d"===C.view.type?e.position[0]+e.label.xoffset:e.position[0],y:"3d"===C.view.type?e.position[1]+e.label.yoffset:e.position[1],z:"3d"===C.view.type?e.position[2]+e.label.zoffset:e.position[2],spatialReference:C.view.spatialReference}),symbol:o,attributes:i});(b=C.view.map.findLayerById(C.displayedLayerid))&&b.add(n),C.mapoverlayers.push(["smap-default",e.uuid,n])}}else if("polyline"===e.overlaytype.toLowerCase()){var a=null;a=e.symbol?e.symbol:{type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin};var l=[];e.path.forEach(function(e){l.push([e.X,e.Y,e.Z])});var s=new x({hasZ:!1,hasM:!1,paths:l,spatialReference:C.view.spatialReference}),d=e.attributes;d.uuid=e.uuid;var y=new g({geometry:s,symbol:a,attributes:d});if(C.mapoverlayers.push(["smap-default",e.uuid,y]),(h=C.view.map.findLayerById(C.displayedLayerid))&&h.add(y),e.label.visible){var c=null;c=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},n=new g({geometry:y.geometry.extent.center,symbol:c,attributes:d}),(b=C.view.map.findLayerById(C.displayedLayerid))&&b.add(n),C.mapoverlayers.push(["smap-default",e.uuid,n])}}else if("polygon"===e.overlaytype.toLowerCase()){var p=void 0;p=e.symbol?e.symbol:"simple"===e.symboltype?{type:"simple-fill",color:e.fillColor,style:e.style,outline:{color:e.strokeColor,width:e.strokeWeight,style:e.strokestyle}}:{type:"picture-fill",url:e.url,width:e.picwidth,height:e.picheight,outline:{style:e.strokestyle,color:e.strokeColor,width:e.strokeWeight}};var u=[];e.paths.forEach(function(e){u.push([e.X,e.Y,e.Z])});var f=new k({hasZ:!0,hasM:!0,rings:u,spatialReference:C.view.spatialReference}),v=e.attributes;v.uuid=e.uuid;var h,m=new g({geometry:f,symbol:p,attributes:v});if(C.mapoverlayers.push(["smap-default",e.uuid,m]),(h=C.view.map.findLayerById(C.displayedLayerid))&&h.add(m),e.label.visible){var b,w=null;w=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},n=new g({geometry:m.geometry.extent.center,symbol:w,attributes:v}),(b=C.view.map.findLayerById(C.displayedLayerid))&&b.add(n),C.mapoverlayers.push(["smap-default",e.uuid,n])}}});else if("group"===R.type)R.overlayers.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var t=void 0;t=e.symbol?e.symbol:"2d"===C.view.type?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]};var i=e.attributes;i.uuid=e.uuid;var r=new g({geometry:new L({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:C.view.spatialReference}),symbol:t,attributes:i});if(C.mapoverlayers.push([R.uuid,e.uuid,r]),(v=C.view.map.findLayerById(C.displayedLayerid))&&v.add(r),e.label.visible){var o=null;o=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}};var n=new g({geometry:new L({x:"3d"===C.view.type?e.position[0]+e.label.xoffset:e.position[0],y:"3d"===C.view.type?e.position[1]+e.label.yoffset:e.position[1],z:"3d"===C.view.type?e.position[2]+e.label.zoffset:e.position[2],spatialReference:C.view.spatialReference}),symbol:o,attributes:i});(b=C.view.map.findLayerById(C.displayedLayerid))&&b.add(n),C.mapoverlayers.push([R.uuid,e.uuid,n])}}else if("polyline"===e.overlaytype.toLowerCase()){var a=null;a=e.symbol?e.symbol:{type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin};var l=[];e.path.forEach(function(e){l.push([e.X,e.Y,e.Z])});var s=new x({hasZ:!1,hasM:!1,paths:l,spatialReference:C.view.spatialReference}),d=e.attributes;d.uuid=e.uuid;var y=new g({geometry:s,symbol:a,attributes:d});if(C.mapoverlayers.push([R.uuid,e.uuid,y]),(b=C.view.map.findLayerById(C.displayedLayerid))&&b.add(y),e.label.visible){var c=null;c=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},n=new g({geometry:y.geometry.extent.center,symbol:c,attributes:d}),(v=C.view.map.findLayerById(C.displayedLayerid))&&v.add(n),C.mapoverlayers.push([R.uuid,e.uuid,n])}}else if("polygon"===e.overlaytype.toLowerCase()){var p=void 0;p=e.symbol?e.symbol:"simple"===e.symboltype?{type:"simple-fill",color:e.fillColor,style:e.style,outline:{color:e.strokeColor,width:e.strokeWeight,style:e.strokestyle}}:{type:"picture-fill",url:e.url,width:e.picwidth,height:e.picheight,outline:{style:e.strokestyle,color:e.strokeColor,width:e.strokeWeight}};var u=[];e.paths.forEach(function(e){u.push([e.X,e.Y,e.Z])});var f=e.attributes;f.uuid=e.uuid;var v,h=new k({hasZ:!0,hasM:!0,rings:u,spatialReference:C.view.spatialReference}),m=new g({geometry:h,symbol:p,attributes:f});if(C.mapoverlayers.push([R.uuid,e.uuid,m]),(v=C.view.map.findLayerById(C.displayedLayerid))&&v.add(m),e.label.visible){var b,w=null;w=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},n=new g({geometry:m.geometry.extent.center,symbol:w,attributes:f}),(b=C.view.map.findLayerById(C.displayedLayerid))&&b.add(n),C.mapoverlayers.push([R.uuid,e.uuid,n])}}});else if("element"===R.type)if("marker"===R.overlaytype.toLowerCase()){var r=void 0;r=R.symbol?R.symbol:"2d"===C.view.type?{type:"picture-marker",url:R.icon.image,width:R.icon.size.width,height:R.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:R.icon.size.width,resource:{href:R.icon.image}}]};var o=R.attributes;o.uuid=R.uuid;var n=new g({geometry:new L({x:R.position[0],y:R.position[1],z:void 0===R.position[2]?0:R.position[2],spatialReference:C.view.spatialReference}),symbol:r,attributes:o});if(C.mapoverlayers.push(["smap-default",R.uuid,n]),(m=C.view.map.findLayerById(C.displayedLayerid))&&m.add(n),R.label.visible){var a=null;a=R.label.labelingInfo?R.label.labelingInfo:{type:R.label.type,text:R.label.text,color:R.label.color,angle:R.label.angle,backgroundColor:R.label.backgroundColor,borderLineColor:R.label.borderLineColor,borderLineSize:R.label.borderLineSize,kerning:R.label.kerning,lineHeight:R.label.lineHeight,lineWidth:R.label.lineWidth,rotated:R.label.rotated,haloColor:R.label.haloColor,haloSize:R.label.haloSize,xoffset:R.label.xoffset,yoffset:R.label.yoffset,verticalAlignment:R.label.verticalAlignment,horizontalAlignment:R.label.horizontalAlignment,font:{size:R.label.size,family:"Josefin Slab",weight:R.label.weight}};var l=new g({geometry:new L({x:"3d"===C.view.type?R.position[0]+R.label.xoffset:R.position[0],y:"3d"===C.view.type?R.position[1]+R.label.yoffset:R.position[1],z:"3d"===C.view.type?R.position[2]+R.label.zoffset:R.position[2],spatialReference:C.view.spatialReference}),symbol:a,attributes:o});(b=C.view.map.findLayerById(C.displayedLayerid))&&b.add(l),C.mapoverlayers.push(["smap-default",R.uuid,l])}}else if("polyline"===R.overlaytype.toLowerCase()){var s=null;s=R.symbol?R.symbol:{type:"simple-line",color:R.strokeColor,style:R.style,width:R.width,cap:R.cap,join:R.lineJoin};var d=[];R.path.forEach(function(e){d.push([e.X,e.Y,e.Z])});var y=new x({hasZ:!1,hasM:!1,paths:d,spatialReference:C.view.spatialReference}),c=R.attributes;c.uuid=R.uuid;var p=new g({geometry:y,symbol:s,attributes:c});if(C.mapoverlayers.push(["smap-default",R.uuid,p]),(b=C.view.map.findLayerById(C.displayedLayerid))&&b.add(p),R.label.visible){var u=null;u=R.label.labelingInfo?R.label.labelingInfo:{type:R.label.type,text:R.label.text,color:R.label.color,angle:R.label.angle,backgroundColor:R.label.backgroundColor,borderLineColor:R.label.borderLineColor,borderLineSize:R.label.borderLineSize,kerning:R.label.kerning,lineHeight:R.label.lineHeight,lineWidth:R.label.lineWidth,rotated:R.label.rotated,haloColor:R.label.haloColor,haloSize:R.label.haloSize,xoffset:R.label.xoffset,yoffset:R.label.yoffset,verticalAlignment:R.label.verticalAlignment,horizontalAlignment:R.label.horizontalAlignment,font:{size:R.label.size,family:"Josefin Slab",weight:R.label.weight}},l=new g({geometry:p.geometry.extent.center,symbol:u,attributes:c}),(m=C.view.map.findLayerById(C.displayedLayerid))&&m.add(l),C.mapoverlayers.push(["smap-default",R.uuid,l])}}else if("polygon"===R.overlaytype.toLowerCase()){var f=void 0;f=R.symbol?R.symbol:"simple"===R.symboltype?{type:"simple-fill",color:R.fillColor,style:R.style,outline:{color:R.strokeColor,width:R.strokeWeight,style:R.strokestyle}}:{type:"picture-fill",url:R.url,width:R.picwidth,height:R.picheight,outline:{style:R.strokestyle,color:R.strokeColor,width:R.strokeWeight}};var v=[];R.paths.forEach(function(e){v.push([e.X,e.Y,e.Z])});var h=R.attributes;h.uuid=R.uuid;var m,b,w=new k({hasZ:!0,hasM:!0,rings:v,spatialReference:C.view.spatialReference}),z=new g({geometry:w,symbol:f,attributes:h});if(C.mapoverlayers.push(["smap-default",R.uuid,z]),(m=C.view.map.findLayerById(C.displayedLayerid))&&m.add(z),R.label.visible)u=null,u=R.label.labelingInfo?R.label.labelingInfo:{type:R.label.type,text:R.label.text,color:R.label.color,angle:R.label.angle,backgroundColor:R.label.backgroundColor,borderLineColor:R.label.borderLineColor,borderLineSize:R.label.borderLineSize,kerning:R.label.kerning,lineHeight:R.label.lineHeight,lineWidth:R.label.lineWidth,rotated:R.label.rotated,haloColor:R.label.haloColor,haloSize:R.label.haloSize,xoffset:R.label.xoffset,yoffset:R.label.yoffset,verticalAlignment:R.label.verticalAlignment,horizontalAlignment:R.label.horizontalAlignment,font:{size:R.label.size,family:"Josefin Slab",weight:R.label.weight}},l=new g({geometry:z.geometry.extent.center,symbol:u,attributes:h}),(b=C.view.map.findLayerById(C.displayedLayerid))&&b.add(l),C.mapoverlayers.push(["smap-default",R.uuid,l])}}).catch(function(e){console.error(e)})},pe.prototype.remove=function(t){var i=this;t instanceof Array?t.forEach(function(t){i.mapoverlayers.filter(function(e){return e[1]===t.uuid}).forEach(function(e){var t=i.view.map.findLayerById(i.displayedLayerid);t&&t.remove(e[2])}),i.mapoverlayers=i.mapoverlayers.filter(function(e){return e[1]!==t.uuid})}):"group"===t.type?(this.mapoverlayers.filter(function(e){return e[0]===t.uuid}).forEach(function(e){var t=i.view.map.findLayerById(i.displayedLayerid);t&&t.remove(e[2])}),this.mapoverlayers=this.mapoverlayers.filter(function(e){return e[0]!==t.uuid})):"element"===t.type&&(this.mapoverlayers.filter(function(e){return e[1]===t.uuid}).forEach(function(e){var t=i.view.map.findLayerById(i.displayedLayerid);t&&t.remove(e[2])}),this.mapoverlayers=this.mapoverlayers.filter(function(e){return e[1]!==t.uuid}))},pe.prototype.update=function(z){var R=this;L(["esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){var g=e[0],L=e[1],x=(e[2],e[3]),k=e[4];if(z instanceof Array)z.forEach(function(t){if(R.mapoverlayers.filter(function(e){return e[1]===t.uuid}).forEach(function(e){var t=R.view.map.findLayerById(R.displayedLayerid);t&&t.remove(e[2])}),R.mapoverlayers=R.mapoverlayers.filter(function(e){return e[1]!==t.uuid}),"marker"===t.overlaytype.toLowerCase()){var e=void 0;e=t.symbol?t.symbol:"2d"===R.view.type?{type:"picture-marker",url:t.icon.image,width:t.icon.size.width,height:t.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:t.icon.size.width,resource:{href:t.icon.image}}]};var i=t.attributes;i.uuid=t.uuid;var r=new g({geometry:new L({x:t.position[0],y:t.position[1],z:void 0===t.position[2]?0:t.position[2],spatialReference:R.view.spatialReference}),symbol:e,attributes:i});if(R.mapoverlayers.push(["smap-default",t.uuid,r]),(h=R.view.map.findLayerById(R.displayedLayerid))&&h.add(r),t.label.visible){var o=null;o=t.label.labelingInfo?t.label.labelingInfo:{type:t.label.type,text:t.label.text,color:t.label.color,angle:t.label.angle,backgroundColor:t.label.backgroundColor,borderLineColor:t.label.borderLineColor,borderLineSize:t.label.borderLineSize,kerning:t.label.kerning,lineHeight:t.label.lineHeight,lineWidth:t.label.lineWidth,rotated:t.label.rotated,haloColor:t.label.haloColor,haloSize:t.label.haloSize,xoffset:t.label.xoffset,yoffset:t.label.yoffset,verticalAlignment:t.label.verticalAlignment,horizontalAlignment:t.label.horizontalAlignment,font:{size:t.label.size,family:"Josefin Slab",weight:t.label.weight}};var n=new g({geometry:new L({x:"3d"===R.view.type?t.position[0]+t.label.xoffset:t.position[0],y:"3d"===R.view.type?t.position[1]+t.label.yoffset:t.position[1],z:"3d"===R.view.type?t.position[2]+t.label.zoffset:t.position[2],spatialReference:R.view.spatialReference}),symbol:o,attributes:i});(b=R.view.map.findLayerById(R.displayedLayerid))&&b.add(n),R.mapoverlayers.push(["smap-default",t.uuid,n])}}else if("polyline"===t.overlaytype.toLowerCase()){var a=null;a=t.symbol?t.symbol:{type:"simple-line",color:t.strokeColor,style:t.style,width:t.width,cap:t.cap,join:t.lineJoin};var l=[];t.path.forEach(function(e){l.push([e.X,e.Y,e.Z])});var s=new x({hasZ:!1,hasM:!1,paths:l,spatialReference:R.view.spatialReference}),d=t.attributes;d.uuid=t.uuid;var y=new g({geometry:s,symbol:a,attributes:d});if(R.mapoverlayers.push(["smap-default",t.uuid,y]),(b=R.view.map.findLayerById(R.displayedLayerid))&&b.add(y),t.label.visible){var c=null;c=t.label.labelingInfo?t.label.labelingInfo:{type:t.label.type,text:t.label.text,color:t.label.color,angle:t.label.angle,backgroundColor:t.label.backgroundColor,borderLineColor:t.label.borderLineColor,borderLineSize:t.label.borderLineSize,kerning:t.label.kerning,lineHeight:t.label.lineHeight,lineWidth:t.label.lineWidth,rotated:t.label.rotated,haloColor:t.label.haloColor,haloSize:t.label.haloSize,xoffset:t.label.xoffset,yoffset:t.label.yoffset,verticalAlignment:t.label.verticalAlignment,horizontalAlignment:t.label.horizontalAlignment,font:{size:t.label.size,family:"Josefin Slab",weight:t.label.weight}},n=new g({geometry:y.geometry.extent.center,symbol:c,attributes:d}),(h=R.view.map.findLayerById(R.displayedLayerid))&&h.add(n),R.mapoverlayers.push(["smap-default",t.uuid,n])}}else if("polygon"===t.overlaytype.toLowerCase()){var p=void 0;p=t.symbol?t.symbol:"simple"===t.symboltype?{type:"simple-fill",color:t.fillColor,style:t.style,outline:{color:t.strokeColor,width:t.strokeWeight,style:t.strokestyle}}:{type:"picture-fill",url:t.url,width:t.picwidth,height:t.picheight,outline:{style:t.strokestyle,color:t.strokeColor,width:t.strokeWeight}};var u=[];t.paths.forEach(function(e){u.push([e.X,e.Y,e.Z])});var f=new k({hasZ:!0,hasM:!0,rings:u,spatialReference:R.view.spatialReference}),v=t.attributes;v.uuid=t.uuid;var h,m=new g({geometry:f,symbol:p,attributes:v});if(R.mapoverlayers.push(["smap-default",t.uuid,m]),(h=R.view.map.findLayerById(R.displayedLayerid))&&h.add(m),t.label.visible){var b,w=null;w=t.label.labelingInfo?t.label.labelingInfo:{type:t.label.type,text:t.label.text,color:t.label.color,angle:t.label.angle,backgroundColor:t.label.backgroundColor,borderLineColor:t.label.borderLineColor,borderLineSize:t.label.borderLineSize,kerning:t.label.kerning,lineHeight:t.label.lineHeight,lineWidth:t.label.lineWidth,rotated:t.label.rotated,haloColor:t.label.haloColor,haloSize:t.label.haloSize,xoffset:t.label.xoffset,yoffset:t.label.yoffset,verticalAlignment:t.label.verticalAlignment,horizontalAlignment:t.label.horizontalAlignment,font:{size:t.label.size,family:"Josefin Slab",weight:t.label.weight}},n=new g({geometry:m.geometry.extent.center,symbol:w,attributes:v}),(b=R.view.map.findLayerById(R.displayedLayerid))&&b.add(n),R.mapoverlayers.push(["smap-default",t.uuid,n])}}});else if("group"===z.type)R.mapoverlayers.filter(function(e){return e[0]===z.uuid}).forEach(function(e){var t=R.view.map.findLayerById(R.displayedLayerid);t&&t.remove(e[2])}),R.mapoverlayers=R.mapoverlayers.filter(function(e){return e[0]!==z.uuid}),z.overlayers.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var t=void 0;t=e.symbol?e.symbol:"2d"===R.view.type?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]};var i=e.attributes;i.uuid=e.uuid;var r=new g({geometry:new L({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:R.view.spatialReference}),symbol:t,attributes:i});if(R.mapoverlayers.push([z.uuid,e.uuid,r]),(v=R.view.map.findLayerById(R.displayedLayerid))&&v.add(r),e.label.visible){var o=null;o=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}};var n=new g({geometry:new L({x:"3d"===R.view.type?e.position[0]+e.label.xoffset:e.position[0],y:"3d"===R.view.type?e.position[1]+e.label.yoffset:e.position[1],z:"3d"===R.view.type?e.position[2]+e.label.zoffset:e.position[2],spatialReference:R.view.spatialReference}),symbol:o,attributes:i});(b=R.view.map.findLayerById(R.displayedLayerid))&&b.add(n),R.mapoverlayers.push([z.uuid,e.uuid,n])}}else if("polyline"===e.overlaytype.toLowerCase()){var a=null;a=e.symbol?e.symbol:{type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin};var l=[];e.path.forEach(function(e){l.push([e.X,e.Y,e.Z])});var s=new x({hasZ:!1,hasM:!1,paths:l,spatialReference:R.view.spatialReference}),d=e.attributes;d.uuid=e.uuid;var y=new g({geometry:s,symbol:a,attributes:d});if(R.mapoverlayers.push([z.uuid,e.uuid,y]),(b=R.view.map.findLayerById(R.displayedLayerid))&&b.add(y),e.label.visible){var c=null;c=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},n=new g({geometry:y.geometry.extent.center,symbol:c,attributes:d}),(v=R.view.map.findLayerById(R.displayedLayerid))&&v.add(n),R.mapoverlayers.push([z.uuid,e.uuid,n])}}else if("polygon"===e.overlaytype.toLowerCase()){var p=void 0;p=e.symbol?e.symbol:"simple"===z.symboltype?{type:"simple-fill",color:z.fillColor,style:z.style,outline:{color:z.strokeColor,width:z.strokeWeight,style:z.strokestyle}}:{type:"picture-fill",url:z.url,width:z.picwidth,height:z.picheight,outline:{style:z.strokestyle,color:z.strokeColor,width:z.strokeWeight}};var u=[];z.paths.forEach(function(e){u.push([e.X,e.Y,e.Z])});var f=e.attributes;f.uuid=e.uuid;var v,h=new k({hasZ:!0,hasM:!0,rings:u,spatialReference:R.view.spatialReference}),m=new g({geometry:h,symbol:p,attributes:f});if(R.mapoverlayers.push(["smap-default",z.uuid,m]),(v=R.view.map.findLayerById(R.displayedLayerid))&&v.add(m),z.label.visible){var b,w=null;w=e.label.labelingInfo?e.label.labelingInfo:{type:z.label.type,text:z.label.text,color:z.label.color,angle:z.label.angle,backgroundColor:z.label.backgroundColor,borderLineColor:z.label.borderLineColor,borderLineSize:z.label.borderLineSize,kerning:z.label.kerning,lineHeight:z.label.lineHeight,lineWidth:z.label.lineWidth,rotated:z.label.rotated,haloColor:z.label.haloColor,haloSize:z.label.haloSize,xoffset:z.label.xoffset,yoffset:z.label.yoffset,verticalAlignment:z.label.verticalAlignment,horizontalAlignment:z.label.horizontalAlignment,font:{size:z.label.size,family:"Josefin Slab",weight:z.label.weight}},n=new g({geometry:m.geometry.extent.center,symbol:w,attributes:f}),(b=R.view.map.findLayerById(R.displayedLayerid))&&b.add(n),R.mapoverlayers.push(["smap-default",z.uuid,n])}}});else if("element"===z.type)if(R.mapoverlayers.filter(function(e){return e[1]===z.uuid}).forEach(function(e){var t=R.view.map.findLayerById(R.displayedLayerid);t&&t.remove(e[2])}),R.mapoverlayers=R.mapoverlayers.filter(function(e){return e[1]!==z.uuid}),"marker"===z.overlaytype.toLowerCase()){var t=void 0;t=z.symbol?z.symbol:"2d"===R.view.type?{type:"picture-marker",url:z.icon.image,width:z.icon.size.width,height:z.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:z.icon.size.width,resource:{href:z.icon.image}}]};var i=z.attributes;i.uuid=z.uuid;var r=new g({geometry:new L({x:z.position[0],y:z.position[1],z:void 0===z.position[2]?0:z.position[2],spatialReference:R.view.spatialReference}),symbol:t,attributes:i});if(R.mapoverlayers.push(["smap-default",z.uuid,r]),(h=R.view.map.findLayerById(R.displayedLayerid))&&h.add(r),z.label.visible){var o=null;o=z.label.labelingInfo?z.label.labelingInfo:{type:z.label.type,text:z.label.text,color:z.label.color,angle:z.label.angle,backgroundColor:z.label.backgroundColor,borderLineColor:z.label.borderLineColor,borderLineSize:z.label.borderLineSize,kerning:z.label.kerning,lineHeight:z.label.lineHeight,lineWidth:z.label.lineWidth,rotated:z.label.rotated,haloColor:z.label.haloColor,haloSize:z.label.haloSize,xoffset:z.label.xoffset,yoffset:z.label.yoffset,verticalAlignment:z.label.verticalAlignment,horizontalAlignment:z.label.horizontalAlignment,font:{size:z.label.size,family:"Josefin Slab",weight:z.label.weight}};var n=new g({geometry:new L({x:"3d"===R.view.type?z.position[0]+z.label.xoffset:z.position[0],y:"3d"===R.view.type?z.position[1]+z.label.yoffset:z.position[1],z:"3d"===R.view.type?z.position[2]+z.label.zoffset:z.position[2],spatialReference:R.view.spatialReference}),symbol:o,attributes:i});(m=R.view.map.findLayerById(R.displayedLayerid))&&m.add(n),R.mapoverlayers.push(["smap-default",z.uuid,n])}}else if("polyline"===z.overlaytype.toLowerCase()){var a=null;a=z.symbol?z.symbol:{type:"simple-line",color:z.strokeColor,style:z.style,width:z.width,cap:z.cap,join:z.lineJoin};var l=[];z.path.forEach(function(e){l.push([e.X,e.Y,e.Z])});var s=new x({hasZ:!1,hasM:!1,paths:l,spatialReference:R.view.spatialReference}),d=z.attributes;d.uuid=z.uuid;var y=new g({geometry:s,symbol:a,attributes:d});if(R.mapoverlayers.push(["smap-default",z.uuid,y]),(m=R.view.map.findLayerById(R.displayedLayerid))&&m.add(y),z.label.visible){var c=null;c=z.label.labelingInfo?z.label.labelingInfo:{type:z.label.type,text:z.label.text,color:z.label.color,angle:z.label.angle,backgroundColor:z.label.backgroundColor,borderLineColor:z.label.borderLineColor,borderLineSize:z.label.borderLineSize,kerning:z.label.kerning,lineHeight:z.label.lineHeight,lineWidth:z.label.lineWidth,rotated:z.label.rotated,haloColor:z.label.haloColor,haloSize:z.label.haloSize,xoffset:z.label.xoffset,yoffset:z.label.yoffset,verticalAlignment:z.label.verticalAlignment,horizontalAlignment:z.label.horizontalAlignment,font:{size:z.label.size,family:"Josefin Slab",weight:z.label.weight}},n=new g({geometry:y.geometry.extent.center,symbol:c,attributes:d}),(h=R.view.map.findLayerById(R.displayedLayerid))&&h.add(n),R.mapoverlayers.push(["smap-default",z.uuid,n])}}else if("polygon"===z.overlaytype.toLowerCase()){var p=void 0;p=z.symbol?z.symbol:"simple"===z.symboltype?{type:"simple-fill",color:z.fillColor,style:z.style,outline:{color:z.strokeColor,width:z.strokeWeight,style:z.strokestyle}}:{type:"picture-fill",url:z.url,width:z.picwidth,height:z.picheight,outline:{style:z.strokestyle,color:z.strokeColor,width:z.strokeWeight}};var u=[];z.paths.forEach(function(e){u.push([e.X,e.Y,e.Z])});var f=new k({hasZ:!0,hasM:!0,rings:u,spatialReference:R.view.spatialReference}),v=z.attributes;v.uuid=z.uuid;var h,m,b=new g({geometry:f,symbol:p,attributes:v});if(R.mapoverlayers.push(["smap-default",z.uuid,b]),(h=R.view.map.findLayerById(R.displayedLayerid))&&h.add(b),z.label.visible)c=null,c=z.label.labelingInfo?z.label.labelingInfo:{type:z.label.type,text:z.label.text,color:z.label.color,angle:z.label.angle,backgroundColor:z.label.backgroundColor,borderLineColor:z.label.borderLineColor,borderLineSize:z.label.borderLineSize,kerning:z.label.kerning,lineHeight:z.label.lineHeight,lineWidth:z.label.lineWidth,rotated:z.label.rotated,haloColor:z.label.haloColor,haloSize:z.label.haloSize,xoffset:z.label.xoffset,yoffset:z.label.yoffset,verticalAlignment:z.label.verticalAlignment,horizontalAlignment:z.label.horizontalAlignment,font:{size:z.label.size,family:"Josefin Slab",weight:z.label.weight}},n=new g({geometry:b.geometry.extent.center,symbol:c,attributes:v}),(m=R.view.map.findLayerById(R.displayedLayerid))&&m.add(n),R.mapoverlayers.push(["smap-default",z.uuid,n])}})},pe.prototype.removeAll=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.removeAll(),this.mapoverlayers=[])},pe.prototype.delete=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(this.view.map.remove(e),this.mapoverlayers=[])},pe.prototype.show=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!0)},pe.prototype.hide=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!1)},pe.prototype.init=function(t){return de(this,void 0,void 0,function(){var r=this;return ye(this,function(e){return this.displayedLayerid=(new x).uuid,this.view=t,this.view.on(k.click,function(i){r.view.hitTest(i).then(function(t){return de(r,void 0,void 0,function(){return ye(this,function(e){return 0<t.results.length&&t.results[0].graphic.layer.id===this.displayedLayerid&&this.emit(k.click,t,i.mapPoint),[2]})})})}),this.view.on(k.pointermove,function(i){r.view.hitTest(i).then(function(t){return de(r,void 0,void 0,function(){return ye(this,function(e){return 0<t.results.length&&t.results[0].graphic.layer.id===this.displayedLayerid&&this.emit(k.pointermove,t,this.view.toMap({x:i.x,y:i.y})),[2]})})})}),[2]})})},pe);function pe(e){var t=le.call(this)||this;return t.displayedLayerid="",t.view=null,t.mapoverlayers=[],t.init(e),t}var ue,fe,ve=(ue=function(e,t){return(ue=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}ue(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),he=function(e,a,l,s){return new(l=l||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,o)}n((s=s.apply(e,a||[])).next())})},me=function(i,r){var o,n,a,e,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,n&&(a=2&t[0]?n.return:t[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,t[1])).done)return a;switch(n=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,n=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){l.label=t[1];break}if(6===t[0]&&l.label<a[1]){l.label=a[1],a=t;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(t);break}a[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(i,l)}catch(e){t=[6,e],n=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},be=(ve(we,fe=e),we.prototype.add=function(r){var o=this;L(["smiapi/utils/HeatMapLayer"]).then(function(e){var t=e[0],i={container:document.getElementById(r.container),radius:r.radius||30,maxOpacity:r.maxOpacity||.8,minOpacity:r.minOpacity||0,blur:r.blur||.7,gradient:r.gradient||{0:"rgb(0,0,0)",.3:"rgb(0,0,255)",.8:"rgb(0,255,0)",.98:"rgb(255,255,0)",1:"rgb(255,0,0)"}};o.heatmaplayer=new t(o.view,i,r.datas,r.h337,r.id),o.heatmaplayer.addData()})},we.prototype.remove=function(e){var t=document.getElementsByClassName("esri-view-surface")[0],i=document.getElementById(e);null!=i&&t.removeChild(i)},we.prototype.refreshdata=function(e){this.heatmaplayer.setVisible(!0),this.heatmaplayer.freshenLayerData(e)},we.prototype.show=function(){this.heatmaplayer.setVisible(!0)},we.prototype.hide=function(){this.heatmaplayer.setVisible(!1)},we.prototype.init=function(t){return he(this,void 0,void 0,function(){return me(this,function(e){return this.displayedLayerid=(new x).uuid,this.view=t,[2]})})},we);function we(e){var t=fe.call(this)||this;return t.displayedLayerid="",t.view=null,t.heatmaplayer=null,t.init(e),t}var ge=(Le.shqxboundary="qx_boundary",Le.shjdboundary="jd_boundary",Le.shjwhboundary="jwh_boundary",Le);function Le(){}var xe,ke,ze=(xe=function(e,t){return(xe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}xe(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Re=function(e,a,l,s){return new(l=l||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,o)}n((s=s.apply(e,a||[])).next())})},Ce=function(i,r){var o,n,a,e,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,n&&(a=2&t[0]?n.return:t[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,t[1])).done)return a;switch(n=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,n=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){l.label=t[1];break}if(6===t[0]&&l.label<a[1]){l.label=a[1],a=t;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(t);break}a[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(i,l)}catch(e){t=[6,e],n=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},Ie=(ze(Se,ke=e),Se.prototype.add=function(u){var f=this;L(["esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Polygon","esri/geometry/geometryEngineAsync","esri/geometry/SpatialReference","esri/Color"]).then(function(e){var d=e[0],t=e[1],i=e[2],y=e[3],c=(e[4],e[5]),r=null;"qx_boundary"!==u.boundaryType&&"jd_boundary"!==u.boundaryType&&"jwh_boundary"!==u.boundaryType||(r=f.view.map.findLayerById(u.boundaryType));var p=f.view.map.findLayerById(f.displayedLayerid);if(null==p&&(p=new t({id:f.displayedLayerid,title:"遮罩层",listMode:"hide"}),f.view.map.add(p)),p.removeAll(),u.inputgeometry){if(null===(r=f.view.map.findLayerById("qx_boundary")))return;var o=new i({rings:u.inputgeometry,spatialReference:f.view.spatialReference}),n=r.fullExtent;n.spatialReference=f.view.spatialReference;var s=o;s.spatialReference=f.view.spatialReference,y.buffer(s,u.boundarydistance,"meters").then(function(e){y.difference(n,e).then(function(e){var t;t="3d"===f.view.type?u.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:u.maskColor},size:u.symbol.size,edges:{type:"solid",color:u.maskColor}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:u.maskColor},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:u.maskColor,style:"solid",outline:{color:u.maskColor,width:1}};var i=new d({geometry:e,symbol:t});p.add(i);for(var o=void 0===u.bounarycount?30:u.bounarycount,n=Math.ceil(u.boundarydistance/o),a=new c(u.boundaryColor).toRgba(),r=function(r){y.buffer(s,r*o,"meters").then(function(t){y.buffer(s,(r-1)*o,"meters").then(function(e){y.difference(t,e).then(function(e){var t;a[3]=1/n*r,t="3d"===f.view.type?u.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:a},size:u.symbol.size,edges:{type:"solid",color:a}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:a},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:a,style:"solid",outline:{color:a,width:1}};var i=new d({geometry:e,symbol:t});p.add(i)})})})},l=1;l<=n;l++)r(l)})})}else{if(console.log(r),null===r)return;var a=r.createQuery();a.where=u.boundaryDefinition,r.queryFeatures(a).then(function(e){if(e.features.length){var t=r.fullExtent;t.spatialReference=f.view.spatialReference;var s=e.features[0].geometry;s.spatialReference=f.view.spatialReference,y.buffer(s,u.boundarydistance,"meters").then(function(e){y.difference(t,e).then(function(e){var t;t="3d"===f.view.type?u.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:u.maskColor},size:u.symbol.size,edges:{type:"solid",color:u.maskColor}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:u.maskColor},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:u.maskColor,style:"solid",outline:{color:u.maskColor,width:1}};var i=new d({geometry:e,symbol:t});p.add(i);for(var o=void 0===u.bounarycount?30:u.bounarycount,n=Math.ceil(u.boundarydistance/o),a=new c(u.boundaryColor).toRgba(),r=function(r){y.buffer(s,r*o,"meters").then(function(t){y.buffer(s,(r-1)*o,"meters").then(function(e){y.difference(t,e).then(function(e){var t;a[3]=1/n*r,t="3d"===f.view.type?u.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:a},size:u.symbol.size,edges:{type:"solid",color:a}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:a},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:a,style:"solid",outline:{color:a,width:1}};var i=new d({geometry:e,symbol:t});p.add(i)})})})},l=1;l<=n;l++)r(l)})})}})}})},Se.prototype.remove=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e)},Se.prototype.show=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!0)},Se.prototype.hide=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!1)},Se.prototype.init=function(t){return Re(this,void 0,void 0,function(){return Ce(this,function(e){return this.displayedLayerid=(new x).uuid,this.view=t,[2]})})},Se);function Se(e){var t=ke.call(this)||this;return t.displayedLayerid="",t.view=null,t.init(e),t}var Ae,Be,Ee=(Ae=function(e,t){return(Ae=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ae(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Pe=function(e,a,l,s){return new(l=l||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,o)}n((s=s.apply(e,a||[])).next())})},_e=function(i,r){var o,n,a,e,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,n&&(a=2&t[0]?n.return:t[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,t[1])).done)return a;switch(n=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,n=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){l.label=t[1];break}if(6===t[0]&&l.label<a[1]){l.label=a[1],a=t;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(t);break}a[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(i,l)}catch(e){t=[6,e],n=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},Me=(Ee(Fe,Be=e),Fe.prototype.circle=function(){var g=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Point","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],v=e[1],i=e[2],h=e[3],m=e[4];g.drawtool=new t({view:g.view}),g.drawtool.reset();var b=g.view.map.findLayerById(g.displayedLayerid);null==b&&(b=new i({id:g.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),g.view.map.add(b));var r=(new x).uuid,w=g.view.map.findLayerById(r);w||(w=new i({id:g.displayedLayerid,title:"画圆显示层",listMode:"hide"}),g.view.map.add(w));var o=g.drawtool.create("circle",{mode:"click"});g.view.focus(),o.on("vertex-add",function(e){if(2===e.vertices.length){w.removeAll();var t=new h({x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:g.view.spatialReference}),i=new h({x:e.vertices[1][0],y:e.vertices[1][1],spatialReference:g.view.spatialReference}),r=new v({geometry:{type:"polyline",paths:[[e.vertices[0],e.vertices[1]]],spatialReference:g.view.spatialReference},symbol:g.polylinesymbol}),o=m.geodesicLength(r.geometry,"meters"),n=m.buffer(t,o,"meters"),a=m.geodesicArea(n,"square-meters"),l=new v({geometry:n,symbol:g.polygonsymbol}),s=g.textsymbol,d=1e3<o?"半径:"+(o/1e3).toFixed(3)+"千米":"半径:"+parseFloat(o).toFixed(3)+"米";s.text=d;var y=new v({geometry:i,symbol:s}),c=g.textsymbol,p=1e5<a?"面积:"+(a/1e6).toFixed(3)+"平千方米":"面积:"+parseFloat(a).toFixed(3)+"平方米";c.text=p;var u=new v({geometry:t,symbol:c});w.add(l),w.add(r),w.add(y),w.add(u)}}),o.on("vertex-remove",function(e){console.log(e)}),o.on("cursor-update",function(e){if(2===e.vertices.length){w.removeAll();var t=new h({x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:g.view.spatialReference}),i=new h({x:e.vertices[1][0],y:e.vertices[1][1],spatialReference:g.view.spatialReference}),r=new v({geometry:{type:"polyline",paths:[[e.vertices[0],e.vertices[1]]],spatialReference:g.view.spatialReference},symbol:g.polylinesymbol}),o=m.geodesicLength(r.geometry,"meters"),n=m.buffer(t,o,"meters"),a=m.geodesicArea(n,"square-meters"),l=new v({geometry:n,symbol:g.polygonsymbol}),s=g.textsymbol,d=1e3<o?"半径:"+(o/1e3).toFixed(3)+"千米":"半径:"+parseFloat(o).toFixed(3)+"米";s.text=d;var y=new v({geometry:i,symbol:s}),c=g.textsymbol,p=1e5<a?"面积:"+(a/1e6).toFixed(3)+"平千方米":"面积:"+parseFloat(a).toFixed(3)+"平方米";c.text=p;var u=new v({geometry:t,symbol:c});w.add(l),w.add(r),w.add(y),w.add(u)}}),o.on("redo",function(e){console.log(e)}),o.on("undo",function(e){console.log(e)}),o.on("draw-complete",function(e){if(2===e.vertices.length){var t=new h({x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:g.view.spatialReference}),i=new h({x:e.vertices[1][0],y:e.vertices[1][1],spatialReference:g.view.spatialReference}),r=new v({geometry:{type:"polyline",paths:[[e.vertices[0],e.vertices[1]]],spatialReference:g.view.spatialReference},symbol:g.polylinesymbol}),o=m.geodesicLength(r.geometry,"meters"),n=m.buffer(t,o,"meters"),a=m.geodesicArea(n,"square-meters"),l=new v({geometry:n,symbol:g.polygonsymbol}),s=g.textsymbol,d=1e3<o?"半径:"+(o/1e3).toFixed(3)+"千米":"半径:"+parseFloat(o).toFixed(3)+"米";s.text=d;var y=new v({geometry:i,symbol:s}),c=g.textsymbol,p=1e5<a?"面积:"+(a/1e6).toFixed(3)+"平千方米":"面积:"+parseFloat(a).toFixed(3)+"平方米";c.text=p;var u=new v({geometry:t,symbol:c});g.view.map.remove(w),b.add(l),b.add(r),b.add(y),b.add(u);var f={radiusdistance:o,circlearea:a};g.emit("measurementcomplete",l,f,"circle")}})})},Fe.prototype.rectangle=function(){var P=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Point","esri/geometry/Polygon","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],C=e[1],i=e[2],I=e[3],S=e[4],A=e[5];P.drawtool=new t({view:P.view}),P.drawtool.reset();var B=P.view.map.findLayerById(P.displayedLayerid);B||(B=new i({id:P.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),P.view.map.add(B));var r=(new x).uuid,E=P.view.map.findLayerById(r);null==E&&(E=new i({id:P.displayedLayerid,title:"画矩形追踪显示层",listMode:"hide"}),P.view.map.add(E));var o=P.drawtool.create("rectangle",{mode:"click"});P.view.focus(),o.on("vertex-add",function(e){if(2===e.vertices.length){E.removeAll();var t=e.vertices[0][0]>e.vertices[1][0]?e.vertices[1][0]:e.vertices[0][0],i=e.vertices[0][1]>e.vertices[1][1]?e.vertices[1][1]:e.vertices[0][1],r=e.vertices[0][0]>e.vertices[1][0]?e.vertices[0][0]:e.vertices[1][0],o=e.vertices[0][1]>e.vertices[1][1]?e.vertices[0][1]:e.vertices[1][1],n=new S({hasZ:!0,hasM:!0,rings:[[[t,i],[r,i],[r,o],[t,o],[t,i]]],spatialReference:P.view.spatialReference}),a=new C({geometry:n,symbol:P.polygonsymbol}),l=new I({x:t+(r-t)/2,y:i,spatialReference:P.view.spatialReference}),s=new I({x:t,y:i,spatialReference:P.view.spatialReference}),d=new I({x:r,y:t,spatialReference:P.view.spatialReference}),y=A.distance(s,d,"meters"),c=P.textsymbol,p=1e3<y?"长度:"+(y/1e3).toFixed(3)+"千米":"长度:"+y.toFixed(3)+"米";c.text=p;var u=new C({geometry:l,symbol:c}),f=new I({x:r,y:i+(o-i)/2,spatialReference:P.view.spatialReference}),v=new I({x:r,y:i,spatialReference:P.view.spatialReference}),h=new I({x:r,y:o,spatialReference:P.view.spatialReference}),m=A.distance(v,h,"meters"),b=P.textsymbol,w=1e3<m?"宽度:"+(m/1e3).toFixed(3)+"千米":"宽度:"+m.toFixed(3)+"米";b.text=w;var g=new C({geometry:f,symbol:b}),L=new I({x:t+(r-t)/2,y:i+(o-i)/2,spatialReference:P.view.spatialReference}),x=P.textsymbol,k=y*m,z=1e5<k?"面积:"+(k/1e6).toFixed(3)+"平方千米":"面积:"+k.toFixed(3)+"平方米";x.text=z;var R=new C({geometry:L,symbol:x});E.add(u),E.add(g),E.add(R),E.add(a)}}),o.on("vertex-remove",function(e){console.log(e)}),o.on("cursor-update",function(e){if(2===e.vertices.length){E.removeAll();var t=e.vertices[0][0]>e.vertices[1][0]?e.vertices[1][0]:e.vertices[0][0],i=e.vertices[0][1]>e.vertices[1][1]?e.vertices[1][1]:e.vertices[0][1],r=e.vertices[0][0]>e.vertices[1][0]?e.vertices[0][0]:e.vertices[1][0],o=e.vertices[0][1]>e.vertices[1][1]?e.vertices[0][1]:e.vertices[1][1],n=new S({hasZ:!0,hasM:!0,rings:[[[t,i],[r,i],[r,o],[t,o],[t,i]]],spatialReference:P.view.spatialReference}),a=new C({geometry:n,symbol:P.polygonsymbol}),l=new I({x:t+(r-t)/2,y:i,spatialReference:P.view.spatialReference}),s=new I({x:t,y:i,spatialReference:P.view.spatialReference}),d=new I({x:r,y:i,spatialReference:P.view.spatialReference}),y=A.distance(s,d,"meters"),c=P.textsymbol,p=1e3<y?"长度:"+(y/1e3).toFixed(3)+"千米":"长度:"+y.toFixed(3)+"米";c.text=p;var u=new C({geometry:l,symbol:c}),f=new I({x:r,y:i+(o-i)/2,spatialReference:P.view.spatialReference}),v=new I({x:r,y:i,spatialReference:P.view.spatialReference}),h=new I({x:r,y:o,spatialReference:P.view.spatialReference}),m=A.distance(v,h,"meters"),b=P.textsymbol,w=1e3<m?"宽度:"+(m/1e3).toFixed(3)+"千米":"宽度:"+m.toFixed(3)+"米";b.text=w;var g=new C({geometry:f,symbol:b}),L=new I({x:t+(r-t)/2,y:i+(o-i)/2,spatialReference:P.view.spatialReference}),x=P.textsymbol,k=y*m,z=1e5<k?"面积:"+(k/1e6).toFixed(3)+"平方千米":"面积:"+k.toFixed(3)+"平方米";x.text=z;var R=new C({geometry:L,symbol:x});E.add(u),E.add(g),E.add(R),E.add(a)}}),o.on("redo",function(e){console.log(e)}),o.on("undo",function(e){console.log(e)}),o.on("draw-complete",function(e){if(2===e.vertices.length){var t=e.vertices[0][0]>e.vertices[1][0]?e.vertices[1][0]:e.vertices[0][0],i=e.vertices[0][1]>e.vertices[1][1]?e.vertices[1][1]:e.vertices[0][1],r=e.vertices[0][0]>e.vertices[1][0]?e.vertices[0][0]:e.vertices[1][0],o=e.vertices[0][1]>e.vertices[1][1]?e.vertices[0][1]:e.vertices[1][1],n=new S({hasZ:!0,hasM:!0,rings:[[[t,i],[r,i],[r,o],[t,o],[t,i]]],spatialReference:P.view.spatialReference}),a=new C({geometry:n,symbol:P.polygonsymbol}),l=new I({x:t+(r-t)/2,y:i,spatialReference:P.view.spatialReference}),s=new I({x:t,y:i,spatialReference:P.view.spatialReference}),d=new I({x:r,y:i,spatialReference:P.view.spatialReference}),y=A.distance(s,d,"meters"),c=P.textsymbol,p=1e3<y?"长度:"+(y/1e3).toFixed(3)+"千米":"长度:"+y.toFixed(3)+"米";c.text=p;var u=new C({geometry:l,symbol:c}),f=new I({x:r,y:i+(o-i)/2,spatialReference:P.view.spatialReference}),v=new I({x:r,y:i,spatialReference:P.view.spatialReference}),h=new I({x:r,y:o,spatialReference:P.view.spatialReference}),m=A.distance(v,h,"meters"),b=P.textsymbol,w=1e3<m?"宽度:"+(m/1e3).toFixed(3)+"千米":"宽度:"+m.toFixed(3)+"米";b.text=w;var g=new C({geometry:f,symbol:b}),L=new I({x:t+(r-t)/2,y:i+(o-i)/2,spatialReference:P.view.spatialReference}),x=P.textsymbol,k=y*m,z=1e5<k?"面积:"+(k/1e6).toFixed(3)+"平方千米":"面积:"+k.toFixed(3)+"平方米";x.text=z;var R=new C({geometry:L,symbol:x});P.view.map.remove(E),B.add(u),B.add(g),B.add(R),B.add(a),P.emit("measurementcomplete",a,{length:y,width:m,area:m*y},"rectangle")}})})},Fe.prototype.Point=function(){var d=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer"]).then(function(e){var t=e[0],a=e[1],i=e[2];d.drawtool=new t({view:d.view}),d.drawtool.reset();var l=d.view.map.findLayerById(d.displayedLayerid);l||(l=new i({id:d.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),d.view.map.add(l));var r=(new x).uuid,s=d.view.map.findLayerById(r);null==s&&(s=new i({id:d.displayedLayerid,title:"画点移动追踪显示层",listMode:"hide"}),d.view.map.add(s));var o=d.drawtool.create("point",{mode:"click"});d.view.focus(),o.on("vertex-add",function(e){console.log(e)}),o.on("vertex-remove",function(e){console.log(e)}),o.on("cursor-update",function(e){s.removeAll();var t={type:"point",x:e.coordinates[0],y:e.coordinates[1],spatialReference:d.view.spatialReference},i=new a({geometry:t,symbol:d.marksymbol});s.add(i);var r=d.textsymbol;r.text="("+parseFloat(e.coordinates[0]).toFixed(3)+","+parseFloat(e.coordinates[0]).toFixed(3)+")";var o=new a({geometry:t,symbol:r});s.add(o)}),o.on("redo",function(e){console.log(e)}),o.on("undo",function(e){console.log(e)}),o.on("draw-complete",function(e){var t={type:"point",x:e.coordinates[0],y:e.coordinates[1],spatialReference:d.view.spatialReference},i=new a({geometry:t,symbol:d.marksymbol}),r=d.textsymbol;r.text="("+parseFloat(e.coordinates[0]).toFixed(3)+","+parseFloat(e.coordinates[0]).toFixed(3)+")";var o=new a({geometry:t,symbol:r});d.view.map.remove(s),l.add(o),l.add(i);var n="("+parseFloat(e.coordinates[0]).toFixed(3)+","+parseFloat(e.coordinates[0]).toFixed(3)+")";d.emit("measurementcomplete",i,n,"point")})})},Fe.prototype.Multipoint=function(){var c=this;L(["esri/views/draw/Draw","esri/views/draw/PointDrawAction","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Polygon","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],l=(e[1],e[2]),i=e[3];e[4],e[5],c.drawtool=new t({view:c.view}),c.drawtool.reset();var s=c.view.map.findLayerById(c.displayedLayerid);s||(s=new i({id:c.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),c.view.map.add(s));var r=(new x).uuid,d=c.view.map.findLayerById(r);null==d&&(d=new i({id:c.displayedLayerid,title:"画多点显示层",listMode:"hide"}),c.view.map.add(d));var o=(new x).uuid,y=c.view.map.findLayerById(o);null==y&&(y=new i({id:c.displayedLayerid,title:"移动追踪点显示层",listMode:"hide"}),c.view.map.add(y));var n=c.drawtool.create("multipoint",{mode:"click"});c.view.focus(),n.on("vertex-add",function(e){d.removeAll(),e.vertices.map(function(e){var t={type:"point",x:e[0],y:e[1],spatialReference:c.view.spatialReference},i=new l({geometry:t,symbol:c.marksymbol}),r=c.textsymbol;r.text="("+parseFloat(e[0]).toFixed(3)+","+parseFloat(e[1]).toFixed(3)+")";var o=new l({geometry:t,symbol:r});d.add(o),d.add(i)})}),n.on("vertex-remove",function(e){console.log(e)}),n.on("cursor-update",function(e){y.removeAll(),e.vertices.map(function(e){var t={type:"point",x:e[0],y:e[1],spatialReference:c.view.spatialReference},i=new l({geometry:t,symbol:c.marksymbol}),r=c.textsymbol;r.text="("+parseFloat(e[0]).toFixed(3)+","+parseFloat(e[1]).toFixed(3)+")";var o=new l({geometry:t,symbol:r});y.add(o),y.add(i)})}),n.on("redo",function(e){console.log(e)}),n.on("undo",function(e){console.log(e)}),n.on("draw-complete",function(e){c.view.map.remove(d),c.view.map.remove(y);var n=[],a=[];e.vertices.map(function(e){var t={type:"point",x:e[0],y:e[1],spatialReference:c.view.spatialReference},i=new l({geometry:t,symbol:c.marksymbol}),r=c.textsymbol;r.text="("+parseFloat(e[0]).toFixed(3)+","+parseFloat(e[1]).toFixed(3)+")";var o=new l({geometry:t,symbol:r});s.add(i),s.add(o),n.push(i),a.push(e)}),c.emit("measurementcomplete",n,a,"multipoint")})})},Fe.prototype.drawPolyline=function(){var h=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],p=e[1],i=e[2],u=e[3];h.drawtool=new t({view:h.view}),h.drawtool.reset();var f=h.view.map.findLayerById(h.displayedLayerid);f||(f=new i({id:h.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),h.view.map.add(f));var r=(new x).uuid,v=h.view.map.findLayerById(r);null==v&&(v=new i({id:h.displayedLayerid,title:"画线显示层",listMode:"hide"}),h.view.map.add(v));var o=h.drawtool.create("polyline");h.view.focus(),o.on(["vertex-add","vertex-remove","cursor-update","redo","undo"],function(e){if(1<e.vertices.length){var t=e.vertices;v.removeAll();var i=new p({geometry:{type:"polyline",paths:t,spatialReference:h.view.spatialReference},symbol:h.polylinesymbol}),r=function(e){var t=e.clone(),i=t.removePoint(0,t.paths[0].length-1),r=t.getPoint(0,t.paths[0].length-1);return{type:"polyline",spatialReference:h.view.spatialReference,hasZ:!1,paths:[[[r.x,r.y],[i.x,i.y]]]}};if(function(e){if(!(e.paths[0].length<3)){var t=e.clone(),i=r(e);return t.removePoint(0,t.paths[0].length-1),u.crosses(i,t)}}(i.geometry)){var o=new p({geometry:r(i.geometry),symbol:h.polylinesymbol});o&&v.addMany([i,o]),o&&e.preventDefault()}else v.add(i);var n=h.textsymbol,a=u.geodesicLength(i.geometry,"meters"),l=1e3<a?"长度:"+(a/1e3).toFixed(3)+"千米":"长度:"+a.toFixed(3)+"米";n.text=l;var s=i.geometry.clone(),d=s.removePoint(0,s.paths[0].length-1),y=new p({geometry:d,symbol:n});v.add(y)}}),o.on("draw-complete",function(e){if(1<e.vertices.length){var t=e.vertices;v.removeAll();var i=new p({geometry:{type:"polyline",paths:t,spatialReference:h.view.spatialReference},symbol:h.polylinesymbol}),r=function(e){var t=e.clone(),i=t.removePoint(0,t.paths[0].length-1),r=t.getPoint(0,t.paths[0].length-1);return{type:"polyline",spatialReference:h.view.spatialReference,hasZ:!1,paths:[[[r.x,r.y],[i.x,i.y]]]}},o=null;if(function(e){if(!(e.paths[0].length<3)){var t=e.clone(),i=r(e);return t.removePoint(0,t.paths[0].length-1),u.crosses(i,t)}}(i.geometry)){var n=new p({geometry:r(i.geometry),symbol:h.polylinesymbol});n&&(f.addMany([i,n]),o=new p({geometry:u.union(i.geometry,n.geometry),symbol:h.polylinesymbol})),n&&e.preventDefault()}else o=i,f.add(i);var a=h.textsymbol,l=u.geodesicLength(i.geometry,"meters"),s=1e3<l?"长度:"+(l/1e3).toFixed(3)+"千米":"长度:"+l.toFixed(3)+"米";a.text=s;var d=i.geometry.clone(),y=d.removePoint(0,d.paths[0].length-1),c=new p({geometry:y,symbol:a});f.add(c),h.view.map.remove(v),h.emit("measurementcomplete",o,{distance:l},"polyline")}})})},Fe.prototype.drawPolygon=function(){var p=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],s=e[1],i=e[2],d=e[3];p.drawtool=new t({view:p.view}),p.drawtool.reset();var y=p.view.map.findLayerById(p.displayedLayerid);y||(y=new i({id:p.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),p.view.map.add(y));var r=(new x).uuid,c=p.view.map.findLayerById(r);null==c&&(c=new i({id:p.displayedLayerid,title:"画面显示层",listMode:"hide"}),p.view.map.add(c));var o=p.drawtool.create("polygon");p.view.focus(),o.on(["vertex-add","vertex-remove","cursor-update","redo","undo"],function(e){var t=e.vertices;c.removeAll();var i={type:"polygon",rings:t,spatialReference:p.view.spatialReference},r=new s({geometry:i,symbol:p.polygonsymbol}),o=d.geodesicArea(r.geometry,"square-meters"),n=p.textsymbol,a=1e5<Math.abs(o)?"面积:"+(Math.abs(o)/1e6).toFixed(3)+"平方千米":"面积:"+Math.abs(o).toFixed(3)+"平方米";n.text=a;var l=new s({geometry:r.geometry.extent.center,symbol:n});c.add(l),c.add(r)}),o.on("draw-complete",function(e){var t=e.vertices;c.removeAll();var i={type:"polygon",rings:t,spatialReference:p.view.spatialReference},r=new s({geometry:i,symbol:p.polygonsymbol}),o=d.geodesicArea(r.geometry,"square-meters"),n=p.textsymbol,a=1e5<Math.abs(o)?"面积:"+(Math.abs(o)/1e6).toFixed(3)+"平方千米":"面积:"+Math.abs(o).toFixed(3)+"平方米";n.text=a;var l=new s({geometry:r.geometry.extent.center,symbol:n});p.view.map.remove(c),y.add(l),y.add(r),p.emit("measurementcomplete",r,{area:o},"polygon")})})},Fe.prototype.reset=function(){this.drawtool&&this.drawtool.reset()},Fe.prototype.clean=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e)},Fe.prototype.show=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!0)},Fe.prototype.hide=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!1)},Fe.prototype.init=function(i){return Pe(this,void 0,void 0,function(){var t=this;return _e(this,function(e){return this.displayedLayerid=(new x).uuid,this.view=i,"2d"===this.view.type?(this.polygonsymbol={type:"simple-fill",color:[255,255,255,.6],style:"solid",outline:{color:[255,255,0,.8],width:2}},this.polylinesymbol={type:"simple-line",color:[255,255,255,.6],width:"4px",style:"solid"},this.marksymbol={type:"simple-marker",style:"circle",color:[255,255,0,.6],size:"24px",outline:{color:[255,255,0,.8],width:2}}):(this.polygonsymbol={type:"polygon-3d",symbolLayers:[{type:"extrude",castShadows:!1,size:10,material:{color:[255,255,255,.4]},edges:{type:"solid",color:[50,50,50,.5]}}]},this.polylinesymbol={type:"line-3d",symbolLayers:[{type:"path",anchor:"center",Values:"center",profile:"quad",width:2,height:10,material:{color:[255,255,255,.4]},cap:"square",join:"miter",castShadows:!1,profileRotation:"heading"}]},this.marksymbol={type:"point-3d",symbolLayers:[{type:"object",width:20,height:20,depth:20,resource:{primitive:"sphere"},material:{color:[0,0,255,.8]}}],verticalOffset:{screenLength:60,maxWorldLength:1e3,minWorldLength:20},callout:{type:"line",size:1.5,color:"white",border:{color:"black"}}}),this.textsymbol={type:"text",color:"white",angle:0,text:"",xoffset:60,yoffset:10,horizontalAlignment:"right",verticalAlignment:"bottom",font:{size:12,family:"Josefin Slab",weight:"bold"}},this.view.on(k.click,function(e){t.view.hitTest(e).then(function(e){return Pe(t,void 0,void 0,function(){return _e(this,function(e){return[2]})})})}),this.view.on(k.pointermove,function(e){t.view.hitTest(e).then(function(e){return Pe(t,void 0,void 0,function(){return _e(this,function(e){return[2]})})})}),[2]})})},Fe);function Fe(e){var t=Be.call(this)||this;return t.marksymbol=null,t.polylinesymbol=null,t.polygonsymbol=null,t.textsymbol=null,t.displayedLayerid="",t.view=null,t.drawtool=null,t.drawlayerscollection=[],t.init(e),t}var je,Oe,We=(je=function(e,t){return(je=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}je(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ge=function(e,a,l,s){return new(l=l||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,o)}n((s=s.apply(e,a||[])).next())})},Te=function(i,r){var o,n,a,e,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,n&&(a=2&t[0]?n.return:t[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,t[1])).done)return a;switch(n=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,n=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){l.label=t[1];break}if(6===t[0]&&l.label<a[1]){l.label=a[1],a=t;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(t);break}a[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(i,l)}catch(e){t=[6,e],n=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},He=(We(Ze,Oe=e),Ze.prototype.add=function(n){var a=this;void 0===n&&(n={}),L(["esri/layers/echartsLayer"]).then(function(e){var t=e[0],i=[];n.datas.forEach(function(e,t){i.push({name:e[0]+" Top10",type:"lines",coordinateSystem:"arcgis",zlevel:1,effect:{show:!0,period:6,trailLength:.7,color:"#fff",symbolSize:3},lineStyle:{normal:{color:n.color[t],width:0,curveness:.2}},data:a.convertData(e[1],n.geoCoordMap)},{name:e[0]+" Top10",type:"lines",coordinateSystem:"arcgis",zlevel:2,symbol:["none","arrow"],symbolSize:10,effect:{show:!0,period:6,trailLength:0,symbol:n.planePath,symbolSize:15},lineStyle:{normal:{color:n.color[t],width:1,opacity:.6,curveness:.2}},data:a.convertData(e[1],n.geoCoordMap)},{name:e[0]+" Top10",type:"effectScatter",coordinateSystem:"arcgis",zlevel:2,rippleEffect:{brushType:"stroke"},legendHoverLink:!0,hoverAnimation:!0,symbol:n.symbol,label:{normal:{show:!0,position:"right",formatter:"{b}"}},symbolSize:function(e){return e[2]/8},itemStyle:{normal:{color:n.color[t],shadowBlur:10,shadowColor:"#333"}},data:e[1].map(function(e){return{name:e[1].name,value:n.geoCoordMap[e[1].name].concat([e[1].value])}})})});var r=new t(a.view,"",n.id),o={title:{text:"",subtext:"",left:"center",textStyle:{color:"#fff"}},series:i};r.setChartOption(o)})},Ze.prototype.remove=function(e){var t=document.getElementsByClassName("esri-view-surface")[0],i=document.getElementById(e);null!=i&&t.removeChild(i)},Ze.prototype.convertData=function(e,t){for(var i=[],r=0,o=e;r<o.length;r++){var n=o[r],a=t[n[0].name],l=t[n[1].name];a&&l&&i.push({fromName:n[0].name,toName:n[1].name,coords:[a,l],value:n[1].value})}return i},Ze.prototype.getAPIScript=function(e){return document.querySelector("script["+e+"]")},Ze.prototype.loadAPIScript=function(o,n){var a=this;return new r.Promise(function(e,t){var i=a.getAPIScript(o);if(i){var r=i.getAttribute("src");r!==n?t(new Error("The echartgl is already loaded ("+r+").")):a.handleScriptLoad(i,e,t)}else i=a.createScript(o,n),a.handleScriptLoad(i,function(){i.setAttribute(o,"loaded"),e(i)},t),document.head.appendChild(i)})},Ze.prototype.createScript=function(e,t){var i=document.createElement("script");return i.type="text/javascript",i.src=t,i.setAttribute(e,"loading"),i},Ze.prototype.handleScriptLoad=function(e,t,i){var r;i&&(r=this.handleScriptError(e,i));var o=function(){t(e),e.removeEventListener("load",o,!1),r&&e.removeEventListener("error",r,!1)};e.addEventListener("load",o,!1)},Ze.prototype.handleScriptError=function(t,i){var r=function(e){i(e.error||new Error("There was an error attempting to load "+t.src)),t.removeEventListener("error",r,!1)};return t.addEventListener("error",r,!1),r},Ze.prototype.init=function(t){return Ge(this,void 0,void 0,function(){return Te(this,function(e){return this.view=t,[2]})})},Ze);function Ze(e){var t=Oe.call(this)||this;return t.view=null,t.init(e),t}var De,qe,Je=(De=function(e,t){return(De=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}De(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ne=function(e,a,l,s){return new(l=l||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,o)}n((s=s.apply(e,a||[])).next())})},Xe=function(i,r){var o,n,a,e,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,n&&(a=2&t[0]?n.return:t[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,t[1])).done)return a;switch(n=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,n=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){l.label=t[1];break}if(6===t[0]&&l.label<a[1]){l.label=a[1],a=t;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(t);break}a[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(i,l)}catch(e){t=[6,e],n=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},Ye=(Je(Ve,qe=e),Ve.prototype.play=function(a){var l=this;void 0===a&&(a={}),L(["geolocate","esri/widgets/Track","esri/geometry/support/webMercatorUtils"]).then(function(e){var i=e[0],t=e[1],r=e[2];if(void 0!==a.coords){var o=0;l.track=new t({view:l.view,goToLocationEnabled:!1});var n=0;i.use(),void 0!==l.routepalybackinternal&&clearInterval(l.routepalybackinternal),l.routepalybackinternal=setInterval(function(){var e=r.xyToLngLat(a.coords[n].x,a.coords[n].y),t={lng:e[0],lat:e[1]};i.change(t),n=(n+1)%a.coords.length,++o===a.coords.length&&clearInterval(l.routepalybackinternal)},2500),l.view.when(function(){var t=l.view.center;l.track.on("track",function(){a.mobilesymbol&&(l.track.graphic.symbol=a.mobilesymbol);var e=l.track.graphic.geometry;1<o&&a.showtrail&&l.createAnimateRoute(e,t,a.trailsymbol),l.view.goTo({center:e,tilt:70,scale:2500,heading:360-l.getHeading(e,t),rotation:360-l.getHeading(e,t)}).catch(function(e){"AbortError"!==e.name&&console.error(e)}),t=e.clone()}),l.track.start()})}}).catch(function(e){console.error(e)})},Ve.prototype.remove=function(){this.routepalybackinternal,clearInterval(this.routepalybackinternal),this.track.destroy();var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e)},Ve.prototype.getHeading=function(e,t){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI-90},Ve.prototype.createAnimateRoute=function(n,a,l){var s=this;L(["esri/Graphic","esri/layers/GraphicsLayer"]).then(function(e){var t=e[0],i=e[1],r=new t({geometry:{type:"polyline",paths:[[a.longitude,a.latitude],[n.longitude,n.latitude]]},symbol:void 0!==l?l:{type:"simple-line",color:[156,39,176],width:10}}),o=s.view.map.findLayerById(s.displayedLayerid);void 0===o&&(o=new i({title:"路径轨迹播放",id:s.displayedLayerid,listMode:"hide"}),s.view.map.add(o)),o.add(r)})},Ve.prototype.init=function(t){return Ne(this,void 0,void 0,function(){return Xe(this,function(e){return this.displayedLayerid=(new x).uuid,this.view=t,[2]})})},Ve);function Ve(e){var t=qe.call(this)||this;return t.displayedLayerid="",t.view=null,t.routepalybackinternal=null,t.track=null,t.init(e),t}var Ue,Qe,$e=(Ue=function(e,t){return(Ue=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ue(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ke=function(e,a,l,s){return new(l=l||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,o)}n((s=s.apply(e,a||[])).next())})},et=function(i,r){var o,n,a,e,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,n&&(a=2&t[0]?n.return:t[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,t[1])).done)return a;switch(n=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,n=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){l.label=t[1];break}if(6===t[0]&&l.label<a[1]){l.label=a[1],a=t;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(t);break}a[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(i,l)}catch(e){t=[6,e],n=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},tt=($e(it,Qe=e),it.prototype.play=function(p){var u=this;void 0===p&&(p={}),L(["esri/geometry/Point","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/support/webMercatorUtils"]).then(function(e){var o=e[0],n=e[1],a=e[2];if(e[3],void 0!==p.coords){var l=0,s=0,d=u.view.center;void 0!==u.mapRoamplayinternal&&clearInterval(u.mapRoamplayinternal);var y=void 0!==p.duration?p.duration:2e3,c=void 0!==p.speedFactor?p.speedFactor:1;u.mapRoamplayinternal=setInterval(function(){var e={x:p.coords[s].x,y:p.coords[s].y,z:void 0!==p.coords[s].z?p.coords[s].z:0};s=(s+1)%p.coords.length,++l;var t=new o({x:e.x,y:e.y,z:e.z,spatialReference:u.view.spatialReference}),i=u.view.map.findLayerById(u.mobilelayerid);void 0===i&&(i=new a({title:"漫游路径"+u.mobilelayerid,id:u.mobilelayerid,listMode:"hide"}),u.view.map.add(i)),i.removeAll();var r=new n({geometry:t,symbol:p.mobilesymbol});i.add(r),1<l&&p.showtrail&&u.createAnimateRoute(t,d,p.trailsymbol),u.view.goTo({center:t,tilt:70,scale:2500,heading:360-u.getHeading(t,d),rotation:360-u.getHeading(t,d)},{speedFactor:c,duration:y-.2*y,maxDuration:y-.2*y,easing:"in-out-coast-quadratic"}).then().catch(function(e){"AbortError"!==e.name&&console.error(e)}),d=t.clone(),l===p.coords.length&&clearInterval(u.mapRoamplayinternal)},y)}}).catch(function(e){console.error(e)})},it.prototype.remove=function(){this.mapRoamplayinternal,clearInterval(this.mapRoamplayinternal);var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e);var t=this.view.map.findLayerById(this.mobilelayerid);t&&this.view.map.remove(t)},it.prototype.getHeading=function(e,t){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI-90},it.prototype.createAnimateRoute=function(n,a,l){var s=this;L(["esri/Graphic","esri/layers/GraphicsLayer"]).then(function(e){var t=e[0],i=e[1],r=new t({geometry:{type:"polyline",paths:[[a.x,a.y,a.z],[n.x,n.y,n.z]],spatialReference:s.view.spatialReference},symbol:void 0!==l?l:{type:"simple-line",color:[156,39,176],width:10}}),o=s.view.map.findLayerById(s.displayedLayerid);void 0===o&&(o=new i({title:"漫游路径"+s.displayedLayerid,id:s.displayedLayerid,listMode:"hide"}),s.view.map.add(o)),o.add(r)})},it.prototype.init=function(t){return Ke(this,void 0,void 0,function(){return et(this,function(e){return this.displayedLayerid=(new x).uuid,this.mobilelayerid=(new x).uuid,this.view=t,[2]})})},it);function it(e){var t=Qe.call(this)||this;return t.displayedLayerid="",t.view=null,t.mapRoamplayinternal=null,t.mobilelayerid="",t.init(e),t}return{load:L,Layers:ge,Boundary:B,Draw:O,GraphicOverlays:ce,FeaureOverlays:Q,EchartFlashPointLayer:q,FlashPoint3DLayer:oe,HeatMap:be,Measurement:Me,MaskBoundary:Ie,TrajectoryPlus:tt,MigrationMap:He,Trajectory:Ye}});
//# sourceMappingURL=Plugins.min.js.map

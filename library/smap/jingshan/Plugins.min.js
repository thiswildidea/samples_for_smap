!function (e, t) { "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : e.Plugins = t() }(this, function () { "use strict"; var e = (t.prototype._addListener = function (e, t, i) { if (this.emit("newListener", e, t), this.events.has(e)) { var r = this.events.get(e); i ? r.unshift(t) : r.push(t) } else this.events.set(e, [t]); var l = this.getMaxListeners(); if (0 < l && this.listenerCount(e) > l) { var o = new Error("Possible EventEmitter memory leak detected.\n         " + this.listenerCount(e) + " " + e.toString() + " listeners.\n         Use emitter.setMaxListeners() to increase limit"); o.name = "MaxListenersExceededWarning", console.warn(o) } return this }, t.prototype.addListener = function (e, t) { return this._addListener(e, t, !1) }, t.prototype.emit = function (e) { for (var t = [], i = 1; i < arguments.length; i++)t[i - 1] = arguments[i]; if (this.events.has(e)) { for (var r = 0, l = this.events.get(e).slice(); r < l.length; r++) { var o = l[r]; try { o.apply(this, t) } catch (e) { this.emit("error", e) } } return !0 } if ("error" === e) throw 0 < t.length ? t[0] : Error("Unhandled error."); return !1 }, t.prototype.eventNames = function () { return Array.from(this.events.keys()) }, t.prototype.getMaxListeners = function () { return this.maxListeners || t.defaultMaxListeners }, t.prototype.listenerCount = function (e) { return this.events.has(e) ? this.events.get(e).length : 0 }, t.prototype._listeners = function (e, t, i) { if (!e.events.has(t)) return []; var r = e.events.get(t); return i ? this.unwrapListeners(r) : r.slice(0) }, t.prototype.unwrapListeners = function (e) { for (var t = new Array(e.length), i = 0; i < e.length; i++)t[i] = e[i].listener || e[i]; return t }, t.prototype.listeners = function (e) { return this._listeners(this, e, !0) }, t.prototype.rawListeners = function (e) { return this._listeners(this, e, !1) }, t.prototype.off = function (e, t) { return this.removeListener(e, t) }, t.prototype.on = function (e, t) { return this.addListener(e, t) }, t.prototype.once = function (e, t) { var i = this.onceWrap(e, t); return this.on(e, i), this }, t.prototype.onceWrap = function (e, t) { function i() { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t]; this.context.removeListener(this.eventName, this.rawListener), this.listener.apply(this.context, e) } var r = { eventName: e, listener: t, rawListener: i, context: this }, l = i.bind(r); return (r.rawListener = l).listener = t, l }, t.prototype.prependListener = function (e, t) { return this._addListener(e, t, !0) }, t.prototype.prependOnceListener = function (e, t) { var i = this.onceWrap(e, t); return this.prependListener(e, i), this }, t.prototype.removeAllListeners = function (e) { var t = this; if (void 0 === this.events) return this; if (this.events.has(e)) { var i = this.events.get(e).slice(); this.events.delete(e); for (var r = 0, l = i; r < l.length; r++) { var o = l[r]; this.emit("removeListener", e, o) } } else this.eventNames().map(function (e) { t.removeAllListeners(e) }); return this }, t.prototype.removeListener = function (e, t) { if (this.events.has(e)) { var i = this.events.get(e); -1 !== i.indexOf(t) && (i.splice(i.indexOf(t), 1), this.emit("removeListener", e, t), 0 === i.length && this.events.delete(e)) } return this }, t.prototype.setMaxListeners = function (e) { return this.maxListeners = e, this }, t.defaultMaxListeners = 50, t); function t() { this.events = new Map } var c = (i.jsapi ="http://31.8.11.75/smiapi/arcgis",i.jsapiversion4X="4.16",i);function i(){}var a=c.jsapiversion4X,l="next";function o(e){if(null===e&&(e=a),e.toString().toLowerCase()===l)return l;var t=e&&e.match(/^(\d)\.(\d+)/);return t&&{major:parseInt(t[1],10),minor:parseInt(t[2],10)}}function n(e){return void 0===e&&(e=a),c.jsapi+"/"+e+"/init.js"}function s(e){var t=document.createElement("link");return t.rel="stylesheet",t.href=e,t}function d(e,t){if(t){var i=document.querySelector(t);i.parentNode.insertBefore(e,i)}else document.head.appendChild(e)}function y(e){return document.querySelector('link[href*="'+e+'"]')}function p(e){return!e||o(e)?function(e){void 0===e&&(e=a),null===e&&(e=a);var t=n(e),i=t.substring(0,t.indexOf("init.js")),r=o(e);return r===l||3!==r.major?i+"esri/themes/light/main.css":i+(r.minor<=10?"js/":"")+"esri/css/esri.css"}(e):e}function u(e,t){var i=p(e),r=y(i);if(r||d(r=s(i),t),4===function(e){null===e&&(e=a);var t=e&&e.match(/^(\d)\.(\d+)/);return t&&{major:parseInt(t[1],10),minor:parseInt(t[2],10)}}(e).major){var l=i.substring(0,i.indexOf("esri/themes/"))+"esri/themes/gis/css/gis.css",o=y(l);o||d(o=s(l),t)}return r}var r={Promise:"undefined"!=typeof window?window.Promise:void 0},f={};function b(e,t,i){var r,l,o,a;i&&(o=i,a=function(e){o(e.error||new Error("There was an error attempting to load "+l.src)),l.removeEventListener("error",a,!1)},(l=e).addEventListener("error",a,!1),r=a);var n=function(){t(e),e.removeEventListener("load",n,!1),r&&e.removeEventListener("error",r,!1)};e.addEventListener("load",n,!1)}function v(){return document.querySelector("script[data-shsmi]")}function h(){var e=window.require;return e&&e.on}function m(e){void 0===e&&(e={});var s={};[f,e].forEach(function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(s[t]=e[t])});var d=s.version,y=s.url||n(d);return new r.Promise(function(e,t){var i,r,l=v();if(l){var o=l.getAttribute("src");o!==y?t(new Error("The ArcGIS API for JavaScript is already loaded ("+o+").")):h()?e(l):b(l,e,t)}else if(h())t(new Error("The ArcGIS API for JavaScript is already loaded."));else{var a=s.css;if(a)u(!0===a?d:a,s.insertCssBefore);else u(null,s.insertCssBefore);if(s.dojoConfig)window.dojoConfig=s.dojoConfig;else{var n={async:!0,packages:[{location:c.jsapi+"/extensions",name:"smiapi"},{location:c.jsapi+"/extensions/geolocation",name:"geolocate",main:"geolocate"}],deps:["@dojo/framework/shim/main"],has:{"esri-promise-compatibility":1,"esri-featurelayer-webgl":1}};window.dojoConfig=n}i=y,(r=document.createElement("script")).type="text/javascript",r.src=i,r.setAttribute("data-shsmi","loading"),b(l=r,function(){l.setAttribute("data-shsmi","loaded"),e(l)},t),document.head.appendChild(l)}})}function w(t){return new r.Promise(function(i,e){var r=window.require.on("error",e);window.require(t,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.remove(),i(e)})})}function L(e,t){if(void 0===t&&(t={}),h())return w(e);var i=v(),r=i&&i.getAttribute("src");return!t.url&&r&&(t.url=r),m(t).then(function(){return w(e)})}var x=(g.prototype.S4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},g.prototype.get_uuid=function(){return this.S4()+this.S4()+"-"+this.S4()+"-"+this.S4()+"-"+this.S4()+"-"+this.S4()+this.S4()+this.S4()},g);function g(){this.uuid=this.get_uuid()}var z=(k.maploaded="maploaded",k.zoomchanged="zoomchanged",k.extentchanged="extentchanged",k.centerchanged="centerchanged",k.blur="blur",k.click="click",k.doubleclick="doubleclick",k.drag="drag",k.focus="focus",k.hold="hold",k.keydown="key-down",k.keyup="key-up",k.mousewheel="mouse-wheel",k.pointerdown="pointer-down",k.pointerenter="pointer-enter",k.pointerleave="pointer-leave",k.pointermove="pointer-move",k.pointerup="pointer-up",k.resize="pointer-up",k.popupvisible="popup-visible",k);function k(){}var C,R,I=(C=function(e,t){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}C(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),S=function(e,a,n,s){return new(n=n||Promise)(function(i,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function l(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(r,l)}o((s=s.apply(e,a||[])).next())})},A=function(i,r){var l,o,a,e,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(l)throw new TypeError("Generator is already executing.");for(;n;)try{if(l=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,o=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){n=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){n.label=t[1];break}if(6===t[0]&&n.label<a[1]){n.label=a[1],a=t;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(t);break}a[2]&&n.ops.pop(),n.trys.pop();continue}t=r.call(i,n)}catch(e){t=[6,e],o=0}finally{l=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},E=(I(B,R=e),B.prototype.add=function(a){var n=this;void 0===a&&(a={}),L(["esri/layers/GraphicsLayer","esri/Graphic","esri/layers/FeatureLayer"]).then(function(e){var t=e[0],l=e[1],i=e[2];if(n.view){var r=null;if(a.boundaryType&&(r=n.view.map.findLayerById(a.boundaryType)),r||a.url&&(r=new i({url:a.url,id:a.boundaryType,title:a.boundaryType,visible:!1}),n.view.map.add(r)),r){var o=r.createQuery();o.where=a.boundaryDefinition,r.queryFeatures(o).then(function(e){if(0<e.features.length){var i,r=n.view.map.findLayerById(n.displayedLayerid);void 0===r&&(r=new t({title:n.displayedLayerid+"边界",id:n.displayedLayerid,listMode:"hide"}),n.view.map.add(r)),i=void 0!==a.symbol?a.symbol:{type:"simple-fill",color:[255,255,255,0],outline:{color:[255,255,0,1],width:"5px"}},e.features.map(function(e){var t=new l({geometry:e.geometry,symbol:i,attributes:e.attributes});r.add(t)})}})}}}).catch(function(e){console.error(e)})},B.prototype.remove=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e)},B.prototype.show=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!0)},B.prototype.hide=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!1)},B.prototype.init=function(t){return S(this,void 0,void 0,function(){var r=this;return A(this,function(e){return this.displayedLayerid=(new x).uuid,this.view=t,this.view.on(z.click,function(i){r.view.hitTest(i).then(function(t){return S(r,void 0,void 0,function(){return A(this,function(e){return 0<t.results.length&&t.results[0].graphic.layer.id===this.displayedLayerid&&this.emit(z.click,t.results[0].graphic,i.mapPoint),[2]})})})}),this.view.on(z.pointermove,function(i){r.view.hitTest(i).then(function(t){return S(r,void 0,void 0,function(){return A(this,function(e){return 0<t.results.length&&t.results[0].graphic.layer.id===this.displayedLayerid&&this.emit(z.pointermove,t.results[0].graphic,i.mapPoint),[2]})})})}),[2]})})},B);function B(e){var t=R.call(this)||this;return t.displayedLayerid="",t.view=null,t.init(e),t}var P,M,_=(P=function(e,t){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}P(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),W=function(e,a,n,s){return new(n=n||Promise)(function(i,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function l(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(r,l)}o((s=s.apply(e,a||[])).next())})},F=function(i,r){var l,o,a,e,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(l)throw new TypeError("Generator is already executing.");for(;n;)try{if(l=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,o=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){n=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){n.label=t[1];break}if(6===t[0]&&n.label<a[1]){n.label=a[1],a=t;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(t);break}a[2]&&n.ops.pop(),n.trys.pop();continue}t=r.call(i,n)}catch(e){t=[6,e],o=0}finally{l=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},j=(_(O,M=e),O.prototype.drawcircle=function(){var c=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Point","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],a=e[1],i=e[2],n=e[3],s=e[4];c.emit("drawbegin","circle"),c.drawtool=new t({view:c.view}),c.drawtool.reset();var d=c.view.map.findLayerById(c.displayedLayerid);null==d&&(d=new i({id:c.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),c.view.map.add(d));var r=(new x).uuid,y=c.view.map.findLayerById(r);y||(y=new i({id:c.displayedLayerid,title:"绘制圆实时追踪显示层",listMode:"hide"}),c.view.map.add(y));var l=c.drawtool.create("circle",{mode:"click"});c.view.focus(),l.on("vertex-add",function(e){if(2===e.vertices.length){y.removeAll();var t=new n({x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:c.view.spatialReference}),i=new n({x:e.vertices[1][0],y:e.vertices[1][1],spatialReference:c.view.spatialReference}),r=s.distance(t,i,"meters"),l=s.buffer(t,r,"meters"),o=new a({geometry:l,symbol:c.polygonsymbol});y.add(o)}}),l.on("vertex-remove",function(e){console.log(e)}),l.on("cursor-update",function(e){if(2===e.vertices.length){y.removeAll();var t=new n({x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:c.view.spatialReference}),i=new n({x:e.vertices[1][0],y:e.vertices[1][1],spatialReference:c.view.spatialReference}),r=s.distance(t,i,"meters"),l=s.buffer(t,r,"meters"),o=new a({geometry:l,symbol:c.polygonsymbol});y.add(o)}}),l.on("redo",function(e){console.log(e)}),l.on("undo",function(e){console.log(e)}),l.on("draw-complete",function(e){if(2===e.vertices.length){var t=new n({x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:c.view.spatialReference}),i=new n({x:e.vertices[1][0],y:e.vertices[1][1],spatialReference:c.view.spatialReference}),r=s.distance(t,i,"meters"),l=s.buffer(t,r,"meters"),o=new a({geometry:l,symbol:c.polygonsymbol});c.view.map.remove(y),d.add(o),c.emit("drawcomplete",o,"circle")}})})},O.prototype.drawrectangle=function(){var c=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Polygon"]).then(function(e){var t=e[0],n=e[1],i=e[2],s=e[3];c.emit("drawbegin","rectangle"),c.drawtool=new t({view:c.view}),c.drawtool.reset();var d=c.view.map.findLayerById(c.displayedLayerid);d||(d=new i({id:c.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),c.view.map.add(d));var r=(new x).uuid,y=c.view.map.findLayerById(r);null==y&&(y=new i({id:c.displayedLayerid,title:"绘制矩形追踪实时显示层",listMode:"hide"}),c.view.map.add(y));var l=c.drawtool.create("rectangle",{mode:"click"});c.view.focus(),l.on("vertex-add",function(e){if(2===e.vertices.length){y.removeAll();var t=e.vertices[0][0]>e.vertices[1][0]?e.vertices[1][0]:e.vertices[0][0],i=e.vertices[0][1]>e.vertices[1][1]?e.vertices[1][1]:e.vertices[0][1],r=e.vertices[0][0]>e.vertices[1][0]?e.vertices[0][0]:e.vertices[1][0],l=e.vertices[0][1]>e.vertices[1][1]?e.vertices[0][1]:e.vertices[1][1],o=new s({hasZ:!0,hasM:!0,rings:[[[t,i],[r,i],[r,l],[t,l],[t,i]]],spatialReference:c.view.spatialReference}),a=new n({geometry:o,symbol:c.polygonsymbol});y.add(a)}}),l.on("vertex-remove",function(e){console.log(e)}),l.on("cursor-update",function(e){if(2===e.vertices.length){y.removeAll();var t=e.vertices[0][0]>e.vertices[1][0]?e.vertices[1][0]:e.vertices[0][0],i=e.vertices[0][1]>e.vertices[1][1]?e.vertices[1][1]:e.vertices[0][1],r=e.vertices[0][0]>e.vertices[1][0]?e.vertices[0][0]:e.vertices[1][0],l=e.vertices[0][1]>e.vertices[1][1]?e.vertices[0][1]:e.vertices[1][1],o=new s({hasZ:!0,hasM:!0,rings:[[[t,i],[r,i],[r,l],[t,l],[t,i]]],spatialReference:c.view.spatialReference}),a=new n({geometry:o,symbol:c.polygonsymbol});y.add(a)}}),l.on("redo",function(e){console.log(e)}),l.on("undo",function(e){console.log(e)}),l.on("draw-complete",function(e){if(2===e.vertices.length){var t=e.vertices[0][0]>e.vertices[1][0]?e.vertices[1][0]:e.vertices[0][0],i=e.vertices[0][1]>e.vertices[1][1]?e.vertices[1][1]:e.vertices[0][1],r=e.vertices[0][0]>e.vertices[1][0]?e.vertices[0][0]:e.vertices[1][0],l=e.vertices[0][1]>e.vertices[1][1]?e.vertices[0][1]:e.vertices[1][1],o=new s({hasZ:!0,hasM:!0,rings:[[[t,i],[r,i],[r,l],[t,l],[t,i]]],spatialReference:c.view.spatialReference}),a=new n({geometry:o,symbol:c.polygonsymbol});c.view.map.remove(y),d.add(a),c.emit("drawcomplete",a,"rectangle")}})})},O.prototype.drawPoint=function(){var s=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer"]).then(function(e){var t=e[0],r=e[1],i=e[2];s.emit("drawbegin","point"),s.drawtool=new t({view:s.view}),s.drawtool.reset();var l=s.view.map.findLayerById(s.displayedLayerid);l||(l=new i({id:s.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),s.view.map.add(l));var o=(new x).uuid,a=s.view.map.findLayerById(o);null==a&&(a=new i({id:s.displayedLayerid,title:"绘制点移动实时追踪显示层",listMode:"hide"}),s.view.map.add(a));var n=s.drawtool.create("point",{mode:"click"});s.view.focus(),n.on("vertex-add",function(e){console.log(e)}),n.on("vertex-remove",function(e){console.log(e)}),n.on("cursor-update",function(e){a.removeAll();var t={type:"point",x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:s.view.spatialReference},i=new r({geometry:t,symbol:s.marksymbol});a.add(i)}),n.on("redo",function(e){console.log(e)}),n.on("undo",function(e){console.log(e)}),n.on("draw-complete",function(e){var t={type:"point",x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:s.view.spatialReference},i=new r({geometry:t,symbol:s.marksymbol});s.view.map.remove(a),l.add(i),s.emit("drawcomplete",i,"point")})})},O.prototype.drawMultipoint=function(){var y=this;L(["esri/views/draw/Draw","esri/views/draw/PointDrawAction","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Polygon","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],l=(e[1],e[2]),i=e[3];e[4],e[5],y.emit("drawbegin","multipoint"),y.drawtool=new t({view:y.view}),y.drawtool.reset();var o=y.view.map.findLayerById(y.displayedLayerid);o||(o=new i({id:y.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),y.view.map.add(o));var r=(new x).uuid,a=y.view.map.findLayerById(r);null==a&&(a=new i({id:y.displayedLayerid,title:"绘制多点临时显示层",listMode:"hide"}),y.view.map.add(a));var n=(new x).uuid,s=y.view.map.findLayerById(n);null==s&&(s=new i({id:y.displayedLayerid,title:"绘制多点移动追踪显示层",listMode:"hide"}),y.view.map.add(s));var d=y.drawtool.create("multipoint",{mode:"click"});y.view.focus(),d.on("vertex-add",function(e){a.removeAll(),e.vertices.map(function(e){var t={type:"point",x:e[0],y:e[1],spatialReference:y.view.spatialReference},i=new l({geometry:t,symbol:y.marksymbol});a.add(i)})}),d.on("vertex-remove",function(e){console.log(e)}),d.on("cursor-update",function(e){s.removeAll(),e.vertices.map(function(e){var t={type:"point",x:e[0],y:e[1],spatialReference:y.view.spatialReference},i=new l({geometry:t,symbol:y.marksymbol});s.add(i)})}),d.on("redo",function(e){console.log(e)}),d.on("undo",function(e){console.log(e)}),d.on("draw-complete",function(e){var r=[];e.vertices.map(function(e){var t={type:"point",x:e[0],y:e[1],spatialReference:y.view.spatialReference},i=new l({geometry:t,symbol:y.marksymbol});r.push(i),o.add(i)}),y.view.map.remove(a),y.view.map.remove(s),y.emit("drawcomplete",r,"multipoint")})})},O.prototype.drawPolyline=function(){var y=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],a=e[1],i=e[2],n=e[3];y.emit("drawbegin","polyline"),y.drawtool=new t({view:y.view}),y.drawtool.reset();var s=y.view.map.findLayerById(y.displayedLayerid);s||(s=new i({id:y.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),y.view.map.add(s));var r=(new x).uuid,d=y.view.map.findLayerById(r);null==d&&(d=new i({id:y.displayedLayerid,title:"绘制线实时追踪显示层",listMode:"hide"}),y.view.map.add(d));var l=y.drawtool.create("polyline");y.view.focus(),l.on(["vertex-add","vertex-remove","cursor-update","redo","undo"],function(e){if(1<e.vertices.length){var t=e.vertices;d.removeAll();var i=new a({geometry:{type:"polyline",paths:t,spatialReference:y.view.spatialReference},symbol:y.polylinesymbol}),r=function(e){var t=e.clone(),i=t.removePoint(0,t.paths[0].length-1),r=t.getPoint(0,t.paths[0].length-1);return{type:"polyline",spatialReference:y.view.spatialReference,hasZ:!1,paths:[[[r.x,r.y],[i.x,i.y]]]}};if(function(e){if(!(e.paths[0].length<3)){var t=e.clone(),i=r(e);return t.removePoint(0,t.paths[0].length-1),n.crosses(i,t)}}(i.geometry)){var l=new a({geometry:r(i.geometry),symbol:y.polylinesymbol});l&&d.addMany([i,l]),l&&e.preventDefault()}else d.add(i)}}),l.on("draw-complete",function(e){if(1<e.vertices.length){var t=e.vertices;d.removeAll();var i=new a({geometry:{type:"polyline",paths:t,spatialReference:y.view.spatialReference},symbol:y.polylinesymbol}),r=function(e){var t=e.clone(),i=t.removePoint(0,t.paths[0].length-1),r=t.getPoint(0,t.paths[0].length-1);return{type:"polyline",spatialReference:y.view.spatialReference,hasZ:!1,paths:[[[r.x,r.y],[i.x,i.y]]]}},l=null;if(function(e){if(!(e.paths[0].length<3)){var t=e.clone(),i=r(e);return t.removePoint(0,t.paths[0].length-1),n.crosses(i,t)}}(i.geometry)){var o=new a({geometry:r(i.geometry),symbol:y.polylinesymbol});o&&(s.addMany([i,o]),l=new a({geometry:n.union(i.geometry,o.geometry),symbol:y.polylinesymbol})),o&&e.preventDefault()}else l=i,s.add(i);y.view.map.remove(d),y.emit("drawcomplete",l,"polyline")}})})},O.prototype.drawPolygon=function(){var s=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],l=e[1],i=e[2];e[3],s.emit("drawbegin","polygon"),s.drawtool=new t({view:s.view}),s.drawtool.reset();var o=s.view.map.findLayerById(s.displayedLayerid);o||(o=new i({id:s.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),s.view.map.add(o));var r=(new x).uuid,a=s.view.map.findLayerById(r);null==a&&(a=new i({id:s.displayedLayerid,title:"绘制多边形实时追踪显示层",listMode:"hide"}),s.view.map.add(a));var n=s.drawtool.create("polygon");s.view.focus(),n.on(["vertex-add","vertex-remove","cursor-update","redo","undo"],function(e){var t=e.vertices;a.removeAll();var i={type:"polygon",rings:t,spatialReference:s.view.spatialReference},r=new l({geometry:i,symbol:s.polygonsymbol});a.add(r)}),n.on("draw-complete",function(e){var t=e.vertices;a.removeAll();var i={type:"polygon",rings:t,spatialReference:s.view.spatialReference},r=new l({geometry:i,symbol:s.polygonsymbol});s.view.map.remove(a),o.add(r),s.emit("drawcomplete",r,"polygon")})})},O.prototype.reset=function(){this.drawtool&&this.drawtool.reset()},O.prototype.clean=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e)},O.prototype.show=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!0)},O.prototype.hide=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!1)},O.prototype.init=function(i){return W(this,void 0,void 0,function(){var t=this;return F(this,function(e){return this.displayedLayerid=(new x).uuid,this.view=i,"2d"===this.view.type?(this.polygonsymbol={type:"simple-fill",color:[255,255,255,.6],style:"solid",outline:{color:[255,255,0,.8],width:2}},this.polylinesymbol={type:"simple-line",color:[255,255,255,.6],width:"4px",style:"solid"},this.marksymbol={type:"simple-marker",style:"circle",color:[255,255,0,.6],size:"24px",outline:{color:[255,255,0,.8],width:2}}):(this.polygonsymbol={type:"polygon-3d",symbolLayers:[{type:"extrude",castShadows:!1,size:100,material:{color:[255,255,255,.4]},edges:{type:"solid",color:[50,50,50,.5]}}]},this.polylinesymbol={type:"line-3d",symbolLayers:[{type:"path",anchor:"center",Values:"center",profile:"quad",width:2,height:10,material:{color:[255,255,255,.4]},cap:"square",join:"miter",castShadows:!1,profileRotation:"heading"}]},this.marksymbol={type:"point-3d",symbolLayers:[{type:"object",width:20,height:20,depth:20,resource:{primitive:"sphere"},material:{color:[0,0,255,.8]}}],verticalOffset:{screenLength:60,maxWorldLength:1e3,minWorldLength:20},callout:{type:"line",size:1.5,color:"white",border:{color:"black"}}}),this.view.on(z.click,function(e){t.view.hitTest(e).then(function(e){return W(t,void 0,void 0,function(){return F(this,function(e){return[2]})})})}),this.view.on(z.pointermove,function(e){t.view.hitTest(e).then(function(e){return W(t,void 0,void 0,function(){return F(this,function(e){return[2]})})})}),[2]})})},O);function O(e){var t=M.call(this)||this;return t.marksymbol=null,t.polylinesymbol=null,t.polygonsymbol=null,t.displayedLayerid="",t.view=null,t.drawtool=null,t.drawlayerscollection=[],t.init(e),t}var H,Z,T=(H=function(e,t){return(H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}H(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),G=function(e,a,n,s){return new(n=n||Promise)(function(i,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function l(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(r,l)}o((s=s.apply(e,a||[])).next())})},J=function(i,r){var l,o,a,e,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(l)throw new TypeError("Generator is already executing.");for(;n;)try{if(l=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,o=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){n=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){n.label=t[1];break}if(6===t[0]&&n.label<a[1]){n.label=a[1],a=t;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(t);break}a[2]&&n.ops.pop(),n.trys.pop();continue}t=r.call(i,n)}catch(e){t=[6,e],o=0}finally{l=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},X=(T(q,Z=e),q.prototype.add=function(a){var n=this;L(["esri/layers/echartsLayer"]).then(function(e){var t=e[0],i=document.getElementsByClassName("esri-view-surface")[0],r=document.getElementById(n.displayedLayerid);null!==r&&i.removeChild(r);var l=[];n.datas=a.datas,a.datas.forEach(function(e,t){l.push({name:"Top10",type:"effectScatter",coordinateSystem:"arcgis",zlevel:2,showEffectOn:"render",rippleEffect:{brushType:"stroke"},legendHoverLink:!0,hoverAnimation:!0,symbol:null==e.symbol||void 0===e.symbol?"diamond":e.symbol,cursor:"pointer",label:{normal:{show:!0,position:null==e.labelposition||void 0===e.labelposition?"right":e.labelposition,formatter:"{b}"}},tooltip:{padding:10,backgroundColor:"#222",borderColor:"#777",borderWidth:1},symbolSize:function(e){return e[2]/8},itemStyle:{normal:{color:e.color,shadowBlur:10,shadowColor:"#333"}},data:[{name:e.name,value:[e.x,e.y].concat([e.value])}]})});var o={title:{text:"",subtext:"",left:"center",textStyle:{color:"#fff"}},series:l};new t(n.view,"",n.displayedLayerid).setChartOption(o)})},q.prototype.update=function(a){var n=this;L(["esri/layers/echartsLayer"]).then(function(e){var t=e[0],i=document.getElementsByClassName("esri-view-surface")[0],r=document.getElementById(n.displayedLayerid);null!==r&&i.removeChild(r);var l=[];n.datas=a.datas,a.datas.forEach(function(e,t){l.push({name:"Top10",type:"effectScatter",coordinateSystem:"arcgis",zlevel:2,showEffectOn:"render",rippleEffect:{brushType:"stroke"},legendHoverLink:!0,hoverAnimation:!0,symbol:null==e.symbol||void 0===e.symbol?"diamond":e.symbol,cursor:"pointer",label:{normal:{show:!0,position:null==e.labelposition||void 0===e.labelposition?"right":e.labelposition,formatter:"{b}"}},tooltip:{padding:10,backgroundColor:"#222",borderColor:"#777",borderWidth:1},symbolSize:function(e){return e[2]/8},itemStyle:{normal:{color:e.color,shadowBlur:10,shadowColor:"#333"}},data:[{name:e.name,value:[e.x,e.y].concat([e.value])}]})});var o={title:{text:"",subtext:"",left:"center",textStyle:{color:"#fff"}},series:l};new t(n.view,"",n.displayedLayerid).setChartOption(o)})},q.prototype.delete=function(){var e=document.getElementsByClassName("esri-view-surface")[0],t=document.getElementById(this.displayedLayerid);null!==t&&e.removeChild(t)},q.prototype.init=function(t){return G(this,void 0,void 0,function(){var s=this;return J(this,function(e){return this.view=t,this.displayedLayerid=(new x).uuid,L(["esri/geometry/Point","esri/geometry/SpatialReference","esri/geometry/support/webMercatorUtils"]).then(function(e){var a=e[0],n=e[1];e[2],s.view.on(z.click,function(r){if(s.datas.length){var i=s.datas.map(function(e){var t=new a({x:e.x,y:e.y,spatialReference:n.WebMercator}),i=s.view.toScreen(t);return Math.sqrt((i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y))}),l=0;i.forEach(function(e,t){e<i[l]&&(l=t)}),35<i[l]||s.emit(z.click,s.datas[l],r.mapPoint)}}),s.view.on(z.doubleclick,function(r){if(s.datas.length){var i=s.datas.map(function(e){var t=new a({x:e.x,y:e.y,spatialReference:n.WebMercator}),i=s.view.toScreen(t);return Math.sqrt((i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y))}),l=0;i.forEach(function(e,t){e<i[l]&&(l=t)}),35<i[l]||s.emit(z.doubleclick,s.datas[l],r.mapPoint)}}),s.view.on(z.pointermove,function(o){s.view.hitTest(o).then(function(t){return G(s,void 0,void 0,function(){var i,r,l=this;return J(this,function(e){if(0<t.results.length&&t.results[0].graphic.layer.id===this.displayedLayerid){if(!this.datas.length)return[2];if(i=this.datas.map(function(e){var t=new a({x:e.x,y:e.y,spatialReference:n.WebMercator}),i=l.view.toScreen(t);return Math.sqrt((i.x-o.x)*(i.x-o.x)+(i.y-o.y)*(i.y-o.y))}),r=0,i.forEach(function(e,t){e<i[r]&&(r=t)}),35<i[r])return[2];this.emit(z.pointermove,this.datas[r],this.view.toMap({x:o.x,y:o.y}))}return[2]})})})})}),[2]})})},q);function q(e){var t=Z.call(this)||this;return t.displayedLayerid="",t.view=null,t.datas=null,t.init(e),t}var Y,D,U=(Y=function(e,t){return(Y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Y(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),N=function(e,a,n,s){return new(n=n||Promise)(function(i,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function l(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(r,l)}o((s=s.apply(e,a||[])).next())})},V=function(i,r){var l,o,a,e,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(l)throw new TypeError("Generator is already executing.");for(;n;)try{if(l=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,o=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){n=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){n.label=t[1];break}if(6===t[0]&&n.label<a[1]){n.label=a[1],a=t;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(t);break}a[2]&&n.ops.pop(),n.trys.pop();continue}t=r.call(i,n)}catch(e){t=[6,e],o=0}finally{l=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},$=(U(Q,D=e),Q.prototype.createFeatureGroup=function(S){var A=this,e=this.view.map.findLayerById(this.displayedLayerid);e&&(this.view.map.remove(e),this.mapoverlayersflayer=[]),L(["esri/layers/FeatureLayer","esri/layers/support/LabelClass","esri/Graphic","esri/geometry/Point","esri/geometry/Circle","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){var t=e[0],i=e[1],o=e[2],r=e[3],l=e[4],a=(e[5],e[6]),n=e[7];if("group"===S.type){var s,d=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}];if(d.push({name:"style",alias:"样式",type:"string"}),S.datafiled.forEach(function(e){d.push(e)}),"marker"===S.overlaytype.toLowerCase()){S.renderer?s=S.renderer:(s={type:"unique-value",field:"style",uniqueValueInfos:[]},S.style.forEach(function(e){s.uniqueValueInfos.push({value:e.style,label:e.style,symbol:e.symbol})}));var y=new t({id:A.displayedLayerid,title:"Overlayer-marker-"+A.displayedLayerid,objectIdField:"objectId",geometryType:"point",renderer:s,screenSizePerspectiveEnabled:"3d"===A.view.type,popupEnabled:!1,popupTemplate:!1,fields:d,source:[],spatialReference:A.view.spatialReference});if(S.elevationInfo&&(y.elevationInfo=S.elevationInfo),S.frreduction&&("3d"===A.view.type?y.featureReduction={type:S.frreduction.type}:y.featureReduction=S.frreduction.clusterConfig),A.view.map.add(y),S.overlayers.forEach(function(e){if(e.attributes&&e.position){var t=e.attributes;t.uuid=e.uuid;var i=new o({geometry:new r({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:A.view.spatialReference}),attributes:t});y.source.add(i),A.mapoverlayersflayer.push([S.uuid,e.uuid,i])}}),100<y.source.items.length&&null!=S.frreduction&&(y.featureReduction={type:S.frreduction.type,clusterRadius:S.frreduction.clusterRadius}),S.label.visible){var c=void 0;if(S.label.labelingInfo)c=S.label.labelingInfo,y.labelingInfo=c;else{var p=new i({labelExpressionInfo:{expression:"$feature.NAME"},symbol:c="2d"===A.view.type?{type:S.label.type,text:S.label.text,color:S.label.color,angle:S.label.angle,backgroundColor:S.label.backgroundColor,borderLineColor:S.label.borderLineColor,borderLineSize:S.label.borderLineSize,kerning:S.label.kerning,lineHeight:S.label.lineHeight,lineWidth:S.label.lineWidth,rotated:S.label.rotated,haloColor:S.label.haloColor,haloSize:S.label.haloSize,xoffset:S.label.xoffset,yoffset:S.label.yoffset,verticalAlignment:S.label.verticalAlignment,horizontalAlignment:S.label.horizontalAlignment,font:{size:S.label.size,family:"Josefin Slab",weight:S.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:S.label.color},size:S.label.size,halo:{color:S.label.haloColor,size:S.label.haloSize}}]},labelPlacement:S.label.placement,minScale:S.label.minScale,maxScale:S.label.maxScale});y.labelingInfo=[p]}}}else if("circle"===S.overlaytype.toLowerCase()){S.renderer?s=S.renderer:(s={type:"unique-value",field:"style",uniqueValueInfos:[]},S.style.forEach(function(e){s.uniqueValueInfos.push({value:e.style,label:e.style,symbol:e.symbol})}));var u=new t({id:A.displayedLayerid,title:"Overlayer-circle-"+A.displayedLayerid,objectIdField:"objectId",geometryType:"polygon",renderer:s,screenSizePerspectiveEnabled:"3d"===A.view.type,popupEnabled:!1,popupTemplate:!1,fields:d,source:[],spatialReference:A.view.spatialReference});S.elevationInfo&&(u.elevationInfo=S.elevationInfo),A.view.map.add(u),S.overlayers.forEach(function(e){if(e.attributes&&e.center&&e.radius){var t=e.attributes;t.uuid=e.uuid;var i=new o({geometry:new l({center:new r({x:e.center.X,y:e.center.Y,z:e.center.Z,spatialReference:A.view.spatialReference}),radius:e.radius,radiusUnit:e.radiusUnit,spatialReference:A.view.spatialReference}),attributes:t});u.source.add(i),A.mapoverlayersflayer.push([S.uuid,e.uuid,i])}}),S.label.visible&&(c=void 0,S.label.labelingInfo?(c=S.label.labelingInfo,u.labelingInfo=c):(p=new i({labelExpressionInfo:{expression:"$feature.NAME"},symbol:c="2d"===A.view.type?{type:S.label.type,text:S.label.text,color:S.label.color,angle:S.label.angle,backgroundColor:S.label.backgroundColor,borderLineColor:S.label.borderLineColor,borderLineSize:S.label.borderLineSize,kerning:S.label.kerning,lineHeight:S.label.lineHeight,lineWidth:S.label.lineWidth,rotated:S.label.rotated,haloColor:S.label.haloColor,haloSize:S.label.haloSize,xoffset:S.label.xoffset,yoffset:S.label.yoffset,verticalAlignment:S.label.verticalAlignment,horizontalAlignment:S.label.horizontalAlignment,font:{size:S.label.size,family:"Josefin Slab",weight:S.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:S.label.color},size:S.label.size,halo:{color:S.label.haloColor,size:S.label.haloSize}}]},labelPlacement:S.label.placement,minScale:S.label.minScale,maxScale:S.label.maxScale}),u.labelingInfo=[p]))}else if("polyline"===S.overlaytype.toLowerCase()){S.renderer?s=S.renderer:(s={type:"unique-value",field:"style",uniqueValueInfos:[]},S.style.forEach(function(e){s.uniqueValueInfos.push({value:e.style,label:e.style,symbol:e.symbol})}));var f=new t({id:A.displayedLayerid,title:"Overlayer-polyline-"+A.displayedLayerid,objectIdField:"objectId",geometryType:"polyline",renderer:s,popupEnabled:!1,popupTemplate:!1,fields:d,source:[],spatialReference:A.view.spatialReference});S.elevationInfo&&(f.elevationInfo=S.elevationInfo),A.view.map.add(f),S.overlayers.forEach(function(e){if(e.attributes&&e.path){var t=e.attributes;t.uuid=e.uuid;var i=[];e.path.forEach(function(e){i.push([e.X,e.Y,e.Z])});var r=new a({hasZ:!1,hasM:!1,paths:i,spatialReference:A.view.spatialReference}),l=new o({geometry:r,attributes:t});f.source.add(l),A.mapoverlayersflayer.push([S.uuid,e.uuid,l])}}),S.label.visible&&(c=void 0,S.label.labelingInfo?(c=S.label.labelingInfo,f.labelingInfo=c):(p=new i({labelExpressionInfo:{expression:"$feature.NAME"},symbol:c="2d"===A.view.type?{type:S.label.type,text:S.label.text,color:S.label.color,angle:S.label.angle,backgroundColor:S.label.backgroundColor,borderLineColor:S.label.borderLineColor,borderLineSize:S.label.borderLineSize,kerning:S.label.kerning,lineHeight:S.label.lineHeight,lineWidth:S.label.lineWidth,rotated:S.label.rotated,haloColor:S.label.haloColor,haloSize:S.label.haloSize,xoffset:S.label.xoffset,yoffset:S.label.yoffset,verticalAlignment:S.label.verticalAlignment,horizontalAlignment:S.label.horizontalAlignment,font:{size:S.label.size,family:"Josefin Slab",weight:S.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:S.label.color},size:S.label.size,halo:{color:S.label.haloColor,size:S.label.haloSize}}]},labelPlacement:S.label.placement,minScale:S.label.minScale,maxScale:S.label.maxScale}),f.labelingInfo=[p]))}else if("polygon"===S.overlaytype.toLowerCase()){S.renderer?s=S.renderer:(s={type:"unique-value",field:"style",uniqueValueInfos:[]},S.style.forEach(function(e){s.uniqueValueInfos.push({value:e.style,label:e.style,symbol:e.symbol})}));var b=new t({id:A.displayedLayerid,title:"Overlayer-polygon-"+A.displayedLayerid,objectIdField:"objectId",geometryType:"polygon",renderer:s,popupEnabled:!1,popupTemplate:!1,fields:d,source:[],spatialReference:A.view.spatialReference});S.elevationInfo&&(b.elevationInfo=S.elevationInfo),A.view.map.add(b),S.overlayers.forEach(function(e){if(e.attributes&&e.paths){var t=e.attributes;t.uuid=e.uuid;var i=[];e.paths.forEach(function(e){i.push([e.X,e.Y,e.Z])});var r=new n({hasZ:!0,hasM:!0,rings:i,spatialReference:A.view.spatialReference}),l=new o({geometry:r,attributes:t});b.source.add(l),A.mapoverlayersflayer.push([S.uuid,e.uuid,l])}}),S.label.visible&&(c=void 0,S.label.labelingInfo?(c=S.label.labelingInfo,b.labelingInfo=c):(p=new i({labelExpressionInfo:{expression:"$feature.NAME"},symbol:c="2d"===A.view.type?{type:S.label.type,text:S.label.text,color:S.label.color,angle:S.label.angle,backgroundColor:S.label.backgroundColor,borderLineColor:S.label.borderLineColor,borderLineSize:S.label.borderLineSize,kerning:S.label.kerning,lineHeight:S.label.lineHeight,lineWidth:S.label.lineWidth,rotated:S.label.rotated,haloColor:S.label.haloColor,haloSize:S.label.haloSize,xoffset:S.label.xoffset,yoffset:S.label.yoffset,verticalAlignment:S.label.verticalAlignment,horizontalAlignment:S.label.horizontalAlignment,font:{size:S.label.size,family:"Josefin Slab",weight:S.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:S.label.color},size:S.label.size,halo:{color:S.label.haloColor,size:S.label.haloSize}}]},labelPlacement:S.label.placement,minScale:S.label.minScale,maxScale:S.label.maxScale}),b.labelingInfo=[p]))}}else if("element"===S.type){var v=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}];if(Object.keys(S.attributes).forEach(function(e){v.push({name:e,alias:e,type:"string"})}),"marker"===S.overlaytype.toLowerCase()){var h=void 0;h=S.renderer?S.renderer:"3d"===A.view.type?{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:S.icon.size.width,resource:{href:S.icon.image}}]}}:{type:"simple",symbol:{type:"picture-marker",url:S.icon.image,width:S.icon.size.width,height:S.icon.size.height}};var m=new t({id:A.displayedLayerid,title:"Overlayer-marker-"+A.displayedLayerid,objectIdField:"objectId",geometryType:"point",renderer:h,screenSizePerspectiveEnabled:!0,popupEnabled:!1,popupTemplate:!1,fields:v,source:[],spatialReference:A.view.spatialReference});if(S.elevationInfo&&(m.elevationInfo=S.elevationInfo),S.position&&S.attributes){(C=S.attributes).uuid=S.uuid;var w=new o({geometry:new r({x:S.position[0],y:S.position[1],z:void 0===S.position[2]?0:S.position[2],spatialReference:A.view.spatialReference}),attributes:C});m.source.add(w),A.mapoverlayersflayer.push([S.uuid,S.uuid,w])}A.view.map.add(m),S.label.visible&&(c=void 0,S.label.labelingInfo?(c=S.label.labelingInfo,m.labelingInfo=c):(p=new i({labelExpressionInfo:{expression:"$feature.NAME"},symbol:c="2d"===A.view.type?{type:S.label.type,text:S.label.text,color:S.label.color,angle:S.label.angle,backgroundColor:S.label.backgroundColor,borderLineColor:S.label.borderLineColor,borderLineSize:S.label.borderLineSize,kerning:S.label.kerning,lineHeight:S.label.lineHeight,lineWidth:S.label.lineWidth,rotated:S.label.rotated,haloColor:S.label.haloColor,haloSize:S.label.haloSize,xoffset:S.label.xoffset,yoffset:S.label.yoffset,verticalAlignment:S.label.verticalAlignment,horizontalAlignment:S.label.horizontalAlignment,font:{size:S.label.size,family:"Josefin Slab",weight:S.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:S.label.color},size:S.label.size,halo:{color:S.label.haloColor,size:S.label.haloSize}}]},labelPlacement:S.label.placement,minScale:S.label.minScale,maxScale:S.label.maxScale}),m.labelingInfo=[p]))}else if("circle"===S.overlaytype.toLowerCase()){var g=void 0;g=S.renderer?S.renderer:"simple"===S.symboltype?{type:"simple",symbol:{type:"simple-fill",color:S.fillColor,style:S.style,outline:{color:S.strokeColor,width:S.strokeWeight,style:S.strokestyle}}}:{type:"picture-fill",url:S.url,width:S.picwidth,height:S.picheight,outline:{style:S.strokestyle,color:S.strokeColor,width:S.strokeWeight}},m=new t({id:A.displayedLayerid,title:"Overlayer-circle-"+A.displayedLayerid,objectIdField:"objectId",geometryType:"polygon",renderer:g,screenSizePerspectiveEnabled:!0,popupEnabled:!1,popupTemplate:!1,fields:v,source:[],spatialReference:A.view.spatialReference}),S.elevationInfo&&(m.elevationInfo=S.elevationInfo),S.center&&S.radius&&S.attributes&&((C=S.attributes).uuid=S.uuid,w=new o({geometry:new l({center:new r({x:S.center.X,y:S.center.Y,z:S.center.Z,spatialReference:A.view.spatialReference}),radius:S.radius,radiusUnit:S.radiusUnit,spatialReference:A.view.spatialReference}),attributes:C}),m.source.add(w),A.mapoverlayersflayer.push([S.uuid,S.uuid,w])),A.view.map.add(m),S.label.visible&&(c=void 0,S.label.labelingInfo?(c=S.label.labelingInfo,m.labelingInfo=c):(p=new i({labelExpressionInfo:{expression:"$feature.NAME"},symbol:c="2d"===A.view.type?{type:S.label.type,text:S.label.text,color:S.label.color,angle:S.label.angle,backgroundColor:S.label.backgroundColor,borderLineColor:S.label.borderLineColor,borderLineSize:S.label.borderLineSize,kerning:S.label.kerning,lineHeight:S.label.lineHeight,lineWidth:S.label.lineWidth,rotated:S.label.rotated,haloColor:S.label.haloColor,haloSize:S.label.haloSize,xoffset:S.label.xoffset,yoffset:S.label.yoffset,verticalAlignment:S.label.verticalAlignment,horizontalAlignment:S.label.horizontalAlignment,font:{size:S.label.size,family:"Josefin Slab",weight:S.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:S.label.color},size:S.label.size,halo:{color:S.label.haloColor,size:S.label.haloSize}}]},labelPlacement:S.label.placement,minScale:S.label.minScale,maxScale:S.label.maxScale}),m.labelingInfo=[p]))}else if("polyline"===S.overlaytype.toLowerCase()){var L=void 0;if(!S.renderer){if(L="simple"===S.symboltype?{type:"simple",symbol:{type:"simple-line",color:S.strokeColor,style:S.style,width:S.width,cap:S.cap,join:S.lineJoin}}:S.renderer,m=new t({id:A.displayedLayerid,title:"Overlayer-polyline-"+A.displayedLayerid,objectIdField:"objectId",geometryType:"polyline",renderer:L,screenSizePerspectiveEnabled:!0,popupEnabled:!1,popupTemplate:!1,fields:v,source:[],spatialReference:A.view.spatialReference}),S.elevationInfo&&(m.elevationInfo=S.elevationInfo),S.path&&S.attributes){(C=S.attributes).uuid=S.uuid;var x=[];S.path.forEach(function(e){x.push([e.X,e.Y,e.Z])});var z=new a({hasZ:!1,hasM:!1,paths:x,spatialReference:A.view.spatialReference});w=new o({geometry:z,attributes:C}),m.source.add(w),A.mapoverlayersflayer.push([S.uuid,S.uuid,w])}A.view.map.add(m),S.label.visible&&(c=void 0,S.label.labelingInfo?(c=S.label.labelingInfo,m.labelingInfo=c):(p=new i({labelExpressionInfo:{expression:"$feature.NAME"},symbol:c="2d"===A.view.type?{type:S.label.type,text:S.label.text,color:S.label.color,angle:S.label.angle,backgroundColor:S.label.backgroundColor,borderLineColor:S.label.borderLineColor,borderLineSize:S.label.borderLineSize,kerning:S.label.kerning,lineHeight:S.label.lineHeight,lineWidth:S.label.lineWidth,rotated:S.label.rotated,haloColor:S.label.haloColor,haloSize:S.label.haloSize,xoffset:S.label.xoffset,yoffset:S.label.yoffset,verticalAlignment:S.label.verticalAlignment,horizontalAlignment:S.label.horizontalAlignment,font:{size:S.label.size,family:"Josefin Slab",weight:S.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:S.label.color},size:S.label.size,halo:{color:S.label.haloColor,size:S.label.haloSize}}]},labelPlacement:S.label.placement,minScale:S.label.minScale,maxScale:S.label.maxScale}),m.labelingInfo=[p]))}}else if("polygon"===S.overlaytype.toLowerCase()){var k=void 0;if(k=S.renderer?S.symbol:"simple"===S.symboltype?{type:"simple",symbol:{type:"simple-fill",color:S.fillColor,style:S.style,outline:{color:S.strokeColor,width:S.strokeWeight,style:S.strokestyle}}}:{type:"simple",symbol:{type:"picture-fill",url:S.url,width:S.picwidth,height:S.picheight,outline:{style:S.strokestyle,color:S.strokeColor,width:S.strokeWeight}}},m=new t({id:A.displayedLayerid,title:"Overlayer-polygon-"+A.displayedLayerid,objectIdField:"objectId",geometryType:"polygon",renderer:k,screenSizePerspectiveEnabled:!0,popupEnabled:!1,popupTemplate:!1,fields:v,source:[],spatialReference:A.view.spatialReference}),S.elevationInfo&&(m.elevationInfo=S.elevationInfo),S.paths&&S.attributes){var C;(C=S.attributes).uuid=S.uuid;var R=[];S.paths.forEach(function(e){R.push([e.X,e.Y,e.Z])});var I=new n({hasZ:!0,hasM:!0,rings:R,spatialReference:A.view.spatialReference});w=new o({geometry:I,attributes:C}),m.source.add(w),A.mapoverlayersflayer.push([S.uuid,S.uuid,w])}A.view.map.add(m),S.label.visible&&(c=void 0,S.label.labelingInfo?(c=S.label.labelingInfo,m.labelingInfo=c):(p=new i({labelExpressionInfo:{expression:"$feature.NAME"},symbol:c="2d"===A.view.type?{type:S.label.type,text:S.label.text,color:S.label.color,angle:S.label.angle,backgroundColor:S.label.backgroundColor,borderLineColor:S.label.borderLineColor,borderLineSize:S.label.borderLineSize,kerning:S.label.kerning,lineHeight:S.label.lineHeight,lineWidth:S.label.lineWidth,rotated:S.label.rotated,haloColor:S.label.haloColor,haloSize:S.label.haloSize,xoffset:S.label.xoffset,yoffset:S.label.yoffset,verticalAlignment:S.label.verticalAlignment,horizontalAlignment:S.label.horizontalAlignment,font:{size:S.label.size,family:"Josefin Slab",weight:S.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:S.label.color},size:S.label.size,halo:{color:S.label.haloColor,size:S.label.haloSize}}]},labelPlacement:S.label.placement,minScale:S.label.minScale,maxScale:S.label.maxScale}),m.labelingInfo=[p]))}}})},Q.prototype.addfeature=function(f){var b=this;L(["esri/layers/FeatureLayer","esri/layers/support/LabelClass","esri/Graphic","esri/geometry/Point","esri/geometry/Circle","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){e[0],e[1];var n=e[2],s=e[3],d=e[4],y=(e[5],e[6]),c=e[7],t=b.view.map.findLayerById(b.displayedLayerid);if(t){var p=[];if(f instanceof Array)f.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){(l=e.attributes).uuid=e.uuid;var t=new n({geometry:new s({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:b.view.spatialReference}),attributes:l});p.push(t),b.mapoverlayersflayer.push([e.uuid,e.uuid,t])}else if("circle"===e.overlaytype.toLowerCase())(l=e.attributes).uuid=e.uuid,t=new n({geometry:new d({center:new s({x:e.center.X,y:e.center.Y,z:e.center.Z,spatialReference:b.view.spatialReference}),radius:e.radius,radiusUnit:e.radiusUnit,spatialReference:b.view.spatialReference}),attributes:l}),p.push(t),b.mapoverlayersflayer.push([e.uuid,e.uuid,t]);else if("polyline"===e.overlaytype.toLowerCase()){(l=e.attributes).uuid=e.uuid;var i=[];e.path.forEach(function(e){i.push([e.X,e.Y,e.Z])});var r=new y({hasZ:!1,hasM:!1,paths:i,spatialReference:b.view.spatialReference});t=new n({geometry:r,attributes:l}),p.push(t),b.mapoverlayersflayer.push([e.uuid,e.uuid,t])}else if("polygon"===e.overlaytype.toLowerCase()){var l;(l=e.attributes).uuid=e.uuid;var o=[];e.paths.forEach(function(e){o.push([e.X,e.Y,e.Z])});var a=new c({hasZ:!0,hasM:!0,rings:o,spatialReference:b.view.spatialReference});t=new n({geometry:a,attributes:l}),p.push(t),b.mapoverlayersflayer.push([e.uuid,e.uuid,t])}}),t.applyEdits({addFeatures:p}).then(function(e){});else{if("marker"===f.overlaytype.toLowerCase()){(o=f.attributes).uuid=f.uuid;var i=new n({geometry:new s({x:f.position[0],y:f.position[1],z:void 0===f.position[2]?0:f.position[2],spatialReference:b.view.spatialReference}),attributes:o});p.push(i),b.mapoverlayersflayer.push([f.uuid,f.uuid,i])}else if("circle"===f.overlaytype.toLowerCase())(o=f.attributes).uuid=f.uuid,i=new n({geometry:new d({center:new s({x:f.center.X,y:f.center.Y,z:f.center.Z,spatialReference:b.view.spatialReference}),radius:f.radius,radiusUnit:f.radiusUnit,spatialReference:b.view.spatialReference}),attributes:o}),p.push(i),b.mapoverlayersflayer.push([f.uuid,f.uuid,i]);else if("polyline"===f.overlaytype.toLowerCase()){(o=f.attributes).uuid=f.uuid;var r=[];f.path.forEach(function(e){r.push([e.X,e.Y,e.Z])});var l=new y({hasZ:!1,hasM:!1,paths:r,spatialReference:b.view.spatialReference});i=new n({geometry:l,attributes:o}),p.push(i),b.mapoverlayersflayer.push([f.uuid,f.uuid,i])}else if("polygon"===f.overlaytype.toLowerCase()){var o;(o=f.attributes).uuid=f.uuid;var a=[];f.paths.forEach(function(e){a.push([e.X,e.Y,e.Z])});var u=new c({hasZ:!0,hasM:!0,rings:a,spatialReference:b.view.spatialReference});i=new n({geometry:u,attributes:o}),p.push(i),b.mapoverlayersflayer.push([f.uuid,f.uuid,i])}t.applyEdits({addFeatures:p}).then(function(e){})}}})},Q.prototype.updatefeature=function(u){var f=this;L(["esri/layers/FeatureLayer","esri/layers/support/LabelClass","esri/Graphic","esri/geometry/Point","esri/geometry/Circle","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){e[0],e[1],e[2];var n=e[3],s=e[4],d=(e[5],e[6]),y=e[7];if(f.view.map.findLayerById(f.displayedLayerid)){var c=[];if(u instanceof Array)u.forEach(function(t){var i=f.mapoverlayersflayer.filter(function(e){return e[1]===t.uuid});if(1===i.length){if("marker"===t.overlaytype.toLowerCase()){var e=new n({x:t.position[0],y:t.position[1],z:void 0===t.position[2]?0:t.position[2],spatialReference:f.view.spatialReference});i[0][2].geometry=e}else if("circle"===t.overlaytype.toLowerCase())e=new s({center:new n({x:t.center.X,y:t.center.Y,z:t.center.Z,spatialReference:f.view.spatialReference}),radius:t.radius,radiusUnit:t.radiusUnit,spatialReference:f.view.spatialReference}),i[0][2].geometry=e;else if("polyline"===t.overlaytype.toLowerCase()){var r=[];t.path.forEach(function(e){r.push([e.X,e.Y,e.Z])});var l=new d({hasZ:!1,hasM:!1,paths:r,spatialReference:f.view.spatialReference});i[0][2].geometry=l}else if("polygon"===t.overlaytype.toLowerCase()){var o=[];t.paths.forEach(function(e){o.push([e.X,e.Y,e.Z])});var a=new y({hasZ:!0,hasM:!0,rings:o,spatialReference:f.view.spatialReference});i[0][2].geometry=a}Object.keys(t.attributes).map(function(e){"objectId"!==e&&i[0][2].setAttribute(e,t.attributes[e])}),c.push(i[0][2])}}),(t=f.view.map.findLayerById(f.displayedLayerid))&&c.length&&t.applyEdits({updateFeatures:c}).then(function(e){});else if("group"===u.type){var t;u.overlayers.forEach(function(t){var i=f.mapoverlayersflayer.filter(function(e){return e[1]===t.uuid});if(1===i.length){if("marker"===t.overlaytype.toLowerCase()){var e=new n({x:t.position[0],y:t.position[1],z:void 0===t.position[2]?0:t.position[2],spatialReference:f.view.spatialReference});i[0][2].geometry=e}else if("circle"===t.overlaytype.toLowerCase())e=new s({center:new n({x:t.center.X,y:t.center.Y,z:t.center.Z,spatialReference:f.view.spatialReference}),radius:t.radius,radiusUnit:t.radiusUnit,spatialReference:f.view.spatialReference}),i[0][2].geometry=e;else if("polyline"===t.overlaytype.toLowerCase()){var r=[];t.path.forEach(function(e){r.push([e.X,e.Y,e.Z])});var l=new d({hasZ:!1,hasM:!1,paths:r,spatialReference:f.view.spatialReference});i[0][2].geometry=l}else if("polygon"===t.overlaytype.toLowerCase()){var o=[];t.paths.forEach(function(e){o.push([e.X,e.Y,e.Z])});var a=new y({hasZ:!0,hasM:!0,rings:o,spatialReference:f.view.spatialReference});i[0][2].geometry=a}Object.keys(t.attributes).map(function(e){"objectId"!==e&&i[0][2].setAttribute(e,t.attributes[e])}),c.push(i[0][2])}}),(t=f.view.map.findLayerById(f.displayedLayerid))&&c.length&&t.applyEdits({updateFeatures:c}).then(function(e){})}else if("element"===u.type){var p=f.mapoverlayersflayer.filter(function(e){return e[1]===u.uuid});p.forEach(function(t){if(u.attributes.uuid=u.uuid,"marker"===u.overlaytype.toLowerCase()){var e=new n({x:u.position[0],y:u.position[1],z:void 0===u.position[2]?0:u.position[2],spatialReference:f.view.spatialReference});t[2].geometry=e}else if("circle"===u.overlaytype.toLowerCase())e=new s({center:new n({x:u.center.X,y:u.center.Y,z:u.center.Z,spatialReference:f.view.spatialReference}),radius:u.radius,radiusUnit:u.radiusUnit,spatialReference:f.view.spatialReference}),p[0][2].geometry=e;else if("polyline"===u.overlaytype.toLowerCase()){var i=[];u.path.forEach(function(e){i.push([e.X,e.Y,e.Z])});var r=new d({hasZ:!1,hasM:!1,paths:i,spatialReference:f.view.spatialReference});p[0][2].geometry=r}else if("polygon"===u.overlaytype.toLowerCase()){var l=[];u.paths.forEach(function(e){l.push([e.X,e.Y,e.Z])});var o=new y({hasZ:!0,hasM:!0,rings:l,spatialReference:f.view.spatialReference});p[0][2].geometry=o}Object.keys(u.attributes).map(function(e){"objectId"!==e&&t[2].setAttribute(e,u.attributes[e])}),c.push(t[2]);var a=f.view.map.findLayerById(f.displayedLayerid);a&&c.length&&a.applyEdits({updateFeatures:c}).then(function(e){})})}}})},Q.prototype.removefeature=function(t){var e=this;if(this.view.map.findLayerById(this.displayedLayerid))if(t instanceof Array){var i=[];t.forEach(function(t){e.mapoverlayersflayer.filter(function(e){return e[1]===t.uuid}).forEach(function(e){i.push(e[2])}),e.mapoverlayersflayer=e.mapoverlayersflayer.filter(function(e){return e[1]!==t.uuid})}),(o=this.view.map.findLayerById(this.displayedLayerid))&&i.length&&o.applyEdits({deleteFeatures:i}).then(function(e){})}else if("group"===t.type){var r=this.mapoverlayersflayer.filter(function(e){return e[0]===t.uuid}),l=[];r.forEach(function(e){l.push(e[2])}),(o=this.view.map.findLayerById(this.displayedLayerid))&&l.length&&o.applyEdits({deleteFeatures:l}).then(function(e){}),this.mapoverlayersflayer=this.mapoverlayersflayer.filter(function(e){return e[0]!==t.uuid})}else if("element"===t.type){r=this.mapoverlayersflayer.filter(function(e){return e[1]===t.uuid});var o,a=[];r.forEach(function(e){a.push(e[2])}),(o=this.view.map.findLayerById(this.displayedLayerid))&&a.length&&o.applyEdits({deleteFeatures:a}).then(function(e){}),this.mapoverlayersflayer=this.mapoverlayersflayer.filter(function(e){return e[1]!==t.uuid})}},Q.prototype.removeAll=function(){var t=this,e=this.view.map.findLayerById(this.displayedLayerid);if(e){var i=[];this.mapoverlayersflayer.forEach(function(e){i.push(e[2])}),e.applyEdits({deleteFeatures:i}).then(function(e){t.mapoverlayersflayer=[]})}},Q.prototype.delete=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(this.view.map.remove(e),this.mapoverlayersflayer=[])},Q.prototype.addcluster=function(e){var t=this.view.map.findLayerById(this.displayedLayerid);t&&(t.featureReduction=e)},Q.prototype.deletecluster=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.featureReduction=null)},Q.prototype.show=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!0)},Q.prototype.hide=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!1)},Q.prototype.init=function(i){return N(this,void 0,void 0,function(){var t=this;return V(this,function(e){return this.displayedLayerid=(new x).uuid,this.view=i,this.view.on(z.click,function(a){t.view.hitTest(a).then(function(o){return N(t,void 0,void 0,function(){var t,i,r,l=this;return V(this,function(e){if(0<o.results.length){if(!o.results[0].graphic.layer)return[2];if(!(t=o.results[0].graphic.layer.id))return[2];t===this.displayedLayerid&&(i=o.results[0].graphic.attributes.objectId,(r=o.results[0].graphic.layer.createQuery()).where="objectId ="+i,o.results[0].graphic.layer.queryFeatures(r).then(function(e){0<e.features.length&&l.emit(z.click,e.features,a,a.mapPoint)}))}return[2]})})})}),this.view.on(z.pointermove,function(n){t.view.hitTest(n).then(function(a){return N(t,void 0,void 0,function(){var t,i,r,l,o=this;return V(this,function(e){if(0<a.results.length){if(!a.results[0].graphic.layer)return[2];if(!(t=a.results[0].graphic.layer.id))return[2];t===this.displayedLayerid&&(i=a.results[0].graphic.attributes.objectId,(r=a.results[0].graphic.layer.createQuery()).where="objectId ="+i,a.results[0].graphic.layer.queryFeatures(r).then(function(e){0<e.features.length&&(o.eventResult=e.features,o.emit(z.pointermove,e.features,n,o.view.toMap({x:n.x,y:n.y})))}))}else{if(null===this.eventResult)return[2];l=this.eventResult,this.eventResult=null,this.emit(z.pointerleave,l,n,this.view.toMap({x:n.x,y:n.y}))}return[2]})})})}),[2]})})},Q);function Q(e){var t=D.call(this)||this;return t.displayedLayerid="",t.view=null,t.mapoverlayersflayer=[],t.eventResult=null,t.init(e),t}var K,ee,te=(K=function(e,t){return(K=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}K(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ie=function(e,a,n,s){return new(n=n||Promise)(function(i,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function l(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(r,l)}o((s=s.apply(e,a||[])).next())})},re=function(i,r){var l,o,a,e,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(l)throw new TypeError("Generator is already executing.");for(;n;)try{if(l=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,o=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){n=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){n.label=t[1];break}if(6===t[0]&&n.label<a[1]){n.label=a[1],a=t;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(t);break}a[2]&&n.ops.pop(),n.trys.pop();continue}t=r.call(i,n)}catch(e){t=[6,e],o=0}finally{l=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},le=(te(oe,ee=e),oe.prototype.add=function(l){var o=this;L(["smiapi/utils/FlashPoint3DLayer","esri/geometry/Point","esri/views/3d/externalRenderers"]).then(function(e){var t=e[0],i=e[1],r=e[2];o.falshpoint3DRenderer=new t({nring:l.nring,spead:l.spead,size:l.size,color:l.color,view:l.view,points:l.points},function(e){var t=null;null!=e&&(t=new i({x:e.x,y:e.y,spatialReference:{wkid:102100}})),o.emit(z.click,e,t)},function(e){var t=null;null!=e&&(t=new i({x:e.x,y:e.y,spatialReference:{wkid:102100}})),o.emit(z.pointermove,e,t)}),r.add(o.view,o.falshpoint3DRenderer)})},oe.prototype.remove=function(){var t=this;L(["esri/views/3d/externalRenderers"]).then(function(e){e[0].remove(t.view,t.falshpoint3DRenderer)})},oe.prototype.init=function(t){return ie(this,void 0,void 0,function(){return re(this,function(e){return this.view=t,[2]})})},oe);function oe(e){var t=ee.call(this)||this;return t.view=null,t.falshpoint3DRenderer=null,t.init(e),t}var ae,ne,se=(ae=function(e,t){return(ae=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}ae(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),de=function(e,a,n,s){return new(n=n||Promise)(function(i,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function l(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(r,l)}o((s=s.apply(e,a||[])).next())})},ye=function(i,r){var l,o,a,e,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(l)throw new TypeError("Generator is already executing.");for(;n;)try{if(l=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,o=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){n=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){n.label=t[1];break}if(6===t[0]&&n.label<a[1]){n.label=a[1],a=t;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(t);break}a[2]&&n.ops.pop(),n.trys.pop();continue}t=r.call(i,n)}catch(e){t=[6,e],o=0}finally{l=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},ce=(se(pe,ne=e),pe.prototype.add=function(A){var E=this;L(["esri/Graphic","esri/geometry/Point","esri/layers/GraphicsLayer","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon","esri/geometry/Circle"]).then(function(e){var x=e[0],z=e[1],t=e[2],k=(e[3],e[4]),C=e[5],R=e[6],i=E.view.map.findLayerById(E.displayedLayerid);if(i||(i=new t({id:E.displayedLayerid,title:"Overlayer-"+E.displayedLayerid}),E.view.map.add(i)),A instanceof Array)A.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var t=void 0;t=e.symbol?e.symbol:"2d"===E.view.type?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]};var i=e.attributes;i.uuid=e.uuid;var r=new x({geometry:new z({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:E.view.spatialReference}),symbol:t,attributes:i});if(E.mapoverlayers.push(["smap-default",e.uuid,r]),(w=E.view.map.findLayerById(E.displayedLayerid))&&w.add(r),e.label.visible){var l=null;l=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}};var o=new x({geometry:new z({x:"3d"===E.view.type?e.position[0]+e.label.xoffset:e.position[0],y:"3d"===E.view.type?e.position[1]+e.label.yoffset:e.position[1],z:"3d"===E.view.type?e.position[2]+e.label.zoffset:e.position[2],spatialReference:E.view.spatialReference}),symbol:l,attributes:i});(g=E.view.map.findLayerById(E.displayedLayerid))&&g.add(o),E.mapoverlayers.push(["smap-default",e.uuid,o])}}else if("polyline"===e.overlaytype.toLowerCase()){var a=null;a=e.symbol?e.symbol:{type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin};var n=[];e.path.forEach(function(e){n.push([e.X,e.Y,e.Z])});var s=new k({hasZ:!1,hasM:!1,paths:n,spatialReference:E.view.spatialReference}),d=e.attributes;d.uuid=e.uuid;var y=new x({geometry:s,symbol:a,attributes:d});if(E.mapoverlayers.push(["smap-default",e.uuid,y]),(w=E.view.map.findLayerById(E.displayedLayerid))&&w.add(y),e.label.visible){var c=null;c=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},o=new x({geometry:y.geometry.extent.center,symbol:c,attributes:d}),(g=E.view.map.findLayerById(E.displayedLayerid))&&g.add(o),E.mapoverlayers.push(["smap-default",e.uuid,o])}}else if("polygon"===e.overlaytype.toLowerCase()){var p=void 0;p=e.symbol?e.symbol:"simple"===e.symboltype?{type:"simple-fill",color:e.fillColor,style:e.style,outline:{color:e.strokeColor,width:e.strokeWeight,style:e.strokestyle}}:{type:"picture-fill",url:e.url,width:e.picwidth,height:e.picheight,outline:{style:e.strokestyle,color:e.strokeColor,width:e.strokeWeight}};var u=[];e.paths.forEach(function(e){u.push([e.X,e.Y,e.Z])});var f=new C({hasZ:!0,hasM:!0,rings:u,spatialReference:E.view.spatialReference}),b=e.attributes;b.uuid=e.uuid;var v=new x({geometry:f,symbol:p,attributes:b});if(E.mapoverlayers.push(["smap-default",e.uuid,v]),(w=E.view.map.findLayerById(E.displayedLayerid))&&w.add(v),e.label.visible){var h=null;h=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},o=new x({geometry:v.geometry.extent.center,symbol:h,attributes:b}),(g=E.view.map.findLayerById(E.displayedLayerid))&&g.add(o),E.mapoverlayers.push(["smap-default",e.uuid,o])}}else if("circle"===e.overlaytype.toLowerCase()&&(p=void 0,p=e.symbol?e.symbol:"simple"===e.symboltype?{type:"simple-fill",color:e.fillColor,style:e.style,outline:{color:e.strokeColor,width:e.strokeWeight,style:e.strokestyle}}:{type:"picture-fill",url:e.url,width:e.picwidth,height:e.picheight,outline:{style:e.strokestyle,color:e.strokeColor,width:e.strokeWeight}},e.attributes&&e.center&&e.radius)){var m=e.attributes;m.uuid=e.uuid;var w,g,L=new x({geometry:new R({center:new z({x:e.center.X,y:e.center.Y,z:e.center.Z,spatialReference:E.view.spatialReference}),radius:e.radius,radiusUnit:e.radiusUnit,spatialReference:E.view.spatialReference}),symbol:p,attributes:m});if(E.mapoverlayers.push(["smap-default",e.uuid,L]),(w=E.view.map.findLayerById(E.displayedLayerid))&&w.add(L),e.label.visible)h=null,h=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},o=new x({geometry:L.geometry.extent.center,symbol:h,attributes:m}),(g=E.view.map.findLayerById(E.displayedLayerid))&&g.add(o),E.mapoverlayers.push(["smap-default",e.uuid,o])}});else if("group"===A.type)A.overlayers.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var t=void 0;t=e.symbol?e.symbol:"2d"===E.view.type?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]};var i=e.attributes;i.uuid=e.uuid;var r=new x({geometry:new z({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:E.view.spatialReference}),symbol:t,attributes:i});if(E.mapoverlayers.push([A.uuid,e.uuid,r]),(g=E.view.map.findLayerById(E.displayedLayerid))&&g.add(r),e.label.visible){var l=null;l=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}};var o=new x({geometry:new z({x:"3d"===E.view.type?e.position[0]+e.label.xoffset:e.position[0],y:"3d"===E.view.type?e.position[1]+e.label.yoffset:e.position[1],z:"3d"===E.view.type?e.position[2]+e.label.zoffset:e.position[2],spatialReference:E.view.spatialReference}),symbol:l,attributes:i});(w=E.view.map.findLayerById(E.displayedLayerid))&&w.add(o),E.mapoverlayers.push([A.uuid,e.uuid,o])}}else if("polyline"===e.overlaytype.toLowerCase()){var a=null;a=e.symbol?e.symbol:{type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin};var n=[];e.path.forEach(function(e){n.push([e.X,e.Y,e.Z])});var s=new k({hasZ:!1,hasM:!1,paths:n,spatialReference:E.view.spatialReference}),d=e.attributes;d.uuid=e.uuid;var y=new x({geometry:s,symbol:a,attributes:d});if(E.mapoverlayers.push([A.uuid,e.uuid,y]),(w=E.view.map.findLayerById(E.displayedLayerid))&&w.add(y),e.label.visible){var c=null;c=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},o=new x({geometry:y.geometry.extent.center,symbol:c,attributes:d}),(g=E.view.map.findLayerById(E.displayedLayerid))&&g.add(o),E.mapoverlayers.push([A.uuid,e.uuid,o])}}else if("polygon"===e.overlaytype.toLowerCase()){var p=void 0;p=e.symbol?e.symbol:"simple"===e.symboltype?{type:"simple-fill",color:e.fillColor,style:e.style,outline:{color:e.strokeColor,width:e.strokeWeight,style:e.strokestyle}}:{type:"picture-fill",url:e.url,width:e.picwidth,height:e.picheight,outline:{style:e.strokestyle,color:e.strokeColor,width:e.strokeWeight}};var u=[];e.paths.forEach(function(e){u.push([e.X,e.Y,e.Z])});var f=e.attributes;f.uuid=e.uuid;var b=new C({hasZ:!0,hasM:!0,rings:u,spatialReference:E.view.spatialReference}),v=new x({geometry:b,symbol:p,attributes:f});if(E.mapoverlayers.push([A.uuid,e.uuid,v]),(g=E.view.map.findLayerById(E.displayedLayerid))&&g.add(v),e.label.visible){var h=null;h=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},o=new x({geometry:v.geometry.extent.center,symbol:h,attributes:f}),(w=E.view.map.findLayerById(E.displayedLayerid))&&w.add(o),E.mapoverlayers.push([A.uuid,e.uuid,o])}}else if("circle"===e.overlaytype.toLowerCase()&&(p=void 0,p=e.symbol?e.symbol:"simple"===e.symboltype?{type:"simple-fill",color:e.fillColor,style:e.style,outline:{color:e.strokeColor,width:e.strokeWeight,style:e.strokestyle}}:{type:"picture-fill",url:e.url,width:e.picwidth,height:e.picheight,outline:{style:e.strokestyle,color:e.strokeColor,width:e.strokeWeight}},e.attributes&&e.center&&e.radius)){var m=e.attributes;m.uuid=e.uuid;var w,g,L=new x({geometry:new R({center:new z({x:e.center.X,y:e.center.Y,z:e.center.Z,spatialReference:E.view.spatialReference}),radius:e.radius,radiusUnit:e.radiusUnit,spatialReference:E.view.spatialReference}),symbol:p,attributes:m});if(E.mapoverlayers.push(["smap-default",e.uuid,L]),(w=E.view.map.findLayerById(E.displayedLayerid))&&w.add(L),e.label.visible)h=null,h=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},o=new x({geometry:L.geometry.extent.center,symbol:h,attributes:m}),(g=E.view.map.findLayerById(E.displayedLayerid))&&g.add(o),E.mapoverlayers.push(["smap-default",e.uuid,o])}});else if("element"===A.type)if("marker"===A.overlaytype.toLowerCase()){var r=void 0;r=A.symbol?A.symbol:"2d"===E.view.type?{type:"picture-marker",url:A.icon.image,width:A.icon.size.width,height:A.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:A.icon.size.width,resource:{href:A.icon.image}}]};var l=A.attributes;l.uuid=A.uuid;var o=new x({geometry:new z({x:A.position[0],y:A.position[1],z:void 0===A.position[2]?0:A.position[2],spatialReference:E.view.spatialReference}),symbol:r,attributes:l});if(E.mapoverlayers.push(["smap-default",A.uuid,o]),(g=E.view.map.findLayerById(E.displayedLayerid))&&g.add(o),A.label.visible){var a=null;a=A.label.labelingInfo?A.label.labelingInfo:{type:A.label.type,text:A.label.text,color:A.label.color,angle:A.label.angle,backgroundColor:A.label.backgroundColor,borderLineColor:A.label.borderLineColor,borderLineSize:A.label.borderLineSize,kerning:A.label.kerning,lineHeight:A.label.lineHeight,lineWidth:A.label.lineWidth,rotated:A.label.rotated,haloColor:A.label.haloColor,haloSize:A.label.haloSize,xoffset:A.label.xoffset,yoffset:A.label.yoffset,verticalAlignment:A.label.verticalAlignment,horizontalAlignment:A.label.horizontalAlignment,font:{size:A.label.size,family:"Josefin Slab",weight:A.label.weight}};var n=new x({geometry:new z({x:"3d"===E.view.type?A.position[0]+A.label.xoffset:A.position[0],y:"3d"===E.view.type?A.position[1]+A.label.yoffset:A.position[1],z:"3d"===E.view.type?A.position[2]+A.label.zoffset:A.position[2],spatialReference:E.view.spatialReference}),symbol:a,attributes:l});(I=E.view.map.findLayerById(E.displayedLayerid))&&I.add(n),E.mapoverlayers.push(["smap-default",A.uuid,n])}}else if("polyline"===A.overlaytype.toLowerCase()){var s=null;s=A.symbol?A.symbol:{type:"simple-line",color:A.strokeColor,style:A.style,width:A.width,cap:A.cap,join:A.lineJoin};var d=[];A.path.forEach(function(e){d.push([e.X,e.Y,e.Z])});var y=new k({hasZ:!1,hasM:!1,paths:d,spatialReference:E.view.spatialReference}),c=A.attributes;c.uuid=A.uuid;var p=new x({geometry:y,symbol:s,attributes:c});if(E.mapoverlayers.push(["smap-default",A.uuid,p]),(I=E.view.map.findLayerById(E.displayedLayerid))&&I.add(p),A.label.visible){var u=null;u=A.label.labelingInfo?A.label.labelingInfo:{type:A.label.type,text:A.label.text,color:A.label.color,angle:A.label.angle,backgroundColor:A.label.backgroundColor,borderLineColor:A.label.borderLineColor,borderLineSize:A.label.borderLineSize,kerning:A.label.kerning,lineHeight:A.label.lineHeight,lineWidth:A.label.lineWidth,rotated:A.label.rotated,haloColor:A.label.haloColor,haloSize:A.label.haloSize,xoffset:A.label.xoffset,yoffset:A.label.yoffset,verticalAlignment:A.label.verticalAlignment,horizontalAlignment:A.label.horizontalAlignment,font:{size:A.label.size,family:"Josefin Slab",weight:A.label.weight}},n=new x({geometry:p.geometry.extent.center,symbol:u,attributes:c}),(g=E.view.map.findLayerById(E.displayedLayerid))&&g.add(n),E.mapoverlayers.push(["smap-default",A.uuid,n])}}else if("polygon"===A.overlaytype.toLowerCase()){var f=void 0;f=A.symbol?A.symbol:"simple"===A.symboltype?{type:"simple-fill",color:A.fillColor,style:A.style,outline:{color:A.strokeColor,width:A.strokeWeight,style:A.strokestyle}}:{type:"picture-fill",url:A.url,width:A.picwidth,height:A.picheight,outline:{style:A.strokestyle,color:A.strokeColor,width:A.strokeWeight}};var b=[];A.paths.forEach(function(e){b.push([e.X,e.Y,e.Z])});var v=A.attributes;v.uuid=A.uuid;var h=new C({hasZ:!0,hasM:!0,rings:b,spatialReference:E.view.spatialReference}),m=new x({geometry:h,symbol:f,attributes:v});E.mapoverlayers.push(["smap-default",A.uuid,m]),(g=E.view.map.findLayerById(E.displayedLayerid))&&g.add(m),A.label.visible&&(u=null,u=A.label.labelingInfo?A.label.labelingInfo:{type:A.label.type,text:A.label.text,color:A.label.color,angle:A.label.angle,backgroundColor:A.label.backgroundColor,borderLineColor:A.label.borderLineColor,borderLineSize:A.label.borderLineSize,kerning:A.label.kerning,lineHeight:A.label.lineHeight,lineWidth:A.label.lineWidth,rotated:A.label.rotated,haloColor:A.label.haloColor,haloSize:A.label.haloSize,xoffset:A.label.xoffset,yoffset:A.label.yoffset,verticalAlignment:A.label.verticalAlignment,horizontalAlignment:A.label.horizontalAlignment,font:{size:A.label.size,family:"Josefin Slab",weight:A.label.weight}},n=new x({geometry:m.geometry.extent.center,symbol:u,attributes:v}),(I=E.view.map.findLayerById(E.displayedLayerid))&&I.add(n),E.mapoverlayers.push(["smap-default",A.uuid,n]))}else if("circle"===A.overlaytype.toLowerCase()&&(f=void 0,f=A.symbol?A.symbol:"simple"===A.symboltype?{type:"simple-fill",color:A.fillColor,style:A.style,outline:{color:A.strokeColor,width:A.strokeWeight,style:A.strokestyle}}:{type:"picture-fill",url:A.url,width:A.picwidth,height:A.picheight,outline:{style:A.strokestyle,color:A.strokeColor,width:A.strokeWeight}},A.attributes&&A.center&&A.radius)){var w=A.attributes;w.uuid=A.uuid;var g,L=new x({geometry:new R({center:new z({x:A.center.X,y:A.center.Y,z:A.center.Z,spatialReference:E.view.spatialReference}),radius:A.radius,radiusUnit:A.radiusUnit,spatialReference:E.view.spatialReference}),symbol:f,attributes:w});if(E.mapoverlayers.push(["smap-default",A.uuid,L]),(g=E.view.map.findLayerById(E.displayedLayerid))&&g.add(L),A.label.visible){var I,S=null;S=A.label.labelingInfo?A.label.labelingInfo:{type:A.label.type,text:A.label.text,color:A.label.color,angle:A.label.angle,backgroundColor:A.label.backgroundColor,borderLineColor:A.label.borderLineColor,borderLineSize:A.label.borderLineSize,kerning:A.label.kerning,lineHeight:A.label.lineHeight,lineWidth:A.label.lineWidth,rotated:A.label.rotated,haloColor:A.label.haloColor,haloSize:A.label.haloSize,xoffset:A.label.xoffset,yoffset:A.label.yoffset,verticalAlignment:A.label.verticalAlignment,horizontalAlignment:A.label.horizontalAlignment,font:{size:A.label.size,family:"Josefin Slab",weight:A.label.weight}},n=new x({geometry:L.geometry.extent.center,symbol:S,attributes:w}),(I=E.view.map.findLayerById(E.displayedLayerid))&&I.add(n),E.mapoverlayers.push(["smap-default",A.uuid,n])}}}).catch(function(e){console.error(e)})},pe.prototype.remove=function(t){var i=this;t instanceof Array?t.forEach(function(t){i.mapoverlayers.filter(function(e){return e[1]===t.uuid}).forEach(function(e){var t=i.view.map.findLayerById(i.displayedLayerid);t&&t.remove(e[2])}),i.mapoverlayers=i.mapoverlayers.filter(function(e){return e[1]!==t.uuid})}):"group"===t.type?(this.mapoverlayers.filter(function(e){return e[0]===t.uuid}).forEach(function(e){var t=i.view.map.findLayerById(i.displayedLayerid);t&&t.remove(e[2])}),this.mapoverlayers=this.mapoverlayers.filter(function(e){return e[0]!==t.uuid})):"element"===t.type&&(this.mapoverlayers.filter(function(e){return e[1]===t.uuid}).forEach(function(e){var t=i.view.map.findLayerById(i.displayedLayerid);t&&t.remove(e[2])}),this.mapoverlayers=this.mapoverlayers.filter(function(e){return e[1]!==t.uuid}))},pe.prototype.update=function(I){var S=this;L(["esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon","esri/geometry/Circle"]).then(function(e){var x=e[0],z=e[1],k=(e[2],e[3]),C=e[4],R=e[5];if(I instanceof Array)I.forEach(function(t){if(S.mapoverlayers.filter(function(e){return e[1]===t.uuid}).forEach(function(e){var t=S.view.map.findLayerById(S.displayedLayerid);t&&t.remove(e[2])}),S.mapoverlayers=S.mapoverlayers.filter(function(e){return e[1]!==t.uuid}),"marker"===t.overlaytype.toLowerCase()){var e=void 0;e=t.symbol?t.symbol:"2d"===S.view.type?{type:"picture-marker",url:t.icon.image,width:t.icon.size.width,height:t.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:t.icon.size.width,resource:{href:t.icon.image}}]};var i=t.attributes;i.uuid=t.uuid;var r=new x({geometry:new z({x:t.position[0],y:t.position[1],z:void 0===t.position[2]?0:t.position[2],spatialReference:S.view.spatialReference}),symbol:e,attributes:i});if(S.mapoverlayers.push(["smap-default",t.uuid,r]),(g=S.view.map.findLayerById(S.displayedLayerid))&&g.add(r),t.label.visible){var l=null;l=t.label.labelingInfo?t.label.labelingInfo:{type:t.label.type,text:t.label.text,color:t.label.color,angle:t.label.angle,backgroundColor:t.label.backgroundColor,borderLineColor:t.label.borderLineColor,borderLineSize:t.label.borderLineSize,kerning:t.label.kerning,lineHeight:t.label.lineHeight,lineWidth:t.label.lineWidth,rotated:t.label.rotated,haloColor:t.label.haloColor,haloSize:t.label.haloSize,xoffset:t.label.xoffset,yoffset:t.label.yoffset,verticalAlignment:t.label.verticalAlignment,horizontalAlignment:t.label.horizontalAlignment,font:{size:t.label.size,family:"Josefin Slab",weight:t.label.weight}};var o=new x({geometry:new z({x:"3d"===S.view.type?t.position[0]+t.label.xoffset:t.position[0],y:"3d"===S.view.type?t.position[1]+t.label.yoffset:t.position[1],z:"3d"===S.view.type?t.position[2]+t.label.zoffset:t.position[2],spatialReference:S.view.spatialReference}),symbol:l,attributes:i});(w=S.view.map.findLayerById(S.displayedLayerid))&&w.add(o),S.mapoverlayers.push(["smap-default",t.uuid,o])}}else if("polyline"===t.overlaytype.toLowerCase()){var a=null;a=t.symbol?t.symbol:{type:"simple-line",color:t.strokeColor,style:t.style,width:t.width,cap:t.cap,join:t.lineJoin};var n=[];t.path.forEach(function(e){n.push([e.X,e.Y,e.Z])});var s=new k({hasZ:!1,hasM:!1,paths:n,spatialReference:S.view.spatialReference}),d=t.attributes;d.uuid=t.uuid;var y=new x({geometry:s,symbol:a,attributes:d});if(S.mapoverlayers.push(["smap-default",t.uuid,y]),(w=S.view.map.findLayerById(S.displayedLayerid))&&w.add(y),t.label.visible){var c=null;c=t.label.labelingInfo?t.label.labelingInfo:{type:t.label.type,text:t.label.text,color:t.label.color,angle:t.label.angle,backgroundColor:t.label.backgroundColor,borderLineColor:t.label.borderLineColor,borderLineSize:t.label.borderLineSize,kerning:t.label.kerning,lineHeight:t.label.lineHeight,lineWidth:t.label.lineWidth,rotated:t.label.rotated,haloColor:t.label.haloColor,haloSize:t.label.haloSize,xoffset:t.label.xoffset,yoffset:t.label.yoffset,verticalAlignment:t.label.verticalAlignment,horizontalAlignment:t.label.horizontalAlignment,font:{size:t.label.size,family:"Josefin Slab",weight:t.label.weight}},o=new x({geometry:y.geometry.extent.center,symbol:c,attributes:d}),(g=S.view.map.findLayerById(S.displayedLayerid))&&g.add(o),S.mapoverlayers.push(["smap-default",t.uuid,o])}}else if("polygon"===t.overlaytype.toLowerCase()){var p=void 0;p=t.symbol?t.symbol:"simple"===t.symboltype?{type:"simple-fill",color:t.fillColor,style:t.style,outline:{color:t.strokeColor,width:t.strokeWeight,style:t.strokestyle}}:{type:"picture-fill",url:t.url,width:t.picwidth,height:t.picheight,outline:{style:t.strokestyle,color:t.strokeColor,width:t.strokeWeight}};var u=[];t.paths.forEach(function(e){u.push([e.X,e.Y,e.Z])});var f=new C({hasZ:!0,hasM:!0,rings:u,spatialReference:S.view.spatialReference}),b=t.attributes;b.uuid=t.uuid;var v=new x({geometry:f,symbol:p,attributes:b});if(S.mapoverlayers.push(["smap-default",t.uuid,v]),(g=S.view.map.findLayerById(S.displayedLayerid))&&g.add(v),t.label.visible){var h=null;h=t.label.labelingInfo?t.label.labelingInfo:{type:t.label.type,text:t.label.text,color:t.label.color,angle:t.label.angle,backgroundColor:t.label.backgroundColor,borderLineColor:t.label.borderLineColor,borderLineSize:t.label.borderLineSize,kerning:t.label.kerning,lineHeight:t.label.lineHeight,lineWidth:t.label.lineWidth,rotated:t.label.rotated,haloColor:t.label.haloColor,haloSize:t.label.haloSize,xoffset:t.label.xoffset,yoffset:t.label.yoffset,verticalAlignment:t.label.verticalAlignment,horizontalAlignment:t.label.horizontalAlignment,font:{size:t.label.size,family:"Josefin Slab",weight:t.label.weight}},o=new x({geometry:v.geometry.extent.center,symbol:h,attributes:b}),(w=S.view.map.findLayerById(S.displayedLayerid))&&w.add(o),S.mapoverlayers.push(["smap-default",t.uuid,o])}}else if("circle"===t.overlaytype.toLowerCase()&&(p=void 0,p=t.symbol?t.symbol:"simple"===t.symboltype?{type:"simple-fill",color:t.fillColor,style:t.style,outline:{color:t.strokeColor,width:t.strokeWeight,style:t.strokestyle}}:{type:"picture-fill",url:t.url,width:t.picwidth,height:t.picheight,outline:{style:t.strokestyle,color:t.strokeColor,width:t.strokeWeight}},t.attributes&&t.center&&t.radius)){var m=t.attributes;m.uuid=t.uuid;var w,g,L=new x({geometry:new R({center:new z({x:t.center.X,y:t.center.Y,z:t.center.Z,spatialReference:S.view.spatialReference}),radius:t.radius,radiusUnit:t.radiusUnit,spatialReference:S.view.spatialReference}),symbol:p,attributes:m});if(S.mapoverlayers.push(["smap-default",t.uuid,L]),(w=S.view.map.findLayerById(S.displayedLayerid))&&w.add(L),t.label.visible)h=null,h=t.label.labelingInfo?t.label.labelingInfo:{type:t.label.type,text:t.label.text,color:t.label.color,angle:t.label.angle,backgroundColor:t.label.backgroundColor,borderLineColor:t.label.borderLineColor,borderLineSize:t.label.borderLineSize,kerning:t.label.kerning,lineHeight:t.label.lineHeight,lineWidth:t.label.lineWidth,rotated:t.label.rotated,haloColor:t.label.haloColor,haloSize:t.label.haloSize,xoffset:t.label.xoffset,yoffset:t.label.yoffset,verticalAlignment:t.label.verticalAlignment,horizontalAlignment:t.label.horizontalAlignment,font:{size:t.label.size,family:"Josefin Slab",weight:t.label.weight}},o=new x({geometry:L.geometry.extent.center,symbol:h,attributes:m}),(g=S.view.map.findLayerById(S.displayedLayerid))&&g.add(o),S.mapoverlayers.push(["smap-default",t.uuid,o])}});else if("group"===I.type)S.mapoverlayers.filter(function(e){return e[0]===I.uuid}).forEach(function(e){var t=S.view.map.findLayerById(S.displayedLayerid);t&&t.remove(e[2])}),S.mapoverlayers=S.mapoverlayers.filter(function(e){return e[0]!==I.uuid}),I.overlayers.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var t=void 0;t=e.symbol?e.symbol:"2d"===S.view.type?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]};var i=e.attributes;i.uuid=e.uuid;var r=new x({geometry:new z({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:S.view.spatialReference}),symbol:t,attributes:i});if(S.mapoverlayers.push([I.uuid,e.uuid,r]),(w=S.view.map.findLayerById(S.displayedLayerid))&&w.add(r),e.label.visible){var l=null;l=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}};var o=new x({geometry:new z({x:"3d"===S.view.type?e.position[0]+e.label.xoffset:e.position[0],y:"3d"===S.view.type?e.position[1]+e.label.yoffset:e.position[1],z:"3d"===S.view.type?e.position[2]+e.label.zoffset:e.position[2],spatialReference:S.view.spatialReference}),symbol:l,attributes:i});(g=S.view.map.findLayerById(S.displayedLayerid))&&g.add(o),S.mapoverlayers.push([I.uuid,e.uuid,o])}}else if("polyline"===e.overlaytype.toLowerCase()){var a=null;a=e.symbol?e.symbol:{type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin};var n=[];e.path.forEach(function(e){n.push([e.X,e.Y,e.Z])});var s=new k({hasZ:!1,hasM:!1,paths:n,spatialReference:S.view.spatialReference}),d=e.attributes;d.uuid=e.uuid;var y=new x({geometry:s,symbol:a,attributes:d});if(S.mapoverlayers.push([I.uuid,e.uuid,y]),(g=S.view.map.findLayerById(S.displayedLayerid))&&g.add(y),e.label.visible){var c=null;c=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},o=new x({geometry:y.geometry.extent.center,symbol:c,attributes:d}),(w=S.view.map.findLayerById(S.displayedLayerid))&&w.add(o),S.mapoverlayers.push([I.uuid,e.uuid,o])}}else if("polygon"===e.overlaytype.toLowerCase()){var p=void 0;p=e.symbol?e.symbol:"simple"===I.symboltype?{type:"simple-fill",color:I.fillColor,style:I.style,outline:{color:I.strokeColor,width:I.strokeWeight,style:I.strokestyle}}:{type:"picture-fill",url:I.url,width:I.picwidth,height:I.picheight,outline:{style:I.strokestyle,color:I.strokeColor,width:I.strokeWeight}};var u=[];I.paths.forEach(function(e){u.push([e.X,e.Y,e.Z])});var f=e.attributes;f.uuid=e.uuid;var b=new C({hasZ:!0,hasM:!0,rings:u,spatialReference:S.view.spatialReference}),v=new x({geometry:b,symbol:p,attributes:f});if(S.mapoverlayers.push(["smap-default",I.uuid,v]),(w=S.view.map.findLayerById(S.displayedLayerid))&&w.add(v),I.label.visible){var h=null;h=e.label.labelingInfo?e.label.labelingInfo:{type:I.label.type,text:I.label.text,color:I.label.color,angle:I.label.angle,backgroundColor:I.label.backgroundColor,borderLineColor:I.label.borderLineColor,borderLineSize:I.label.borderLineSize,kerning:I.label.kerning,lineHeight:I.label.lineHeight,lineWidth:I.label.lineWidth,rotated:I.label.rotated,haloColor:I.label.haloColor,haloSize:I.label.haloSize,xoffset:I.label.xoffset,yoffset:I.label.yoffset,verticalAlignment:I.label.verticalAlignment,horizontalAlignment:I.label.horizontalAlignment,font:{size:I.label.size,family:"Josefin Slab",weight:I.label.weight}},o=new x({geometry:v.geometry.extent.center,symbol:h,attributes:f}),(g=S.view.map.findLayerById(S.displayedLayerid))&&g.add(o),S.mapoverlayers.push(["smap-default",I.uuid,o])}}else if("circle"===e.overlaytype.toLowerCase()&&(p=void 0,p=e.symbol?e.symbol:"simple"===e.symboltype?{type:"simple-fill",color:e.fillColor,style:e.style,outline:{color:e.strokeColor,width:e.strokeWeight,style:e.strokestyle}}:{type:"picture-fill",url:e.url,width:e.picwidth,height:e.picheight,outline:{style:e.strokestyle,color:e.strokeColor,width:e.strokeWeight}},e.attributes&&e.center&&e.radius)){var m=e.attributes;m.uuid=e.uuid;var w,g,L=new x({geometry:new R({center:new z({x:e.center.X,y:e.center.Y,z:e.center.Z,spatialReference:S.view.spatialReference}),radius:e.radius,radiusUnit:e.radiusUnit,spatialReference:S.view.spatialReference}),symbol:p,attributes:m});if(S.mapoverlayers.push(["smap-default",e.uuid,L]),(w=S.view.map.findLayerById(S.displayedLayerid))&&w.add(L),e.label.visible)h=null,h=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},o=new x({geometry:L.geometry.extent.center,symbol:h,attributes:m}),(g=S.view.map.findLayerById(S.displayedLayerid))&&g.add(o),S.mapoverlayers.push(["smap-default",e.uuid,o])}});else if("element"===I.type)if(S.mapoverlayers.filter(function(e){return e[1]===I.uuid}).forEach(function(e){var t=S.view.map.findLayerById(S.displayedLayerid);t&&t.remove(e[2])}),S.mapoverlayers=S.mapoverlayers.filter(function(e){return e[1]!==I.uuid}),"marker"===I.overlaytype.toLowerCase()){var t=void 0;t=I.symbol?I.symbol:"2d"===S.view.type?{type:"picture-marker",url:I.icon.image,width:I.icon.size.width,height:I.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:I.icon.size.width,resource:{href:I.icon.image}}]};var i=I.attributes;i.uuid=I.uuid;var r=new x({geometry:new z({x:I.position[0],y:I.position[1],z:void 0===I.position[2]?0:I.position[2],spatialReference:S.view.spatialReference}),symbol:t,attributes:i});if(S.mapoverlayers.push(["smap-default",I.uuid,r]),(g=S.view.map.findLayerById(S.displayedLayerid))&&g.add(r),I.label.visible){var l=null;l=I.label.labelingInfo?I.label.labelingInfo:{type:I.label.type,text:I.label.text,color:I.label.color,angle:I.label.angle,backgroundColor:I.label.backgroundColor,borderLineColor:I.label.borderLineColor,borderLineSize:I.label.borderLineSize,kerning:I.label.kerning,lineHeight:I.label.lineHeight,lineWidth:I.label.lineWidth,rotated:I.label.rotated,haloColor:I.label.haloColor,haloSize:I.label.haloSize,xoffset:I.label.xoffset,yoffset:I.label.yoffset,verticalAlignment:I.label.verticalAlignment,horizontalAlignment:I.label.horizontalAlignment,font:{size:I.label.size,family:"Josefin Slab",weight:I.label.weight}};var o=new x({geometry:new z({x:"3d"===S.view.type?I.position[0]+I.label.xoffset:I.position[0],y:"3d"===S.view.type?I.position[1]+I.label.yoffset:I.position[1],z:"3d"===S.view.type?I.position[2]+I.label.zoffset:I.position[2],spatialReference:S.view.spatialReference}),symbol:l,attributes:i});(m=S.view.map.findLayerById(S.displayedLayerid))&&m.add(o),S.mapoverlayers.push(["smap-default",I.uuid,o])}}else if("polyline"===I.overlaytype.toLowerCase()){var a=null;a=I.symbol?I.symbol:{type:"simple-line",color:I.strokeColor,style:I.style,width:I.width,cap:I.cap,join:I.lineJoin};var n=[];I.path.forEach(function(e){n.push([e.X,e.Y,e.Z])});var s=new k({hasZ:!1,hasM:!1,paths:n,spatialReference:S.view.spatialReference}),d=I.attributes;d.uuid=I.uuid;var y=new x({geometry:s,symbol:a,attributes:d});if(S.mapoverlayers.push(["smap-default",I.uuid,y]),(m=S.view.map.findLayerById(S.displayedLayerid))&&m.add(y),I.label.visible){var c=null;c=I.label.labelingInfo?I.label.labelingInfo:{type:I.label.type,text:I.label.text,color:I.label.color,angle:I.label.angle,backgroundColor:I.label.backgroundColor,borderLineColor:I.label.borderLineColor,borderLineSize:I.label.borderLineSize,kerning:I.label.kerning,lineHeight:I.label.lineHeight,lineWidth:I.label.lineWidth,rotated:I.label.rotated,haloColor:I.label.haloColor,haloSize:I.label.haloSize,xoffset:I.label.xoffset,yoffset:I.label.yoffset,verticalAlignment:I.label.verticalAlignment,horizontalAlignment:I.label.horizontalAlignment,font:{size:I.label.size,family:"Josefin Slab",weight:I.label.weight}},o=new x({geometry:y.geometry.extent.center,symbol:c,attributes:d}),(g=S.view.map.findLayerById(S.displayedLayerid))&&g.add(o),S.mapoverlayers.push(["smap-default",I.uuid,o])}}else if("polygon"===I.overlaytype.toLowerCase()){var p=void 0;p=I.symbol?I.symbol:"simple"===I.symboltype?{type:"simple-fill",color:I.fillColor,style:I.style,outline:{color:I.strokeColor,width:I.strokeWeight,style:I.strokestyle}}:{type:"picture-fill",url:I.url,width:I.picwidth,height:I.picheight,outline:{style:I.strokestyle,color:I.strokeColor,width:I.strokeWeight}};var u=[];I.paths.forEach(function(e){u.push([e.X,e.Y,e.Z])});var f=new C({hasZ:!0,hasM:!0,rings:u,spatialReference:S.view.spatialReference}),b=I.attributes;b.uuid=I.uuid;var v=new x({geometry:f,symbol:p,attributes:b});S.mapoverlayers.push(["smap-default",I.uuid,v]),(g=S.view.map.findLayerById(S.displayedLayerid))&&g.add(v),I.label.visible&&(c=null,c=I.label.labelingInfo?I.label.labelingInfo:{type:I.label.type,text:I.label.text,color:I.label.color,angle:I.label.angle,backgroundColor:I.label.backgroundColor,borderLineColor:I.label.borderLineColor,borderLineSize:I.label.borderLineSize,kerning:I.label.kerning,lineHeight:I.label.lineHeight,lineWidth:I.label.lineWidth,rotated:I.label.rotated,haloColor:I.label.haloColor,haloSize:I.label.haloSize,xoffset:I.label.xoffset,yoffset:I.label.yoffset,verticalAlignment:I.label.verticalAlignment,horizontalAlignment:I.label.horizontalAlignment,font:{size:I.label.size,family:"Josefin Slab",weight:I.label.weight}},o=new x({geometry:v.geometry.extent.center,symbol:c,attributes:b}),(m=S.view.map.findLayerById(S.displayedLayerid))&&m.add(o),S.mapoverlayers.push(["smap-default",I.uuid,o]))}else if("circle"===I.overlaytype.toLowerCase()&&(p=void 0,p=I.symbol?I.symbol:"simple"===I.symboltype?{type:"simple-fill",color:I.fillColor,style:I.style,outline:{color:I.strokeColor,width:I.strokeWeight,style:I.strokestyle}}:{type:"picture-fill",url:I.url,width:I.picwidth,height:I.picheight,outline:{style:I.strokestyle,color:I.strokeColor,width:I.strokeWeight}},I.attributes&&I.center&&I.radius)){var h=I.attributes;h.uuid=I.uuid;var m,w=new x({geometry:new R({center:new z({x:I.center.X,y:I.center.Y,z:I.center.Z,spatialReference:S.view.spatialReference}),radius:I.radius,radiusUnit:I.radiusUnit,spatialReference:S.view.spatialReference}),symbol:p,attributes:h});if(S.mapoverlayers.push(["smap-default",I.uuid,w]),(m=S.view.map.findLayerById(S.displayedLayerid))&&m.add(w),I.label.visible){var g,L=null;L=I.label.labelingInfo?I.label.labelingInfo:{type:I.label.type,text:I.label.text,color:I.label.color,angle:I.label.angle,backgroundColor:I.label.backgroundColor,borderLineColor:I.label.borderLineColor,borderLineSize:I.label.borderLineSize,kerning:I.label.kerning,lineHeight:I.label.lineHeight,lineWidth:I.label.lineWidth,rotated:I.label.rotated,haloColor:I.label.haloColor,haloSize:I.label.haloSize,xoffset:I.label.xoffset,yoffset:I.label.yoffset,verticalAlignment:I.label.verticalAlignment,horizontalAlignment:I.label.horizontalAlignment,font:{size:I.label.size,family:"Josefin Slab",weight:I.label.weight}},o=new x({geometry:w.geometry.extent.center,symbol:L,attributes:h}),(g=S.view.map.findLayerById(S.displayedLayerid))&&g.add(o),S.mapoverlayers.push(["smap-default",I.uuid,o])}}})},pe.prototype.removeAll=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.removeAll(),this.mapoverlayers=[])},pe.prototype.delete=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(this.view.map.remove(e),this.mapoverlayers=[])},pe.prototype.show=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!0)},pe.prototype.hide=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!1)},pe.prototype.init=function(i){return de(this,void 0,void 0,function(){var t=this;return ye(this,function(e){return this.displayedLayerid=(new x).uuid,this.view=i,this.view.on(z.click,function(r){t.view.hitTest(r).then(function(i){return de(t,void 0,void 0,function(){var t;return ye(this,function(e){if(0<i.results.length){if(!i.results[0].graphic.layer)return[2];if(!(t=i.results[0].graphic.layer.id))return[2];t===this.displayedLayerid&&this.emit(z.click,i,r.mapPoint)}return[2]})})})}),this.view.on(z.pointermove,function(r){t.view.hitTest(r).then(function(i){return de(t,void 0,void 0,function(){var t;return ye(this,function(e){if(0<i.results.length){if(!i.results[0].graphic.layer)return[2];if(!(t=i.results[0].graphic.layer.id))return[2];t===this.displayedLayerid&&this.emit(z.pointermove,i,this.view.toMap({x:r.x,y:r.y}))}return[2]})})})}),[2]})})},pe);function pe(e){var t=ne.call(this)||this;return t.displayedLayerid="",t.view=null,t.mapoverlayers=[],t.init(e),t}var ue,fe,be=(ue=function(e,t){return(ue=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}ue(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ve=function(e,a,n,s){return new(n=n||Promise)(function(i,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function l(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(r,l)}o((s=s.apply(e,a||[])).next())})},he=function(i,r){var l,o,a,e,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(l)throw new TypeError("Generator is already executing.");for(;n;)try{if(l=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,o=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){n=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){n.label=t[1];break}if(6===t[0]&&n.label<a[1]){n.label=a[1],a=t;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(t);break}a[2]&&n.ops.pop(),n.trys.pop();continue}t=r.call(i,n)}catch(e){t=[6,e],o=0}finally{l=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},me=(be(we,fe=e),we.prototype.add=function(r){var l=this;L(["smiapi/utils/HeatMapLayer"]).then(function(e){var t=e[0],i={container:document.getElementById(r.container),radius:r.radius||30,maxOpacity:r.maxOpacity||.8,minOpacity:r.minOpacity||0,blur:r.blur||.7,gradient:r.gradient||{0:"rgb(0,0,0)",.3:"rgb(0,0,255)",.8:"rgb(0,255,0)",.98:"rgb(255,255,0)",1:"rgb(255,0,0)"}};l.heatmaplayer=new t(l.view,i,r.datas,r.h337,r.id),l.heatmaplayer.addData()})},we.prototype.remove=function(e){var t=document.getElementsByClassName("esri-view-surface")[0],i=document.getElementById(e);null!=i&&t.removeChild(i)},we.prototype.refreshdata=function(e){this.heatmaplayer.setVisible(!0),this.heatmaplayer.freshenLayerData(e)},we.prototype.show=function(){this.heatmaplayer.setVisible(!0)},we.prototype.hide=function(){this.heatmaplayer.setVisible(!1)},we.prototype.init=function(t){return ve(this,void 0,void 0,function(){return he(this,function(e){return this.displayedLayerid=(new x).uuid,this.view=t,[2]})})},we);function we(e){var t=fe.call(this)||this;return t.displayedLayerid="",t.view=null,t.heatmaplayer=null,t.init(e),t}var ge=(Le.shqxboundary="qx_boundary",Le.shjdboundary="jd_boundary",Le.shjwhboundary="jwh_boundary",Le);function Le(){}var xe,ze,ke=(xe=function(e,t){return(xe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}xe(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ce=function(e,a,n,s){return new(n=n||Promise)(function(i,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function l(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(r,l)}o((s=s.apply(e,a||[])).next())})},Re=function(i,r){var l,o,a,e,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(l)throw new TypeError("Generator is already executing.");for(;n;)try{if(l=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,o=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){n=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){n.label=t[1];break}if(6===t[0]&&n.label<a[1]){n.label=a[1],a=t;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(t);break}a[2]&&n.ops.pop(),n.trys.pop();continue}t=r.call(i,n)}catch(e){t=[6,e],o=0}finally{l=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},Ie=(ke(Se,ze=e),Se.prototype.add=function(u){var f=this;L(["esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Polygon","esri/geometry/geometryEngineAsync","esri/geometry/SpatialReference","esri/Color"]).then(function(e){var d=e[0],t=e[1],i=e[2],y=e[3],c=(e[4],e[5]),r=null;"qx_boundary"!==u.boundaryType&&"jd_boundary"!==u.boundaryType&&"jwh_boundary"!==u.boundaryType||(r=f.view.map.findLayerById(u.boundaryType));var p=f.view.map.findLayerById(f.displayedLayerid);if(null==p&&(p=new t({id:f.displayedLayerid,title:u.boundaryType+"遮罩层",listMode:"hide"}),f.view.map.add(p)),p.removeAll(),u.inputgeometry){if(null===(r=f.view.map.findLayerById("qx_boundary")))return;var l=new i({rings:u.inputgeometry,spatialReference:f.view.spatialReference}),o=r.fullExtent;o.spatialReference=f.view.spatialReference;var s=l;s.spatialReference=f.view.spatialReference,y.buffer(s,u.boundarydistance,"meters").then(function(e){y.difference(o,e).then(function(e){var t;t="3d"===f.view.type?u.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:u.maskColor},size:u.symbol.size,edges:{type:"solid",color:u.maskColor}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:u.maskColor},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:u.maskColor,style:"solid",outline:{color:u.maskColor,width:1}};var i=new d({geometry:e,symbol:t});p.add(i);for(var l=void 0===u.bounarycount?30:u.bounarycount,o=Math.ceil(u.boundarydistance/l),a=new c(u.boundaryColor).toRgba(),r=function(r){y.buffer(s,r*l,"meters").then(function(t){y.buffer(s,(r-1)*l,"meters").then(function(e){y.difference(t,e).then(function(e){var t;a[3]=1/o*r,t="3d"===f.view.type?u.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:a},size:u.symbol.size,edges:{type:"solid",color:a}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:a},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:a,style:"solid",outline:{color:a,width:1}};var i=new d({geometry:e,symbol:t});p.add(i)})})})},n=1;n<=o;n++)r(n)})})}else{if(console.log(r),null===r)return;var a=r.createQuery();a.where=u.boundaryDefinition,r.queryFeatures(a).then(function(e){if(e.features.length){var t=r.fullExtent;t.spatialReference=f.view.spatialReference;var s=e.features[0].geometry;s.spatialReference=f.view.spatialReference,y.buffer(s,u.boundarydistance,"meters").then(function(e){y.difference(t,e).then(function(e){var t;t="3d"===f.view.type?u.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:u.maskColor},size:u.symbol.size,edges:{type:"solid",color:u.maskColor}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:u.maskColor},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:u.maskColor,style:"solid",outline:{color:u.maskColor,width:1}};var i=new d({geometry:e,symbol:t});p.add(i);for(var l=void 0===u.bounarycount?30:u.bounarycount,o=Math.ceil(u.boundarydistance/l),a=new c(u.boundaryColor).toRgba(),r=function(r){y.buffer(s,r*l,"meters").then(function(t){y.buffer(s,(r-1)*l,"meters").then(function(e){y.difference(t,e).then(function(e){var t;a[3]=1/o*r,t="3d"===f.view.type?u.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:a},size:u.symbol.size,edges:{type:"solid",color:a}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:a},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:a,style:"solid",outline:{color:a,width:1}};var i=new d({geometry:e,symbol:t});p.add(i)})})})},n=1;n<=o;n++)r(n)})})}})}})},Se.prototype.remove=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e)},Se.prototype.show=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!0)},Se.prototype.hide=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!1)},Se.prototype.init=function(t){return Ce(this,void 0,void 0,function(){return Re(this,function(e){return this.displayedLayerid=(new x).uuid,this.view=t,[2]})})},Se);function Se(e){var t=ze.call(this)||this;return t.displayedLayerid="",t.view=null,t.init(e),t}var Ae,Ee,Be=(Ae=function(e,t){return(Ae=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ae(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Pe=function(e,a,n,s){return new(n=n||Promise)(function(i,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function l(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(r,l)}o((s=s.apply(e,a||[])).next())})},Me=function(i,r){var l,o,a,e,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(l)throw new TypeError("Generator is already executing.");for(;n;)try{if(l=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,o=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){n=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){n.label=t[1];break}if(6===t[0]&&n.label<a[1]){n.label=a[1],a=t;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(t);break}a[2]&&n.ops.pop(),n.trys.pop();continue}t=r.call(i,n)}catch(e){t=[6,e],o=0}finally{l=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},_e=(Be(We,Ee=e),We.prototype.circle=function(){var g=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Point","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],b=e[1],i=e[2],v=e[3],h=e[4];g.drawtool=new t({view:g.view}),g.drawtool.reset();var m=g.view.map.findLayerById(g.displayedLayerid);null==m&&(m=new i({id:g.displayedLayerid,title:"测量结果显示层",listMode:"hide"}),g.view.map.add(m));var r=(new x).uuid,w=g.view.map.findLayerById(r);w||(w=new i({id:g.displayedLayerid,title:"测量圆实时追踪显示层",listMode:"hide"}),g.view.map.add(w));var l=g.drawtool.create("circle",{mode:"click"});g.view.focus(),l.on("vertex-add",function(e){if(2===e.vertices.length){w.removeAll();var t=new v({x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:g.view.spatialReference}),i=new v({x:e.vertices[1][0],y:e.vertices[1][1],spatialReference:g.view.spatialReference}),r=new b({geometry:{type:"polyline",paths:[[e.vertices[0],e.vertices[1]]],spatialReference:g.view.spatialReference},symbol:g.polylinesymbol}),l=h.geodesicLength(r.geometry,"meters"),o=h.buffer(t,l,"meters"),a=h.geodesicArea(o,"square-meters"),n=new b({geometry:o,symbol:g.polygonsymbol}),s=g.textsymbol,d=1e3<l?"半径:"+(l/1e3).toFixed(3)+"千米":"半径:"+parseFloat(l).toFixed(3)+"米";s.text=d;var y=new b({geometry:i,symbol:s}),c=g.textsymbol,p=1e5<a?"面积:"+(a/1e6).toFixed(3)+"平千方米":"面积:"+parseFloat(a).toFixed(3)+"平方米";c.text=p;var u=new b({geometry:t,symbol:c});w.add(n),w.add(r),w.add(y),w.add(u)}}),l.on("vertex-remove",function(e){console.log(e)}),l.on("cursor-update",function(e){if(2===e.vertices.length){w.removeAll();var t=new v({x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:g.view.spatialReference}),i=new v({x:e.vertices[1][0],y:e.vertices[1][1],spatialReference:g.view.spatialReference}),r=new b({geometry:{type:"polyline",paths:[[e.vertices[0],e.vertices[1]]],spatialReference:g.view.spatialReference},symbol:g.polylinesymbol}),l=h.geodesicLength(r.geometry,"meters"),o=h.buffer(t,l,"meters"),a=h.geodesicArea(o,"square-meters"),n=new b({geometry:o,symbol:g.polygonsymbol}),s=g.textsymbol,d=1e3<l?"半径:"+(l/1e3).toFixed(3)+"千米":"半径:"+parseFloat(l).toFixed(3)+"米";s.text=d;var y=new b({geometry:i,symbol:s}),c=g.textsymbol,p=1e5<a?"面积:"+(a/1e6).toFixed(3)+"平千方米":"面积:"+parseFloat(a).toFixed(3)+"平方米";c.text=p;var u=new b({geometry:t,symbol:c});w.add(n),w.add(r),w.add(y),w.add(u)}}),l.on("redo",function(e){console.log(e)}),l.on("undo",function(e){console.log(e)}),l.on("draw-complete",function(e){if(2===e.vertices.length){var t=new v({x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:g.view.spatialReference}),i=new v({x:e.vertices[1][0],y:e.vertices[1][1],spatialReference:g.view.spatialReference}),r=new b({geometry:{type:"polyline",paths:[[e.vertices[0],e.vertices[1]]],spatialReference:g.view.spatialReference},symbol:g.polylinesymbol}),l=h.geodesicLength(r.geometry,"meters"),o=h.buffer(t,l,"meters"),a=h.geodesicArea(o,"square-meters"),n=new b({geometry:o,symbol:g.polygonsymbol}),s=g.textsymbol,d=1e3<l?"半径:"+(l/1e3).toFixed(3)+"千米":"半径:"+parseFloat(l).toFixed(3)+"米";s.text=d;var y=new b({geometry:i,symbol:s}),c=g.textsymbol,p=1e5<a?"面积:"+(a/1e6).toFixed(3)+"平千方米":"面积:"+parseFloat(a).toFixed(3)+"平方米";c.text=p;var u=new b({geometry:t,symbol:c});g.view.map.remove(w),m.add(n),m.add(r),m.add(y),m.add(u);var f={radiusdistance:l,circlearea:a};g.emit("measurementcomplete",n,f,"circle")}})})},We.prototype.rectangle=function(){var P=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Point","esri/geometry/Polygon","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],R=e[1],i=e[2],I=e[3],S=e[4],A=e[5];P.drawtool=new t({view:P.view}),P.drawtool.reset();var E=P.view.map.findLayerById(P.displayedLayerid);E||(E=new i({id:P.displayedLayerid,title:"测量结果显示层",listMode:"hide"}),P.view.map.add(E));var r=(new x).uuid,B=P.view.map.findLayerById(r);null==B&&(B=new i({id:P.displayedLayerid,title:"测量矩形实时追踪显示层",listMode:"hide"}),P.view.map.add(B));var l=P.drawtool.create("rectangle",{mode:"click"});P.view.focus(),l.on("vertex-add",function(e){if(2===e.vertices.length){B.removeAll();var t=e.vertices[0][0]>e.vertices[1][0]?e.vertices[1][0]:e.vertices[0][0],i=e.vertices[0][1]>e.vertices[1][1]?e.vertices[1][1]:e.vertices[0][1],r=e.vertices[0][0]>e.vertices[1][0]?e.vertices[0][0]:e.vertices[1][0],l=e.vertices[0][1]>e.vertices[1][1]?e.vertices[0][1]:e.vertices[1][1],o=new S({hasZ:!0,hasM:!0,rings:[[[t,i],[r,i],[r,l],[t,l],[t,i]]],spatialReference:P.view.spatialReference}),a=new R({geometry:o,symbol:P.polygonsymbol}),n=new I({x:t+(r-t)/2,y:i,spatialReference:P.view.spatialReference}),s=new I({x:t,y:i,spatialReference:P.view.spatialReference}),d=new I({x:r,y:t,spatialReference:P.view.spatialReference}),y=A.distance(s,d,"meters"),c=P.textsymbol,p=1e3<y?"长度:"+(y/1e3).toFixed(3)+"千米":"长度:"+y.toFixed(3)+"米";c.text=p;var u=new R({geometry:n,symbol:c}),f=new I({x:r,y:i+(l-i)/2,spatialReference:P.view.spatialReference}),b=new I({x:r,y:i,spatialReference:P.view.spatialReference}),v=new I({x:r,y:l,spatialReference:P.view.spatialReference}),h=A.distance(b,v,"meters"),m=P.textsymbol,w=1e3<h?"宽度:"+(h/1e3).toFixed(3)+"千米":"宽度:"+h.toFixed(3)+"米";m.text=w;var g=new R({geometry:f,symbol:m}),L=new I({x:t+(r-t)/2,y:i+(l-i)/2,spatialReference:P.view.spatialReference}),x=P.textsymbol,z=y*h,k=1e5<z?"面积:"+(z/1e6).toFixed(3)+"平方千米":"面积:"+z.toFixed(3)+"平方米";x.text=k;var C=new R({geometry:L,symbol:x});B.add(u),B.add(g),B.add(C),B.add(a)}}),l.on("vertex-remove",function(e){console.log(e)}),l.on("cursor-update",function(e){if(2===e.vertices.length){B.removeAll();var t=e.vertices[0][0]>e.vertices[1][0]?e.vertices[1][0]:e.vertices[0][0],i=e.vertices[0][1]>e.vertices[1][1]?e.vertices[1][1]:e.vertices[0][1],r=e.vertices[0][0]>e.vertices[1][0]?e.vertices[0][0]:e.vertices[1][0],l=e.vertices[0][1]>e.vertices[1][1]?e.vertices[0][1]:e.vertices[1][1],o=new S({hasZ:!0,hasM:!0,rings:[[[t,i],[r,i],[r,l],[t,l],[t,i]]],spatialReference:P.view.spatialReference}),a=new R({geometry:o,symbol:P.polygonsymbol}),n=new I({x:t+(r-t)/2,y:i,spatialReference:P.view.spatialReference}),s=new I({x:t,y:i,spatialReference:P.view.spatialReference}),d=new I({x:r,y:i,spatialReference:P.view.spatialReference}),y=A.distance(s,d,"meters"),c=P.textsymbol,p=1e3<y?"长度:"+(y/1e3).toFixed(3)+"千米":"长度:"+y.toFixed(3)+"米";c.text=p;var u=new R({geometry:n,symbol:c}),f=new I({x:r,y:i+(l-i)/2,spatialReference:P.view.spatialReference}),b=new I({x:r,y:i,spatialReference:P.view.spatialReference}),v=new I({x:r,y:l,spatialReference:P.view.spatialReference}),h=A.distance(b,v,"meters"),m=P.textsymbol,w=1e3<h?"宽度:"+(h/1e3).toFixed(3)+"千米":"宽度:"+h.toFixed(3)+"米";m.text=w;var g=new R({geometry:f,symbol:m}),L=new I({x:t+(r-t)/2,y:i+(l-i)/2,spatialReference:P.view.spatialReference}),x=P.textsymbol,z=y*h,k=1e5<z?"面积:"+(z/1e6).toFixed(3)+"平方千米":"面积:"+z.toFixed(3)+"平方米";x.text=k;var C=new R({geometry:L,symbol:x});B.add(u),B.add(g),B.add(C),B.add(a)}}),l.on("redo",function(e){console.log(e)}),l.on("undo",function(e){console.log(e)}),l.on("draw-complete",function(e){if(2===e.vertices.length){var t=e.vertices[0][0]>e.vertices[1][0]?e.vertices[1][0]:e.vertices[0][0],i=e.vertices[0][1]>e.vertices[1][1]?e.vertices[1][1]:e.vertices[0][1],r=e.vertices[0][0]>e.vertices[1][0]?e.vertices[0][0]:e.vertices[1][0],l=e.vertices[0][1]>e.vertices[1][1]?e.vertices[0][1]:e.vertices[1][1],o=new S({hasZ:!0,hasM:!0,rings:[[[t,i],[r,i],[r,l],[t,l],[t,i]]],spatialReference:P.view.spatialReference}),a=new R({geometry:o,symbol:P.polygonsymbol}),n=new I({x:t+(r-t)/2,y:i,spatialReference:P.view.spatialReference}),s=new I({x:t,y:i,spatialReference:P.view.spatialReference}),d=new I({x:r,y:i,spatialReference:P.view.spatialReference}),y=A.distance(s,d,"meters"),c=P.textsymbol,p=1e3<y?"长度:"+(y/1e3).toFixed(3)+"千米":"长度:"+y.toFixed(3)+"米";c.text=p;var u=new R({geometry:n,symbol:c}),f=new I({x:r,y:i+(l-i)/2,spatialReference:P.view.spatialReference}),b=new I({x:r,y:i,spatialReference:P.view.spatialReference}),v=new I({x:r,y:l,spatialReference:P.view.spatialReference}),h=A.distance(b,v,"meters"),m=P.textsymbol,w=1e3<h?"宽度:"+(h/1e3).toFixed(3)+"千米":"宽度:"+h.toFixed(3)+"米";m.text=w;var g=new R({geometry:f,symbol:m}),L=new I({x:t+(r-t)/2,y:i+(l-i)/2,spatialReference:P.view.spatialReference}),x=P.textsymbol,z=y*h,k=1e5<z?"面积:"+(z/1e6).toFixed(3)+"平方千米":"面积:"+z.toFixed(3)+"平方米";x.text=k;var C=new R({geometry:L,symbol:x});P.view.map.remove(B),E.add(u),E.add(g),E.add(C),E.add(a),P.emit("measurementcomplete",a,{length:y,width:h,area:h*y},"rectangle")}})})},We.prototype.Point=function(){var d=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer"]).then(function(e){var t=e[0],a=e[1],i=e[2];d.drawtool=new t({view:d.view}),d.drawtool.reset();var n=d.view.map.findLayerById(d.displayedLayerid);n||(n=new i({id:d.displayedLayerid,title:"测量结果显示层",listMode:"hide"}),d.view.map.add(n));var r=(new x).uuid,s=d.view.map.findLayerById(r);null==s&&(s=new i({id:d.displayedLayerid,title:"测量点移动实时追踪显示层",listMode:"hide"}),d.view.map.add(s));var l=d.drawtool.create("point",{mode:"click"});d.view.focus(),l.on("vertex-add",function(e){console.log(e)}),l.on("vertex-remove",function(e){console.log(e)}),l.on("cursor-update",function(e){s.removeAll();var t={type:"point",x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:d.view.spatialReference},i=new a({geometry:t,symbol:d.marksymbol});s.add(i);var r=d.textsymbol;r.text="("+parseFloat(e.vertices[0][0]).toFixed(3)+","+parseFloat(e.vertices[0][1]).toFixed(3)+")";var l=new a({geometry:t,symbol:r});s.add(l)}),l.on("redo",function(e){console.log(e)}),l.on("undo",function(e){console.log(e)}),l.on("draw-complete",function(e){var t={type:"point",x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:d.view.spatialReference},i=new a({geometry:t,symbol:d.marksymbol}),r=d.textsymbol;r.text="("+parseFloat(e.vertices[0][0]).toFixed(3)+","+parseFloat(e.vertices[0][1]).toFixed(3)+")";var l=new a({geometry:t,symbol:r});d.view.map.remove(s),n.add(l),n.add(i);var o="("+parseFloat(e.vertices[0][0]).toFixed(3)+","+parseFloat(e.vertices[0][0]).toFixed(3)+")";d.emit("measurementcomplete",i,o,"point")})})},We.prototype.Multipoint=function(){var c=this;L(["esri/views/draw/Draw","esri/views/draw/PointDrawAction","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Polygon","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],n=(e[1],e[2]),i=e[3];e[4],e[5],c.drawtool=new t({view:c.view}),c.drawtool.reset();var s=c.view.map.findLayerById(c.displayedLayerid);s||(s=new i({id:c.displayedLayerid,title:"测量结果显示层",listMode:"hide"}),c.view.map.add(s));var r=(new x).uuid,d=c.view.map.findLayerById(r);null==d&&(d=new i({id:c.displayedLayerid,title:"测量多点临时显示层",listMode:"hide"}),c.view.map.add(d));var l=(new x).uuid,y=c.view.map.findLayerById(l);null==y&&(y=new i({id:c.displayedLayerid,title:"测量多点移动追踪显示层",listMode:"hide"}),c.view.map.add(y));var o=c.drawtool.create("multipoint",{mode:"click"});c.view.focus(),o.on("vertex-add",function(e){d.removeAll(),e.vertices.map(function(e){var t={type:"point",x:e[0],y:e[1],spatialReference:c.view.spatialReference},i=new n({geometry:t,symbol:c.marksymbol}),r=c.textsymbol;r.text="("+parseFloat(e[0]).toFixed(3)+","+parseFloat(e[1]).toFixed(3)+")";var l=new n({geometry:t,symbol:r});d.add(l),d.add(i)})}),o.on("vertex-remove",function(e){console.log(e)}),o.on("cursor-update",function(e){y.removeAll(),e.vertices.map(function(e){var t={type:"point",x:e[0],y:e[1],spatialReference:c.view.spatialReference},i=new n({geometry:t,symbol:c.marksymbol}),r=c.textsymbol;r.text="("+parseFloat(e[0]).toFixed(3)+","+parseFloat(e[1]).toFixed(3)+")";var l=new n({geometry:t,symbol:r});y.add(l),y.add(i)})}),o.on("redo",function(e){console.log(e)}),o.on("undo",function(e){console.log(e)}),o.on("draw-complete",function(e){c.view.map.remove(d),c.view.map.remove(y);var o=[],a=[];e.vertices.map(function(e){var t={type:"point",x:e[0],y:e[1],spatialReference:c.view.spatialReference},i=new n({geometry:t,symbol:c.marksymbol}),r=c.textsymbol;r.text="("+parseFloat(e[0]).toFixed(3)+","+parseFloat(e[1]).toFixed(3)+")";var l=new n({geometry:t,symbol:r});s.add(i),s.add(l),o.push(i),a.push(e)}),c.emit("measurementcomplete",o,a,"multipoint")})})},We.prototype.drawPolyline=function(){var v=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],p=e[1],i=e[2],u=e[3];v.drawtool=new t({view:v.view}),v.drawtool.reset();var f=v.view.map.findLayerById(v.displayedLayerid);f||(f=new i({id:v.displayedLayerid,title:"测量结果显示层",listMode:"hide"}),v.view.map.add(f));var r=(new x).uuid,b=v.view.map.findLayerById(r);null==b&&(b=new i({id:v.displayedLayerid,title:"测量多边线实时追踪显示层",listMode:"hide"}),v.view.map.add(b));var l=v.drawtool.create("polyline");v.view.focus(),l.on(["vertex-add","vertex-remove","cursor-update","redo","undo"],function(e){if(1<e.vertices.length){var t=e.vertices;b.removeAll();var i=new p({geometry:{type:"polyline",paths:t,spatialReference:v.view.spatialReference},symbol:v.polylinesymbol}),r=function(e){var t=e.clone(),i=t.removePoint(0,t.paths[0].length-1),r=t.getPoint(0,t.paths[0].length-1);return{type:"polyline",spatialReference:v.view.spatialReference,hasZ:!1,paths:[[[r.x,r.y],[i.x,i.y]]]}};if(function(e){if(!(e.paths[0].length<3)){var t=e.clone(),i=r(e);return t.removePoint(0,t.paths[0].length-1),u.crosses(i,t)}}(i.geometry)){var l=new p({geometry:r(i.geometry),symbol:v.polylinesymbol});l&&b.addMany([i,l]),l&&e.preventDefault()}else b.add(i);var o=v.textsymbol,a=u.geodesicLength(i.geometry,"meters"),n=1e3<a?"长度:"+(a/1e3).toFixed(3)+"千米":"长度:"+a.toFixed(3)+"米";o.text=n;var s=i.geometry.clone(),d=s.removePoint(0,s.paths[0].length-1),y=new p({geometry:d,symbol:o});b.add(y)}}),l.on("draw-complete",function(e){if(1<e.vertices.length){var t=e.vertices;b.removeAll();var i=new p({geometry:{type:"polyline",paths:t,spatialReference:v.view.spatialReference},symbol:v.polylinesymbol}),r=function(e){var t=e.clone(),i=t.removePoint(0,t.paths[0].length-1),r=t.getPoint(0,t.paths[0].length-1);return{type:"polyline",spatialReference:v.view.spatialReference,hasZ:!1,paths:[[[r.x,r.y],[i.x,i.y]]]}},l=null;if(function(e){if(!(e.paths[0].length<3)){var t=e.clone(),i=r(e);return t.removePoint(0,t.paths[0].length-1),u.crosses(i,t)}}(i.geometry)){var o=new p({geometry:r(i.geometry),symbol:v.polylinesymbol});o&&(f.addMany([i,o]),l=new p({geometry:u.union(i.geometry,o.geometry),symbol:v.polylinesymbol})),o&&e.preventDefault()}else l=i,f.add(i);var a=v.textsymbol,n=u.geodesicLength(i.geometry,"meters"),s=1e3<n?"长度:"+(n/1e3).toFixed(3)+"千米":"长度:"+n.toFixed(3)+"米";a.text=s;var d=i.geometry.clone(),y=d.removePoint(0,d.paths[0].length-1),c=new p({geometry:y,symbol:a});f.add(c),v.view.map.remove(b),v.emit("measurementcomplete",l,{distance:n},"polyline")}})})},We.prototype.drawPolygon=function(){var p=this;L(["esri/views/draw/Draw","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],s=e[1],i=e[2],d=e[3];p.drawtool=new t({view:p.view}),p.drawtool.reset();var y=p.view.map.findLayerById(p.displayedLayerid);y||(y=new i({id:p.displayedLayerid,title:"测量结果显示层",listMode:"hide"}),p.view.map.add(y));var r=(new x).uuid,c=p.view.map.findLayerById(r);null==c&&(c=new i({id:p.displayedLayerid,title:"测量多边形实时追踪显示层",listMode:"hide"}),p.view.map.add(c));var l=p.drawtool.create("polygon");p.view.focus(),l.on(["vertex-add","vertex-remove","cursor-update","redo","undo"],function(e){var t=e.vertices;c.removeAll();var i={type:"polygon",rings:t,spatialReference:p.view.spatialReference},r=new s({geometry:i,symbol:p.polygonsymbol});if(3<e.vertices.length){var l=d.geodesicArea(r.geometry,"square-meters"),o=p.textsymbol,a=1e5<Math.abs(l)?"面积:"+(Math.abs(l)/1e6).toFixed(3)+"平方千米":"面积:"+Math.abs(l).toFixed(3)+"平方米";o.text=a;var n=new s({geometry:r.geometry.extent.center,symbol:o});c.add(n)}c.add(r)}),l.on("draw-complete",function(e){var t=e.vertices;c.removeAll();var i={type:"polygon",rings:t,spatialReference:p.view.spatialReference},r=new s({geometry:i,symbol:p.polygonsymbol}),l=d.geodesicArea(r.geometry,"square-meters"),o=p.textsymbol,a=1e5<Math.abs(l)?"面积:"+(Math.abs(l)/1e6).toFixed(3)+"平方千米":"面积:"+Math.abs(l).toFixed(3)+"平方米";o.text=a;var n=new s({geometry:r.geometry.extent.center,symbol:o});p.view.map.remove(c),y.add(n),y.add(r),p.emit("measurementcomplete",r,{area:l},"polygon")})})},We.prototype.reset=function(){this.drawtool&&this.drawtool.reset()},We.prototype.clean=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e)},We.prototype.show=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!0)},We.prototype.hide=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!1)},We.prototype.init=function(i){return Pe(this,void 0,void 0,function(){var t=this;return Me(this,function(e){return this.displayedLayerid=(new x).uuid,this.view=i,"2d"===this.view.type?(this.polygonsymbol={type:"simple-fill",color:[255,255,255,.6],style:"solid",outline:{color:[255,255,0,.8],width:2}},this.polylinesymbol={type:"simple-line",color:[255,255,255,.6],width:"4px",style:"solid"},this.marksymbol={type:"simple-marker",style:"circle",color:[255,255,0,.6],size:"24px",outline:{color:[255,255,0,.8],width:2}}):(this.polygonsymbol={type:"polygon-3d",symbolLayers:[{type:"extrude",castShadows:!1,size:10,material:{color:[255,255,255,.4]},edges:{type:"solid",color:[50,50,50,.5]}}]},this.polylinesymbol={type:"line-3d",symbolLayers:[{type:"path",anchor:"center",Values:"center",profile:"quad",width:2,height:10,material:{color:[255,255,255,.4]},cap:"square",join:"miter",castShadows:!1,profileRotation:"heading"}]},this.marksymbol={type:"point-3d",symbolLayers:[{type:"object",width:20,height:20,depth:20,resource:{primitive:"sphere"},material:{color:[0,0,255,.8]}}],verticalOffset:{screenLength:60,maxWorldLength:1e3,minWorldLength:20},callout:{type:"line",size:1.5,color:"white",border:{color:"black"}}}),this.textsymbol={type:"text",color:"white",angle:0,text:"",xoffset:60,yoffset:10,horizontalAlignment:"right",verticalAlignment:"bottom",font:{size:12,family:"Josefin Slab",weight:"bold"}},this.view.on(z.click,function(e){t.view.hitTest(e).then(function(e){return Pe(t,void 0,void 0,function(){return Me(this,function(e){return[2]})})})}),this.view.on(z.pointermove,function(e){t.view.hitTest(e).then(function(e){return Pe(t,void 0,void 0,function(){return Me(this,function(e){return[2]})})})}),[2]})})},We);function We(e){var t=Ee.call(this)||this;return t.marksymbol=null,t.polylinesymbol=null,t.polygonsymbol=null,t.textsymbol=null,t.displayedLayerid="",t.view=null,t.drawtool=null,t.drawlayerscollection=[],t.init(e),t}var Fe,je,Oe=(Fe=function(e,t){return(Fe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Fe(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),He=function(e,a,n,s){return new(n=n||Promise)(function(i,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function l(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(r,l)}o((s=s.apply(e,a||[])).next())})},Ze=function(i,r){var l,o,a,e,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(l)throw new TypeError("Generator is already executing.");for(;n;)try{if(l=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,o=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){n=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){n.label=t[1];break}if(6===t[0]&&n.label<a[1]){n.label=a[1],a=t;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(t);break}a[2]&&n.ops.pop(),n.trys.pop();continue}t=r.call(i,n)}catch(e){t=[6,e],o=0}finally{l=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},Te=(Oe(Ge,je=e),Ge.prototype.add=function(o){var a=this;void 0===o&&(o={}),L(["esri/layers/echartsLayer"]).then(function(e){var t=e[0],i=[];o.datas.forEach(function(e,t){i.push({name:e[0]+" Top10",type:"lines",coordinateSystem:"arcgis",zlevel:1,effect:{show:!0,period:6,trailLength:.7,color:"#fff",symbolSize:3},lineStyle:{normal:{color:o.color[t],width:0,curveness:.2}},data:a.convertData(e[1],o.geoCoordMap)},{name:e[0]+" Top10",type:"lines",coordinateSystem:"arcgis",zlevel:2,symbol:["none","arrow"],symbolSize:10,effect:{show:!0,period:6,trailLength:0,symbol:o.planePath,symbolSize:15},lineStyle:{normal:{color:o.color[t],width:1,opacity:.6,curveness:.2}},data:a.convertData(e[1],o.geoCoordMap)},{name:e[0]+" Top10",type:"effectScatter",coordinateSystem:"arcgis",zlevel:2,rippleEffect:{brushType:"stroke"},legendHoverLink:!0,hoverAnimation:!0,symbol:o.symbol,label:{normal:{show:!0,position:"right",formatter:"{b}"}},symbolSize:function(e){return e[2]/8},itemStyle:{normal:{color:o.color[t],shadowBlur:10,shadowColor:"#333"}},data:e[1].map(function(e){return{name:e[1].name,value:o.geoCoordMap[e[1].name].concat([e[1].value])}})})});var r=new t(a.view,"",o.id),l={title:{text:"",subtext:"",left:"center",textStyle:{color:"#fff"}},series:i};r.setChartOption(l)})},Ge.prototype.remove=function(e){var t=document.getElementsByClassName("esri-view-surface")[0],i=document.getElementById(e);null!=i&&t.removeChild(i)},Ge.prototype.convertData=function(e,t){for(var i=[],r=0,l=e;r<l.length;r++){var o=l[r],a=t[o[0].name],n=t[o[1].name];a&&n&&i.push({fromName:o[0].name,toName:o[1].name,coords:[a,n],value:o[1].value})}return i},Ge.prototype.getAPIScript=function(e){return document.querySelector("script["+e+"]")},Ge.prototype.loadAPIScript=function(l,o){var a=this;return new r.Promise(function(e,t){var i=a.getAPIScript(l);if(i){var r=i.getAttribute("src");r!==o?t(new Error("The echartgl is already loaded ("+r+").")):a.handleScriptLoad(i,e,t)}else i=a.createScript(l,o),a.handleScriptLoad(i,function(){i.setAttribute(l,"loaded"),e(i)},t),document.head.appendChild(i)})},Ge.prototype.createScript=function(e,t){var i=document.createElement("script");return i.type="text/javascript",i.src=t,i.setAttribute(e,"loading"),i},Ge.prototype.handleScriptLoad=function(e,t,i){var r;i&&(r=this.handleScriptError(e,i));var l=function(){t(e),e.removeEventListener("load",l,!1),r&&e.removeEventListener("error",r,!1)};e.addEventListener("load",l,!1)},Ge.prototype.handleScriptError=function(t,i){var r=function(e){i(e.error||new Error("There was an error attempting to load "+t.src)),t.removeEventListener("error",r,!1)};return t.addEventListener("error",r,!1),r},Ge.prototype.init=function(t){return He(this,void 0,void 0,function(){return Ze(this,function(e){return this.view=t,[2]})})},Ge);function Ge(e){var t=je.call(this)||this;return t.view=null,t.init(e),t}var Je,Xe,qe=(Je=function(e,t){return(Je=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Je(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ye=function(e,a,n,s){return new(n=n||Promise)(function(i,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function l(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(r,l)}o((s=s.apply(e,a||[])).next())})},De=function(i,r){var l,o,a,e,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(l)throw new TypeError("Generator is already executing.");for(;n;)try{if(l=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,o=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){n=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){n.label=t[1];break}if(6===t[0]&&n.label<a[1]){n.label=a[1],a=t;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(t);break}a[2]&&n.ops.pop(),n.trys.pop();continue}t=r.call(i,n)}catch(e){t=[6,e],o=0}finally{l=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},Ue=(qe(Ne,Xe=e),Ne.prototype.play=function(a){var n=this;void 0===a&&(a={}),L(["geolocate","esri/widgets/Track","esri/geometry/support/webMercatorUtils"]).then(function(e){var i=e[0],t=e[1],r=e[2];if(void 0!==a.coords){var l=0;n.track=new t({view:n.view,goToLocationEnabled:!1});var o=0;i.use(),void 0!==n.routepalybackinternal&&clearInterval(n.routepalybackinternal),n.routepalybackinternal=setInterval(function(){var e=r.xyToLngLat(a.coords[o].x,a.coords[o].y),t={lng:e[0],lat:e[1]};i.change(t),o=(o+1)%a.coords.length,++l===a.coords.length&&clearInterval(n.routepalybackinternal)},2500),n.view.when(function(){var t=n.view.center;n.track.on("track",function(){a.mobilesymbol&&(n.track.graphic.symbol=a.mobilesymbol);var e=n.track.graphic.geometry;1<l&&a.showtrail&&n.createAnimateRoute(e,t,a.trailsymbol),n.view.goTo({center:e,tilt:70,scale:2500,heading:360-n.getHeading(e,t),rotation:360-n.getHeading(e,t)}).catch(function(e){"AbortError"!==e.name&&console.error(e)}),t=e.clone()}),n.track.start()})}}).catch(function(e){console.error(e)})},Ne.prototype.remove=function(){this.routepalybackinternal,clearInterval(this.routepalybackinternal),this.track.destroy();var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e)},Ne.prototype.getHeading=function(e,t){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI-90},Ne.prototype.createAnimateRoute=function(o,a,n){var s=this;L(["esri/Graphic","esri/layers/GraphicsLayer"]).then(function(e){var t=e[0],i=e[1],r=new t({geometry:{type:"polyline",paths:[[a.longitude,a.latitude],[o.longitude,o.latitude]]},symbol:void 0!==n?n:{type:"simple-line",color:[156,39,176],width:10}}),l=s.view.map.findLayerById(s.displayedLayerid);void 0===l&&(l=new i({title:"路径轨迹播放",id:s.displayedLayerid,listMode:"hide"}),s.view.map.add(l)),l.add(r)})},Ne.prototype.init=function(t){return Ye(this,void 0,void 0,function(){return De(this,function(e){return this.displayedLayerid=(new x).uuid,this.view=t,[2]})})},Ne);function Ne(e){var t=Xe.call(this)||this;return t.displayedLayerid="",t.view=null,t.routepalybackinternal=null,t.track=null,t.init(e),t}var Ve,$e,Qe=(Ve=function(e,t){return(Ve=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ve(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ke=function(e,a,n,s){return new(n=n||Promise)(function(i,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function l(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(r,l)}o((s=s.apply(e,a||[])).next())})},et=function(i,r){var l,o,a,e,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(l)throw new TypeError("Generator is already executing.");for(;n;)try{if(l=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,o=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){n=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){n.label=t[1];break}if(6===t[0]&&n.label<a[1]){n.label=a[1],a=t;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(t);break}a[2]&&n.ops.pop(),n.trys.pop();continue}t=r.call(i,n)}catch(e){t=[6,e],o=0}finally{l=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},tt=(Qe(it,$e=e),it.prototype.play=function(p){var u=this;void 0===p&&(p={}),L(["esri/geometry/Point","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/support/webMercatorUtils"]).then(function(e){var l=e[0],o=e[1],a=e[2];if(e[3],void 0!==p.coords){var n=0,s=0,d=u.view.center;void 0!==u.mapRoamplayinternal&&clearInterval(u.mapRoamplayinternal);var y=void 0!==p.duration?p.duration:2e3,c=void 0!==p.speedFactor?p.speedFactor:1;u.mapRoamplayinternal=setInterval(function(){var e={x:p.coords[s].x,y:p.coords[s].y,z:void 0!==p.coords[s].z?p.coords[s].z:0};s=(s+1)%p.coords.length,++n;var t=new l({x:e.x,y:e.y,z:e.z,spatialReference:u.view.spatialReference}),i=u.view.map.findLayerById(u.mobilelayerid);void 0===i&&(i=new a({title:"漫游路径"+u.mobilelayerid,id:u.mobilelayerid,listMode:"hide"}),u.view.map.add(i)),i.removeAll();var r=new o({geometry:t,symbol:p.mobilesymbol});i.add(r),1<n&&p.showtrail&&u.createAnimateRoute(t,d,p.trailsymbol),u.view.goTo({center:t,tilt:70,scale:2500,heading:360-u.getHeading(t,d),rotation:360-u.getHeading(t,d)},{speedFactor:c,duration:y-.2*y,maxDuration:y-.2*y,easing:"in-out-coast-quadratic"}).then().catch(function(e){"AbortError"!==e.name&&console.error(e)}),d=t.clone(),n===p.coords.length&&clearInterval(u.mapRoamplayinternal)},y)}}).catch(function(e){console.error(e)})},it.prototype.remove=function(){this.mapRoamplayinternal,clearInterval(this.mapRoamplayinternal);var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e);var t=this.view.map.findLayerById(this.mobilelayerid);t&&this.view.map.remove(t)},it.prototype.getHeading=function(e,t){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI-90},it.prototype.createAnimateRoute=function(o,a,n){var s=this;L(["esri/Graphic","esri/layers/GraphicsLayer"]).then(function(e){var t=e[0],i=e[1],r=new t({geometry:{type:"polyline",paths:[[a.x,a.y,a.z],[o.x,o.y,o.z]],spatialReference:s.view.spatialReference},symbol:void 0!==n?n:{type:"simple-line",color:[156,39,176],width:10}}),l=s.view.map.findLayerById(s.displayedLayerid);void 0===l&&(l=new i({title:"漫游路径"+s.displayedLayerid,id:s.displayedLayerid,listMode:"hide"}),s.view.map.add(l)),l.add(r)})},it.prototype.init=function(t){return Ke(this,void 0,void 0,function(){return et(this,function(e){return this.displayedLayerid=(new x).uuid,this.mobilelayerid=(new x).uuid,this.view=t,[2]})})},it);function it(e){var t=$e.call(this)||this;return t.displayedLayerid="",t.view=null,t.mapRoamplayinternal=null,t.mobilelayerid="",t.init(e),t}return{load:L,Layers:ge,Boundary:E,Draw:j,GraphicOverlays:ce,FeaureOverlays:$,EchartFlashPointLayer:X,FlashPoint3DLayer:le,HeatMap:me,Measurement:_e,MaskBoundary:Ie,TrajectoryPlus:tt,MigrationMap:Te,Trajectory:Ue}});
//# sourceMappingURL=Plugins.min.js.map

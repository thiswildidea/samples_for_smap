!function (e, t) { "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : e.Plugins = t() }(this, function () { "use strict"; var e = (t.prototype._addListener = function (e, t, i) { if (this.emit("newListener", e, t), this.events.has(e)) { var r = this.events.get(e); i ? r.unshift(t) : r.push(t) } else this.events.set(e, [t]); var o = this.getMaxListeners(); if (0 < o && this.listenerCount(e) > o) { var n = new Error("Possible EventEmitter memory leak detected.\n         " + this.listenerCount(e) + " " + e.toString() + " listeners.\n         Use emitter.setMaxListeners() to increase limit"); n.name = "MaxListenersExceededWarning", console.warn(n) } return this }, t.prototype.addListener = function (e, t) { return this._addListener(e, t, !1) }, t.prototype.emit = function (e) { for (var t = [], i = 1; i < arguments.length; i++)t[i - 1] = arguments[i]; if (this.events.has(e)) { for (var r = 0, o = this.events.get(e).slice(); r < o.length; r++) { var n = o[r]; try { n.apply(this, t) } catch (e) { this.emit("error", e) } } return !0 } if ("error" === e) throw 0 < t.length ? t[0] : Error("Unhandled error."); return !1 }, t.prototype.eventNames = function () { return Array.from(this.events.keys()) }, t.prototype.getMaxListeners = function () { return this.maxListeners || t.defaultMaxListeners }, t.prototype.listenerCount = function (e) { return this.events.has(e) ? this.events.get(e).length : 0 }, t.prototype._listeners = function (e, t, i) { if (!e.events.has(t)) return []; var r = e.events.get(t); return i ? this.unwrapListeners(r) : r.slice(0) }, t.prototype.unwrapListeners = function (e) { for (var t = new Array(e.length), i = 0; i < e.length; i++)t[i] = e[i].listener || e[i]; return t }, t.prototype.listeners = function (e) { return this._listeners(this, e, !0) }, t.prototype.rawListeners = function (e) { return this._listeners(this, e, !1) }, t.prototype.off = function (e, t) { return this.removeListener(e, t) }, t.prototype.on = function (e, t) { return this.addListener(e, t) }, t.prototype.once = function (e, t) { var i = this.onceWrap(e, t); return this.on(e, i), this }, t.prototype.onceWrap = function (e, t) { function i() { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t]; this.context.removeListener(this.eventName, this.rawListener), this.listener.apply(this.context, e) } var r = { eventName: e, listener: t, rawListener: i, context: this }, o = i.bind(r); return (r.rawListener = o).listener = t, o }, t.prototype.prependListener = function (e, t) { return this._addListener(e, t, !0) }, t.prototype.prependOnceListener = function (e, t) { var i = this.onceWrap(e, t); return this.prependListener(e, i), this }, t.prototype.removeAllListeners = function (e) { var t = this; if (void 0 === this.events) return this; if (this.events.has(e)) { var i = this.events.get(e).slice(); this.events.delete(e); for (var r = 0, o = i; r < o.length; r++) { var n = o[r]; this.emit("removeListener", e, n) } } else this.eventNames().map(function (e) { t.removeAllListeners(e) }); return this }, t.prototype.removeListener = function (e, t) { if (this.events.has(e)) { var i = this.events.get(e); -1 !== i.indexOf(t) && (i.splice(i.indexOf(t), 1), this.emit("removeListener", e, t), 0 === i.length && this.events.delete(e)) } return this }, t.prototype.setMaxListeners = function (e) { return this.maxListeners = e, this }, t.defaultMaxListeners = 50, t); function t() { this.events = new Map } var c = (i.jsapi ="http://31.8.11.75/smiapi/arcgis",i.jsapiversion4X="4.15",i);function i(){}var l=c.jsapiversion4X,o="next";function n(e){if(null===e&&(e=l),e.toString().toLowerCase()===o)return o;var t=e&&e.match(/^(\d)\.(\d+)/);return t&&{major:parseInt(t[1],10),minor:parseInt(t[2],10)}}function a(e){return void 0===e&&(e=l),c.jsapi+"/"+e+"/init.js"}function s(e){var t=document.createElement("link");return t.rel="stylesheet",t.href=e,t}function u(e,t){if(t){var i=document.querySelector(t);i.parentNode.insertBefore(e,i)}else document.head.appendChild(e)}function d(e){return document.querySelector('link[href*="'+e+'"]')}function y(e){return!e||n(e)?function(e){void 0===e&&(e=l),null===e&&(e=l);var t=a(e),i=t.substring(0,t.indexOf("init.js")),r=n(e);return r===o||3!==r.major?i+"esri/themes/light/main.css":i+(r.minor<=10?"js/":"")+"esri/css/esri.css"}(e):e}function p(e,t){var i=y(e),r=d(i);if(r||u(r=s(i),t),4===function(e){null===e&&(e=l);var t=e&&e.match(/^(\d)\.(\d+)/);return t&&{major:parseInt(t[1],10),minor:parseInt(t[2],10)}}(e).major){var o=i.substring(0,i.indexOf("esri/themes/"))+"esri/themes/gis/css/gis.css",n=d(o);n||u(n=s(o),t)}return r}var r={Promise:"undefined"!=typeof window?window.Promise:void 0},f={};function h(e,t,i){var r,o,n,l;i&&(n=i,l=function(e){n(e.error||new Error("There was an error attempting to load "+o.src)),o.removeEventListener("error",l,!1)},(o=e).addEventListener("error",l,!1),r=l);var a=function(){t(e),e.removeEventListener("load",a,!1),r&&e.removeEventListener("error",r,!1)};e.addEventListener("load",a,!1)}function b(){return document.querySelector("script[data-shsmi]")}function v(){var e=window.require;return e&&e.on}function m(e){void 0===e&&(e={});var s={};[f,e].forEach(function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(s[t]=e[t])});var u=s.version,d=s.url||a(u);return new r.Promise(function(e,t){var i,r,o=b();if(o){var n=o.getAttribute("src");n!==d?t(new Error("The ArcGIS API for JavaScript is already loaded ("+n+").")):v()?e(o):h(o,e,t)}else if(v())t(new Error("The ArcGIS API for JavaScript is already loaded."));else{var l=s.css;if(l)p(!0===l?u:l,s.insertCssBefore);else p(null,s.insertCssBefore);if(s.dojoConfig)window.dojoConfig=s.dojoConfig;else{var a={async:!0,packages:[{location:c.jsapi+"/extensions",name:"smiapi"},{location:c.jsapi+"/extensions/geolocation",name:"geolocate",main:"geolocate"}],deps:["@dojo/framework/shim/main"],has:{"esri-promise-compatibility":1,"esri-featurelayer-webgl":1}};window.dojoConfig=a}i=d,(r=document.createElement("script")).type="text/javascript",r.src=i,r.setAttribute("data-shsmi","loading"),h(o=r,function(){o.setAttribute("data-shsmi","loaded"),e(o)},t),document.head.appendChild(o)}})}function w(t){return new r.Promise(function(i,e){var r=window.require.on("error",e);window.require(t,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.remove(),i(e)})})}function g(e,t){if(void 0===t&&(t={}),v())return w(e);var i=b(),r=i&&i.getAttribute("src");return!t.url&&r&&(t.url=r),m(t).then(function(){return w(e)})}var L=(x.prototype.S4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},x.prototype.get_uuid=function(){return this.S4()+this.S4()+"-"+this.S4()+"-"+this.S4()+"-"+this.S4()+"-"+this.S4()+this.S4()+this.S4()},x);function x(){this.uuid=this.get_uuid()}var z=(k.maploaded="maploaded",k.zoomchanged="zoomchanged",k.extentchanged="extentchanged",k.centerchanged="centerchanged",k.blur="blur",k.click="click",k.doubleclick="doubleclick",k.drag="drag",k.focus="focus",k.hold="hold",k.keydown="key-down",k.keyup="key-up",k.mousewheel="mouse-wheel",k.pointerdown="pointer-down",k.pointerenter="pointer-enter",k.pointerleave="pointer-leave",k.pointermove="pointer-move",k.pointerup="pointer-up",k.resize="pointer-up",k.popupvisible="popup-visible",k);function k(){}var C,S,I=(C=function(e,t){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}C(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),A=function(e,l,a,s){return new(a=a||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,o)}n((s=s.apply(e,l||[])).next())})},R=function(i,r){var o,n,l,e,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(l=2&t[0]?n.return:t[0]?n.throw||((l=n.return)&&l.call(n),0):n.next)&&!(l=l.call(n,t[1])).done)return l;switch(n=0,l&&(t=[2&t[0],l.value]),t[0]){case 0:case 1:l=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,n=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(l=0<(l=a.trys).length&&l[l.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!l||t[1]>l[0]&&t[1]<l[3])){a.label=t[1];break}if(6===t[0]&&a.label<l[1]){a.label=l[1],l=t;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(t);break}l[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(i,a)}catch(e){t=[6,e],n=0}finally{o=l=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},E=(I(_,S=e),_.prototype.add=function(l){var a=this;void 0===l&&(l={}),g(["esri/layers/GraphicsLayer","esri/Graphic","esri/layers/FeatureLayer"]).then(function(e){var t=e[0],o=e[1],i=e[2];if(a.view){var r=null;if(l.boundaryType&&(r=a.view.map.findLayerById(l.boundaryType)),r||l.url&&(r=new i({url:l.url,id:l.boundaryType,title:l.boundaryType,visible:!1}),a.view.map.add(r)),r){var n=r.createQuery();n.where=l.boundaryDefinition,r.queryFeatures(n).then(function(e){if(0<e.features.length){var i,r=a.view.map.findLayerById(a.displayedLayerid);void 0===r&&(r=new t({title:a.displayedLayerid+"边界",id:a.displayedLayerid,listMode:"hide"}),a.view.map.add(r)),i=void 0!==l.symbol?l.symbol:{type:"simple-fill",color:[255,255,255,0],outline:{color:[255,255,0,1],width:"5px"}},e.features.map(function(e){var t=new o({geometry:e.geometry,symbol:i,attributes:e.attributes});r.add(t)})}})}}}).catch(function(e){console.error(e)})},_.prototype.remove=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e)},_.prototype.show=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!0)},_.prototype.hide=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!1)},_.prototype.init=function(t){return A(this,void 0,void 0,function(){var r=this;return R(this,function(e){return this.displayedLayerid=(new L).uuid,this.view=t,this.view.on(z.click,function(i){r.view.hitTest(i).then(function(t){return A(r,void 0,void 0,function(){return R(this,function(e){return 0<t.results.length&&t.results[0].graphic.layer.id===this.displayedLayerid&&this.emit(z.click,t.results[0].graphic,i.mapPoint),[2]})})})}),this.view.on(z.pointermove,function(i){r.view.hitTest(i).then(function(t){return A(r,void 0,void 0,function(){return R(this,function(e){return 0<t.results.length&&t.results[0].graphic.layer.id===this.displayedLayerid&&this.emit(z.pointermove,t.results[0].graphic,i.mapPoint),[2]})})})}),[2]})})},_);function _(e){var t=S.call(this)||this;return t.displayedLayerid="",t.view=null,t.init(e),t}var B,P,j=(B=function(e,t){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}B(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),M=function(e,l,a,s){return new(a=a||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,o)}n((s=s.apply(e,l||[])).next())})},O=function(i,r){var o,n,l,e,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(l=2&t[0]?n.return:t[0]?n.throw||((l=n.return)&&l.call(n),0):n.next)&&!(l=l.call(n,t[1])).done)return l;switch(n=0,l&&(t=[2&t[0],l.value]),t[0]){case 0:case 1:l=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,n=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(l=0<(l=a.trys).length&&l[l.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!l||t[1]>l[0]&&t[1]<l[3])){a.label=t[1];break}if(6===t[0]&&a.label<l[1]){a.label=l[1],l=t;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(t);break}l[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(i,a)}catch(e){t=[6,e],n=0}finally{o=l=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},W=(j(T,P=e),T.prototype.drawcircle=function(){var c=this;g(["esri/views/draw/Draw","esri/views/draw/PointDrawAction","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Point","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],l=(e[1],e[2]),i=e[3],a=e[4],s=e[5],r=new t({view:c.view}),u=c.view.map.findLayerById(c.displayedLayerid);null==u&&(u=new i({id:c.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),c.view.map.add(u));var o=(new L).uuid,d=c.view.map.findLayerById(o);d||(d=new i({id:c.displayedLayerid,title:"画圆显示层",listMode:"hide"}),c.view.map.add(d));var n=r.create("circle",{mode:"click"});c.view.focus(),n.on("vertex-add",function(e){if(2===e.vertices.length){d.removeAll();var t=new a({x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:c.view.spatialReference}),i=new a({x:e.vertices[1][0],y:e.vertices[1][1],spatialReference:c.view.spatialReference}),r=s.distance(t,i,"meters"),o=s.buffer(t,r,"meters"),n=new l({geometry:o,symbol:c.polygonsymbol});d.add(n)}}),n.on("vertex-remove",function(e){console.log(e)}),n.on("cursor-update",function(e){if(2===e.vertices.length){d.removeAll();var t=new a({x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:c.view.spatialReference}),i=new a({x:e.vertices[1][0],y:e.vertices[1][1],spatialReference:c.view.spatialReference}),r=s.distance(t,i,"meters"),o=s.buffer(t,r,"meters"),n=new l({geometry:o,symbol:c.polygonsymbol});d.add(n)}}),n.on("redo",function(e){console.log(e)}),n.on("undo",function(e){console.log(e)}),n.on("draw-complete",function(e){if(2===e.vertices.length){var t=new a({x:e.vertices[0][0],y:e.vertices[0][1],spatialReference:c.view.spatialReference}),i=new a({x:e.vertices[1][0],y:e.vertices[1][1],spatialReference:c.view.spatialReference}),r=s.distance(t,i,"meters"),o=s.buffer(t,r,"meters"),n=new l({geometry:o,symbol:{type:"simple-fill",color:[255,255,255,.6],style:"solid",outline:{color:"yellow",width:2}}});c.view.map.remove(d),u.add(n),c.emit("drawcomplete",n,"circle")}})})},T.prototype.drawrectangle=function(){var c=this;g(["esri/views/draw/Draw","esri/views/draw/PointDrawAction","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Polygon","esri/geometry/geometryEngine"]).then(function(e){var t=e[0],a=(e[1],e[2]),i=e[3],s=e[4],r=(e[5],new t({view:c.view})),u=c.view.map.findLayerById(c.displayedLayerid);u||(u=new i({id:c.displayedLayerid,title:"绘制结果显示层",listMode:"hide"}),c.view.map.add(u));var o=(new L).uuid,d=c.view.map.findLayerById(o);null==d&&(d=new i({id:c.displayedLayerid,title:"画圆显示层",listMode:"hide"}),c.view.map.add(d));var n=r.create("rectangle",{mode:"click"});c.view.focus(),n.on("vertex-add",function(e){if(2===e.vertices.length){d.removeAll();var t=e.vertices[0][0]>e.vertices[1][0]?e.vertices[1][0]:e.vertices[0][0],i=e.vertices[0][1]>e.vertices[1][1]?e.vertices[1][1]:e.vertices[0][1],r=e.vertices[0][0]>e.vertices[1][0]?e.vertices[0][0]:e.vertices[1][0],o=e.vertices[0][1]>e.vertices[1][1]?e.vertices[0][1]:e.vertices[1][1],n=new s({hasZ:!0,hasM:!0,rings:[[[t,i],[r,i],[r,o],[t,o],[t,i]]],spatialReference:c.view.spatialReference}),l=new a({geometry:n,symbol:c.polygonsymbol});d.add(l)}}),n.on("vertex-remove",function(e){console.log(e)}),n.on("cursor-update",function(e){if(2===e.vertices.length){d.removeAll();var t=e.vertices[0][0]>e.vertices[1][0]?e.vertices[1][0]:e.vertices[0][0],i=e.vertices[0][1]>e.vertices[1][1]?e.vertices[1][1]:e.vertices[0][1],r=e.vertices[0][0]>e.vertices[1][0]?e.vertices[0][0]:e.vertices[1][0],o=e.vertices[0][1]>e.vertices[1][1]?e.vertices[0][1]:e.vertices[1][1],n=new s({hasZ:!0,hasM:!0,rings:[[[t,i],[r,i],[r,o],[t,o],[t,i]]],spatialReference:c.view.spatialReference}),l=new a({geometry:n,symbol:c.polygonsymbol});d.add(l)}}),n.on("redo",function(e){console.log(e)}),n.on("undo",function(e){console.log(e)}),n.on("draw-complete",function(e){if(2===e.vertices.length){var t=e.vertices[0][0]>e.vertices[1][0]?e.vertices[1][0]:e.vertices[0][0],i=e.vertices[0][1]>e.vertices[1][1]?e.vertices[1][1]:e.vertices[0][1],r=e.vertices[0][0]>e.vertices[1][0]?e.vertices[0][0]:e.vertices[1][0],o=e.vertices[0][1]>e.vertices[1][1]?e.vertices[0][1]:e.vertices[1][1],n=new s({hasZ:!0,hasM:!0,rings:[[[t,i],[r,i],[r,o],[t,o],[t,i]]],spatialReference:c.view.spatialReference}),l=new a({geometry:n,symbol:c.polygonsymbol});c.view.map.remove(d),u.add(l),c.emit("drawcomplete",l,"rectangle")}})})},T.prototype.clean=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e)},T.prototype.show=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!0)},T.prototype.hide=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!1)},T.prototype.init=function(i){return M(this,void 0,void 0,function(){var t=this;return O(this,function(e){return this.displayedLayerid=(new L).uuid,this.view=i,this.view.on(z.click,function(e){t.view.hitTest(e).then(function(e){return M(t,void 0,void 0,function(){return O(this,function(e){return[2]})})})}),this.view.on(z.pointermove,function(e){t.view.hitTest(e).then(function(e){return M(t,void 0,void 0,function(){return O(this,function(e){return[2]})})})}),[2]})})},T);function T(e){var t=P.call(this)||this;return t.marksymbol=null,t.polylinesymbol=null,t.polygonsymbol=null,t.displayedLayerid="",t.view=null,t.drawlayerscollection=[],t.init(e),t.polygonsymbol={type:"simple-fill",color:[255,255,255,.6],style:"solid",outline:{color:[255,255,0,.8],width:2}},t.polylinesymbol={type:"simple-line",color:[255,255,255,.6],width:"2px",style:"short-dot"},t.marksymbol={type:"simple-marker",style:"circle",color:[255,255,255,.6],size:"8px",outline:{color:[255,255,0,.8],width:1}},t}var H,G,J=(H=function(e,t){return(H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}H(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),F=function(e,l,a,s){return new(a=a||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,o)}n((s=s.apply(e,l||[])).next())})},Z=function(i,r){var o,n,l,e,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(l=2&t[0]?n.return:t[0]?n.throw||((l=n.return)&&l.call(n),0):n.next)&&!(l=l.call(n,t[1])).done)return l;switch(n=0,l&&(t=[2&t[0],l.value]),t[0]){case 0:case 1:l=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,n=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(l=0<(l=a.trys).length&&l[l.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!l||t[1]>l[0]&&t[1]<l[3])){a.label=t[1];break}if(6===t[0]&&a.label<l[1]){a.label=l[1],l=t;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(t);break}l[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(i,a)}catch(e){t=[6,e],n=0}finally{o=l=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},q=(J(D,G=e),D.prototype.add=function(l){var a=this;g(["esri/layers/echartsLayer"]).then(function(e){var t=e[0],i=document.getElementsByClassName("esri-view-surface")[0],r=document.getElementById(a.displayedLayerid);null!==r&&i.removeChild(r);var o=[];a.datas=l.datas,l.datas.forEach(function(e,t){o.push({name:"Top10",type:"effectScatter",coordinateSystem:"arcgis",zlevel:2,showEffectOn:"render",rippleEffect:{brushType:"stroke"},legendHoverLink:!0,hoverAnimation:!0,symbol:null==e.symbol||void 0===e.symbol?"diamond":e.symbol,cursor:"pointer",label:{normal:{show:!0,position:null==e.labelposition||void 0===e.labelposition?"right":e.labelposition,formatter:"{b}"}},tooltip:{padding:10,backgroundColor:"#222",borderColor:"#777",borderWidth:1},symbolSize:function(e){return e[2]/8},itemStyle:{normal:{color:e.color,shadowBlur:10,shadowColor:"#333"}},data:[{name:e.name,value:[e.x,e.y].concat([e.value])}]})});var n={title:{text:"",subtext:"",left:"center",textStyle:{color:"#fff"}},series:o};new t(a.view,"",a.displayedLayerid).setChartOption(n)})},D.prototype.update=function(l){var a=this;g(["esri/layers/echartsLayer"]).then(function(e){var t=e[0],i=document.getElementsByClassName("esri-view-surface")[0],r=document.getElementById(a.displayedLayerid);null!==r&&i.removeChild(r);var o=[];a.datas=l.datas,l.datas.forEach(function(e,t){o.push({name:"Top10",type:"effectScatter",coordinateSystem:"arcgis",zlevel:2,showEffectOn:"render",rippleEffect:{brushType:"stroke"},legendHoverLink:!0,hoverAnimation:!0,symbol:null==e.symbol||void 0===e.symbol?"diamond":e.symbol,cursor:"pointer",label:{normal:{show:!0,position:null==e.labelposition||void 0===e.labelposition?"right":e.labelposition,formatter:"{b}"}},tooltip:{padding:10,backgroundColor:"#222",borderColor:"#777",borderWidth:1},symbolSize:function(e){return e[2]/8},itemStyle:{normal:{color:e.color,shadowBlur:10,shadowColor:"#333"}},data:[{name:e.name,value:[e.x,e.y].concat([e.value])}]})});var n={title:{text:"",subtext:"",left:"center",textStyle:{color:"#fff"}},series:o};new t(a.view,"",a.displayedLayerid).setChartOption(n)})},D.prototype.delete=function(){var e=document.getElementsByClassName("esri-view-surface")[0],t=document.getElementById(this.displayedLayerid);null!==t&&e.removeChild(t)},D.prototype.init=function(t){return F(this,void 0,void 0,function(){var s=this;return Z(this,function(e){return this.view=t,this.displayedLayerid=(new L).uuid,g(["esri/geometry/Point","esri/geometry/SpatialReference","esri/geometry/support/webMercatorUtils"]).then(function(e){var l=e[0],a=e[1];e[2],s.view.on(z.click,function(r){if(s.datas.length){var i=s.datas.map(function(e){var t=new l({x:e.x,y:e.y,spatialReference:a.WebMercator}),i=s.view.toScreen(t);return Math.sqrt((i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y))}),o=0;i.forEach(function(e,t){e<i[o]&&(o=t)}),35<i[o]||s.emit(z.click,s.datas[o],r.mapPoint)}}),s.view.on(z.doubleclick,function(r){if(s.datas.length){var i=s.datas.map(function(e){var t=new l({x:e.x,y:e.y,spatialReference:a.WebMercator}),i=s.view.toScreen(t);return Math.sqrt((i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y))}),o=0;i.forEach(function(e,t){e<i[o]&&(o=t)}),35<i[o]||s.emit(z.doubleclick,s.datas[o],r.mapPoint)}}),s.view.on(z.pointermove,function(n){s.view.hitTest(n).then(function(t){return F(s,void 0,void 0,function(){var i,r,o=this;return Z(this,function(e){if(0<t.results.length&&t.results[0].graphic.layer.id===this.displayedLayerid){if(!this.datas.length)return[2];if(i=this.datas.map(function(e){var t=new l({x:e.x,y:e.y,spatialReference:a.WebMercator}),i=o.view.toScreen(t);return Math.sqrt((i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y))}),r=0,i.forEach(function(e,t){e<i[r]&&(r=t)}),35<i[r])return[2];this.emit(z.pointermove,this.datas[r],this.view.toMap({x:n.x,y:n.y}))}return[2]})})})})}),[2]})})},D);function D(e){var t=G.call(this)||this;return t.displayedLayerid="",t.view=null,t.datas=null,t.init(e),t}var N,X,Y=(N=function(e,t){return(N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}N(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),V=function(e,l,a,s){return new(a=a||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,o)}n((s=s.apply(e,l||[])).next())})},U=function(i,r){var o,n,l,e,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(l=2&t[0]?n.return:t[0]?n.throw||((l=n.return)&&l.call(n),0):n.next)&&!(l=l.call(n,t[1])).done)return l;switch(n=0,l&&(t=[2&t[0],l.value]),t[0]){case 0:case 1:l=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,n=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(l=0<(l=a.trys).length&&l[l.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!l||t[1]>l[0]&&t[1]<l[3])){a.label=t[1];break}if(6===t[0]&&a.label<l[1]){a.label=l[1],l=t;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(t);break}l[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(i,a)}catch(e){t=[6,e],n=0}finally{o=l=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},Q=(Y($,X=e),$.prototype.createFeatureGroup=function(h){var b=this,e=this.view.map.findLayerById(this.displayedLayerid);e&&(this.view.map.remove(e),this.mapoverlayersflayer=[]),g(["esri/layers/FeatureLayer","esri/layers/support/LabelClass","esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol"]).then(function(e){var t=e[0],i=e[1],r=e[2],o=e[3];if(e[4],"group"===h.type){var n,l=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}];if(l.push({name:"style",alias:"样式",type:"string"}),h.datafiled.forEach(function(e){l.push(e)}),"marker"===h.overlaytype.toLowerCase()){h.renderer?n=h.renderer:(n={type:"unique-value",field:"style",uniqueValueInfos:[]},h.style.forEach(function(e){"3d"===b.view.type?n.uniqueValueInfos.push({value:e.style,label:e.style,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:e.size.height,resource:{href:e.url}}]}}):n.uniqueValueInfos.push({value:e.style,label:e.style,symbol:{type:"picture-marker",url:e.url,width:e.size.height,height:e.size.height}})}));var a=new t({id:b.displayedLayerid,title:b.displayedLayerid,objectIdField:"objectId",geometryType:"point",renderer:n,screenSizePerspectiveEnabled:"3d"===b.view.type,popupEnabled:!1,popupTemplate:!1,fields:l,source:[],spatialReference:b.view.spatialReference});if(h.elevationInfo&&(a.elevationInfo=h.elevationInfo),b.view.map.add(a),h.overlayers.forEach(function(e){if(e.attributes&&e.position){e.attributes.uuid=e.uuid;var t=new r({geometry:new o({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:b.view.spatialReference}),attributes:e.attributes});a.source.add(t),b.mapoverlayersflayer.push([h.uuid,e.uuid,t])}}),100<a.source.items.length&&null!=h.frreduction&&(a.featureReduction={type:h.frreduction.type,clusterRadius:h.frreduction.clusterRadius}),h.label.visible){var s=void 0;if(h.label.labelingInfo)s=h.label.labelingInfo,a.labelingInfo=s;else{var u=new i({labelExpressionInfo:{expression:"$feature.NAME"},symbol:s="2d"===b.view.type?{type:h.label.type,text:h.label.text,color:h.label.color,angle:h.label.angle,backgroundColor:h.label.backgroundColor,borderLineColor:h.label.borderLineColor,borderLineSize:h.label.borderLineSize,kerning:h.label.kerning,lineHeight:h.label.lineHeight,lineWidth:h.label.lineWidth,rotated:h.label.rotated,haloColor:h.label.haloColor,haloSize:h.label.haloSize,xoffset:h.label.xoffset,yoffset:h.label.yoffset,verticalAlignment:h.label.verticalAlignment,horizontalAlignment:h.label.horizontalAlignment,font:{size:h.label.size,family:"Josefin Slab",weight:h.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:h.label.color},size:h.label.size,halo:{color:h.label.haloColor,size:h.label.haloSize}}]},labelPlacement:h.label.placement,minScale:h.label.minScale,maxScale:h.label.maxScale});a.labelingInfo=[u]}}}}else if("element"===h.type&&"marker"===h.overlaytype.toLowerCase()){var d=void 0;d=h.renderer?h.renderer:"3d"===b.view.type?{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:h.icon.size.width,resource:{href:h.icon.image}}]}}:{type:"simple",symbol:{type:"picture-marker",url:h.icon.image,width:h.icon.size.width,height:h.icon.size.height}};var c=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}];Object.keys(h.attributes).forEach(function(e){c.push({name:e,alias:e,type:"string"})});var y=new t({id:b.displayedLayerid,title:b.displayedLayerid,objectIdField:"objectId",geometryType:"point",renderer:d,screenSizePerspectiveEnabled:!0,popupEnabled:!1,popupTemplate:!1,fields:c,source:[],spatialReference:b.view.spatialReference});if(h.elevationInfo&&(y.elevationInfo=h.elevationInfo),h.position&&h.attributes){var p=h.attributes;p.uuid=h.uuid;var f=new r({geometry:new o({x:h.position[0],y:h.position[1],z:void 0===h.position[2]?0:h.position[2],spatialReference:b.view.spatialReference}),attributes:p});y.source.add(f),b.mapoverlayersflayer.push([h.uuid,h.uuid,f])}b.view.map.add(y),h.label.visible&&(s=void 0,h.label.labelingInfo?(s=h.label.labelingInfo,y.labelingInfo=s):(u=new i({labelExpressionInfo:{expression:"$feature.NAME"},symbol:s="2d"===b.view.type?{type:h.label.type,text:h.label.text,color:h.label.color,angle:h.label.angle,backgroundColor:h.label.backgroundColor,borderLineColor:h.label.borderLineColor,borderLineSize:h.label.borderLineSize,kerning:h.label.kerning,lineHeight:h.label.lineHeight,lineWidth:h.label.lineWidth,rotated:h.label.rotated,haloColor:h.label.haloColor,haloSize:h.label.haloSize,xoffset:h.label.xoffset,yoffset:h.label.yoffset,verticalAlignment:h.label.verticalAlignment,horizontalAlignment:h.label.horizontalAlignment,font:{size:h.label.size,family:"Josefin Slab",weight:h.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:h.label.color},size:h.label.size,halo:{color:h.label.haloColor,size:h.label.haloSize}}]},labelPlacement:h.label.placement,minScale:h.label.minScale,maxScale:h.label.maxScale}),y.labelingInfo=[u]))}})},$.prototype.addfeature=function(a){var s=this;g(["esri/layers/FeatureLayer","esri/layers/support/LabelClass","esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol"]).then(function(e){e[0],e[1];var r=e[2],o=e[3],t=(e[4],s.view.map.findLayerById(s.displayedLayerid));if(t)if(a instanceof Array){var n=[];a.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var t=e.attributes;t.uuid=e.uuid;var i=new r({geometry:new o({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:s.view.spatialReference}),attributes:t});n.push(i),s.mapoverlayersflayer.push([e.uuid,e.uuid,i])}}),t.applyEdits({addFeatures:n}).then(function(e){})}else if("marker"===a.overlaytype.toLowerCase()){var i=a.attributes;i.uuid=a.uuid;var l=new r({geometry:new o({x:a.position[0],y:a.position[1],z:void 0===a.position[2]?0:a.position[2],spatialReference:s.view.spatialReference}),attributes:i});t.applyEdits({addFeatures:[l]}).then(function(e){}),s.mapoverlayersflayer.push([a.uuid,a.uuid,l])}})},$.prototype.updatefeature=function(l){var a=this;g(["esri/layers/FeatureLayer","esri/layers/support/LabelClass","esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){e[0],e[1],e[2];var o=e[3];if(e[4],e[5],e[6],a.view.map.findLayerById(a.displayedLayerid))if(l instanceof Array){var r=[];l.forEach(function(t){var i=a.mapoverlayersflayer.filter(function(e){return e[1]===t.uuid});if(1===i.length){var e=new o({x:t.position[0],y:t.position[1],z:void 0===t.position[2]?0:t.position[2],spatialReference:a.view.spatialReference});i[0][2].geometry=e,Object.keys(t.attributes).map(function(e){"objectId"!==e&&i[0][2].setAttribute(e,t.attributes[e])}),r.push(i[0][2])}}),(t=a.view.map.findLayerById(a.displayedLayerid))&&r.length&&t.applyEdits({updateFeatures:r}).then(function(e){})}else if("group"===l.type){var t,n=[];l.overlayers.forEach(function(t){var i=a.mapoverlayersflayer.filter(function(e){return e[1]===t.uuid});if(1===i.length){var e=new o({x:t.position[0],y:t.position[1],z:void 0===t.position[2]?0:t.position[2],spatialReference:a.view.spatialReference});i[0][2].geometry=e,Object.keys(t.attributes).map(function(e){"objectId"!==e&&i[0][2].setAttribute(e,t.attributes[e])}),n.push(i[0][2])}}),(t=a.view.map.findLayerById(a.displayedLayerid))&&n.length&&t.applyEdits({updateFeatures:n}).then(function(e){})}else"element"===l.type&&a.mapoverlayersflayer.filter(function(e){return e[1]===l.uuid}).forEach(function(t){var e=[];l.attributes.uuid=l.uuid;var i=new o({x:l.position[0],y:l.position[1],z:void 0===l.position[2]?0:l.position[2],spatialReference:a.view.spatialReference});t[2].geometry=i,Object.keys(l.attributes).map(function(e){"objectId"!==e&&t[2].setAttribute(e,l.attributes[e])}),e.push(t[2]);var r=a.view.map.findLayerById(a.displayedLayerid);r&&e.length&&r.applyEdits({updateFeatures:e}).then(function(e){})})})},$.prototype.removefeature=function(t){var e=this;if(this.view.map.findLayerById(this.displayedLayerid))if(t instanceof Array){var i=[];t.forEach(function(t){e.mapoverlayersflayer.filter(function(e){return e[1]===t.uuid}).forEach(function(e){i.push(e[2])}),e.mapoverlayersflayer=e.mapoverlayersflayer.filter(function(e){return e[1]!==t.uuid})}),(n=this.view.map.findLayerById(this.displayedLayerid))&&i.length&&n.applyEdits({deleteFeatures:i}).then(function(e){})}else if("group"===t.type){var r=this.mapoverlayersflayer.filter(function(e){return e[0]===t.uuid}),o=[];r.forEach(function(e){o.push(e[2])}),(n=this.view.map.findLayerById(this.displayedLayerid))&&o.length&&n.applyEdits({deleteFeatures:o}).then(function(e){}),this.mapoverlayersflayer=this.mapoverlayersflayer.filter(function(e){return e[0]!==t.uuid})}else if("element"===t.type){r=this.mapoverlayersflayer.filter(function(e){return e[1]===t.uuid});var n,l=[];r.forEach(function(e){l.push(e[2])}),(n=this.view.map.findLayerById(this.displayedLayerid))&&l.length&&n.applyEdits({deleteFeatures:l}).then(function(e){}),this.mapoverlayersflayer=this.mapoverlayersflayer.filter(function(e){return e[1]!==t.uuid})}},$.prototype.removeAll=function(){var t=this,e=this.view.map.findLayerById(this.displayedLayerid);if(e){var i=[];this.mapoverlayersflayer.forEach(function(e){i.push(e[2])}),e.applyEdits({deleteFeatures:i}).then(function(e){t.mapoverlayersflayer=[]})}},$.prototype.delete=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(this.view.map.remove(e),this.mapoverlayersflayer=[])},$.prototype.init=function(i){return V(this,void 0,void 0,function(){var t=this;return U(this,function(e){return this.displayedLayerid=(new L).uuid,this.view=i,this.view.on(z.click,function(n){t.view.hitTest(n).then(function(o){return V(t,void 0,void 0,function(){var t,i,r=this;return U(this,function(e){return 0<o.results.length&&o.results[0].graphic.layer.id===this.displayedLayerid&&(t=o.results[0].graphic.attributes.objectId,(i=o.results[0].graphic.layer.createQuery()).where="objectId ="+t,o.results[0].graphic.layer.queryFeatures(i).then(function(e){0<e.features.length&&r.emit(z.click,e.features,n.mapPoint)})),[2]})})})}),this.view.on(z.pointermove,function(n){t.view.hitTest(n).then(function(o){return V(t,void 0,void 0,function(){var t,i,r=this;return U(this,function(e){return 0<o.results.length&&o.results[0].graphic.layer.id===this.displayedLayerid&&(t=o.results[0].graphic.attributes.objectId,(i=o.results[0].graphic.layer.createQuery()).where="objectId ="+t,o.results[0].graphic.layer.queryFeatures(i).then(function(e){0<e.features.length&&r.emit(z.pointermove,e.features,r.view.toMap({x:n.x,y:n.y}))})),[2]})})})}),[2]})})},$);function $(e){var t=X.call(this)||this;return t.displayedLayerid="",t.view=null,t.mapoverlayersflayer=[],t.init(e),t}var K,ee,te=(K=function(e,t){return(K=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}K(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ie=function(e,l,a,s){return new(a=a||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,o)}n((s=s.apply(e,l||[])).next())})},re=function(i,r){var o,n,l,e,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(l=2&t[0]?n.return:t[0]?n.throw||((l=n.return)&&l.call(n),0):n.next)&&!(l=l.call(n,t[1])).done)return l;switch(n=0,l&&(t=[2&t[0],l.value]),t[0]){case 0:case 1:l=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,n=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(l=0<(l=a.trys).length&&l[l.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!l||t[1]>l[0]&&t[1]<l[3])){a.label=t[1];break}if(6===t[0]&&a.label<l[1]){a.label=l[1],l=t;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(t);break}l[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(i,a)}catch(e){t=[6,e],n=0}finally{o=l=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},oe=(te(ne,ee=e),ne.prototype.add=function(o){var n=this;g(["smiapi/utils/FlashPoint3DLayer","esri/geometry/Point","esri/views/3d/externalRenderers"]).then(function(e){var t=e[0],i=e[1],r=e[2];n.falshpoint3DRenderer=new t({nring:o.nring,spead:o.spead,size:o.size,color:o.color,view:o.view,points:o.points},function(e){var t=null;null!=e&&(t=new i({x:e.x,y:e.y,spatialReference:{wkid:102100}})),n.emit(z.click,e,t)},function(e){var t=null;null!=e&&(t=new i({x:e.x,y:e.y,spatialReference:{wkid:102100}})),n.emit(z.pointermove,e,t)}),r.add(n.view,n.falshpoint3DRenderer)})},ne.prototype.remove=function(){var t=this;g(["esri/views/3d/externalRenderers"]).then(function(e){e[0].remove(t.view,t.falshpoint3DRenderer)})},ne.prototype.init=function(t){return ie(this,void 0,void 0,function(){return re(this,function(e){return this.view=t,[2]})})},ne);function ne(e){var t=ee.call(this)||this;return t.view=null,t.falshpoint3DRenderer=null,t.init(e),t}var le,ae,se=(le=function(e,t){return(le=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}le(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ue=function(e,l,a,s){return new(a=a||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,o)}n((s=s.apply(e,l||[])).next())})},de=function(i,r){var o,n,l,e,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(l=2&t[0]?n.return:t[0]?n.throw||((l=n.return)&&l.call(n),0):n.next)&&!(l=l.call(n,t[1])).done)return l;switch(n=0,l&&(t=[2&t[0],l.value]),t[0]){case 0:case 1:l=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,n=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(l=0<(l=a.trys).length&&l[l.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!l||t[1]>l[0]&&t[1]<l[3])){a.label=t[1];break}if(6===t[0]&&a.label<l[1]){a.label=l[1],l=t;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(t);break}l[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(i,a)}catch(e){t=[6,e],n=0}finally{o=l=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},ce=(se(ye,ae=e),ye.prototype.add=function(C){var S=this;g(["esri/Graphic","esri/geometry/Point","esri/layers/GraphicsLayer","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){var g=e[0],L=e[1],t=e[2],x=(e[3],e[4]),z=e[5],i=S.view.map.findLayerById(S.displayedLayerid);if(i||(i=new t({id:S.displayedLayerid,title:S.displayedLayerid}),S.view.map.add(i)),C instanceof Array)C.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var t=void 0;t=e.symbol?e.symbol:"2d"===S.view.type?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]};var i=e.attributes;i.uuid=e.uuid;var r=new g({geometry:new L({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:S.view.spatialReference}),symbol:t,attributes:i});if(S.mapoverlayers.push(["smap-default",e.uuid,r]),(b=S.view.map.findLayerById(S.displayedLayerid))&&b.add(r),e.label.visible){var o=null;o=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}};var n=new g({geometry:new L({x:"3d"===S.view.type?e.position[0]+e.label.xoffset:e.position[0],y:"3d"===S.view.type?e.position[1]+e.label.yoffset:e.position[1],z:"3d"===S.view.type?e.position[2]+e.label.zoffset:e.position[2],spatialReference:S.view.spatialReference}),symbol:o,attributes:i});(m=S.view.map.findLayerById(S.displayedLayerid))&&m.add(n),S.mapoverlayers.push(["smap-default",e.uuid,n])}}else if("polyline"===e.overlaytype.toLowerCase()){var l=null;l=e.symbol?e.symbol:{type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin};var a=[];e.path.forEach(function(e){a.push([e.X,e.Y,e.Z])});var s=new x({hasZ:!1,hasM:!1,paths:a,spatialReference:S.view.spatialReference}),u=e.attributes;u.uuid=e.uuid;var d=new g({geometry:s,symbol:l,attributes:u});if(S.mapoverlayers.push(["smap-default",e.uuid,d]),(b=S.view.map.findLayerById(S.displayedLayerid))&&b.add(d),e.label.visible){var c=null;c=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},n=new g({geometry:d.geometry.extent.center,symbol:c,attributes:u}),(m=S.view.map.findLayerById(S.displayedLayerid))&&m.add(n),S.mapoverlayers.push(["smap-default",e.uuid,n])}}else if("polygon"===e.overlaytype.toLowerCase()){var y=void 0;y=e.symbol?e.symbol:"simple"===e.symboltype?{type:"simple-fill",color:e.fillColor,style:e.style,outline:{color:e.strokeColor,width:e.strokeWeight,style:e.strokestyle}}:{type:"picture-fill",url:e.url,width:e.picwidth,height:e.picheight,outline:{style:e.strokestyle,color:e.strokeColor,width:e.strokeWeight}};var p=[];e.paths.forEach(function(e){p.push([e.X,e.Y,e.Z])});var f=new z({hasZ:!0,hasM:!0,rings:p,spatialReference:S.view.spatialReference}),h=e.attributes;h.uuid=e.uuid;var b,v=new g({geometry:f,symbol:y,attributes:h});if(S.mapoverlayers.push(["smap-default",e.uuid,v]),(b=S.view.map.findLayerById(S.displayedLayerid))&&b.add(v),e.label.visible){var m,w=null;w=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},n=new g({geometry:v.geometry.extent.center,symbol:w,attributes:h}),(m=S.view.map.findLayerById(S.displayedLayerid))&&m.add(n),S.mapoverlayers.push(["smap-default",e.uuid,n])}}});else if("group"===C.type)C.overlayers.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var t=void 0;t=e.symbol?e.symbol:"2d"===S.view.type?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]};var i=e.attributes;i.uuid=e.uuid;var r=new g({geometry:new L({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:S.view.spatialReference}),symbol:t,attributes:i});if(S.mapoverlayers.push([C.uuid,e.uuid,r]),(h=S.view.map.findLayerById(S.displayedLayerid))&&h.add(r),e.label.visible){var o=null;o=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}};var n=new g({geometry:new L({x:"3d"===S.view.type?e.position[0]+e.label.xoffset:e.position[0],y:"3d"===S.view.type?e.position[1]+e.label.yoffset:e.position[1],z:"3d"===S.view.type?e.position[2]+e.label.zoffset:e.position[2],spatialReference:S.view.spatialReference}),symbol:o,attributes:i});(m=S.view.map.findLayerById(S.displayedLayerid))&&m.add(n),S.mapoverlayers.push([C.uuid,e.uuid,n])}}else if("polyline"===e.overlaytype.toLowerCase()){var l=null;l=e.symbol?e.symbol:{type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin};var a=[];e.path.forEach(function(e){a.push([e.X,e.Y,e.Z])});var s=new x({hasZ:!1,hasM:!1,paths:a,spatialReference:S.view.spatialReference}),u=e.attributes;u.uuid=e.uuid;var d=new g({geometry:s,symbol:l,attributes:u});if(S.mapoverlayers.push([C.uuid,e.uuid,d]),(m=S.view.map.findLayerById(S.displayedLayerid))&&m.add(d),e.label.visible){var c=null;c=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},n=new g({geometry:d.geometry.extent.center,symbol:c,attributes:u}),(h=S.view.map.findLayerById(S.displayedLayerid))&&h.add(n),S.mapoverlayers.push([C.uuid,e.uuid,n])}}else if("polygon"===e.overlaytype.toLowerCase()){var y=void 0;y=e.symbol?e.symbol:"simple"===e.symboltype?{type:"simple-fill",color:e.fillColor,style:e.style,outline:{color:e.strokeColor,width:e.strokeWeight,style:e.strokestyle}}:{type:"picture-fill",url:e.url,width:e.picwidth,height:e.picheight,outline:{style:e.strokestyle,color:e.strokeColor,width:e.strokeWeight}};var p=[];e.paths.forEach(function(e){p.push([e.X,e.Y,e.Z])});var f=e.attributes;f.uuid=e.uuid;var h,b=new z({hasZ:!0,hasM:!0,rings:p,spatialReference:S.view.spatialReference}),v=new g({geometry:b,symbol:y,attributes:f});if(S.mapoverlayers.push([C.uuid,e.uuid,v]),(h=S.view.map.findLayerById(S.displayedLayerid))&&h.add(v),e.label.visible){var m,w=null;w=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},n=new g({geometry:v.geometry.extent.center,symbol:w,attributes:f}),(m=S.view.map.findLayerById(S.displayedLayerid))&&m.add(n),S.mapoverlayers.push([C.uuid,e.uuid,n])}}});else if("element"===C.type)if("marker"===C.overlaytype.toLowerCase()){var r=void 0;r=C.symbol?C.symbol:"2d"===S.view.type?{type:"picture-marker",url:C.icon.image,width:C.icon.size.width,height:C.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:C.icon.size.width,resource:{href:C.icon.image}}]};var o=C.attributes;o.uuid=C.uuid;var n=new g({geometry:new L({x:C.position[0],y:C.position[1],z:void 0===C.position[2]?0:C.position[2],spatialReference:S.view.spatialReference}),symbol:r,attributes:o});if(S.mapoverlayers.push(["smap-default",C.uuid,n]),(v=S.view.map.findLayerById(S.displayedLayerid))&&v.add(n),C.label.visible){var l=null;l=C.label.labelingInfo?C.label.labelingInfo:{type:C.label.type,text:C.label.text,color:C.label.color,angle:C.label.angle,backgroundColor:C.label.backgroundColor,borderLineColor:C.label.borderLineColor,borderLineSize:C.label.borderLineSize,kerning:C.label.kerning,lineHeight:C.label.lineHeight,lineWidth:C.label.lineWidth,rotated:C.label.rotated,haloColor:C.label.haloColor,haloSize:C.label.haloSize,xoffset:C.label.xoffset,yoffset:C.label.yoffset,verticalAlignment:C.label.verticalAlignment,horizontalAlignment:C.label.horizontalAlignment,font:{size:C.label.size,family:"Josefin Slab",weight:C.label.weight}};var a=new g({geometry:new L({x:"3d"===S.view.type?C.position[0]+C.label.xoffset:C.position[0],y:"3d"===S.view.type?C.position[1]+C.label.yoffset:C.position[1],z:"3d"===S.view.type?C.position[2]+C.label.zoffset:C.position[2],spatialReference:S.view.spatialReference}),symbol:l,attributes:o});(m=S.view.map.findLayerById(S.displayedLayerid))&&m.add(a),S.mapoverlayers.push(["smap-default",C.uuid,a])}}else if("polyline"===C.overlaytype.toLowerCase()){var s=null;s=C.symbol?C.symbol:{type:"simple-line",color:C.strokeColor,style:C.style,width:C.width,cap:C.cap,join:C.lineJoin};var u=[];C.path.forEach(function(e){u.push([e.X,e.Y,e.Z])});var d=new x({hasZ:!1,hasM:!1,paths:u,spatialReference:S.view.spatialReference}),c=C.attributes;c.uuid=C.uuid;var y=new g({geometry:d,symbol:s,attributes:c});if(S.mapoverlayers.push(["smap-default",C.uuid,y]),(m=S.view.map.findLayerById(S.displayedLayerid))&&m.add(y),C.label.visible){var p=null;p=C.label.labelingInfo?C.label.labelingInfo:{type:C.label.type,text:C.label.text,color:C.label.color,angle:C.label.angle,backgroundColor:C.label.backgroundColor,borderLineColor:C.label.borderLineColor,borderLineSize:C.label.borderLineSize,kerning:C.label.kerning,lineHeight:C.label.lineHeight,lineWidth:C.label.lineWidth,rotated:C.label.rotated,haloColor:C.label.haloColor,haloSize:C.label.haloSize,xoffset:C.label.xoffset,yoffset:C.label.yoffset,verticalAlignment:C.label.verticalAlignment,horizontalAlignment:C.label.horizontalAlignment,font:{size:C.label.size,family:"Josefin Slab",weight:C.label.weight}},a=new g({geometry:y.geometry.extent.center,symbol:p,attributes:c}),(v=S.view.map.findLayerById(S.displayedLayerid))&&v.add(a),S.mapoverlayers.push(["smap-default",C.uuid,a])}}else if("polygon"===C.overlaytype.toLowerCase()){var f=void 0;f=C.symbol?C.symbol:"simple"===C.symboltype?{type:"simple-fill",color:C.fillColor,style:C.style,outline:{color:C.strokeColor,width:C.strokeWeight,style:C.strokestyle}}:{type:"picture-fill",url:C.url,width:C.picwidth,height:C.picheight,outline:{style:C.strokestyle,color:C.strokeColor,width:C.strokeWeight}};var h=[];C.paths.forEach(function(e){h.push([e.X,e.Y,e.Z])});var b=C.attributes;b.uuid=C.uuid;var v,m,w=new z({hasZ:!0,hasM:!0,rings:h,spatialReference:S.view.spatialReference}),k=new g({geometry:w,symbol:f,attributes:b});if(S.mapoverlayers.push(["smap-default",C.uuid,k]),(v=S.view.map.findLayerById(S.displayedLayerid))&&v.add(k),C.label.visible)p=null,p=C.label.labelingInfo?C.label.labelingInfo:{type:C.label.type,text:C.label.text,color:C.label.color,angle:C.label.angle,backgroundColor:C.label.backgroundColor,borderLineColor:C.label.borderLineColor,borderLineSize:C.label.borderLineSize,kerning:C.label.kerning,lineHeight:C.label.lineHeight,lineWidth:C.label.lineWidth,rotated:C.label.rotated,haloColor:C.label.haloColor,haloSize:C.label.haloSize,xoffset:C.label.xoffset,yoffset:C.label.yoffset,verticalAlignment:C.label.verticalAlignment,horizontalAlignment:C.label.horizontalAlignment,font:{size:C.label.size,family:"Josefin Slab",weight:C.label.weight}},a=new g({geometry:k.geometry.extent.center,symbol:p,attributes:b}),(m=S.view.map.findLayerById(S.displayedLayerid))&&m.add(a),S.mapoverlayers.push(["smap-default",C.uuid,a])}}).catch(function(e){console.error(e)})},ye.prototype.remove=function(t){var i=this;t instanceof Array?t.forEach(function(t){i.mapoverlayers.filter(function(e){return e[1]===t.uuid}).forEach(function(e){var t=i.view.map.findLayerById(i.displayedLayerid);t&&t.remove(e[2])}),i.mapoverlayers=i.mapoverlayers.filter(function(e){return e[1]!==t.uuid})}):"group"===t.type?(this.mapoverlayers.filter(function(e){return e[0]===t.uuid}).forEach(function(e){var t=i.view.map.findLayerById(i.displayedLayerid);t&&t.remove(e[2])}),this.mapoverlayers=this.mapoverlayers.filter(function(e){return e[0]!==t.uuid})):"element"===t.type&&(this.mapoverlayers.filter(function(e){return e[1]===t.uuid}).forEach(function(e){var t=i.view.map.findLayerById(i.displayedLayerid);t&&t.remove(e[2])}),this.mapoverlayers=this.mapoverlayers.filter(function(e){return e[1]!==t.uuid}))},ye.prototype.update=function(k){var C=this;g(["esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){var g=e[0],L=e[1],x=(e[2],e[3]),z=e[4];if(k instanceof Array)k.forEach(function(t){if(C.mapoverlayers.filter(function(e){return e[1]===t.uuid}).forEach(function(e){var t=C.view.map.findLayerById(C.displayedLayerid);t&&t.remove(e[2])}),C.mapoverlayers=C.mapoverlayers.filter(function(e){return e[1]!==t.uuid}),"marker"===t.overlaytype.toLowerCase()){var e=void 0;e=t.symbol?t.symbol:"2d"===C.view.type?{type:"picture-marker",url:t.icon.image,width:t.icon.size.width,height:t.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:t.icon.size.width,resource:{href:t.icon.image}}]};var i=t.attributes;i.uuid=t.uuid;var r=new g({geometry:new L({x:t.position[0],y:t.position[1],z:void 0===t.position[2]?0:t.position[2],spatialReference:C.view.spatialReference}),symbol:e,attributes:i});if(C.mapoverlayers.push(["smap-default",t.uuid,r]),(b=C.view.map.findLayerById(C.displayedLayerid))&&b.add(r),t.label.visible){var o=null;o=t.label.labelingInfo?t.label.labelingInfo:{type:t.label.type,text:t.label.text,color:t.label.color,angle:t.label.angle,backgroundColor:t.label.backgroundColor,borderLineColor:t.label.borderLineColor,borderLineSize:t.label.borderLineSize,kerning:t.label.kerning,lineHeight:t.label.lineHeight,lineWidth:t.label.lineWidth,rotated:t.label.rotated,haloColor:t.label.haloColor,haloSize:t.label.haloSize,xoffset:t.label.xoffset,yoffset:t.label.yoffset,verticalAlignment:t.label.verticalAlignment,horizontalAlignment:t.label.horizontalAlignment,font:{size:t.label.size,family:"Josefin Slab",weight:t.label.weight}};var n=new g({geometry:new L({x:"3d"===C.view.type?t.position[0]+t.label.xoffset:t.position[0],y:"3d"===C.view.type?t.position[1]+t.label.yoffset:t.position[1],z:"3d"===C.view.type?t.position[2]+t.label.zoffset:t.position[2],spatialReference:C.view.spatialReference}),symbol:o,attributes:i});(m=C.view.map.findLayerById(C.displayedLayerid))&&m.add(n),C.mapoverlayers.push(["smap-default",t.uuid,n])}}else if("polyline"===t.overlaytype.toLowerCase()){var l=null;l=t.symbol?t.symbol:{type:"simple-line",color:t.strokeColor,style:t.style,width:t.width,cap:t.cap,join:t.lineJoin};var a=[];t.path.forEach(function(e){a.push([e.X,e.Y,e.Z])});var s=new x({hasZ:!1,hasM:!1,paths:a,spatialReference:C.view.spatialReference}),u=t.attributes;u.uuid=t.uuid;var d=new g({geometry:s,symbol:l,attributes:u});if(C.mapoverlayers.push(["smap-default",t.uuid,d]),(m=C.view.map.findLayerById(C.displayedLayerid))&&m.add(d),t.label.visible){var c=null;c=t.label.labelingInfo?t.label.labelingInfo:{type:t.label.type,text:t.label.text,color:t.label.color,angle:t.label.angle,backgroundColor:t.label.backgroundColor,borderLineColor:t.label.borderLineColor,borderLineSize:t.label.borderLineSize,kerning:t.label.kerning,lineHeight:t.label.lineHeight,lineWidth:t.label.lineWidth,rotated:t.label.rotated,haloColor:t.label.haloColor,haloSize:t.label.haloSize,xoffset:t.label.xoffset,yoffset:t.label.yoffset,verticalAlignment:t.label.verticalAlignment,horizontalAlignment:t.label.horizontalAlignment,font:{size:t.label.size,family:"Josefin Slab",weight:t.label.weight}},n=new g({geometry:d.geometry.extent.center,symbol:c,attributes:u}),(b=C.view.map.findLayerById(C.displayedLayerid))&&b.add(n),C.mapoverlayers.push(["smap-default",t.uuid,n])}}else if("polygon"===t.overlaytype.toLowerCase()){var y=void 0;y=t.symbol?t.symbol:"simple"===t.symboltype?{type:"simple-fill",color:t.fillColor,style:t.style,outline:{color:t.strokeColor,width:t.strokeWeight,style:t.strokestyle}}:{type:"picture-fill",url:t.url,width:t.picwidth,height:t.picheight,outline:{style:t.strokestyle,color:t.strokeColor,width:t.strokeWeight}};var p=[];t.paths.forEach(function(e){p.push([e.X,e.Y,e.Z])});var f=new z({hasZ:!0,hasM:!0,rings:p,spatialReference:C.view.spatialReference}),h=t.attributes;h.uuid=t.uuid;var b,v=new g({geometry:f,symbol:y,attributes:h});if(C.mapoverlayers.push(["smap-default",t.uuid,v]),(b=C.view.map.findLayerById(C.displayedLayerid))&&b.add(v),t.label.visible){var m,w=null;w=t.label.labelingInfo?t.label.labelingInfo:{type:t.label.type,text:t.label.text,color:t.label.color,angle:t.label.angle,backgroundColor:t.label.backgroundColor,borderLineColor:t.label.borderLineColor,borderLineSize:t.label.borderLineSize,kerning:t.label.kerning,lineHeight:t.label.lineHeight,lineWidth:t.label.lineWidth,rotated:t.label.rotated,haloColor:t.label.haloColor,haloSize:t.label.haloSize,xoffset:t.label.xoffset,yoffset:t.label.yoffset,verticalAlignment:t.label.verticalAlignment,horizontalAlignment:t.label.horizontalAlignment,font:{size:t.label.size,family:"Josefin Slab",weight:t.label.weight}},n=new g({geometry:v.geometry.extent.center,symbol:w,attributes:h}),(m=C.view.map.findLayerById(C.displayedLayerid))&&m.add(n),C.mapoverlayers.push(["smap-default",t.uuid,n])}}});else if("group"===k.type)C.mapoverlayers.filter(function(e){return e[0]===k.uuid}).forEach(function(e){var t=C.view.map.findLayerById(C.displayedLayerid);t&&t.remove(e[2])}),C.mapoverlayers=C.mapoverlayers.filter(function(e){return e[0]!==k.uuid}),k.overlayers.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var t=void 0;t=e.symbol?e.symbol:"2d"===C.view.type?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]};var i=e.attributes;i.uuid=e.uuid;var r=new g({geometry:new L({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:C.view.spatialReference}),symbol:t,attributes:i});if(C.mapoverlayers.push([k.uuid,e.uuid,r]),(h=C.view.map.findLayerById(C.displayedLayerid))&&h.add(r),e.label.visible){var o=null;o=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}};var n=new g({geometry:new L({x:"3d"===C.view.type?e.position[0]+e.label.xoffset:e.position[0],y:"3d"===C.view.type?e.position[1]+e.label.yoffset:e.position[1],z:"3d"===C.view.type?e.position[2]+e.label.zoffset:e.position[2],spatialReference:C.view.spatialReference}),symbol:o,attributes:i});(m=C.view.map.findLayerById(C.displayedLayerid))&&m.add(n),C.mapoverlayers.push([k.uuid,e.uuid,n])}}else if("polyline"===e.overlaytype.toLowerCase()){var l=null;l=e.symbol?e.symbol:{type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin};var a=[];e.path.forEach(function(e){a.push([e.X,e.Y,e.Z])});var s=new x({hasZ:!1,hasM:!1,paths:a,spatialReference:C.view.spatialReference}),u=e.attributes;u.uuid=e.uuid;var d=new g({geometry:s,symbol:l,attributes:u});if(C.mapoverlayers.push([k.uuid,e.uuid,d]),(m=C.view.map.findLayerById(C.displayedLayerid))&&m.add(d),e.label.visible){var c=null;c=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},n=new g({geometry:d.geometry.extent.center,symbol:c,attributes:u}),(h=C.view.map.findLayerById(C.displayedLayerid))&&h.add(n),C.mapoverlayers.push([k.uuid,e.uuid,n])}}else if("polygon"===e.overlaytype.toLowerCase()){var y=void 0;y=e.symbol?e.symbol:"simple"===k.symboltype?{type:"simple-fill",color:k.fillColor,style:k.style,outline:{color:k.strokeColor,width:k.strokeWeight,style:k.strokestyle}}:{type:"picture-fill",url:k.url,width:k.picwidth,height:k.picheight,outline:{style:k.strokestyle,color:k.strokeColor,width:k.strokeWeight}};var p=[];k.paths.forEach(function(e){p.push([e.X,e.Y,e.Z])});var f=e.attributes;f.uuid=e.uuid;var h,b=new z({hasZ:!0,hasM:!0,rings:p,spatialReference:C.view.spatialReference}),v=new g({geometry:b,symbol:y,attributes:f});if(C.mapoverlayers.push(["smap-default",k.uuid,v]),(h=C.view.map.findLayerById(C.displayedLayerid))&&h.add(v),k.label.visible){var m,w=null;w=e.label.labelingInfo?e.label.labelingInfo:{type:k.label.type,text:k.label.text,color:k.label.color,angle:k.label.angle,backgroundColor:k.label.backgroundColor,borderLineColor:k.label.borderLineColor,borderLineSize:k.label.borderLineSize,kerning:k.label.kerning,lineHeight:k.label.lineHeight,lineWidth:k.label.lineWidth,rotated:k.label.rotated,haloColor:k.label.haloColor,haloSize:k.label.haloSize,xoffset:k.label.xoffset,yoffset:k.label.yoffset,verticalAlignment:k.label.verticalAlignment,horizontalAlignment:k.label.horizontalAlignment,font:{size:k.label.size,family:"Josefin Slab",weight:k.label.weight}},n=new g({geometry:v.geometry.extent.center,symbol:w,attributes:f}),(m=C.view.map.findLayerById(C.displayedLayerid))&&m.add(n),C.mapoverlayers.push(["smap-default",k.uuid,n])}}});else if("element"===k.type)if(C.mapoverlayers.filter(function(e){return e[1]===k.uuid}).forEach(function(e){var t=C.view.map.findLayerById(C.displayedLayerid);t&&t.remove(e[2])}),C.mapoverlayers=C.mapoverlayers.filter(function(e){return e[1]!==k.uuid}),"marker"===k.overlaytype.toLowerCase()){var t=void 0;t=k.symbol?k.symbol:"2d"===C.view.type?{type:"picture-marker",url:k.icon.image,width:k.icon.size.width,height:k.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:k.icon.size.width,resource:{href:k.icon.image}}]};var i=k.attributes;i.uuid=k.uuid;var r=new g({geometry:new L({x:k.position[0],y:k.position[1],z:void 0===k.position[2]?0:k.position[2],spatialReference:C.view.spatialReference}),symbol:t,attributes:i});if(C.mapoverlayers.push(["smap-default",k.uuid,r]),(b=C.view.map.findLayerById(C.displayedLayerid))&&b.add(r),k.label.visible){var o=null;o=k.label.labelingInfo?k.label.labelingInfo:{type:k.label.type,text:k.label.text,color:k.label.color,angle:k.label.angle,backgroundColor:k.label.backgroundColor,borderLineColor:k.label.borderLineColor,borderLineSize:k.label.borderLineSize,kerning:k.label.kerning,lineHeight:k.label.lineHeight,lineWidth:k.label.lineWidth,rotated:k.label.rotated,haloColor:k.label.haloColor,haloSize:k.label.haloSize,xoffset:k.label.xoffset,yoffset:k.label.yoffset,verticalAlignment:k.label.verticalAlignment,horizontalAlignment:k.label.horizontalAlignment,font:{size:k.label.size,family:"Josefin Slab",weight:k.label.weight}};var n=new g({geometry:new L({x:"3d"===C.view.type?k.position[0]+k.label.xoffset:k.position[0],y:"3d"===C.view.type?k.position[1]+k.label.yoffset:k.position[1],z:"3d"===C.view.type?k.position[2]+k.label.zoffset:k.position[2],spatialReference:C.view.spatialReference}),symbol:o,attributes:i});(v=C.view.map.findLayerById(C.displayedLayerid))&&v.add(n),C.mapoverlayers.push(["smap-default",k.uuid,n])}}else if("polyline"===k.overlaytype.toLowerCase()){var l=null;l=k.symbol?k.symbol:{type:"simple-line",color:k.strokeColor,style:k.style,width:k.width,cap:k.cap,join:k.lineJoin};var a=[];k.path.forEach(function(e){a.push([e.X,e.Y,e.Z])});var s=new x({hasZ:!1,hasM:!1,paths:a,spatialReference:C.view.spatialReference}),u=k.attributes;u.uuid=k.uuid;var d=new g({geometry:s,symbol:l,attributes:u});if(C.mapoverlayers.push(["smap-default",k.uuid,d]),(v=C.view.map.findLayerById(C.displayedLayerid))&&v.add(d),k.label.visible){var c=null;c=k.label.labelingInfo?k.label.labelingInfo:{type:k.label.type,text:k.label.text,color:k.label.color,angle:k.label.angle,backgroundColor:k.label.backgroundColor,borderLineColor:k.label.borderLineColor,borderLineSize:k.label.borderLineSize,kerning:k.label.kerning,lineHeight:k.label.lineHeight,lineWidth:k.label.lineWidth,rotated:k.label.rotated,haloColor:k.label.haloColor,haloSize:k.label.haloSize,xoffset:k.label.xoffset,yoffset:k.label.yoffset,verticalAlignment:k.label.verticalAlignment,horizontalAlignment:k.label.horizontalAlignment,font:{size:k.label.size,family:"Josefin Slab",weight:k.label.weight}},n=new g({geometry:d.geometry.extent.center,symbol:c,attributes:u}),(b=C.view.map.findLayerById(C.displayedLayerid))&&b.add(n),C.mapoverlayers.push(["smap-default",k.uuid,n])}}else if("polygon"===k.overlaytype.toLowerCase()){var y=void 0;y=k.symbol?k.symbol:"simple"===k.symboltype?{type:"simple-fill",color:k.fillColor,style:k.style,outline:{color:k.strokeColor,width:k.strokeWeight,style:k.strokestyle}}:{type:"picture-fill",url:k.url,width:k.picwidth,height:k.picheight,outline:{style:k.strokestyle,color:k.strokeColor,width:k.strokeWeight}};var p=[];k.paths.forEach(function(e){p.push([e.X,e.Y,e.Z])});var f=new z({hasZ:!0,hasM:!0,rings:p,spatialReference:C.view.spatialReference}),h=k.attributes;h.uuid=k.uuid;var b,v,m=new g({geometry:f,symbol:y,attributes:h});if(C.mapoverlayers.push(["smap-default",k.uuid,m]),(b=C.view.map.findLayerById(C.displayedLayerid))&&b.add(m),k.label.visible)c=null,c=k.label.labelingInfo?k.label.labelingInfo:{type:k.label.type,text:k.label.text,color:k.label.color,angle:k.label.angle,backgroundColor:k.label.backgroundColor,borderLineColor:k.label.borderLineColor,borderLineSize:k.label.borderLineSize,kerning:k.label.kerning,lineHeight:k.label.lineHeight,lineWidth:k.label.lineWidth,rotated:k.label.rotated,haloColor:k.label.haloColor,haloSize:k.label.haloSize,xoffset:k.label.xoffset,yoffset:k.label.yoffset,verticalAlignment:k.label.verticalAlignment,horizontalAlignment:k.label.horizontalAlignment,font:{size:k.label.size,family:"Josefin Slab",weight:k.label.weight}},n=new g({geometry:m.geometry.extent.center,symbol:c,attributes:h}),(v=C.view.map.findLayerById(C.displayedLayerid))&&v.add(n),C.mapoverlayers.push(["smap-default",k.uuid,n])}})},ye.prototype.removeAll=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.removeAll(),this.mapoverlayers=[])},ye.prototype.delete=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(this.view.map.remove(e),this.mapoverlayers=[])},ye.prototype.init=function(t){return ue(this,void 0,void 0,function(){var r=this;return de(this,function(e){return this.displayedLayerid=(new L).uuid,this.view=t,this.view.on(z.click,function(i){r.view.hitTest(i).then(function(t){return ue(r,void 0,void 0,function(){return de(this,function(e){return 0<t.results.length&&t.results[0].graphic.layer.id===this.displayedLayerid&&this.emit(z.click,t,i.mapPoint),[2]})})})}),this.view.on(z.pointermove,function(i){r.view.hitTest(i).then(function(t){return ue(r,void 0,void 0,function(){return de(this,function(e){return 0<t.results.length&&t.results[0].graphic.layer.id===this.displayedLayerid&&this.emit(z.pointermove,t,this.view.toMap({x:i.x,y:i.y})),[2]})})})}),[2]})})},ye);function ye(e){var t=ae.call(this)||this;return t.displayedLayerid="",t.view=null,t.mapoverlayers=[],t.init(e),t}var pe,fe,he=(pe=function(e,t){return(pe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}pe(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),be=function(e,l,a,s){return new(a=a||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,o)}n((s=s.apply(e,l||[])).next())})},ve=function(i,r){var o,n,l,e,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(l=2&t[0]?n.return:t[0]?n.throw||((l=n.return)&&l.call(n),0):n.next)&&!(l=l.call(n,t[1])).done)return l;switch(n=0,l&&(t=[2&t[0],l.value]),t[0]){case 0:case 1:l=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,n=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(l=0<(l=a.trys).length&&l[l.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!l||t[1]>l[0]&&t[1]<l[3])){a.label=t[1];break}if(6===t[0]&&a.label<l[1]){a.label=l[1],l=t;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(t);break}l[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(i,a)}catch(e){t=[6,e],n=0}finally{o=l=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},me=(he(we,fe=e),we.prototype.add=function(r){var o=this;g(["smiapi/utils/HeatMapLayer"]).then(function(e){var t=e[0],i={container:document.getElementById(r.container),radius:r.radius||30,maxOpacity:r.maxOpacity||.8,minOpacity:r.minOpacity||0,blur:r.blur||.7,gradient:r.gradient||{0:"rgb(0,0,0)",.3:"rgb(0,0,255)",.8:"rgb(0,255,0)",.98:"rgb(255,255,0)",1:"rgb(255,0,0)"}};o.heatmaplayer=new t(o.view,i,r.datas,r.h337,r.id),o.heatmaplayer.addData()})},we.prototype.remove=function(e){var t=document.getElementsByClassName("esri-view-surface")[0],i=document.getElementById(e);null!=i&&t.removeChild(i)},we.prototype.refreshdata=function(e){this.heatmaplayer.setVisible(!0),this.heatmaplayer.freshenLayerData(e)},we.prototype.show=function(){this.heatmaplayer.setVisible(!0)},we.prototype.hide=function(){this.heatmaplayer.setVisible(!1)},we.prototype.init=function(t){return be(this,void 0,void 0,function(){return ve(this,function(e){return this.displayedLayerid=(new L).uuid,this.view=t,[2]})})},we);function we(e){var t=fe.call(this)||this;return t.displayedLayerid="",t.view=null,t.heatmaplayer=null,t.init(e),t}var ge=(Le.shqxboundary="qx_boundary",Le.shjdboundary="jd_boundary",Le.shjwhboundary="jwh_boundary",Le);function Le(){}var xe,ze,ke=(xe=function(e,t){return(xe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}xe(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ce=function(e,l,a,s){return new(a=a||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,o)}n((s=s.apply(e,l||[])).next())})},Se=function(i,r){var o,n,l,e,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(l=2&t[0]?n.return:t[0]?n.throw||((l=n.return)&&l.call(n),0):n.next)&&!(l=l.call(n,t[1])).done)return l;switch(n=0,l&&(t=[2&t[0],l.value]),t[0]){case 0:case 1:l=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,n=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(l=0<(l=a.trys).length&&l[l.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!l||t[1]>l[0]&&t[1]<l[3])){a.label=t[1];break}if(6===t[0]&&a.label<l[1]){a.label=l[1],l=t;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(t);break}l[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(i,a)}catch(e){t=[6,e],n=0}finally{o=l=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},Ie=(ke(Ae,ze=e),Ae.prototype.add=function(p){var f=this;g(["esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Polygon","esri/geometry/geometryEngineAsync","esri/geometry/SpatialReference","esri/Color"]).then(function(e){var u=e[0],t=e[1],i=e[2],d=e[3],c=(e[4],e[5]),r=null;"qx_boundary"!==p.boundaryType&&"jd_boundary"!==p.boundaryType&&"jwh_boundary"!==p.boundaryType||(r=f.view.map.findLayerById(p.boundaryType));var y=f.view.map.findLayerById(f.displayedLayerid);if(null==y&&(y=new t({id:f.displayedLayerid,title:"遮罩层",listMode:"hide"}),f.view.map.add(y)),y.removeAll(),p.inputgeometry){if(null===(r=f.view.map.findLayerById("qx_boundary")))return;var o=new i({rings:p.inputgeometry,spatialReference:f.view.spatialReference}),n=r.fullExtent;n.spatialReference=f.view.spatialReference;var s=o;s.spatialReference=f.view.spatialReference,d.buffer(s,p.boundarydistance,"meters").then(function(e){d.difference(n,e).then(function(e){var t;t="3d"===f.view.type?p.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:p.maskColor},size:p.symbol.size,edges:{type:"solid",color:p.maskColor}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:p.maskColor},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:p.maskColor,style:"solid",outline:{color:p.maskColor,width:1}};var i=new u({geometry:e,symbol:t});y.add(i);for(var o=void 0===p.bounarycount?30:p.bounarycount,n=Math.ceil(p.boundarydistance/o),l=new c(p.boundaryColor).toRgba(),r=function(r){d.buffer(s,r*o,"meters").then(function(t){d.buffer(s,(r-1)*o,"meters").then(function(e){d.difference(t,e).then(function(e){var t;l[3]=1/n*r,t="3d"===f.view.type?p.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:l},size:p.symbol.size,edges:{type:"solid",color:l}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:l},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:l,style:"solid",outline:{color:l,width:1}};var i=new u({geometry:e,symbol:t});y.add(i)})})})},a=1;a<=n;a++)r(a)})})}else{if(console.log(r),null===r)return;var l=r.createQuery();l.where=p.boundaryDefinition,r.queryFeatures(l).then(function(e){if(e.features.length){var t=r.fullExtent;t.spatialReference=f.view.spatialReference;var s=e.features[0].geometry;s.spatialReference=f.view.spatialReference,d.buffer(s,p.boundarydistance,"meters").then(function(e){d.difference(t,e).then(function(e){var t;t="3d"===f.view.type?p.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:p.maskColor},size:p.symbol.size,edges:{type:"solid",color:p.maskColor}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:p.maskColor},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:p.maskColor,style:"solid",outline:{color:p.maskColor,width:1}};var i=new u({geometry:e,symbol:t});y.add(i);for(var o=void 0===p.bounarycount?30:p.bounarycount,n=Math.ceil(p.boundarydistance/o),l=new c(p.boundaryColor).toRgba(),r=function(r){d.buffer(s,r*o,"meters").then(function(t){d.buffer(s,(r-1)*o,"meters").then(function(e){d.difference(t,e).then(function(e){var t;l[3]=1/n*r,t="3d"===f.view.type?p.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:l},size:p.symbol.size,edges:{type:"solid",color:l}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:l},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:l,style:"solid",outline:{color:l,width:1}};var i=new u({geometry:e,symbol:t});y.add(i)})})})},a=1;a<=n;a++)r(a)})})}})}})},Ae.prototype.remove=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e)},Ae.prototype.show=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!0)},Ae.prototype.hide=function(){var e=this.view.map.findLayerById(this.displayedLayerid);e&&(e.visible=!1)},Ae.prototype.init=function(t){return Ce(this,void 0,void 0,function(){return Se(this,function(e){return this.displayedLayerid=(new L).uuid,this.view=t,[2]})})},Ae);function Ae(e){var t=ze.call(this)||this;return t.displayedLayerid="",t.view=null,t.init(e),t}var Re,Ee,_e=(Re=function(e,t){return(Re=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Re(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Be=function(e,l,a,s){return new(a=a||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,o)}n((s=s.apply(e,l||[])).next())})},Pe=function(i,r){var o,n,l,e,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(l=2&t[0]?n.return:t[0]?n.throw||((l=n.return)&&l.call(n),0):n.next)&&!(l=l.call(n,t[1])).done)return l;switch(n=0,l&&(t=[2&t[0],l.value]),t[0]){case 0:case 1:l=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,n=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(l=0<(l=a.trys).length&&l[l.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!l||t[1]>l[0]&&t[1]<l[3])){a.label=t[1];break}if(6===t[0]&&a.label<l[1]){a.label=l[1],l=t;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(t);break}l[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(i,a)}catch(e){t=[6,e],n=0}finally{o=l=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},je=(_e(Me,Ee=e),Me.prototype.add=function(n){var l=this;void 0===n&&(n={}),g(["esri/layers/echartsLayer"]).then(function(e){var t=e[0],i=[];n.datas.forEach(function(e,t){i.push({name:e[0]+" Top10",type:"lines",coordinateSystem:"arcgis",zlevel:1,effect:{show:!0,period:6,trailLength:.7,color:"#fff",symbolSize:3},lineStyle:{normal:{color:n.color[t],width:0,curveness:.2}},data:l.convertData(e[1],n.geoCoordMap)},{name:e[0]+" Top10",type:"lines",coordinateSystem:"arcgis",zlevel:2,symbol:["none","arrow"],symbolSize:10,effect:{show:!0,period:6,trailLength:0,symbol:n.planePath,symbolSize:15},lineStyle:{normal:{color:n.color[t],width:1,opacity:.6,curveness:.2}},data:l.convertData(e[1],n.geoCoordMap)},{name:e[0]+" Top10",type:"effectScatter",coordinateSystem:"arcgis",zlevel:2,rippleEffect:{brushType:"stroke"},legendHoverLink:!0,hoverAnimation:!0,symbol:n.symbol,label:{normal:{show:!0,position:"right",formatter:"{b}"}},symbolSize:function(e){return e[2]/8},itemStyle:{normal:{color:n.color[t],shadowBlur:10,shadowColor:"#333"}},data:e[1].map(function(e){return{name:e[1].name,value:n.geoCoordMap[e[1].name].concat([e[1].value])}})})});var r=new t(l.view,"",n.id),o={title:{text:"",subtext:"",left:"center",textStyle:{color:"#fff"}},series:i};r.setChartOption(o)})},Me.prototype.remove=function(e){var t=document.getElementsByClassName("esri-view-surface")[0],i=document.getElementById(e);null!=i&&t.removeChild(i)},Me.prototype.convertData=function(e,t){for(var i=[],r=0,o=e;r<o.length;r++){var n=o[r],l=t[n[0].name],a=t[n[1].name];l&&a&&i.push({fromName:n[0].name,toName:n[1].name,coords:[l,a],value:n[1].value})}return i},Me.prototype.getAPIScript=function(e){return document.querySelector("script["+e+"]")},Me.prototype.loadAPIScript=function(o,n){var l=this;return new r.Promise(function(e,t){var i=l.getAPIScript(o);if(i){var r=i.getAttribute("src");r!==n?t(new Error("The echartgl is already loaded ("+r+").")):l.handleScriptLoad(i,e,t)}else i=l.createScript(o,n),l.handleScriptLoad(i,function(){i.setAttribute(o,"loaded"),e(i)},t),document.head.appendChild(i)})},Me.prototype.createScript=function(e,t){var i=document.createElement("script");return i.type="text/javascript",i.src=t,i.setAttribute(e,"loading"),i},Me.prototype.handleScriptLoad=function(e,t,i){var r;i&&(r=this.handleScriptError(e,i));var o=function(){t(e),e.removeEventListener("load",o,!1),r&&e.removeEventListener("error",r,!1)};e.addEventListener("load",o,!1)},Me.prototype.handleScriptError=function(t,i){var r=function(e){i(e.error||new Error("There was an error attempting to load "+t.src)),t.removeEventListener("error",r,!1)};return t.addEventListener("error",r,!1),r},Me.prototype.init=function(t){return Be(this,void 0,void 0,function(){return Pe(this,function(e){return this.view=t,[2]})})},Me);function Me(e){var t=Ee.call(this)||this;return t.view=null,t.init(e),t}var Oe,We,Te=(Oe=function(e,t){return(Oe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Oe(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),He=function(e,l,a,s){return new(a=a||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,o)}n((s=s.apply(e,l||[])).next())})},Ge=function(i,r){var o,n,l,e,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(l=2&t[0]?n.return:t[0]?n.throw||((l=n.return)&&l.call(n),0):n.next)&&!(l=l.call(n,t[1])).done)return l;switch(n=0,l&&(t=[2&t[0],l.value]),t[0]){case 0:case 1:l=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,n=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(l=0<(l=a.trys).length&&l[l.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!l||t[1]>l[0]&&t[1]<l[3])){a.label=t[1];break}if(6===t[0]&&a.label<l[1]){a.label=l[1],l=t;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(t);break}l[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(i,a)}catch(e){t=[6,e],n=0}finally{o=l=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},Je=(Te(Fe,We=e),Fe.prototype.play=function(l){var a=this;void 0===l&&(l={}),g(["geolocate","esri/widgets/Track","esri/geometry/support/webMercatorUtils"]).then(function(e){var i=e[0],t=e[1],r=e[2];if(void 0!==l.coords){var o=0;a.track=new t({view:a.view,goToLocationEnabled:!1});var n=0;i.use(),void 0!==a.routepalybackinternal&&clearInterval(a.routepalybackinternal),a.routepalybackinternal=setInterval(function(){var e=r.xyToLngLat(l.coords[n].x,l.coords[n].y),t={lng:e[0],lat:e[1]};i.change(t),n=(n+1)%l.coords.length,++o===l.coords.length&&clearInterval(a.routepalybackinternal)},2500),a.view.when(function(){var t=a.view.center;a.track.on("track",function(){l.mobilesymbol&&(a.track.graphic.symbol=l.mobilesymbol);var e=a.track.graphic.geometry;1<o&&l.showtrail&&a.createAnimateRoute(e,t,l.trailsymbol),a.view.goTo({center:e,tilt:70,scale:2500,heading:360-a.getHeading(e,t),rotation:360-a.getHeading(e,t)}).catch(function(e){"AbortError"!==e.name&&console.error(e)}),t=e.clone()}),a.track.start()})}}).catch(function(e){console.error(e)})},Fe.prototype.remove=function(){this.routepalybackinternal,clearInterval(this.routepalybackinternal),this.track.destroy();var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e)},Fe.prototype.getHeading=function(e,t){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI-90},Fe.prototype.createAnimateRoute=function(n,l,a){var s=this;g(["esri/Graphic","esri/layers/GraphicsLayer"]).then(function(e){var t=e[0],i=e[1],r=new t({geometry:{type:"polyline",paths:[[l.longitude,l.latitude],[n.longitude,n.latitude]]},symbol:void 0!==a?a:{type:"simple-line",color:[156,39,176],width:10}}),o=s.view.map.findLayerById(s.displayedLayerid);void 0===o&&(o=new i({title:"路径轨迹播放",id:s.displayedLayerid,listMode:"hide"}),s.view.map.add(o)),o.add(r)})},Fe.prototype.init=function(t){return He(this,void 0,void 0,function(){return Ge(this,function(e){return this.displayedLayerid=(new L).uuid,this.view=t,[2]})})},Fe);function Fe(e){var t=We.call(this)||this;return t.displayedLayerid="",t.view=null,t.routepalybackinternal=null,t.track=null,t.init(e),t}var Ze,qe,De=(Ze=function(e,t){return(Ze=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ze(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ne=function(e,l,a,s){return new(a=a||Promise)(function(i,t){function r(e){try{n(s.next(e))}catch(e){t(e)}}function o(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,o)}n((s=s.apply(e,l||[])).next())})},Xe=function(i,r){var o,n,l,e,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(l=2&t[0]?n.return:t[0]?n.throw||((l=n.return)&&l.call(n),0):n.next)&&!(l=l.call(n,t[1])).done)return l;switch(n=0,l&&(t=[2&t[0],l.value]),t[0]){case 0:case 1:l=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,n=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(l=0<(l=a.trys).length&&l[l.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!l||t[1]>l[0]&&t[1]<l[3])){a.label=t[1];break}if(6===t[0]&&a.label<l[1]){a.label=l[1],l=t;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(t);break}l[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(i,a)}catch(e){t=[6,e],n=0}finally{o=l=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},Ye=(De(Ve,qe=e),Ve.prototype.play=function(y){var p=this;void 0===y&&(y={}),g(["esri/geometry/Point","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/support/webMercatorUtils"]).then(function(e){var o=e[0],n=e[1],l=e[2];if(e[3],void 0!==y.coords){var a=0,s=0,u=p.view.center;void 0!==p.mapRoamplayinternal&&clearInterval(p.mapRoamplayinternal);var d=void 0!==y.duration?y.duration:2e3,c=void 0!==y.speedFactor?y.speedFactor:1;p.mapRoamplayinternal=setInterval(function(){var e={x:y.coords[s].x,y:y.coords[s].y,z:void 0!==y.coords[s].z?y.coords[s].z:0};s=(s+1)%y.coords.length,++a;var t=new o({x:e.x,y:e.y,z:e.z,spatialReference:p.view.spatialReference}),i=p.view.map.findLayerById(p.mobilelayerid);void 0===i&&(i=new l({title:"漫游路径"+p.mobilelayerid,id:p.mobilelayerid,listMode:"hide"}),p.view.map.add(i)),i.removeAll();var r=new n({geometry:t,symbol:y.mobilesymbol});i.add(r),1<a&&y.showtrail&&p.createAnimateRoute(t,u,y.trailsymbol),p.view.goTo({center:t,tilt:70,scale:2500,heading:360-p.getHeading(t,u),rotation:360-p.getHeading(t,u)},{speedFactor:c,duration:d-.2*d,maxDuration:d-.2*d,easing:"in-out-coast-quadratic"}).then().catch(function(e){"AbortError"!==e.name&&console.error(e)}),u=t.clone(),a===y.coords.length&&clearInterval(p.mapRoamplayinternal)},d)}}).catch(function(e){console.error(e)})},Ve.prototype.remove=function(){this.mapRoamplayinternal,clearInterval(this.mapRoamplayinternal);var e=this.view.map.findLayerById(this.displayedLayerid);e&&this.view.map.remove(e);var t=this.view.map.findLayerById(this.mobilelayerid);t&&this.view.map.remove(t)},Ve.prototype.getHeading=function(e,t){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI-90},Ve.prototype.createAnimateRoute=function(n,l,a){var s=this;g(["esri/Graphic","esri/layers/GraphicsLayer"]).then(function(e){var t=e[0],i=e[1],r=new t({geometry:{type:"polyline",paths:[[l.x,l.y,l.z],[n.x,n.y,n.z]],spatialReference:s.view.spatialReference},symbol:void 0!==a?a:{type:"simple-line",color:[156,39,176],width:10}}),o=s.view.map.findLayerById(s.displayedLayerid);void 0===o&&(o=new i({title:"漫游路径"+s.displayedLayerid,id:s.displayedLayerid,listMode:"hide"}),s.view.map.add(o)),o.add(r)})},Ve.prototype.init=function(t){return Ne(this,void 0,void 0,function(){return Xe(this,function(e){return this.displayedLayerid=(new L).uuid,this.mobilelayerid=(new L).uuid,this.view=t,[2]})})},Ve);function Ve(e){var t=qe.call(this)||this;return t.displayedLayerid="",t.view=null,t.mapRoamplayinternal=null,t.mobilelayerid="",t.init(e),t}return{load:g,Layers:ge,Boundary:E,Draw:W,GraphicOverlays:ce,FeaureOverlays:Q,EchartFlashPointLayer:q,FlashPoint3DLayer:oe,HeatMap:me,MaskBoundary:Ie,TrajectoryPlus:Ye,MigrationMap:je,Trajectory:Je}});
//# sourceMappingURL=Plugins.min.js.map

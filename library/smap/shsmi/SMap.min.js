!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.SMap=t()}(this,function(){"use strict";function e(e,t){this.northeast=t,this.southwest=e,this.xmin=e[0],this.ymin=e[1],this.zmin=void 0!==e[2]?e[2]:void 0,this.xmax=t[0],this.ymax=t[1],this.zmax=void 0!==t[2]?t[2]:void 0}function t(e,t,i){this.X=e,this.Y=t,this.Z=void 0===i?0:i}function i(e){this.visible=!(void 0!==e.visible&&!e.visible),this.position=void 0===e.position||"top-right"===e.position?"top-right":e.position,this.collapse=!0===e.collapse}var o,r,l=((o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})(a,r=i),a);function a(e){var t=r.call(this,e)||this;return t.controlName="basemaptoggle",t}var n,s,c=((n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})(p,s=i),p);function p(e){var t=s.call(this,e)||this;return t.controlName="bimfilter",t.layerid=e.layerid,t}var u,h,d=((u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})(y,h=i),y);function y(e){var t=h.call(this,e)||this;return t.controlName="basemapgallery",t}var f,b,m=((f=function(e,t){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}f(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})(v,b=i),v);function v(e){var t=b.call(this,e)||this;return t.controlName="baseMapGalleryExpand",t}var w,g,z=((w=function(e,t){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}w(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})(x,g=i),x);function x(e){var t=g.call(this,e)||this;return t.controlName="compass",t}var k,C,L=((k=function(e,t){return(k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}k(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})(S,C=i),S);function S(e){var t=C.call(this,e)||this;return t.controlName="fullscreen",t}var _,M,A=((_=function(e,t){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}_(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})(E,M=i),E);function E(e){var t=M.call(this,e)||this;return t.controlName="home",t}var R,O,P=((R=function(e,t){return(R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}R(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})(N,O=i),N);function N(e){var t=O.call(this,e)||this;return t.controlName="toc",t}var D,I,j=((D=function(e,t){return(D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}D(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})(T,I=i),T);function T(e){var t=I.call(this,e)||this;return t.controlName="measurearea",t}var W,B,F=((W=function(e,t){return(W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}W(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})(H,B=i),H);function H(e){var t=B.call(this,e)||this;return t.controlName="measureline",t}var J,V,U=((J=function(e,t){return(J=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}J(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})(Z,V=i),Z);function Z(e){var t=V.call(this,e)||this;return t.controlName="undergroundswitch",t}var G,q,X=((G=function(e,t){return(G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}G(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})(Y,q=i),Y);function Y(e){var t=q.call(this,e)||this;return t.controlName="zoom",t}var $=(K.jsapi="http://10.108.3.16/smiapi/arcgis",K.jsapiversion4X="4.15",K.userName="smiapi",K.menuName="smiapi_23d",K.proxyURL="http://10.108.3.16/mapkProx/proxy.jsp?",K.tokenserviceurl="http://mapserver.smi.sh.cegn.cn:8080/OneMapServer/rest/services",K.mapconfigbackendurl="http://10.108.3.16:8401/mapconfig/usermenu?",K.tokenconfigname="smiapi_new",K.tokenUser="none",K.tokenPassword="none",K);function K(){}var Q=$.jsapiversion4X,ee="next";function te(e){if(null===e&&(e=Q),e.toString().toLowerCase()===ee)return ee;var t=e&&e.match(/^(\d)\.(\d+)/);return t&&{major:parseInt(t[1],10),minor:parseInt(t[2],10)}}function ie(e){return void 0===e&&(e=Q),$.jsapi+"/"+e+"/init.js"}function oe(e){var t=document.createElement("link");return t.rel="stylesheet",t.href=e,t}function re(e,t){var i;t?(i=document.querySelector(t)).parentNode.insertBefore(e,i):document.head.appendChild(e)}function le(e){return document.querySelector('link[href*="'+e+'"]')}function ae(e){return!e||te(e)?function(e){void 0===e&&(e=Q),null===e&&(e=Q);var t=ie(e),i=t.substring(0,t.indexOf("init.js")),o=te(e);return o===ee||3!==o.major?i+"esri/themes/light/main.css":i+(o.minor<=10?"js/":"")+"esri/css/esri.css"}(e):e}function ne(e,t){var i,o=ae(e),r=le(o);return r||re(r=oe(o),t),4===function(e){null===e&&(e=Q);var t=e&&e.match(/^(\d)\.(\d+)/);return t&&{major:parseInt(t[1],10),minor:parseInt(t[2],10)}}(e).major&&(le(i=o.substring(0,o.indexOf("esri/themes/"))+"esri/themes/gis/css/gis.css")||re(oe(i),t)),r}var se={Promise:"undefined"!=typeof window?window.Promise:void 0},ce={};function pe(e,t,i){var o,r,l,a;i&&(l=i,a=function(e){l(e.error||new Error("There was an error attempting to load "+r.src)),r.removeEventListener("error",a,!1)},(r=e).addEventListener("error",a,!1),o=a);var n=function(){t(e),e.removeEventListener("load",n,!1),o&&e.removeEventListener("error",o,!1)};e.addEventListener("load",n,!1)}function ue(){return document.querySelector("script[data-shsmi]")}function he(){var e=window.require;return e&&e.on}function de(e){void 0===e&&(e={});var s={};[ce,e].forEach(function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(s[t]=e[t])});var c=s.version,p=s.url||ie(c);return new se.Promise(function(e,t){var i,o,r,l,a,n=ue();n?(i=n.getAttribute("src"))!==p?t(new Error("The ArcGIS API for JavaScript is already loaded ("+i+").")):he()?e(n):pe(n,e,t):he()?t(new Error("The ArcGIS API for JavaScript is already loaded.")):(ne((o=s.css)?!0===o?c:o:null,s.insertCssBefore),s.dojoConfig?window.dojoConfig=s.dojoConfig:(r={async:!0,packages:[{location:$.jsapi+"/extensions",name:"smiapi"},{location:$.jsapi+"/extensions/geolocation",name:"geolocate",main:"geolocate"}],deps:["@dojo/framework/shim/main"],has:{"esri-promise-compatibility":1,"esri-featurelayer-webgl":1}},window.dojoConfig=r),l=p,(a=document.createElement("script")).type="text/javascript",a.src=l,a.setAttribute("data-shsmi","loading"),pe(n=a,function(){n.setAttribute("data-shsmi","loaded"),e(n)},t),document.head.appendChild(n))})}function ye(t){return new se.Promise(function(i,e){var o=window.require.on("error",e);window.require(t,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.remove(),i(e)})})}function fe(e,t){if(void 0===t&&(t={}),he())return ye(e);var i=ue(),o=i&&i.getAttribute("src");return!t.url&&o&&(t.url=o),de(t).then(function(){return ye(e)})}var be=function(e,a,n,s){return new(n=n||Promise)(function(i,t){function o(e){try{l(s.next(e))}catch(e){t(e)}}function r(e){try{l(s.throw(e))}catch(e){t(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(o,r)}l((s=s.apply(e,a||[])).next())})},me=function(i,o){var r,l,a,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,l&&(a=2&t[0]?l.return:t[0]?l.throw||((a=l.return)&&a.call(l),0):l.next)&&!(a=a.call(l,t[1])).done)return a;switch(l=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,l=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){n=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){n.label=t[1];break}if(6===t[0]&&n.label<a[1]){n.label=a[1],a=t;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(t);break}a[2]&&n.ops.pop(),n.trys.pop();continue}t=o.call(i,n)}catch(e){t=[6,e],l=0}finally{r=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function ve(w,i,g,z){return be(this,void 0,void 0,function(){var t,p,u,h,d,y,f,b,m,v;return me(this,function(e){switch(e.label){case 0:return[4,fe(["esri/geometry/Extent","esri/layers/SHCTiledMapServiceLayer","esri/layers/SceneLayer","esri/layers/TileLayer","esri/layers/GraphicsLayer","esri/layers/MapImageLayer","esri/layers/GeoJSONLayer","esri/layers/GroupLayer","esri/layers/FeatureLayer","esri/geometry/SpatialReference"])];case 1:return t=e.sent(),p=t[0],u=t[1],h=t[2],t[3],d=t[4],y=t[5],f=t[6],b=t[7],m=t[8],v=t[9],i.map(function(e){var t;if("GroupLayer"===e.mapType.trim())"3D"!==z&&1!==parseFloat(e.modeType)||(t=new b({id:e.layerEName,title:e.layerCName,visible:parseFloat(e.isVisible),opacity:parseFloat(e.opacity)}),w.add(t),e.hasChildren&&ve(t,e.children,g,z));else switch(e.mapType.trim()){case"SHCTiledMapServiceLayer":var i=new p({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:v.WebMercator});!0==!parseFloat(e.isToken)?w.add(u({url:e.url,fullExtent:i,opacity:parseFloat(e.opacity),title:e.layerCName,id:e.layerEName,visible:parseFloat(e.isVisible)})):w.add(u({url:e.url,token:g,fullExtent:i,opacity:parseFloat(e.opacity),title:e.layerCName,id:e.layerEName,visible:parseFloat(e.isVisible)}));break;case"MapImageLayer":w.add(new y({url:e.url,opacity:parseFloat(e.opacity),title:e.layerCName,id:e.layerEName,visible:parseFloat(e.isVisible)}));break;case"SceneLayer":var o,r=new h({url:e.url,opacity:parseFloat(e.opacity),title:e.layerCName,id:e.layerEName,visible:parseFloat(e.isVisible)});e.renderer&&(n=JSON.parse(e.renderer),r.renderer=n),e.popuptemplate&&(s=JSON.parse(e.popuptemplate),r.popupTemplate=s),e.definitionExpress&&(r.definitionExpression=e.definitionExpress),e.elevationInfo&&(o=JSON.parse(e.elevationInfo),r.elevationInfo=o),e.maxScale&&(r.maxScale=e.maxScale),e.minScale&&(r.minScale=e.minScale),w.add(r);break;case"GraphicsLayer":var l=new d({opacity:parseFloat(e.opacity),title:e.layerCName,id:e.layerEName,visible:parseFloat(e.isVisible)});w.add(l);break;case"GeoJSONLayer":var a=new f({url:e.url,opacity:parseFloat(e.opacity),title:e.layerCName,id:e.layerEName,visible:parseFloat(e.isVisible)});w.add(a);break;case"FeatureLayer":var n,s,c=new m({url:e.url,opacity:parseFloat(e.opacity),title:e.layerCName,id:e.layerEName,visible:parseFloat(e.isVisible)});e.renderer&&(n=JSON.parse(e.renderer),c.renderer=n),e.popuptemplate&&(s=JSON.parse(e.popuptemplate),c.popupTemplate=s),e.definitionExpress&&(c.definitionExpression=e.definitionExpress),e.elevationInfo&&(c.elevationInfo=JSON.parse(e.elevationInfo)),e.maxScale&&(c.maxScale=e.maxScale),e.maxScale&&(c.minScale=e.minScale),w.add(c)}}),[2]}})})}var we=function(e,a,n,s){return new(n=n||Promise)(function(i,t){function o(e){try{l(s.next(e))}catch(e){t(e)}}function r(e){try{l(s.throw(e))}catch(e){t(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(o,r)}l((s=s.apply(e,a||[])).next())})},ge=function(i,o){var r,l,a,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,l&&(a=2&t[0]?l.return:t[0]?l.throw||((a=l.return)&&a.call(l),0):l.next)&&!(a=a.call(l,t[1])).done)return a;switch(l=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,l=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){n=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){n.label=t[1];break}if(6===t[0]&&n.label<a[1]){n.label=a[1],a=t;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(t);break}a[2]&&n.ops.pop(),n.trys.pop();continue}t=o.call(i,n)}catch(e){t=[6,e],l=0}finally{r=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function ze(v,w,g,e,z,t,x,k){return we(this,void 0,void 0,function(){var t,i,o,r,l,a,n,s,c,p,u,h,d,y,f,b,m=this;return ge(this,function(e){switch(e.label){case 0:return[4,fe(["esri/Map","esri/Basemap","esri/geometry/Point","esri/core/urlUtils","esri/config","esri/core/watchUtils","esri/views/SceneView","esri/identity/IdentityManager","esri/geometry/SpatialReference"])];case 1:return t=e.sent(),i=t[0],o=t[1],r=t[2],l=t[3],a=t[4],n=t[5],s=t[6],c=t[7],p=t[8],parseFloat(w.useProxy)&&z.map(function(e){l.addProxyRule({proxyUrl:e.proxyUrl,urlPrefix:e.domainName})}),a.geometryServiceUrl=w.geometryserviceUrl,u=g.filter(function(e){return"basemap"===e.layerEName}),"2"!==w.tokenType&&c.registerToken({server:$.tokenserviceurl,token:x}),c.on("dialog-create",function(){c.dialog.open=!0}),[4,function(o){return be(this,void 0,void 0,function(){var t,i;return me(this,function(e){switch(e.label){case 0:return[4,fe(["esri/layers/TileLayer"])];case 1:return t=e.sent()[0],i=[],o.forEach(function(e){switch(e.mapType){case"TileLayer":i.push(new t(e.url,{id:e.layerEName,visible:parseFloat(e.isVisible),opacity:e.opacity,title:e.layerCName}))}}),[2,i]}})})}(u[0].children)];case 2:if(h=e.sent(),d=new o({baseLayers:h,title:"底图",id:"basemap_as"}),y=new i({basemap:d}),void 0!==k.mapStyle){switch(k.mapStyle){case"smap://styles/light":y.basemap.id="basemap_zw";break;case"smap://styles/dark":y.basemap.id="basemap_as";break;case"smap://styles/image":y.basemap.id="basemap_air";break;default:y.basemap.id="basemap_as"}y.basemap.baseLayers.items.forEach(function(e){e.id===y.basemap.id?e.visible=!0:e.visible=!1})}return(f=new s({map:y,container:v,spatialReference:{wkid:102100},viewingMode:"local"}),fe(["esri/core/Collection"]).then(function(e){var i=e[0];return we(m,void 0,void 0,function(){var t;return ge(this,function(e){switch(e.label){case 0:return b=new i,t=void 0===k.viewMode||"2D"===k.viewMode?"2D":"3D",[4,ve(b,g.slice(1),x,t)];case 1:return e.sent(),y.addMany(b),["model_white_zw","model_air_real","model_white_as"].forEach(function(e){var t=y.findLayerById(e);!1===k.showBuildingBlock?t&&(t.visible=!1):t&&("basemap_zw"===y.basemap.id?t.visible="model_white_zw"===e:"basemap_as"===y.basemap.id?t.visible="model_white_as"===e:"basemap_air"===y.basemap.id&&(t.visible="model_air_real"===e))}),[2]}})})}).catch(function(e){console.error(e)}),f.ui.empty("top-left"),f.ui.empty("top-right"),f.ui.empty("bottom-left"),f.ui.empty("bottom-right"),f.padding={top:5,bottom:0,left:0,right:5},f.when(function(){f.qualitySettings.memoryLimit=4096,c.on("dialog-create",function(){c.dialog.open=!0})}),void 0!==k.center&&(f.center=new r({x:k.center[0],y:k.center[1],z:void 0!==k.center[2]?k.center[2]:0,spatialReference:p.WebMercator})),void 0!==k.zoom&&(f.zoom=k.zoom),void 0===k.pitch)?[3,4]:[4,f.goTo({center:f.center,zoom:f.zoom,tilt:k.pitch,heading:0})];case 3:e.sent(),n.when(f,"animation",function(e){e.when(function(e){void 0!==k.zooms&&f.watch("zoom",function(e){e>=k.zooms[1]&&(f.zoom=k.zooms[1]),e<=k.zooms[0]&&(f.zoom=k.zooms[0])})}).catch(function(e){console.log(e)})}),e.label=4;case 4:return[2,{sceneView:f,mapv:y}]}})})}function xe(m,v,w,e,g,t,z,x){return we(this,void 0,void 0,function(){var t,i,o,r,l,a,n,s,c,p,u,h,d,y,f,b=this;return ge(this,function(e){switch(e.label){case 0:return[4,fe(["esri/Map","esri/Basemap","esri/core/urlUtils","esri/config","esri/identity/IdentityManager","esri/geometry/SpatialReference","esri/geometry/Point","esri/views/MapView"])];case 1:return t=e.sent(),i=t[0],o=t[1],r=t[2],l=t[3],a=t[4],n=t[5],s=t[6],c=t[7],parseFloat(v.useProxy)&&g.map(function(e){r.addProxyRule({proxyUrl:e.proxyUrl,urlPrefix:e.domainName})}),l.geometryServiceUrl=v.geometryserviceUrl,p=w.filter(function(e){return"basemap"===e.layerEName}),"2"!==v.tokenType&&a.registerToken({server:p[0].children[1].url.substring(0,p[0].children[1].url.lastIndexOf("/rest/services"))+"/rest/services",token:z}),a.on("dialog-create",function(){a.dialog.open=!0}),[4,function(o){return be(this,void 0,void 0,function(){var t,i;return me(this,function(e){switch(e.label){case 0:return[4,fe(["esri/layers/TileLayer"])];case 1:return t=e.sent()[0],i=[],o.map(function(e){switch(e.mapType){case"TileLayer":i.push(new t(e.url,{id:e.layerEName,visible:parseFloat(e.isVisible),opacity:e.opacity,listMode:e.listMode,title:e.layerCName}))}}),[2,i]}})})}(p[0].children)];case 2:if(u=e.sent(),h=new o({baseLayers:u,title:"底图",id:"basemap_as"}),d=new i({basemap:h}),void 0!==x.mapStyle){switch(x.mapStyle){case"smap://styles/light":d.basemap.id="basemap_zw";break;case"smap://styles/dark":d.basemap.id="basemap_as";break;case"smap://styles/image":d.basemap.id="basemap_air";break;default:d.basemap.id="basemap_as"}d.basemap.baseLayers.items.forEach(function(e){e.id===d.basemap.id?e.visible=!0:e.visible=!1})}return new n({wkt:'PROJCS["shanghaicity",GEOGCS["GCS_Beijing_1954",DATUM["D_Beijing_1954",SPHEROID["Krasovsky_1940",6378245.0,298.3]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Transverse_Mercator"],PARAMETER["False_Easting",-3457147.81],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",121.2751921],PARAMETER["Scale_Factor",1.0],PARAMETER["Latitude_Of_Origin",0.0],UNIT["Meter",1.0]]'}),y=new c({map:d,container:m,spatialReference:{wkid:102100}}),fe(["esri/core/Collection"]).then(function(e){var i=e[0];return we(b,void 0,void 0,function(){var t;return ge(this,function(e){switch(e.label){case 0:return f=new i,t=void 0===x.viewMode||"2D"===x.viewMode?"2D":"3D",[4,ve(f,w.slice(1),z,t)];case 1:return e.sent(),d.addMany(f),[2]}})})}).catch(function(e){console.error(e)}),y.ui.empty("top-left"),y.ui.empty("top-right"),y.ui.empty("bottom-left"),y.ui.empty("bottom-right"),y.padding={top:5,bottom:0,left:0,right:5},void 0!==x.center&&(y.center=new s({x:x.center[0],y:x.center[1],spatialReference:{wkid:102100}})),void 0!==x.zoom&&(y.zoom=x.zoom),void 0!==x.zooms&&(y.constraints.minZoom=x.zooms[0],y.constraints.maxZoom=x.zooms[1]),void 0!==x.rotateEnable&&(y.constraints.rotationEnabled=x.rotateEnable),[2,{mapView:y,mapv:d}]}})})}var ke=(Ce.prototype._addListener=function(e,t,i){var o;this.emit("newListener",e,t),this.events.has(e)?(o=this.events.get(e),i?o.unshift(t):o.push(t)):this.events.set(e,[t]);var r,l=this.getMaxListeners();return 0<l&&this.listenerCount(e)>l&&((r=new Error("Possible EventEmitter memory leak detected.\n         "+this.listenerCount(e)+" "+e.toString()+" listeners.\n         Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",console.warn(r)),this},Ce.prototype.addListener=function(e,t){return this._addListener(e,t,!1)},Ce.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(this.events.has(e)){for(var o=0,r=this.events.get(e).slice();o<r.length;o++){var l=r[o];try{l.apply(this,t)}catch(e){this.emit("error",e)}}return!0}if("error"===e)throw 0<t.length?t[0]:Error("Unhandled error.");return!1},Ce.prototype.eventNames=function(){return Array.from(this.events.keys())},Ce.prototype.getMaxListeners=function(){return this.maxListeners||Ce.defaultMaxListeners},Ce.prototype.listenerCount=function(e){return this.events.has(e)?this.events.get(e).length:0},Ce.prototype._listeners=function(e,t,i){if(!e.events.has(t))return[];var o=e.events.get(t);return i?this.unwrapListeners(o):o.slice(0)},Ce.prototype.unwrapListeners=function(e){for(var t=new Array(e.length),i=0;i<e.length;i++)t[i]=e[i].listener||e[i];return t},Ce.prototype.listeners=function(e){return this._listeners(this,e,!0)},Ce.prototype.rawListeners=function(e){return this._listeners(this,e,!1)},Ce.prototype.off=function(e,t){return this.removeListener(e,t)},Ce.prototype.on=function(e,t){return this.addListener(e,t)},Ce.prototype.once=function(e,t){var i=this.onceWrap(e,t);return this.on(e,i),this},Ce.prototype.onceWrap=function(e,t){function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.context.removeListener(this.eventName,this.rawListener),this.listener.apply(this.context,e)}var o={eventName:e,listener:t,rawListener:i,context:this},r=i.bind(o);return(o.rawListener=r).listener=t,r},Ce.prototype.prependListener=function(e,t){return this._addListener(e,t,!0)},Ce.prototype.prependOnceListener=function(e,t){var i=this.onceWrap(e,t);return this.prependListener(e,i),this},Ce.prototype.removeAllListeners=function(e){var t=this;if(void 0===this.events)return this;if(this.events.has(e)){var i=this.events.get(e).slice();this.events.delete(e);for(var o=0,r=i;o<r.length;o++){var l=r[o];this.emit("removeListener",e,l)}}else this.eventNames().map(function(e){t.removeAllListeners(e)});return this},Ce.prototype.removeListener=function(e,t){var i;return!this.events.has(e)||-1!==(i=this.events.get(e)).indexOf(t)&&(i.splice(i.indexOf(t),1),this.emit("removeListener",e,t),0===i.length&&this.events.delete(e)),this},Ce.prototype.setMaxListeners=function(e){return this.maxListeners=e,this},Ce.defaultMaxListeners=50,Ce);function Ce(){this.events=new Map}var Le=(Se.maploaded="maploaded",Se.zoomchanged="zoomchanged",Se.extentchanged="extentchanged",Se.centerchanged="centerchanged",Se.blur="blur",Se.click="click",Se.doubleclick="doubleclick",Se.drag="drag",Se.focus="focus",Se.hold="hold",Se.keydown="key-down",Se.keyup="key-up",Se.mousewheel="mouse-wheel",Se.pointerdown="pointer-down",Se.pointerenter="pointer-enter",Se.pointerleave="pointer-leave",Se.pointermove="pointer-move",Se.pointerup="pointer-up",Se.resize="pointer-up",Se.popupvisible="popup-visible",Se);function Se(){}var _e,Me,Ae=(_e=function(e,t){return(_e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}_e(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ee=function(e,a,n,s){return new(n=n||Promise)(function(i,t){function o(e){try{l(s.next(e))}catch(e){t(e)}}function r(e){try{l(s.throw(e))}catch(e){t(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(o,r)}l((s=s.apply(e,a||[])).next())})},Re=function(i,o){var r,l,a,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,l&&(a=2&t[0]?l.return:t[0]?l.throw||((a=l.return)&&a.call(l),0):l.next)&&!(a=a.call(l,t[1])).done)return a;switch(l=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,l=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){n=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){n.label=t[1];break}if(6===t[0]&&n.label<a[1]){n.label=a[1],a=t;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(t);break}a[2]&&n.ops.pop(),n.trys.pop();continue}t=o.call(i,n)}catch(e){t=[6,e],l=0}finally{r=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},Oe=(Ae(Pe,Me=ke),Pe.prototype.setlayerRenderer=function(e,t){var i=this.view.map.findLayerById(e);i&&(i.renderer=t)},Pe.prototype.addLayer=function(e){!function(h,d,y){be(this,void 0,void 0,function(){return me(this,function(e){return fe(["esri/layers/TileLayer","esri/layers/SceneLayer","esri/layers/FeatureLayer","esri/layers/MapImageLayer","esri/layers/SHCTiledMapServiceLayer","esri/layers/GraphicsLayer","esri/geometry/Extent","esri/geometry/SpatialReference"]).then(function(e){var t=e[0],i=e[1],o=(e[2],e[3]),r=e[4],l=e[5],a=e[6],n=e[7];switch(h.layerType){case"TileLayer":d.map.add(new t({url:h.layerUrl,id:h.layerLayerId,visible:void 0===h.layerVisible||h.layerVisible,opacity:void 0!==h.layerOpacity?h.layerOpacity:1,title:h.layerTitle}));break;case"FeatureLayer":var s=new i({url:h.layerUrl,id:h.layerLayerId,visible:void 0===h.layerVisible||h.layerVisible,opacity:void 0!==h.layerOpacity?h.layerOpacity:1,title:h.layerTitle,popupEnabled:void 0===h.layerPopupEnabled||h.layerPopupEnabled});h.layerPopupTemplate&&(s.popupTemplate=h.layerPopupTemplate),h.layerRenderer&&(s.renderer=h.layerRenderer),h.layerMaxScale&&(s.maxScale=h.layerMaxScale),h.layerMinScale&&(s.minScale=h.layerMinScale),h.layerLabelingInfo&&(s.labelingInfo=h.layerLabelingInfo),h.layerLabelsVisible&&(s.labelsVisible=h.layerLabelsVisible),d.map.add(s);break;case"SceneLayer":var c=new i({url:h.layerUrl,id:h.layerLayerId,visible:void 0===h.layerVisible||h.layerVisible,opacity:void 0!==h.layerOpacity?h.layerOpacity:1,title:h.layerTitle,popupEnabled:void 0===h.layerPopupEnabled||h.layerPopupEnabled});h.layerPopupTemplate&&(c.popupTemplate=h.layerPopupTemplate),h.layerRenderer&&(c.renderer=h.layerRenderer),h.layerMaxScale&&(c.maxScale=h.layerMaxScale),h.layerMinScale&&(c.minScale=h.layerMinScale),d.map.add(c);break;case"MapImageLayer":var p=new o({url:h.layerUrl,id:h.layerLayerId,visible:void 0===h.layerVisible||h.layerVisible,opacity:void 0!==h.layerOpacity?h.layerOpacity:1,title:h.layerTitle});h.layerMaxScale&&(p.maxScale=h.layerMaxScale),h.layerMinScale&&(p.minScale=h.layerMinScale),h.layerSublayers&&(p.sublayers=h.layerSublayers),d.map.add(p);break;case"SHCTiledMapServiceLayer":var u=new a({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:n.WebMercator});!0===h.isToken?d.map.add(new r({url:h.layerUrl,token:y,fullExtent:u,title:h.layerTitle,opacity:void 0!==h.layerOpacity?h.layerOpacity:1,id:h.layerLayerId,visible:void 0===h.layerVisible||h.layerVisible})):d.map.add(new r({url:h.layerUrl,fullExtent:u,opacity:void 0!==h.layerOpacity?h.layerOpacity:1,title:h.layerTitle,id:h.layerLayerId,visible:void 0===h.layerVisible||h.layerVisible}));break;case"GraphicsLayer":d.map.add(new l({id:h.layerLayerId,visible:void 0===h.layerVisible||h.layerVisible,opacity:void 0!==h.layerOpacity?h.layerOpacity:1,title:h.layerTitle}))}}).catch(function(e){console.error(e)}),[2]})})}(e,this.view,this.maptoken)},Pe.prototype.getZoom=function(){if(this.view)return this.view.zoom},Pe.prototype.setZoom=function(e){this.view&&(this.view.zoom=e)},Pe.prototype.panTo=function(i){var o=this;null!==this.view&&fe(["esri/geometry/Point"]).then(function(e){var t=new e[0]({x:i[0],y:i[1],z:void 0!==i[2]?i[2]:0,spatialReference:o.view.spatialReference});o.view.center=t}).catch(function(e){console.error(e)})},Pe.prototype.panBy=function(e,t){var i,o;this.view&&(i=this.view.center,o=this.view.toScreen(i),this.view.center=this.view.toMap({x:o.x+e,y:o.y+t}))},Pe.prototype.getBounds=function(){if(this.view){var e={};return e.southwest=[this.view.extent.xmin.toFixed(6),this.view.extent.ymin.toFixed(6)],"3D"===this.viewMode&&void 0!==this.view.extent.zmin&&e.southwest.push(this.view.extent.zmin.toFixed(6)),e.northeast=[this.view.extent.xmax.toFixed(6),this.view.extent.ymax.toFixed(6)],"3D"===this.viewMode&&void 0!==this.view.extent.zmax&&e.northeast.push(this.view.extent.zmax.toFixed(6)),e}},Pe.prototype.setBounds=function(o){var r=this;this.view&&fe(["esri/geometry/Extent","esri/geometry/SpatialReference"]).then(function(e){var t=e[0],i=(e[1],new t({xmin:o.xmin,ymin:o.ymin,xmax:o.xmax,zmax:o.ymax,spatialReference:r.view.spatialReference}));"3D"===r.viewMode&&void 0!==o.zmin&&void 0!==o.zmax&&(i.zmin=o.zmin,i.zmax=o.zmax),r.view.extent=i}).catch(function(e){console.error(e)})},Pe.prototype.setCenter=function(r,l,a){return Ee(this,void 0,void 0,function(){var t,i,o;return Re(this,function(e){switch(e.label){case 0:return this.view?[4,fe(["esri/geometry/Point","esri/geometry/SpatialReference"])]:[3,2];case 1:t=e.sent(),i=t[0],t[1],o=null,o="2D"===this.viewMode?new i({x:r,y:l,spatialReference:this.view.spatialReference}):new i({x:r,y:l,z:void 0!==a?a:0,spatialReference:this.view.spatialReference}),this.view.center=o,e.label=2;case 2:return[2]}})})},Pe.prototype.setZoomAndCenter=function(r,l){return Ee(this,void 0,void 0,function(){var t,i,o;return Re(this,function(e){switch(e.label){case 0:return this.view?[4,fe(["esri/geometry/Point","esri/geometry/SpatialReference"])]:[3,2];case 1:t=e.sent(),i=t[0],t[1],o=null,"2D"===this.viewMode?(this.view.zoom=r,o=new i({x:l[0],y:l[1],spatialReference:this.view.spatialReference}),this.view.center=o):(o=new i({x:l[0],y:l[1],z:void 0!==l[2]?l[2]:0,spatialReference:this.view.spatialReference}),this.view.goTo({center:o,zoom:r,tilt:this.view.camera.tilt,heading:this.view.camera.heading})),e.label=2;case 2:return[2]}})})},Pe.prototype.getCenter=function(){if(this.view){var e=[];return e.push(this.view.center.x.toFixed(6)),e.push(this.view.center.y.toFixed(6)),"3D"===this.viewMode&&e.push(this.view.center.z.toFixed(6)),e}},Pe.prototype.getScale=function(){if(this.view)return this.view.scale},Pe.prototype.setRotation=function(e){this.view&&("2D"===this.viewMode?this.view.rotation=e:this.view.goTo({center:this.view.center,zoom:this.view.zoom,tilt:this.view.camera.tilt,heading:e}))},Pe.prototype.setPitch=function(e){this.view&&"3D"===this.viewMode&&this.view.goTo({center:this.view.center,zoom:this.view.zoom,tilt:e,heading:this.view.camera.heading})},Pe.prototype.getPitch=function(){if(this.view&&"3D"===this.viewMode)return this.view.camera.tilt},Pe.prototype.zoomIn=function(){this.view&&("3D"===this.viewMode?this.view.zoom+1>=this.zooms[0]&&this.view.zoom+1<=this.zooms[1]&&this.view.goTo({center:this.view.center,zoom:this.view.zoom+1,tilt:this.view.camera.tilt,heading:this.view.camera.heading}):this.view.goTo({center:this.view.center,zoom:this.view.zoom+1}))},Pe.prototype.zoomOut=function(){this.view&&("3D"===this.viewMode?this.view.zoom-1>=this.zooms[0]&&this.view.zoom-1<=this.zooms[1]&&this.view.goTo({center:this.view.center,zoom:this.view.zoom-1,tilt:this.view.camera.tilt,heading:this.view.camera.heading}):this.view.goTo({center:this.view.center,zoom:this.view.zoom-1}))},Pe.prototype.setMapStyle=function(e){var i=this;if(this.view){switch(e){case"smap://styles/light":this.view.map.basemap.id="basemap_zw";break;case"smap://styles/dark":this.view.map.basemap.id="basemap_as";break;case"smap://styles/image":this.view.map.basemap.id="basemap_air";break;default:return}if(this.view.map.basemap.baseLayers.items.forEach(function(e){e.id===i.view.map.basemap.id?e.visible=!0:e.visible=!1}),"2D"===this.viewMode)return;["model_white_zw","model_air_real","model_white_as"].forEach(function(e){var t=i.view.map.findLayerById(e);!1===i.showBuildingBlock?t.visible=!1:t&&("basemap_zw"===i.view.map.basemap.id?t.visible="model_white_zw"===e:"basemap_as"===i.view.map.basemap.id?t.visible="model_white_as"===e:"basemap_air"===i.view.map.basemap.id&&(t.visible="model_air_real"===e))})}},Pe.prototype.getMapStyle=function(){if(this.view)switch(this.view.map.basemap.id){case"basemap_zw":return"smap://styles/light";case"basemap_as":return"smap://styles/dark";case"basemap_air":return"smap://styles/image"}},Pe.prototype.showBuilding=function(e){var i=this;null!==this.view&&"2D"!==this.viewMode&&(this.showBuildingBlock=!!e,["model_white_zw","model_air_real","model_white_as"].forEach(function(e){var t=i.view.map.findLayerById(e);!1===i.showBuildingBlock?t.visible=!1:t&&("basemap_zw"===i.view.map.basemap.id?t.visible="model_white_zw"===e:"basemap_as"===i.view.map.basemap.id?t.visible="model_white_as"===e:"basemap_air"===i.view.map.basemap.id&&(t.visible="model_air_real"===e))}))},Pe.prototype.addControl=function(l){var a=this;if("toc"===l.controlName.toLowerCase())fe(["esri/widgets/LayerList","esri/widgets/Expand"]).then(function(e){var t,i=e[0],o=e[1],r=new i({container:document.createElement("div"),id:"maplayerlist",view:a.view});l.collapse?(t=new o({id:"layerlistonly",view:a.view,content:r.domNode,expandIconClass:"esri-icon-layers",expandTooltip:"专题图层框",group:"top-left"}),a.mapControl.push([l.controlName,t]),l.visible&&a.view.ui.add(t,l.position)):(a.mapControl.push([l.controlName,r]),a.view.ui.add(r,l.position))}).catch(function(e){console.error(e)});else if("zoom"===l.controlName.toLowerCase())fe(["esri/widgets/Zoom"]).then(function(e){var t=new e[0]({view:a.view});a.mapControl.push([l.controlName,t]),l.visible&&a.view.ui.add(t,l.position)}).catch(function(e){console.error(e)});else if("compass"===l.controlName.toLowerCase())fe(["esri/widgets/Compass"]).then(function(e){var t=new e[0]({view:a.view});a.mapControl.push([l.controlName,t]),l.visible&&a.view.ui.add(t,l.position)}).catch(function(e){console.error(e)});else if("home"===l.controlName.toLowerCase())fe(["esri/widgets/Home"]).then(function(e){var t=new e[0]({view:a.view});a.mapControl.push([l.controlName,t]),l.visible&&a.view.ui.add(t,l.position)}).catch(function(e){console.error(e)});else if("fullscreen"===l.controlName.toLowerCase())fe(["esri/widgets/Fullscreen"]).then(function(e){var t=new e[0]({view:a.view});a.mapControl.push([l.controlName,t]),l.visible&&a.view.ui.add(t,l.position)}).catch(function(e){console.error(e)});else if("undergroundswitch"===l.controlName.toLowerCase()){if("2D"===this.viewMode)return;fe(["esri/widgets/AboveBelowModeSwitch"]).then(function(e){var t=new e[0]({view:a.view});a.mapControl.push([l.controlName,t]),l.visible&&a.view.ui.add(t,l.position)}).catch(function(e){console.error(e)})}else if("measurearea"===l.controlName.toLowerCase())"2D"===this.viewMode?fe(["esri/widgets/AreaMeasureMentButton2D"]).then(function(e){var t=new e[0]({view:a.view});a.mapControl.push([l.controlName,t]),l.visible&&a.view.ui.add(t,l.position)}).catch(function(e){console.error(e)}):fe(["esri/widgets/AreaMeasureMentButton3D"]).then(function(e){var t=new e[0]({view:a.view});a.mapControl.push([l.controlName,t]),l.visible&&a.view.ui.add(t,l.position)}).catch(function(e){console.error(e)});else if("measureline"===l.controlName.toLowerCase())"2D"===this.viewMode?fe(["esri/widgets/DistanceMeasureMentButton2D"]).then(function(e){var t=new e[0]({view:a.view});a.mapControl.push([l.controlName,t]),l.visible&&a.view.ui.add(t,l.position)}).catch(function(e){console.error(e)}):fe(["esri/widgets/DistanceMeasureMentButton3D"]).then(function(e){var t=new e[0]({view:a.view});a.mapControl.push([l.controlName,t]),l.visible&&a.view.ui.add(t,l.position)}).catch(function(e){console.error(e)});else if("basemaptoggle"===l.controlName.toLowerCase())"2D"===this.viewMode?fe(["esri/widgets/BaseMapSwitchButton2D"]).then(function(e){var t=new e[0]({view:a.view});a.mapControl.push([l.controlName,t]),l.visible&&a.view.ui.add(t,l.position)}).catch(function(e){console.error(e)}):fe(["esri/widgets/BaseMapSwitchButton3D"]).then(function(e){var t=new e[0]({view:a.view,showBuildingBlock:a.showBuildingBlock});a.mapControl.push([l.controlName,t]),l.visible&&a.view.ui.add(t,l.position)}).catch(function(e){console.error(e)});else if("basemapgallery"===l.controlName.toLowerCase())fe(["esri/widgets/BMapGallery_Control"]).then(function(e){var t=new e[0]({view:a.view,showBuildingBlock:a.showBuildingBlock});a.mapControl.push([l.controlName,t]),l.visible&&a.view.ui.add(t,l.position)}).catch(function(e){console.error(e)});else if("basemapgalleryexpand"===l.controlName.toLowerCase())fe(["esri/widgets/BMapGallery_Expand"]).then(function(e){var t=new e[0]({view:a.view,showBuildingBlock:a.showBuildingBlock});a.mapControl.push([l.controlName,t]),l.visible&&a.view.ui.add(t,l.position)}).catch(function(e){console.error(e)});else if("bimfilter"===l.controlName.toLowerCase()){if("2D"===this.viewMode)return;fe(["esri/widgets/BuildingSencelayerFilter"]).then(function(e){var t=new e[0]({view:a.view,layerid:l.layerid});a.mapControl.push([l.controlName,t]),l.visible&&a.view.ui.add(t,l.position)}).catch(function(e){console.error(e)})}},Pe.prototype.removeControl=function(o){var r=this;this.mapControl.forEach(function(e,t,i){e[0]===o.controlName&&(r.view.ui.remove(e[1]),r.mapControl.slice(t,1))})},Pe.prototype.enableThroughGround=function(e){null!==this.view&&"2D"!==this.viewMode&&(e?(this.view.map.ground.surfaceColor="#fff",this.view.map.ground.opacity=0,this.view.map.ground.navigationConstraint={type:"none"}):(this.view.map.ground.surfaceColor=null,this.view.map.ground.opacity=1,this.view.map.ground.navigationConstraint={type:"stay-above"}))},Pe.prototype.setExtentConstrain=function(a,n){var s=this;fe(["esri/geometry/Extent","esri/geometry/geometryEngine","esri/core/watchUtils"]).then(function(e){var t=e[0],i=e[1],o=e[2],r=new t({xmin:a[0],ymin:a[1],xmax:n[0],ymax:n[1],spatialReference:s.view.spatialReference});s.view.extent=r;var l=o.whenTrue(s.view,"stationary",function(){i.contains(r,s.view.extent)||(s.view.extent=r)});s.watchHandles.push(["extentcontrain",l])})},Pe.prototype.removeExtentConstrain=function(){this.watchHandles.filter(function(e){return"extentcontrain"===e[0]}).forEach(function(e){e[1].remove()}),this.watchHandles=this.watchHandles.filter(function(e){return"extentcontrain"!==e[0]})},Pe.prototype.add=function(w){var g=this;fe(["esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){var t,i,o,r,l,a,n,s,c,p,u,h,d,y,f=e[0],b=e[1],m=(e[2],e[3]),v=e[4];w instanceof Array?w.forEach(function(e){var t,i,o,r,l,a,n,s,c,p,u,h,d,y;"marker"===e.overlaytype.toLowerCase()?(t=void 0,t="2D"===g.viewMode?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]},(i=e.attributes).uuid=e.uuid,o=new f({geometry:new b({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:g.view.spatialReference}),symbol:t,attributes:i}),g.mapoverlayers.push(["smap-default",e.uuid,o]),g.view.graphics.add(o),e.label.visible&&(y=new f({geometry:new b({x:"3D"===g.viewMode?e.position[0]+e.label.xoffset:e.position[0],y:"3D"===g.viewMode?e.position[1]+e.label.yoffset:e.position[1],z:"3D"===g.viewMode?e.position[2]+e.label.zoffset:e.position[2],spatialReference:g.view.spatialReference}),symbol:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},attributes:i}),g.view.graphics.add(y),g.mapoverlayers.push(["smap-default",e.uuid,y]))):"polyline"===e.overlaytype.toLowerCase()?(r={type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin},l=[],e.path.forEach(function(e){l.push([e.X,e.Y,e.Z])}),a=new m({hasZ:!1,hasM:!1,paths:l,spatialReference:g.view.spatialReference}),(n=e.attributes).uuid=e.uuid,s=new f({geometry:a,symbol:r,attributes:n}),g.mapoverlayers.push(["smap-default",e.uuid,s]),g.view.graphics.add(s),e.label.visible&&(y=new f({geometry:s.geometry.extent.center,symbol:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},attributes:n}),g.view.graphics.add(y),g.mapoverlayers.push(["smap-default",e.uuid,y]))):"polygon"===e.overlaytype.toLowerCase()&&(c=void 0,c="simple"===e.symboltype?{type:"simple-fill",color:e.fillColor,style:e.style,outline:{color:e.strokeColor,width:e.strokeWeight,style:e.strokestyle}}:{type:"picture-fill",url:e.url,width:e.picwidth,height:e.picheight,outline:{style:e.strokestyle,color:e.strokeColor,width:e.strokeWeight}},p=[],e.paths.forEach(function(e){p.push([e.X,e.Y,e.Z])}),u=new v({hasZ:!0,hasM:!0,rings:p,spatialReference:g.view.spatialReference}),(h=e.attributes).uuid=e.uuid,d=new f({geometry:u,symbol:c,attributes:h}),g.mapoverlayers.push(["smap-default",e.uuid,d]),g.view.graphics.add(d),e.label.visible&&(y=new f({geometry:d.geometry.extent.center,symbol:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},attributes:h}),g.view.graphics.add(y),g.mapoverlayers.push(["smap-default",e.uuid,y])))}):"group"===w.type?w.overlayers.forEach(function(e){var t,i,o,r,l,a,n,s,c,p,u,h,d,y;"marker"===e.overlaytype.toLowerCase()?(t=void 0,t="2D"===g.viewMode?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]},(i=e.attributes).uuid=e.uuid,o=new f({geometry:new b({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:g.view.spatialReference}),symbol:t,attributes:i}),g.mapoverlayers.push([w.uuid,e.uuid,o]),g.view.graphics.add(o),e.label.visible&&(y=new f({geometry:new b({x:"3D"===g.viewMode?e.position[0]+e.label.xoffset:e.position[0],y:"3D"===g.viewMode?e.position[1]+e.label.yoffset:e.position[1],z:"3D"===g.viewMode?e.position[2]+e.label.zoffset:e.position[2],spatialReference:g.view.spatialReference}),symbol:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},attributes:i}),g.view.graphics.add(y),g.mapoverlayers.push([w.uuid,e.uuid,y]))):"polyline"===e.overlaytype.toLowerCase()?(r={type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin},l=[],e.path.forEach(function(e){l.push([e.X,e.Y,e.Z])}),a=new m({hasZ:!1,hasM:!1,paths:l,spatialReference:g.view.spatialReference}),(n=e.attributes).uuid=e.uuid,s=new f({geometry:a,symbol:r,attributes:n}),g.mapoverlayers.push([w.uuid,e.uuid,s]),g.view.graphics.add(s),e.label.visible&&(y=new f({geometry:s.geometry.extent.center,symbol:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},attributes:n}),g.view.graphics.add(y),g.mapoverlayers.push([w.uuid,e.uuid,y]))):"polygon"===e.overlaytype.toLowerCase()&&(c=void 0,c="simple"===e.symboltype?{type:"simple-fill",color:e.fillColor,style:e.style,outline:{color:e.strokeColor,width:e.strokeWeight,style:e.strokestyle}}:{type:"picture-fill",url:e.url,width:e.picwidth,height:e.picheight,outline:{style:e.strokestyle,color:e.strokeColor,width:e.strokeWeight}},p=[],e.paths.forEach(function(e){p.push([e.X,e.Y,e.Z])}),(u=e.attributes).uuid=e.uuid,h=new v({hasZ:!0,hasM:!0,rings:p,spatialReference:g.view.spatialReference}),d=new f({geometry:h,symbol:c,attributes:u}),g.mapoverlayers.push([w.uuid,e.uuid,d]),g.view.graphics.add(d),e.label.visible&&(y=new f({geometry:d.geometry.extent.center,symbol:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},attributes:u}),g.view.graphics.add(y),g.mapoverlayers.push([w.uuid,e.uuid,y])))}):"element"===w.type&&("marker"===w.overlaytype.toLowerCase()?(t=void 0,t="2D"===g.viewMode?{type:"picture-marker",url:w.icon.image,width:w.icon.size.width,height:w.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:w.icon.size.width,resource:{href:w.icon.image}}]},(i=w.attributes).uuid=w.uuid,o=new f({geometry:new b({x:w.position[0],y:w.position[1],z:void 0===w.position[2]?0:w.position[2],spatialReference:g.view.spatialReference}),symbol:t,attributes:i}),g.mapoverlayers.push(["smap-default",w.uuid,o]),g.view.graphics.add(o),w.label.visible&&(y=new f({geometry:new b({x:"3D"===g.viewMode?w.position[0]+w.label.xoffset:w.position[0],y:"3D"===g.viewMode?w.position[1]+w.label.yoffset:w.position[1],z:"3D"===g.viewMode?w.position[2]+w.label.zoffset:w.position[2],spatialReference:g.view.spatialReference}),symbol:{type:w.label.type,text:w.label.text,color:w.label.color,angle:w.label.angle,backgroundColor:w.label.backgroundColor,borderLineColor:w.label.borderLineColor,borderLineSize:w.label.borderLineSize,kerning:w.label.kerning,lineHeight:w.label.lineHeight,lineWidth:w.label.lineWidth,rotated:w.label.rotated,haloColor:w.label.haloColor,haloSize:w.label.haloSize,xoffset:w.label.xoffset,yoffset:w.label.yoffset,verticalAlignment:w.label.verticalAlignment,horizontalAlignment:w.label.horizontalAlignment,font:{size:w.label.size,family:"Josefin Slab",weight:w.label.weight}},attributes:i}),g.view.graphics.add(y),g.mapoverlayers.push(["smap-default",w.uuid,y]))):"polyline"===w.overlaytype.toLowerCase()?(r={type:"simple-line",color:w.strokeColor,style:w.style,width:w.width,cap:w.cap,join:w.lineJoin},l=[],w.path.forEach(function(e){l.push([e.X,e.Y,e.Z])}),a=new m({hasZ:!1,hasM:!1,paths:l,spatialReference:g.view.spatialReference}),(n=w.attributes).uuid=w.uuid,s=new f({geometry:a,symbol:r,attributes:n}),g.mapoverlayers.push(["smap-default",w.uuid,s]),g.view.graphics.add(s),w.label.visible&&(y=new f({geometry:s.geometry.extent.center,symbol:{type:w.label.type,text:w.label.text,color:w.label.color,angle:w.label.angle,backgroundColor:w.label.backgroundColor,borderLineColor:w.label.borderLineColor,borderLineSize:w.label.borderLineSize,kerning:w.label.kerning,lineHeight:w.label.lineHeight,lineWidth:w.label.lineWidth,rotated:w.label.rotated,haloColor:w.label.haloColor,haloSize:w.label.haloSize,xoffset:w.label.xoffset,yoffset:w.label.yoffset,verticalAlignment:w.label.verticalAlignment,horizontalAlignment:w.label.horizontalAlignment,font:{size:w.label.size,family:"Josefin Slab",weight:w.label.weight}},attributes:n}),g.view.graphics.add(y),g.mapoverlayers.push(["smap-default",w.uuid,y]))):"polygon"===w.overlaytype.toLowerCase()&&(c=void 0,c="simple"===w.symboltype?{type:"simple-fill",color:w.fillColor,style:w.style,outline:{color:w.strokeColor,width:w.strokeWeight,style:w.strokestyle}}:{type:"picture-fill",url:w.url,width:w.picwidth,height:w.picheight,outline:{style:w.strokestyle,color:w.strokeColor,width:w.strokeWeight}},p=[],w.paths.forEach(function(e){p.push([e.X,e.Y,e.Z])}),(u=w.attributes).uuid=w.uuid,h=new v({hasZ:!0,hasM:!0,rings:p,spatialReference:g.view.spatialReference}),d=new f({geometry:h,symbol:c,attributes:u}),g.mapoverlayers.push(["smap-default",w.uuid,d]),g.view.graphics.add(d),w.label.visible&&(y=new f({geometry:d.geometry.extent.center,symbol:{type:w.label.type,text:w.label.text,color:w.label.color,angle:w.label.angle,backgroundColor:w.label.backgroundColor,borderLineColor:w.label.borderLineColor,borderLineSize:w.label.borderLineSize,kerning:w.label.kerning,lineHeight:w.label.lineHeight,lineWidth:w.label.lineWidth,rotated:w.label.rotated,haloColor:w.label.haloColor,haloSize:w.label.haloSize,xoffset:w.label.xoffset,yoffset:w.label.yoffset,verticalAlignment:w.label.verticalAlignment,horizontalAlignment:w.label.horizontalAlignment,font:{size:w.label.size,family:"Josefin Slab",weight:w.label.weight}},attributes:u}),g.view.graphics.add(y),g.mapoverlayers.push(["smap-default",w.uuid,y]))))}).catch(function(e){console.error(e)})},Pe.prototype.remove=function(t){var i=this;t instanceof Array?t.forEach(function(t){i.mapoverlayers.filter(function(e){return e[1]===t.uuid}).forEach(function(e){i.view.graphics.remove(e[2])}),i.mapoverlayers=i.mapoverlayers.filter(function(e){return e[1]!==t.uuid})}):"group"===t.type?(this.mapoverlayers.filter(function(e){return e[0]===t.uuid}).forEach(function(e){i.view.graphics.remove(e[2])}),this.mapoverlayers=this.mapoverlayers.filter(function(e){return e[0]!==t.uuid})):"element"===t.type&&(this.mapoverlayers.filter(function(e){return e[1]===t.uuid}).forEach(function(e){i.view.graphics.remove(e[2])}),this.mapoverlayers=this.mapoverlayers.filter(function(e){return e[1]!==t.uuid}))},Pe.prototype.update=function(w){var g=this;fe(["esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){var t,i,o,r,l,a,n,s,c,p,u,h,d,y,f=e[0],b=e[1],m=(e[2],e[3]),v=e[4];w instanceof Array?w.forEach(function(t){var e,i,o,r,l,a,n,s,c,p,u,h,d,y;g.mapoverlayers.filter(function(e){return e[1]===t.uuid}).forEach(function(e){g.view.graphics.remove(e[2])}),g.mapoverlayers=g.mapoverlayers.filter(function(e){return e[1]!==t.uuid}),"marker"===t.overlaytype.toLowerCase()?(e=void 0,e="2D"===g.viewMode?{type:"picture-marker",url:t.icon.image,width:t.icon.size.width,height:t.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:t.icon.size.width,resource:{href:t.icon.image}}]},(i=t.attributes).uuid=t.uuid,o=new f({geometry:new b({x:t.position[0],y:t.position[1],z:void 0===t.position[2]?0:t.position[2],spatialReference:g.view.spatialReference}),symbol:e,attributes:i}),g.mapoverlayers.push(["smap-default",t.uuid,o]),g.view.graphics.add(o),t.label.visible&&(y=new f({geometry:new b({x:"3D"===g.viewMode?t.position[0]+t.label.xoffset:t.position[0],y:"3D"===g.viewMode?t.position[1]+t.label.yoffset:t.position[1],z:"3D"===g.viewMode?t.position[2]+t.label.zoffset:t.position[2],spatialReference:g.view.spatialReference}),symbol:{type:t.label.type,text:t.label.text,color:t.label.color,angle:t.label.angle,backgroundColor:t.label.backgroundColor,borderLineColor:t.label.borderLineColor,borderLineSize:t.label.borderLineSize,kerning:t.label.kerning,lineHeight:t.label.lineHeight,lineWidth:t.label.lineWidth,rotated:t.label.rotated,haloColor:t.label.haloColor,haloSize:t.label.haloSize,xoffset:t.label.xoffset,yoffset:t.label.yoffset,verticalAlignment:t.label.verticalAlignment,horizontalAlignment:t.label.horizontalAlignment,font:{size:t.label.size,family:"Josefin Slab",weight:t.label.weight}},attributes:i}),g.view.graphics.add(y),g.mapoverlayers.push(["smap-default",t.uuid,y]))):"polyline"===t.overlaytype.toLowerCase()?(r={type:"simple-line",color:t.strokeColor,style:t.style,width:t.width,cap:t.cap,join:t.lineJoin},l=[],t.path.forEach(function(e){l.push([e.X,e.Y,e.Z])}),a=new m({hasZ:!1,hasM:!1,paths:l,spatialReference:g.view.spatialReference}),(n=t.attributes).uuid=t.uuid,s=new f({geometry:a,symbol:r,attributes:n}),g.mapoverlayers.push(["smap-default",t.uuid,s]),g.view.graphics.add(s),t.label.visible&&(y=new f({geometry:s.geometry.extent.center,symbol:{type:t.label.type,text:t.label.text,color:t.label.color,angle:t.label.angle,backgroundColor:t.label.backgroundColor,borderLineColor:t.label.borderLineColor,borderLineSize:t.label.borderLineSize,kerning:t.label.kerning,lineHeight:t.label.lineHeight,lineWidth:t.label.lineWidth,rotated:t.label.rotated,haloColor:t.label.haloColor,haloSize:t.label.haloSize,xoffset:t.label.xoffset,yoffset:t.label.yoffset,verticalAlignment:t.label.verticalAlignment,horizontalAlignment:t.label.horizontalAlignment,font:{size:t.label.size,family:"Josefin Slab",weight:t.label.weight}},attributes:n}),g.view.graphics.add(y),g.mapoverlayers.push(["smap-default",t.uuid,y]))):"polygon"===t.overlaytype.toLowerCase()&&(c=void 0,c="simple"===t.symboltype?{type:"simple-fill",color:t.fillColor,style:t.style,outline:{color:t.strokeColor,width:t.strokeWeight,style:t.strokestyle}}:{type:"picture-fill",url:t.url,width:t.picwidth,height:t.picheight,outline:{style:t.strokestyle,color:t.strokeColor,width:t.strokeWeight}},p=[],t.paths.forEach(function(e){p.push([e.X,e.Y,e.Z])}),u=new v({hasZ:!0,hasM:!0,rings:p,spatialReference:g.view.spatialReference}),(h=t.attributes).uuid=t.uuid,d=new f({geometry:u,symbol:c,attributes:h}),g.mapoverlayers.push(["smap-default",t.uuid,d]),g.view.graphics.add(d),t.label.visible&&(y=new f({geometry:d.geometry.extent.center,symbol:{type:t.label.type,text:t.label.text,color:t.label.color,angle:t.label.angle,backgroundColor:t.label.backgroundColor,borderLineColor:t.label.borderLineColor,borderLineSize:t.label.borderLineSize,kerning:t.label.kerning,lineHeight:t.label.lineHeight,lineWidth:t.label.lineWidth,rotated:t.label.rotated,haloColor:t.label.haloColor,haloSize:t.label.haloSize,xoffset:t.label.xoffset,yoffset:t.label.yoffset,verticalAlignment:t.label.verticalAlignment,horizontalAlignment:t.label.horizontalAlignment,font:{size:t.label.size,family:"Josefin Slab",weight:t.label.weight}},attributes:h}),g.view.graphics.add(y),g.mapoverlayers.push(["smap-default",t.uuid,y])))}):"group"===w.type?(g.mapoverlayers.filter(function(e){return e[0]===w.uuid}).forEach(function(e){g.view.graphics.remove(e[2])}),g.mapoverlayers=g.mapoverlayers.filter(function(e){return e[0]!==w.uuid}),w.overlayers.forEach(function(e){var t,i,o,r,l,a,n,s,c,p,u,h,d,y;"marker"===e.overlaytype.toLowerCase()?(t=void 0,t="2D"===g.viewMode?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]},(i=e.attributes).uuid=e.uuid,o=new f({geometry:new b({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:g.view.spatialReference}),symbol:t,attributes:i}),g.mapoverlayers.push([w.uuid,e.uuid,o]),g.view.graphics.add(o),e.label.visible&&(y=new f({geometry:new b({x:"3D"===g.viewMode?e.position[0]+e.label.xoffset:e.position[0],y:"3D"===g.viewMode?e.position[1]+e.label.yoffset:e.position[1],z:"3D"===g.viewMode?e.position[2]+e.label.zoffset:e.position[2],spatialReference:g.view.spatialReference}),symbol:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},attributes:i}),g.view.graphics.add(y),g.mapoverlayers.push([w.uuid,e.uuid,y]))):"polyline"===e.overlaytype.toLowerCase()?(r={type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin},l=[],e.path.forEach(function(e){l.push([e.X,e.Y,e.Z])}),a=new m({hasZ:!1,hasM:!1,paths:l,spatialReference:g.view.spatialReference}),(n=e.attributes).uuid=e.uuid,s=new f({geometry:a,symbol:r,attributes:n}),g.mapoverlayers.push([w.uuid,e.uuid,s]),g.view.graphics.add(s),e.label.visible&&(y=new f({geometry:s.geometry.extent.center,symbol:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},attributes:n}),g.view.graphics.add(y),g.mapoverlayers.push([w.uuid,e.uuid,y]))):"polygon"===e.overlaytype.toLowerCase()&&(c=void 0,c="simple"===w.symboltype?{type:"simple-fill",color:w.fillColor,style:w.style,outline:{color:w.strokeColor,width:w.strokeWeight,style:w.strokestyle}}:{type:"picture-fill",url:w.url,width:w.picwidth,height:w.picheight,outline:{style:w.strokestyle,color:w.strokeColor,width:w.strokeWeight}},p=[],e.paths.forEach(function(e){p.push([e.X,e.Y,e.Z])}),(u=e.attributes).uuid=e.uuid,h=new v({hasZ:!0,hasM:!0,rings:p,spatialReference:g.view.spatialReference}),d=new f({geometry:h,symbol:c,attributes:u}),g.mapoverlayers.push(["smap-default",w.uuid,d]),g.view.graphics.add(d),w.label.visible&&(y=new f({geometry:d.geometry.extent.center,symbol:{type:w.label.type,text:w.label.text,color:w.label.color,angle:w.label.angle,backgroundColor:w.label.backgroundColor,borderLineColor:w.label.borderLineColor,borderLineSize:w.label.borderLineSize,kerning:w.label.kerning,lineHeight:w.label.lineHeight,lineWidth:w.label.lineWidth,rotated:w.label.rotated,haloColor:w.label.haloColor,haloSize:w.label.haloSize,xoffset:w.label.xoffset,yoffset:w.label.yoffset,verticalAlignment:w.label.verticalAlignment,horizontalAlignment:w.label.horizontalAlignment,font:{size:w.label.size,family:"Josefin Slab",weight:w.label.weight}},attributes:u}),g.view.graphics.add(y),g.mapoverlayers.push(["smap-default",w.uuid,y])))})):"element"===w.type&&(g.mapoverlayers.filter(function(e){return e[1]===w.uuid}).forEach(function(e){g.view.graphics.remove(e[2])}),g.mapoverlayers=g.mapoverlayers.filter(function(e){return e[1]!==w.uuid}),"marker"===w.overlaytype.toLowerCase()?(t=void 0,t="2D"===g.viewMode?{type:"picture-marker",url:w.icon.image,width:w.icon.size.width,height:w.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:w.icon.size.width,resource:{href:w.icon.image}}]},(i=w.attributes).uuid=w.uuid,o=new f({geometry:new b({x:w.position[0],y:w.position[1],z:void 0===w.position[2]?0:w.position[2],spatialReference:g.view.spatialReference}),symbol:t,attributes:i}),g.mapoverlayers.push(["smap-default",w.uuid,o]),g.view.graphics.add(o),w.label.visible&&(y=new f({geometry:new b({x:"3D"===g.viewMode?w.position[0]+w.label.xoffset:w.position[0],y:"3D"===g.viewMode?w.position[1]+w.label.yoffset:w.position[1],z:"3D"===g.viewMode?w.position[2]+w.label.zoffset:w.position[2],spatialReference:g.view.spatialReference}),symbol:{type:w.label.type,text:w.label.text,color:w.label.color,angle:w.label.angle,backgroundColor:w.label.backgroundColor,borderLineColor:w.label.borderLineColor,borderLineSize:w.label.borderLineSize,kerning:w.label.kerning,lineHeight:w.label.lineHeight,lineWidth:w.label.lineWidth,rotated:w.label.rotated,haloColor:w.label.haloColor,haloSize:w.label.haloSize,xoffset:w.label.xoffset,yoffset:w.label.yoffset,verticalAlignment:w.label.verticalAlignment,horizontalAlignment:w.label.horizontalAlignment,font:{size:w.label.size,family:"Josefin Slab",weight:w.label.weight}},attributes:i}),g.view.graphics.add(y),g.mapoverlayers.push(["smap-default",w.uuid,y]))):"polyline"===w.overlaytype.toLowerCase()?(r={type:"simple-line",color:w.strokeColor,style:w.style,width:w.width,cap:w.cap,join:w.lineJoin},l=[],w.path.forEach(function(e){l.push([e.X,e.Y,e.Z])}),a=new m({hasZ:!1,hasM:!1,paths:l,spatialReference:g.view.spatialReference}),(n=w.attributes).uuid=w.uuid,s=new f({geometry:a,symbol:r,attributes:n}),g.mapoverlayers.push(["smap-default",w.uuid,s]),g.view.graphics.add(s),w.label.visible&&(y=new f({geometry:s.geometry.extent.center,symbol:{type:w.label.type,text:w.label.text,color:w.label.color,angle:w.label.angle,backgroundColor:w.label.backgroundColor,borderLineColor:w.label.borderLineColor,borderLineSize:w.label.borderLineSize,kerning:w.label.kerning,lineHeight:w.label.lineHeight,lineWidth:w.label.lineWidth,rotated:w.label.rotated,haloColor:w.label.haloColor,haloSize:w.label.haloSize,xoffset:w.label.xoffset,yoffset:w.label.yoffset,verticalAlignment:w.label.verticalAlignment,horizontalAlignment:w.label.horizontalAlignment,font:{size:w.label.size,family:"Josefin Slab",weight:w.label.weight}},attributes:n}),g.view.graphics.add(y),g.mapoverlayers.push(["smap-default",w.uuid,y]))):"polygon"===w.overlaytype.toLowerCase()&&(c=void 0,c="simple"===w.symboltype?{type:"simple-fill",color:w.fillColor,style:w.style,outline:{color:w.strokeColor,width:w.strokeWeight,style:w.strokestyle}}:{type:"picture-fill",url:w.url,width:w.picwidth,height:w.picheight,outline:{style:w.strokestyle,color:w.strokeColor,width:w.strokeWeight}},p=[],w.paths.forEach(function(e){p.push([e.X,e.Y,e.Z])}),u=new v({hasZ:!0,hasM:!0,rings:p,spatialReference:g.view.spatialReference}),(h=w.attributes).uuid=w.uuid,d=new f({geometry:u,symbol:c,attributes:h}),g.mapoverlayers.push(["smap-default",w.uuid,d]),g.view.graphics.add(d),w.label.visible&&(y=new f({geometry:d.geometry.extent.center,symbol:{type:w.label.type,text:w.label.text,color:w.label.color,angle:w.label.angle,backgroundColor:w.label.backgroundColor,borderLineColor:w.label.borderLineColor,borderLineSize:w.label.borderLineSize,kerning:w.label.kerning,lineHeight:w.label.lineHeight,lineWidth:w.label.lineWidth,rotated:w.label.rotated,haloColor:w.label.haloColor,haloSize:w.label.haloSize,xoffset:w.label.xoffset,yoffset:w.label.yoffset,verticalAlignment:w.label.verticalAlignment,horizontalAlignment:w.label.horizontalAlignment,font:{size:w.label.size,family:"Josefin Slab",weight:w.label.weight}},attributes:h}),g.view.graphics.add(y),g.mapoverlayers.push(["smap-default",w.uuid,y]))))})},Pe.prototype.addfeature=function(f){var b=this;fe(["esri/layers/FeatureLayer","esri/layers/support/LabelClass","esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){var t,i,o,r,l,a,n,s,c,p,u=e[0],h=e[1],d=e[2],y=e[3];e[4],e[5],e[6],f instanceof Array?f.forEach(function(e){var t,i,o,r,l,a,n;"marker"===e.overlaytype.toLowerCase()&&(t=void 0,t="3D"===b.viewMode?{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]}}:{type:"simple",symbol:{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}},i=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}],Object.keys(e.attributes).forEach(function(e){i.push({name:e,alias:e,type:"string"})}),o=new u({id:e.uuid,title:e.uuid,objectIdField:"OBJECTID",geometryType:"point",renderer:t,screenSizePerspectiveEnabled:!0,popupEnabled:!1,popupTemplate:!1,fields:i,source:[],spatialReference:b.view.spatialReference}),(r=e.attributes).uuid=e.uuid,l=new d({geometry:new y({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:b.view.spatialReference}),attributes:r}),o.source.add(l),b.view.map.add(o),b.mapoverlayersflayer.push([e.uuid,e.uuid,l]),e.label.visible&&(a=void 0,a="2D"===b.viewMode?{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:e.label.color},size:e.label.size,halo:{color:e.label.haloColor,size:e.label.haloSize}}]},n=new h({labelExpressionInfo:{expression:"$feature.NAME"},symbol:a,labelPlacement:e.label.placement,minScale:e.label.minScale,maxScale:e.label.maxScale}),o.labelingInfo=[n]))}):"group"===f.type?((t=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}]).push({name:"style",alias:"样式",type:"string"}),f.datafiled.forEach(function(e){t.push(e)}),"marker"===f.overlaytype.toLowerCase()&&(i={type:"unique-value",field:"style",uniqueValueInfos:[]},f.style.forEach(function(e){"3D"===b.viewMode?i.uniqueValueInfos.push({value:e.style,label:e.style,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:e.size.height,resource:{href:e.url}}]}}):i.uniqueValueInfos.push({value:e.style,label:e.style,symbol:{type:"picture-marker",url:e.url,width:e.size.height,height:e.size.height}})}),o=new u({id:f.uuid,title:f.uuid,objectIdField:"OBJECTID",geometryType:"point",renderer:i,screenSizePerspectiveEnabled:"3D"===b.viewMode,popupEnabled:!1,popupTemplate:!1,fields:t,source:[],spatialReference:b.view.spatialReference}),b.view.map.add(o),f.overlayers.forEach(function(e){e.attributes.uuid=e.uuid;var t=new d({geometry:new y({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:b.view.spatialReference}),attributes:e.attributes});o.source.add(t),b.mapoverlayersflayer.push([f.uuid,e.uuid,t])}),100<o.source.items.length&&null!=f.frreduction&&(o.featureReduction={type:f.frreduction.type,clusterRadius:f.frreduction.clusterRadius}),f.label.visible&&(c=void 0,c="2D"===b.viewMode?{type:f.label.type,text:f.label.text,color:f.label.color,angle:f.label.angle,backgroundColor:f.label.backgroundColor,borderLineColor:f.label.borderLineColor,borderLineSize:f.label.borderLineSize,kerning:f.label.kerning,lineHeight:f.label.lineHeight,lineWidth:f.label.lineWidth,rotated:f.label.rotated,haloColor:f.label.haloColor,haloSize:f.label.haloSize,xoffset:f.label.xoffset,yoffset:f.label.yoffset,verticalAlignment:f.label.verticalAlignment,horizontalAlignment:f.label.horizontalAlignment,font:{size:f.label.size,family:"Josefin Slab",weight:f.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:f.label.color},size:f.label.size,halo:{color:f.label.haloColor,size:f.label.haloSize}}]},p=new h({labelExpressionInfo:{expression:"$feature.NAME"},symbol:c,labelPlacement:f.label.placement,minScale:f.label.minScale,maxScale:f.label.maxScale}),o.labelingInfo=[p]))):"element"===f.type&&"marker"===f.overlaytype.toLowerCase()&&(r=void 0,r="3D"===b.viewMode?{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:f.icon.size.width,resource:{href:f.icon.image}}]}}:{type:"simple",symbol:{type:"picture-marker",url:f.icon.image,width:f.icon.size.width,height:f.icon.size.height}},l=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}],Object.keys(f.attributes).forEach(function(e){l.push({name:e,alias:e,type:"string"})}),a=new u({id:f.uuid,title:f.uuid,objectIdField:"OBJECTID",geometryType:"point",renderer:r,screenSizePerspectiveEnabled:!0,popupEnabled:!1,popupTemplate:!1,fields:l,source:[],spatialReference:b.view.spatialReference}),(n=f.attributes).uuid=f.uuid,s=new d({geometry:new y({x:f.position[0],y:f.position[1],z:void 0===f.position[2]?0:f.position[2],spatialReference:b.view.spatialReference}),attributes:n}),a.source.add(s),b.view.map.add(a),b.mapoverlayersflayer.push([f.uuid,f.uuid,s]),f.label.visible&&(c=void 0,c="2D"===b.viewMode?{type:f.label.type,text:f.label.text,color:f.label.color,angle:f.label.angle,backgroundColor:f.label.backgroundColor,borderLineColor:f.label.borderLineColor,borderLineSize:f.label.borderLineSize,kerning:f.label.kerning,lineHeight:f.label.lineHeight,lineWidth:f.label.lineWidth,rotated:f.label.rotated,haloColor:f.label.haloColor,haloSize:f.label.haloSize,xoffset:f.label.xoffset,yoffset:f.label.yoffset,verticalAlignment:f.label.verticalAlignment,horizontalAlignment:f.label.horizontalAlignment,font:{size:f.label.size,family:"Josefin Slab",weight:f.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:f.label.color},size:f.label.size,halo:{color:f.label.haloColor,size:f.label.haloSize}}]},p=new h({labelExpressionInfo:{expression:"$feature.NAME"},symbol:c,labelPlacement:f.label.placement,minScale:f.label.minScale,maxScale:f.label.maxScale}),a.labelingInfo=[p]))})},Pe.prototype.updatefeature=function(l){var s=this;fe(["esri/layers/FeatureLayer","esri/layers/support/LabelClass","esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){e[0];var o,r,a=e[1],n=(e[2],e[3]);e[4],e[5],e[6],l instanceof Array?l.forEach(function(l){"marker"===l.overlaytype.toLowerCase()&&s.mapoverlayersflayer.filter(function(e){return e[1]===l.uuid}).forEach(function(t){var e=[],i=new n({x:l.position[0],y:l.position[1],z:void 0===l.position[2]?0:l.position[2],spatialReference:s.view.spatialReference});t[2].geometry=i,Object.keys(l.attributes).map(function(e){"objectId"!==e&&t[2].setAttribute(e,l.attributes[e])}),e.push(t[2]);var r=s.view.map.findLayerById(t[0]);null!==r&&r.applyEdits({updateFeatures:e}).then(function(e){var t,i,o="3D"===s.viewMode?{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:l.icon.size.width,resource:{href:l.icon.image}}]}}:{type:"simple",symbol:{type:"picture-marker",url:l.icon.image,width:l.icon.size.width,height:l.icon.size.height}};l.label.visible&&(t=void 0,t="2D"===s.viewMode?{type:l.label.type,text:l.label.text,color:l.label.color,angle:l.label.angle,backgroundColor:l.label.backgroundColor,borderLineColor:l.label.borderLineColor,borderLineSize:l.label.borderLineSize,kerning:l.label.kerning,lineHeight:l.label.lineHeight,lineWidth:l.label.lineWidth,rotated:l.label.rotated,haloColor:l.label.haloColor,haloSize:l.label.haloSize,xoffset:l.label.xoffset,yoffset:l.label.yoffset,verticalAlignment:l.label.verticalAlignment,horizontalAlignment:l.label.horizontalAlignment,font:{size:l.label.size,family:"Josefin Slab",weight:l.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:l.label.color},size:l.label.size,halo:{color:l.label.haloColor,size:l.label.haloSize}}]},i=new a({labelExpressionInfo:{expression:"$feature.NAME"},symbol:t,labelPlacement:l.label.placement,minScale:l.label.minScale,maxScale:l.label.maxScale}),r.labelingInfo=[i]),r.renderer=o,r.refresh()})})}):"group"===l.type?(o=[],l.overlayers.forEach(function(t){var e,i=s.mapoverlayersflayer.filter(function(e){return e[1]===t.uuid});1===i.length&&(t.attributes.uuid=t.uuid,e=new n({x:t.position[0],y:t.position[1],z:void 0===t.position[2]?0:t.position[2],spatialReference:s.view.spatialReference}),i[0][2].geometry=e,Object.keys(t.attributes).map(function(e){"objectId"!==e&&i[0][2].setAttribute(e,t.attributes[e])}),o.push(i[0][2]))}),null!==(r=s.view.map.findLayerById(l.uuid))&&r.applyEdits({updateFeatures:o}).then(function(e){var t,i,o={type:"unique-value",field:"style",uniqueValueInfos:[]};l.style.forEach(function(e){"3D"===s.viewMode?o.uniqueValueInfos.push({value:e.style,label:e.style,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:e.size.height,resource:{href:e.url}}]}}):o.uniqueValueInfos.push({value:e.style,label:e.style,symbol:{type:"picture-marker",url:e.url,width:e.size.height,height:e.size.height}})}),r.renderer=o,100<r.source.items.length&&null!=l.frreduction&&(r.featureReduction={type:l.frreduction.type,clusterRadius:l.frreduction.clusterRadius}),l.label.visible&&(t=void 0,t="2D"===s.viewMode?{type:l.label.type,text:l.label.text,color:l.label.color,angle:l.label.angle,backgroundColor:l.label.backgroundColor,borderLineColor:l.label.borderLineColor,borderLineSize:l.label.borderLineSize,kerning:l.label.kerning,lineHeight:l.label.lineHeight,lineWidth:l.label.lineWidth,rotated:l.label.rotated,haloColor:l.label.haloColor,haloSize:l.label.haloSize,xoffset:l.label.xoffset,yoffset:l.label.yoffset,verticalAlignment:l.label.verticalAlignment,horizontalAlignment:l.label.horizontalAlignment,font:{size:l.label.size,family:"Josefin Slab",weight:l.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:l.label.color},size:l.label.size,halo:{color:l.label.haloColor,size:l.label.haloSize}}]},i=new a({labelExpressionInfo:{expression:"$feature.NAME"},symbol:t,labelPlacement:l.label.placement,minScale:l.label.minScale,maxScale:l.label.maxScale}),r.labelingInfo=[i]),r.refresh()})):"element"===l.type&&s.mapoverlayersflayer.filter(function(e){return e[1]===l.uuid}).forEach(function(i){var e=[];l.attributes.uuid=l.uuid;var t=new n({x:l.position[0],y:l.position[1],z:void 0===l.position[2]?0:l.position[2],spatialReference:s.view.spatialReference});i[2].geometry=t,Object.keys(l.attributes).map(function(e){"objectId"!==e&&i[2].setAttribute(e,l.attributes[e])}),e.push(i[2]);var o=s.view.map.findLayerById(i[0]);null!==o&&o.applyEdits({updateFeatures:e}).then(function(e){var t;i[0]===i[1]&&(t="3D"===s.viewMode?{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:l.icon.size.width,resource:{href:l.icon.image}}]}}:{type:"simple",symbol:{type:"picture-marker",url:l.icon.image,width:l.icon.size.width,height:l.icon.size.height}},o.renderer=t,l.label.visible&&("2D"===s.viewMode?(l.label.type,l.label.text,l.label.color,l.label.angle,l.label.backgroundColor,l.label.borderLineColor,l.label.borderLineSize,l.label.kerning,l.label.lineHeight,l.label.lineWidth,l.label.rotated,l.label.haloColor,l.label.haloSize,l.label.xoffset,l.label.yoffset,l.label.verticalAlignment,l.label.horizontalAlignment,l.label.size,l.label.weight):(l.label.color,l.label.size,l.label.haloColor,l.label.haloSize),o.refresh()))})})})},Pe.prototype.removefeature=function(t){var e,i=this;t instanceof Array?t.forEach(function(t){i.mapoverlayersflayer.filter(function(e){return e[1]===t.uuid}).forEach(function(e){var t=i.view.map.findLayerById(e[0]);null!==t&&t.applyEdits({deleteFeatures:[e[2]]}).then(function(e){t.queryFeatures().then(function(e){0===e.features.length&&i.view.map.remove(t)})})}),i.mapoverlayersflayer=i.mapoverlayersflayer.filter(function(e){return e[1]!==t.uuid})}):"group"===t.type?(null!==(e=this.view.map.findLayerById(t.uuid))&&this.view.map.remove(e),this.mapoverlayersflayer=this.mapoverlayersflayer.filter(function(e){return e[0]!==t.uuid})):"element"===t.type&&(this.mapoverlayersflayer.filter(function(e){return e[1]===t.uuid}).forEach(function(e){var t=i.view.map.findLayerById(e[0]);null!==t&&t.applyEdits({deleteFeatures:[e[2]]}).then(function(e){t.queryFeatures().then(function(e){0===e.features.length&&i.view.map.remove(t)})})}),this.mapoverlayersflayer=this.mapoverlayersflayer.filter(function(e){return e[1]!==t.uuid}))},Pe.prototype.clearMap=function(){this.view.graphics.removeAll(),this.mapoverlayers=[]},Pe.prototype.setmaskboundary=function(d){var y=this;fe(["esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Polygon","esri/geometry/geometryEngineAsync","esri/geometry/SpatialReference","esri/Color"]).then(function(e){var c=e[0],t=e[1],i=e[2],p=e[3],u=(e[4],e[5]),o=null;"qx_boundary"===d.boundaryType?o=y.view.map.findLayerById("qx_boundary"):"jd_boundary"===d.boundaryType?o=y.view.map.findLayerById("jd_boundary"):"jwh_boundary"===d.boundaryType&&(o=y.view.map.findLayerById("jwh_boundary"));var h=y.view.map.findLayerById("mask_boundary_graphiclayer");if(null==h&&(h=new t({id:"mask_boundary_graphiclayer",title:"遮罩层",listMode:"hide"}),y.view.map.add(h)),h.removeAll(),d.inputgeometry){if(null===(o=y.view.map.findLayerById("qx_boundary")))return;var r=new i({rings:d.inputgeometry,spatialReference:y.view.spatialReference}),l=o.fullExtent;l.spatialReference=y.view.spatialReference;var s=r;s.spatialReference=y.view.spatialReference,p.buffer(s,d.boundarydistance,"meters").then(function(e){p.difference(l,e).then(function(e){var t="3D"===y.viewMode?d.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:d.maskColor},size:d.symbol.size,edges:{type:"solid",color:d.maskColor}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:d.maskColor},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:d.maskColor,style:"solid",outline:{color:d.maskColor,width:1}},i=new c({geometry:e,symbol:t});h.add(i);for(var r=void 0===d.bounarycount?30:d.bounarycount,l=Math.ceil(d.boundarydistance/r),a=new u(d.boundaryColor).toRgba(),o=function(o){p.buffer(s,o*r,"meters").then(function(t){p.buffer(s,(o-1)*r,"meters").then(function(e){p.difference(t,e).then(function(e){var t;a[3]=1/l*o,t="3D"===y.viewMode?d.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:a},size:d.symbol.size,edges:{type:"solid",color:a}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:a},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:a,style:"solid",outline:{color:a,width:1}};var i=new c({geometry:e,symbol:t});h.add(i)})})})},n=1;n<=l;n++)o(n)})})}else{if(null===o)return;var a=o.createQuery();a.where=d.boundaryDefinition,o.queryFeatures(a).then(function(e){var t,s;e.features.length&&((t=o.fullExtent).spatialReference=y.view.spatialReference,(s=e.features[0].geometry).spatialReference=y.view.spatialReference,p.buffer(s,d.boundarydistance,"meters").then(function(e){p.difference(t,e).then(function(e){var t="3D"===y.viewMode?d.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:d.maskColor},size:d.symbol.size,edges:{type:"solid",color:d.maskColor}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:d.maskColor},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:d.maskColor,style:"solid",outline:{color:d.maskColor,width:1}},i=new c({geometry:e,symbol:t});h.add(i);for(var r=void 0===d.bounarycount?30:d.bounarycount,l=Math.ceil(d.boundarydistance/r),a=new u(d.boundaryColor).toRgba(),o=function(o){p.buffer(s,o*r,"meters").then(function(t){p.buffer(s,(o-1)*r,"meters").then(function(e){p.difference(t,e).then(function(e){var t;a[3]=1/l*o,t="3D"===y.viewMode?d.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:a},size:d.symbol.size,edges:{type:"solid",color:a}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:a},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:a,style:"solid",outline:{color:a,width:1}};var i=new c({geometry:e,symbol:t});h.add(i)})})})},n=1;n<=l;n++)o(n)})}))})}})},Pe.prototype.init=function(n,s,c){return Ee(this,void 0,void 0,function(){var t,i,o=this;return Re(this,function(e){return t=void 0===c.userName?$.userName:c.userName,i=void 0===c.menuName?$.menuName:c.menuName,fe(["smiapi/utils/xhrutils"]).then(function(e){var a=e[0];a.mapconfig(t,i,$.proxyURL,$.mapconfigbackendurl).then(function(l){return Ee(o,void 0,void 0,function(){var t,i,o,r=this;return Re(this,function(e){switch(e.label){case 0:return this.mapconfig=l.data.mapconfig[0],this.maplayers=l.data.layers,this.mapwidgets=l.data.mapwidgets,this.mapProxys=l.data.mapProxys,this.mapextent=l.data.mapextent[0],"1"!==this.mapconfig.tokenType?[3,1]:(t=void 0===this.mapconfig.backtokenconfigname?$.tokenconfigname:this.mapconfig.backtokenconfigname,i=window.location.host,a.maptoken_backend($.proxyURL,this.mapconfig.backtokenUrl,t,i).then(function(i){return Ee(r,void 0,void 0,function(){var t;return Re(this,function(e){switch(e.label){case 0:return this.maptoken=JSON.parse(i.data).token,"3D"!==this.viewMode?[3,2]:[4,ze(n,this.mapconfig,this.maplayers,this.mapwidgets,this.mapProxys,this.mapextent,this.maptoken,c)];case 1:return t=e.sent(),this.view=t.sceneView,[3,4];case 2:return[4,xe(n,this.mapconfig,this.maplayers,this.mapwidgets,this.mapProxys,this.mapextent,this.maptoken,c)];case 3:t=e.sent(),this.view=t.mapView,e.label=4;case 4:return this.initEvent(),[2]}})})}),[3,7]);case 1:return"2"!==this.mapconfig.tokenType?[3,6]:"3D"!==this.viewMode?[3,3]:[4,ze(n,this.mapconfig,this.maplayers,this.mapwidgets,this.mapProxys,this.mapextent,"",c)];case 2:return o=e.sent(),this.view=o.sceneView,[3,5];case 3:return[4,xe(n,this.mapconfig,this.maplayers,this.mapwidgets,this.mapProxys,this.mapextent,"",c)];case 4:o=e.sent(),this.view=o.mapView,e.label=5;case 5:return this.initEvent(),[3,7];case 6:a.maptoken_front(this.mapconfig.fronttokenUrl,$.tokenUser,$.tokenPassword).then(function(i){return Ee(r,void 0,void 0,function(){var t;return Re(this,function(e){switch(e.label){case 0:return this.maptoken=i.token,"3D"!==s?[3,2]:[4,ze(n,this.mapconfig,this.maplayers,this.mapwidgets,this.mapProxys,this.mapextent,this.maptoken,c)];case 1:return t=e.sent(),this.view=t.sceneView,[3,4];case 2:return[4,xe(n,this.mapconfig,this.maplayers,this.mapwidgets,this.mapProxys,this.mapextent,this.maptoken,c)];case 3:t=e.sent(),this.view=t.mapView,e.label=4;case 4:return this.initEvent(),[2]}})})}),e.label=7;case 7:return[2]}})})})}).catch(function(e){console.error(e)}),[2]})})},Pe.prototype.initEvent=function(){return Ee(this,void 0,void 0,function(){var i=this;return Re(this,function(e){return fe(["esri/core/watchUtils"]).then(function(e){var t=e[0];i.view.when(function(){t.whenTrueOnce(i.view,"ready",function(){i.emit(Le.maploaded,i.view)}),t.whenTrue(i.view,"stationary",function(){var e,t;i.view.extent&&(e={xmin:i.view.extent.xmin.toFixed(6),ymin:i.view.extent.ymin.toFixed(6),xmax:i.view.extent.xmax.toFixed(6),ymax:i.view.extent.ymax.toFixed(6)},"2D"===i.viewMode?i.emit(Le.extentchanged,e):(t={xmin:i.view.extent.xmin.toFixed(6),ymin:i.view.extent.ymin.toFixed(6),xmax:i.view.extent.xmax.toFixed(6),ymax:i.view.extent.ymax.toFixed(6),zmin:i.view.extent.zmin,zmax:i.view.extent.zmax},i.emit(Le.extentchanged,t)),i.view.center&&("2D"===i.viewMode?i.emit(Le.centerchanged,{x:i.view.center.x.toFixed(6),y:i.view.center.y.toFixed(6)}):i.emit(Le.centerchanged,{x:i.view.center.x.toFixed(6),y:i.view.center.y.toFixed(6),z:i.view.center.z})),i.view.zoom&&i.emit(Le.zoomchanged,i.view.zoom))}),i.view.popup.watch("visible",function(e){i.emit(Le.popupvisible,e)}),i.view.on("blur",function(e){i.emit(Le.blur,i.view,e)}),i.view.on("click",function(e){i.emit(Le.click,i.view,e)}),i.view.on("double-click",function(e){i.emit(Le.doubleclick,i.view,e)}),i.view.on("drag",function(e){i.emit(Le.drag,i.view,e)}),i.view.on("focus",function(e){i.emit(Le.focus,i.view,e)}),i.view.on("hold",function(e){i.emit(Le.hold,i.view,e)}),i.view.on("key-down",function(e){i.emit(Le.keydown,i.view,e)}),i.view.on("key-up",function(e){i.emit(Le.keyup,i.view,e)}),i.view.on("mouse-wheel",function(e){i.emit(Le.mousewheel,i.view,e)}),i.view.on("pointer-down",function(e){i.emit(Le.pointerdown,i.view,e)}),i.view.on("pointer-enter",function(e){i.emit(Le.pointerenter,i.view,e)}),i.view.on("pointer-leave",function(e){i.emit(Le.pointerleave,i.view,e)}),i.view.on("pointer-move",function(e){i.emit(Le.pointermove,i.view,e)}),i.view.on("pointer-up",function(e){i.emit(Le.pointerup,i.view,e)}),i.view.on("resize",function(e){i.emit(Le.resize,i.view,e)})})}),[2]})})},Pe);function Pe(e,t){void 0===t&&(t={});var i=Me.call(this)||this;return i.viewMode="2D",i.showBuildingBlock=!1,i.view=null,i.maptoken="",i.mapControl=[],i.mapoverlayers=[],i.mapoverlayersflayer=[],i.watchHandles=[],i.viewMode=void 0===t.viewMode||"2D"===t.viewMode?"2D":"3D",i.zooms=void 0===t.zooms?[1,12]:t.zooms,i.showBuildingBlock=!!t.showBuildingBlock,i.init(e,i.viewMode,t),i}function Ne(e){this.type="text",this.type=void 0===e.type?"cluster":e.type,this.clusterRadius=void 0===e.clusterRadius?100:e.clusterRadius}function De(e){this.size=e.size,this.image=e.image}function Ie(e){this.type="text",this.color="white",this.visible=!0,this.size=12,this.weight="normal",this.angle=0,this.backgroundColor="red",this.borderLineColor="blue",this.borderLineSize=200,this.haloColor="yellow",this.haloSize=20,this.horizontalAlignment="right",this.verticalAlignment="top",this.kerning=!0,this.lineHeight=25,this.lineWidth=200,this.rotated=!1,this.xoffset=0,this.yoffset=0,this.zoffset=0,this.placement="above-right",this.maxScale=0,this.minScale=0,this.text=void 0===e.text?"标注":e.text,this.color=void 0===e.color?"white":e.color,this.visible=void 0===e.visible||e.visible,this.size=void 0===e.size?12:e.size,this.weight=void 0===e.weight?"normal":e.weight,this.angle=void 0===e.angle?0:e.angle,this.backgroundColor=void 0===e.backgroundColor?"red":e.backgroundColor,this.borderLineColor=void 0===e.borderLineColor?"blue":e.borderLineColor,this.borderLineSize=void 0===e.borderLineSize?200:e.borderLineSize,this.haloColor=void 0===e.haloColor?"yellow":e.haloColor,this.haloSize=void 0===e.haloSize?0:e.haloSize,this.horizontalAlignment=void 0===e.horizontalAlignment?"right":e.horizontalAlignment,this.verticalAlignment=void 0===e.verticalAlignment?"top":e.verticalAlignment,this.kerning=void 0===e.kerning||e.kerning,this.lineHeight=void 0===e.lineHeight?25:e.lineHeight,this.lineWidth=void 0===e.lineWidth?200:e.lineWidth,this.rotated=void 0!==e.rotated&&e.rotated,this.xoffset=void 0===e.xoffset?0:e.xoffset,this.yoffset=void 0===e.yoffset?0:e.yoffset,this.zoffset=void 0===e.zoffset?0:e.zoffset,this.placement=void 0===e.placement?"center-right":e.placement,this.maxScale=void 0===e.maxScale?0:e.maxScale,this.minScale=void 0===e.minScale?0:e.minScale}var je=(Te.prototype.S4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},Te.prototype.get_uuid=function(){return this.S4()+this.S4()+"-"+this.S4()+"-"+this.S4()+"-"+this.S4()+"-"+this.S4()+this.S4()+this.S4()},Te);function Te(){this.uuid=this.get_uuid()}function We(e){this.uuid=(new je).uuid,this.label=e.label,this.attributes=void 0===e.attributes?{}:e.attributes,this.type="element"}var Be,Fe,He=((Be=function(e,t){return(Be=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Be(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})(Je,Fe=We),Je);function Je(e){var t=Fe.call(this,e)||this;return t.overlaytype="Marker",t.icon=e.icon,t.position=e.position,t}function Ve(e,t){this.uuid=(new je).uuid,this.overlayers=e,this.type="group",this.overlaytype=void 0===t.overlaytype?"marker":t.overlaytype,this.datafiled=void 0===t.datafiled?[]:t.datafiled,this.style=void 0===t.style?[]:t.style,this.label=void 0===t.label?null:t.label,this.frreduction=void 0===t.frreduction?null:t.frreduction}var Ue,Ze,Ge,qe,Xe=((Ue=function(e,t){return(Ue=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ue(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})(Ye,Ze=We),Ye);function Ye(e){var t=Ze.call(this,e)||this;return t.overlaytype="polygon",t.paths=e.paths,t.symboltype=void 0===e.symboltype?"simple":e.symboltype,t.fillColor=void 0===e.fillColor?"white":e.fillColor,t.style=void 0===e.style?"solid":e.style,t.strokeColor=void 0===e.strokeColor?"red":e.strokeColor,t.strokestyle=void 0===e.strokestyle?"solid":e.strokestyle,t.strokeWeight=void 0===e.strokeWeight?2:e.strokeWeight,t.url=void 0===e.url?"":e.url,t.picwidth=void 0===e.picwidth?20:e.picwidth,t.picheight=void 0===e.picheight?20:e.picheight,t}function $e(e){var t=qe.call(this,e)||this;return t.overlaytype="Polyline",t.path=e.path,t.cap=void 0===e.cap?"square":e.cap,t.strokeColor=void 0===e.strokeColor?"red":e.strokeColor,t.style=void 0===e.style?"solid":e.style,t.lineJoin=void 0===e.lineJoin?"round":e.lineJoin,t.width=void 0===e.width?5:e.width,t}return{load:fe,Bounds:e,LayerListControl:P,Zoom:X,Home:A,Compass:z,Fullscreen:L,MeasureArea:j,MeasureLine:F,BasemapToggle:l,BMapGallery:d,BMapGalleryExpand:m,UndergroundSwitch:U,BIMFilterControl:c,Marker:He,Icon:De,Size:function(e,t){this.width=e,this.height=t},Label:Ie,FeatureReduction:Ne,OverlayGroup:Ve,LngLat:t,Polyline:((Ge=function(e,t){return(Ge=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ge(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})($e,qe=We),$e),Polygon:Xe,MapEvent:Le,Map:Oe}});
//# sourceMappingURL=SMap.min.js.map

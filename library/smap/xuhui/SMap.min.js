!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):e.SMap=i()}(this,function(){"use strict";function e(e,i){this.northeast=i,this.southwest=e,this.xmin=e[0],this.ymin=e[1],this.zmin=void 0!==e[2]?e[2]:void 0,this.xmax=i[0],this.ymax=i[1],this.zmax=void 0!==i[2]?i[2]:void 0}function i(e,i,t){this.X=e,this.Y=i,this.Z=void 0===t?0:t}function t(e){this.visible=!(void 0!==e.visible&&!e.visible),this.position=void 0===e.position||"top-right"===e.position?"top-right":e.position,this.collapse=!0===e.collapse}var o,r,l=((o=function(e,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}o(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)})(a,r=t),a);function a(e){var i=r.call(this,e)||this;return i.controlName="basemaptoggle",i}var n,s,p=((n=function(e,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}n(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)})(c,s=t),c);function c(e){var i=s.call(this,e)||this;return i.controlName="bimfilter",i.layerid=e.layerid,i}var u,d,y=((u=function(e,i){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}u(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)})(h,d=t),h);function h(e){var i=d.call(this,e)||this;return i.controlName="basemapgallery",i}var b,v,f=((b=function(e,i){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}b(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)})(m,v=t),m);function m(e){var i=v.call(this,e)||this;return i.controlName="baseMapGalleryExpand",i}var w,g,x=((w=function(e,i){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}w(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)})(z,g=t),z);function z(e){var i=g.call(this,e)||this;return i.controlName="compass",i}var k,C,L=((k=function(e,i){return(k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}k(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)})(S,C=t),S);function S(e){var i=C.call(this,e)||this;return i.controlName="fullscreen",i}var M,_,E=((M=function(e,i){return(M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}M(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)})(A,_=t),A);function A(e){var i=_.call(this,e)||this;return i.controlName="home",i}var I,T,R=((I=function(e,i){return(I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}I(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)})(O,T=t),O);function O(e){var i=T.call(this,e)||this;return i.controlName="toc",i}var P,D,j=((P=function(e,i){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}P(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)})(H,D=t),H);function H(e){var i=D.call(this,e)||this;return i.controlName="measurearea",i}var N,B,W=((N=function(e,i){return(N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}N(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)})(F,B=t),F);function F(e){var i=B.call(this,e)||this;return i.controlName="measureline",i}var G,J,V=((G=function(e,i){return(G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}G(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)})(Z,J=t),Z);function Z(e){var i=J.call(this,e)||this;return i.controlName="undergroundswitch",i}var U,q,X=((U=function(e,i){return(U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}U(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)})(Y,q=t),Y);function Y(e){var i=q.call(this,e)||this;return i.controlName="zoom",i}var $=(Q.jsapi="http://10.201.37.225:8080/smiapi/arcgis",Q.bujianurl="http://10.201.37.225:8080/smiapi/arcgis/4.15/esri/layers/json/tileJson.json",Q.jsapiversion4X="4.15",Q.tokenserver={tokenType:"free",token_front:{url:"http://10.108.3.52:8080/onemap/tokens/generateToken",user:"none",password:"none"},token_black:{url:"http://10.108.3.16:8401/mapconfig/gistoken",tokenconfigname:"smiapi_new"}},Q.proxyConifg={useProxy:!0,url:"http://10.201.37.225:8080/mapkProx/proxy.jsp?",httpsDomains:[{proxyUrl:"http://10.201.37.225:8080/mapkProx/proxy.jsp",domainName:"http://hostserver.xhbd.local"},{proxyUrl:"http://10.201.37.225:8080/mapkProx/proxy.jsp",domainName:"http://hostserver2.xhbd.local"}]},Q.fonts={url:"http://10.201.37.225:8080/smiapi/arcgis/4.15/fonts"},Q.gisService={geometryServiceUrl:"http:///mapserver.smi.sh.cegn.cn:8080/OneMapServer/rest/services/Geometry/GeometryServer",serverurl:"http://mapserver.smi.sh.cegn.cn:8080/OneMapServer/rest/services",baseMapServices:{isToken:!0,tokenType:"OneMap",layers:[{url:"http://hostserver.xhbd.local/arcgis/rest/services/Air2020/MapServer",layerEName:"basemap_air",isToken:!1,visible:!1,opacity:1,mapType:"SHCTiledMapServiceLayer",tag:"影像底图",layerCName:"影像底图",type:"basemap_air"},{url:"http://hostserver.xhbd.local/arcgis/rest/services/BaseMap/MapServer",layerEName:"basemap_zw",isToken:!1,visible:!1,opacity:1,mapType:"SHCTiledMapServiceLayer",tag:"政务底图",layerCName:"政务底图",type:"basemap_zw"},{url:"http://hostserver.xhbd.local/arcgis/rest/services/MarkerMap/MapServer",layerEName:"basemap_as",isToken:!1,visible:!1,opacity:1,mapType:"TileLayer",tag:"暗色底图",layerCName:"暗色底图",type:"basemap_as"}]},buildingsLayers:{id:"buildings_3d_layers",title:"空间基础",tag:"buildings_3d_layers",listMode:"show",visible:!0,layerGroups:[{id:"buildings_3d_above_layers",title:"地上",tag:"buildings_3d_above_layers",visible:!0,listMode:"show",layerGroups:[],layers:[{url:"http://hostserver.xhbd.local/arcgis/rest/services/Hosted/XuHuiJingMo/SceneServer",id:"model_air_real",isToken:!1,visible:!1,opacity:1,maptype:"SceneLayer",tag:"影像底图精模",title:"影像底图精模",elevationInfo:{mode:"absolute-height",offset:-4},type:"model_air_real",popupEnabled:!0,listMode:"show"},{url:"http://hostserver.xhbd.local/arcgis/rest/services/Hosted/XuHuiQuBaiMo/SceneServer",id:"model_white_zw",isToken:!1,visible:!0,opacity:1,maptype:"SceneLayer",tag:"政务白模型",title:"政务白模型",type:"model_white_zw",popupEnabled:!0,listMode:"show",renderer:{type:"simple",symbol:{type:"mesh-3d",symbolLayers:[{type:"fill",material:{color:[255,255,255,.6],colorMixMode:"replace"},edges:{type:"solid",color:[0,0,0,.6],size:1}}]}}},{url:"http://hostserver.xhbd.local/arcgis/rest/services/Hosted/XuHuiQuBaiMo/SceneServer",id:"model_white_as",isToken:!1,visible:!1,opacity:1,maptype:"SceneLayer",tag:"暗色白模型",title:"暗色白模型",type:"model_white_as",popupEnabled:!0,listMode:"show",renderer:{type:"simple",symbol:{type:"mesh-3d",symbolLayers:[{type:"fill",material:{color:[77,126,176,1],colorMixMode:"replace"},edges:{type:"solid",color:[0,0,0,.6],size:1}}]}}}]}]},smapbussinessLayers:{serverurl:"http://hostserver.xhbd.local/arcgis/rest/services",istoken:!1,tokenType:"OneMap",layerGroups:[{id:"smap_3D_layers",title:"三维业务组",grouptype:"3D",tag:"smap_3D_layers",visible:!0,listMode:"show",layerGroups:[],layers:[]},{id:"smap_2D_layers",title:"二维业务组",grouptype:"2D",tag:"smap_2D_layers",visible:!0,listMode:"show",layerGroups:[{id:"shanghaiboundary",title:"上海边界范围数据",tag:"shanghaiboundary",visible:!0,listMode:"show",layers:[{url:"http://hostserver2.xhbd.local/server/rest/services/Hosted/sh_qx_boundary/FeatureServer",id:"qx_boundary",istoken:!0,visible:!1,opacity:1,maptype:"FeatureLayer",tag:"qx_boundary",title:"上海区县边界",renderer:{type:"simple",symbol:{type:"simple-fill",color:[0,227,229,0],outline:{color:[0,0,255,1],width:"2px"}}},type:"image",listMode:"show"},{url:"http://hostserver2.xhbd.local/server/rest/services/Hosted/sh_jd_boundary/FeatureServer",id:"jd_boundary",istoken:!0,visible:!1,opacity:1,maptype:"FeatureLayer",tag:"jd_boundary",title:"上海街道边界",renderer:{type:"simple",symbol:{type:"simple-fill",color:[0,227,229,0],outline:{color:[0,255,0,1],width:"2px"}}},type:"image",listMode:"show"},{url:"http://hostserver2.xhbd.local/server/rest/services/Hosted/sh_jwh_boundary/FeatureServer",id:"jwh_boundary",istoken:!0,visible:!1,opacity:1,maptype:"FeatureLayer",tag:"jwh_boundary",title:"上海居委会边界",renderer:{type:"simple",symbol:{type:"simple-fill",color:[0,227,229,0],outline:{color:[255,0,0,1],width:"2px"}}},type:"image",listMode:"show"}]}],layers:[{id:"Hight_Graphiclayer",istoken:!1,visible:!0,opacity:1,maptype:"GraphicsLayer",tag:"辅助显示图层",title:"辅助显示图层",type:"image",listMode:"hide"},{id:"location_Hightlight",istoken:!1,visible:!0,opacity:1,maptype:"GraphicsLayer",tag:"地名地址高亮",title:"地名地址高亮",type:"image",listMode:"hide"}]}]}},Q);function Q(){}var K=$.jsapiversion4X,ee="next";function ie(e){if(null===e&&(e=K),e.toString().toLowerCase()===ee)return ee;var i=e&&e.match(/^(\d)\.(\d+)/);return i&&{major:parseInt(i[1],10),minor:parseInt(i[2],10)}}function te(e){return void 0===e&&(e=K),$.jsapi+"/"+e+"/init.js"}function oe(e){var i=document.createElement("link");return i.rel="stylesheet",i.href=e,i}function re(e,i){if(i){var t=document.querySelector(i);t.parentNode.insertBefore(e,t)}else document.head.appendChild(e)}function le(e){return document.querySelector('link[href*="'+e+'"]')}function ae(e){return!e||ie(e)?function(e){void 0===e&&(e=K),null===e&&(e=K);var i=te(e),t=i.substring(0,i.indexOf("init.js")),o=ie(e);return o===ee||3!==o.major?t+"esri/themes/light/main.css":t+(o.minor<=10?"js/":"")+"esri/css/esri.css"}(e):e}function ne(e,i){var t=ae(e),o=le(t);if(o||re(o=oe(t),i),4===function(e){null===e&&(e=K);var i=e&&e.match(/^(\d)\.(\d+)/);return i&&{major:parseInt(i[1],10),minor:parseInt(i[2],10)}}(e).major){var r=t.substring(0,t.indexOf("esri/themes/"))+"esri/themes/gis/css/gis.css",l=le(r);l||re(l=oe(r),i)}return o}var se={Promise:"undefined"!=typeof window?window.Promise:void 0},pe={};function ce(e,i,t){var o,r,l,a;t&&(l=t,a=function(e){l(e.error||new Error("There was an error attempting to load "+r.src)),r.removeEventListener("error",a,!1)},(r=e).addEventListener("error",a,!1),o=a);var n=function(){i(e),e.removeEventListener("load",n,!1),o&&e.removeEventListener("error",o,!1)};e.addEventListener("load",n,!1)}function ue(){return document.querySelector("script[data-shsmi]")}function de(){var e=window.require;return e&&e.on}function ye(e){void 0===e&&(e={});var s={};[pe,e].forEach(function(e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i])});var p=s.version,c=s.url||te(p);return new se.Promise(function(e,i){var t,o,r=ue();if(r){var l=r.getAttribute("src");l!==c?i(new Error("The ArcGIS API for JavaScript is already loaded ("+l+").")):de()?e(r):ce(r,e,i)}else if(de())i(new Error("The ArcGIS API for JavaScript is already loaded."));else{var a=s.css;if(a)ne(!0===a?p:a,s.insertCssBefore);else ne(null,s.insertCssBefore);if(s.dojoConfig)window.dojoConfig=s.dojoConfig;else{var n={async:!0,packages:[{location:$.jsapi+"/extensions",name:"smiapi"},{location:$.jsapi+"/extensions/geolocation",name:"geolocate",main:"geolocate"}],deps:["@dojo/framework/shim/main"],has:{"esri-promise-compatibility":1,"esri-featurelayer-webgl":1}};window.dojoConfig=n}t=c,(o=document.createElement("script")).type="text/javascript",o.src=t,o.setAttribute("data-shsmi","loading"),ce(r=o,function(){r.setAttribute("data-shsmi","loaded"),e(r)},i),document.head.appendChild(r)}})}function he(i){return new se.Promise(function(t,e){var o=window.require.on("error",e);window.require(i,function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];o.remove(),t(e)})})}function be(e,i){if(void 0===i&&(i={}),de())return he(e);var t=ue(),o=t&&t.getAttribute("src");return!i.url&&o&&(i.url=o),ye(i).then(function(){return he(e)})}var ve=function(e,a,n,s){return new(n=n||Promise)(function(t,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function r(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var i;e.done?t(e.value):((i=e.value)instanceof n?i:new n(function(e){e(i)})).then(o,r)}l((s=s.apply(e,a||[])).next())})},fe=function(t,o){var r,l,a,e,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function i(i){return function(e){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,l&&(a=2&i[0]?l.return:i[0]?l.throw||((a=l.return)&&a.call(l),0):l.next)&&!(a=a.call(l,i[1])).done)return a;switch(l=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,l=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){n=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){n.label=i[1];break}if(6===i[0]&&n.label<a[1]){n.label=a[1],a=i;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(i);break}a[2]&&n.ops.pop(),n.trys.pop();continue}i=o.call(t,n)}catch(e){i=[6,e],l=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,e])}}};function me(t,g,a){return ve(this,void 0,void 0,function(){var i,n,s,p,c,u,d,y,h,r,b,v,f,m,w,l;return fe(this,function(e){switch(e.label){case 0:return[4,be(["esri/layers/TileLayer","esri/layers/SceneLayer","esri/layers/VectorTileLayer","esri/layers/MapImageLayer","esri/layers/IntegratedMeshLayer","esri/layers/PointCloudLayer","esri/layers/BuildingSceneLayer","esri/layers/SHCTiledMapServiceLayer","esri/layers/SHCMapServiceLayer","esri/layers/GroupLayer","esri/layers/GeoJSONLayer","esri/layers/FeatureLayer","esri/layers/GraphicsLayer","esri/geometry/Extent","esri/geometry/SpatialReference"])];case 1:return i=e.sent(),n=i[0],s=i[1],i[2],p=i[3],c=i[4],u=i[5],d=i[6],y=i[7],h=i[8],r=i[9],b=i[10],v=i[11],f=i[12],m=i[13],w=i[14],l=[],t.map(function(e){var i=new r({id:e.id,title:e.title,visible:e.visible,listMode:e.listMode});if(null!=e.layerGroups){var t=e.layerGroups.reverse().map(function(e){var a=new r({id:e.id,title:e.title,visible:e.visible,listMode:e.listMode});return e.layers.reverse().map(function(e){switch(e.maptype){case"TileLayer":a.add(new n(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));break;case"MapImageLayer":a.add(new p(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));break;case"GeoJSONLayer":a.add(new b({url:e.url,id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));break;case"localFeatureLayer":var i=new v({id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode,popupTemplate:e.popupTemplate,popupEnabled:e.popupEnabled,source:[]});null!=e.renderer&&void 0!==e.renderer&&(i.renderer=e.renderer),a.add(i);break;case"FeatureLayer":var t=new v(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode,popupTemplate:e.popupTemplate,popupEnabled:e.popupEnabled});null!=e.renderer&&void 0!==e.renderer&&(t.renderer=e.renderer),null!=e.elevationInfo&&void 0!==e.elevationInfo&&(t.elevationInfo=e.elevationInfo),null!=e.labelingInfo&&void 0!==e.labelingInfo&&(t.labelingInfo=e.labelingInfo),null!=e.popupTemplate&&void 0!==e.popupTemplate&&(t.popupTemplate=e.popupTemplate),a.add(t);break;case"SceneLayer":var o=new s(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,renderer:e.renderer,popupTemplate:e.popupTemplate,popupEnabled:e.popupEnabled,elevationInfo:e.elevationInfo});null!=o.renderer&&void 0!==o.renderer&&(o.renderer=e.renderer),null!=e.elevationInfo&&void 0!==e.elevationInfo&&(o.elevationInfo=e.elevationInfo),null!=e.popupTemplate&&void 0!==e.popupTemplate&&(o.popupTemplate=e.popupTemplate),a.add(o);break;case"BuildingSceneLayer":a.add(new d({url:e.url,id:e.id,title:e.title,visible:e.visible,opacity:e.opacity}));break;case"PointCloudLayer":a.add(new u(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));break;case"IntegratedMeshLayer":a.add(new c(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));case"GraphicsLayer":a.add(new f({id:e.id,visible:e.visible,opacity:e.opacity,listMode:e.listMode,title:e.title}));break;case"SHCTiledMapServiceLayer":var r=new m({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:w.WebMercator});!0===e.istoken?a.add(y({url:e.url,token:g,fullExtent:r,opacity:e.opacity,title:e.title,id:e.id,visible:e.visible})):a.add(y({url:e.url,fullExtent:r,opacity:e.opacity,title:e.title,id:e.id,visible:e.visible}));break;case"SHCMapServiceLayer":var l=new m({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:w.WebMercator});!0===e.istoken?a.add(h({url:e.url,token:g,fullExtent:l,opacity:e.opacity,title:e.title,id:e.id,visible:e.visible})):a.add(new h({url:e.url,fullExtent:l,opacity:e.opacity,title:e.title,id:e.id,visible:e.visible}))}}),a});i.addMany(t)}if(null!=e.layers){var o=e.layers.reverse().map(function(e){switch(e.maptype){case"TileLayer":return new n(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity});case"MapImageLayer":return new p(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity});case"FeatureLayer":var i=new v(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,popupEnabled:e.popupEnabled});return null!=e.renderer&&void 0!==e.renderer&&(i.renderer=e.renderer),null!=e.labelingInfo&&void 0!==e.labelingInfo&&(i.labelingInfo=e.labelingInfo),null!=e.elevationInfo&&void 0!==e.elevationInfo&&(i.elevationInfo=e.elevationInfo),null!=e.popupTemplate&&void 0!==e.popupTemplate&&(i.popupTemplate=e.popupTemplate),i;case"SceneLayer":var t=new s({url:e.url,id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,popupEnabled:e.popupEnabled});return null!=e.renderer&&void 0!==e.renderer&&(t.renderer=e.renderer),null!=e.popupTemplate&&void 0!==e.popupTemplate&&(t.popupTemplate=e.popupTemplate),null!=e.elevationInfo&&void 0!==e.elevationInfo&&(t.elevationInfo=e.elevationInfo),t;case"BuildingSceneLayer":return new d({url:e.url,id:e.id,title:e.title,visible:e.visible,opacity:e.opacity});case"PointCloudLayer":return new u(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode});case"IntegratedMeshLayer":return new c(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode});case"GraphicsLayer":return new f({id:e.id,visible:e.visible,opacity:e.opacity,listMode:e.listMode,title:e.title})}});i.addMany(o)}"2D"===a&&"2D"!==e.grouptype||l.push(i)}),[2,l]}})})}var we=function(e,a,n,s){return new(n=n||Promise)(function(t,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function r(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var i;e.done?t(e.value):((i=e.value)instanceof n?i:new n(function(e){e(i)})).then(o,r)}l((s=s.apply(e,a||[])).next())})},ge=function(t,o){var r,l,a,e,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function i(i){return function(e){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,l&&(a=2&i[0]?l.return:i[0]?l.throw||((a=l.return)&&a.call(l),0):l.next)&&!(a=a.call(l,i[1])).done)return a;switch(l=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,l=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){n=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){n.label=i[1];break}if(6===i[0]&&n.label<a[1]){n.label=a[1],a=i;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(i);break}a[2]&&n.ops.pop(),n.trys.pop();continue}i=o.call(t,n)}catch(e){i=[6,e],l=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,e])}}};function xe(f,m,w,g,x){return we(this,void 0,void 0,function(){var i,t,o,r,l,a,n,s,p,c,u,d,y,h,b,v;return ge(this,function(e){switch(e.label){case 0:return[4,be(["esri/Map","esri/Basemap","esri/geometry/Point","esri/core/urlUtils","esri/config","esri/identity/IdentityManager","esri/core/watchUtils","esri/views/SceneView"])];case 1:return i=e.sent(),t=i[0],o=i[1],r=i[2],l=i[3],a=i[4],n=i[5],s=i[6],p=i[7],w.useProxy&&w.httpsDomains.map(function(e){l.addProxyRule({proxyUrl:e.proxyUrl,urlPrefix:e.domainName})}),a.geometryServiceUrl=m.geometryServiceUrl,""!==g&&n.registerToken({server:m.serverurl,token:g}),n.on("dialog-create",function(){n.dialog.open=!0}),[4,function(a,n){return ve(this,void 0,void 0,function(){var i,t,o,r,l;return fe(this,function(e){switch(e.label){case 0:return[4,be(["esri/geometry/Extent","esri/layers/SHCTiledMapServiceLayer","esri/layers/TileLayer","esri/geometry/SpatialReference"])];case 1:return i=e.sent(),t=i[0],o=i[1],r=i[2],l=i[3],[2,a.map(function(e){switch(e.mapType){case"SHCTiledMapServiceLayer":var i=new t({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:l.WebMercator});return!0===e.isToken?new o({url:e.url,token:n,fullExtent:i,opacity:e.opacity,title:e.layerCName,id:e.layerEName,visible:e.visible}):new o({url:e.url,fullExtent:i,opacity:e.opacity,title:e.layerCName,id:e.layerEName,visible:e.visible});case"TileLayer":return new r({url:e.url,id:e.layerEName,visible:e.visible,opacity:e.opacity,listMode:e.listMode,title:e.layerCName})}})]}})})}(m.baseMapServices.layers,g)];case 2:return c=e.sent(),u=new o({baseLayers:c,title:"底图",id:"basemap_zw"}),d=new t({basemap:u}),[4,function(l,m){return ve(this,void 0,void 0,function(){var i,a,n,s,p,c,u,d,y,r,h,b,v,f,t,o;return fe(this,function(e){switch(e.label){case 0:return[4,be(["esri/layers/TileLayer","esri/layers/SceneLayer","esri/layers/VectorTileLayer","esri/layers/MapImageLayer","esri/layers/IntegratedMeshLayer","esri/layers/PointCloudLayer","esri/layers/BuildingSceneLayer","esri/layers/SHCTiledMapServiceLayer","esri/layers/SHCMapServiceLayer","esri/layers/GroupLayer","esri/layers/FeatureLayer","esri/layers/GraphicsLayer","esri/geometry/Extent","esri/geometry/SpatialReference"])];case 1:return i=e.sent(),a=i[0],n=i[1],i[2],s=i[3],p=i[4],c=i[5],u=i[6],d=i[7],y=i[8],r=i[9],h=i[10],b=i[11],v=i[12],f=i[13],t=new r({id:l.id,title:l.title,visible:l.visible,listMode:l.listMode}),o=l.layerGroups.map(function(e){var i=new r({id:e.id,title:e.title,visible:e.visible,listMode:e.listMode});if(null!=e.layerGroups){var t=e.layerGroups.reverse().map(function(e){var l=new r({id:e.id,title:e.title,visible:e.visible,listMode:e.listMode});return e.layers.reverse().map(function(e){switch(e.maptype){case"TileLayer":l.add(new a(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));break;case"MapImageLayer":l.add(new s(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));break;case"FeatureLayer":var i=new h(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode,popupEnabled:e.popupEnabled});return null!=e.renderer&&void 0!==e.renderer&&(i.renderer=e.renderer),null!=e.labelingInfo&&void 0!==e.labelingInfo&&(i.labelingInfo=e.labelingInfo),null!=e.elevationInfo&&void 0!==e.elevationInfo&&(i.elevationInfo=e.elevationInfo),null!=e.popupTemplate&&void 0!==e.popupTemplate&&(i.popupTemplate=e.popupTemplate),i;case"SceneLayer":var t=new n(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,popupEnabled:e.popupEnabled});null!=e.renderer&&void 0!==e.renderer&&(t.renderer=e.renderer),null!=e.elevationInfo&&void 0!==e.elevationInfo&&(t.elevationInfo=e.elevationInfo),null!=e.popupTemplate&&void 0!==e.popupTemplate&&(t.popupTemplate=e.popupTemplate),l.add(t);break;case"BuildingSceneLayer":l.add(new u({url:e.url,id:e.id,title:e.title,visible:e.visible,opacity:e.opacity}));break;case"PointCloudLayer":l.add(new c(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));break;case"IntegratedMeshLayer":l.add(new p(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));case"GraphicsLayer":l.add(new b({id:e.id,visible:e.visible,opacity:e.opacity,listMode:e.listMode,title:e.title}));break;case"SHCTiledMapServiceLayer":var o=new v({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:f.WebMercator});!0===e.istoken?l.add(d({url:e.url,token:m,fullExtent:o,opacity:e.opacity,title:e.title,id:e.id,visible:e.visible})):l.add(d({url:e.url,fullExtent:o,opacity:e.opacity,title:e.title,id:e.id,visible:e.visible}));break;case"SHCMapServiceLayer":var r=new v({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:f.WebMercator});!0===e.istoken?l.add(y({url:e.url,token:m,fullExtent:r,opacity:e.opacity,title:e.title,id:e.id,visible:e.visible})):l.add(new y({url:e.url,fullExtent:r,opacity:e.opacity,title:e.title,id:e.id,visible:e.visible}))}}),l});i.addMany(t)}if(null!=e.layers){var o=e.layers.reverse().map(function(e){switch(e.maptype){case"TileLayer":return new a(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity});case"MapImageLayer":return new s(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity});case"FeatureLayer":var i=new h(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,popupEnabled:e.popupEnabled});return null!=e.renderer&&void 0!==e.renderer&&(i.renderer=e.renderer),null!=e.labelingInfo&&void 0!==e.labelingInfo&&(i.labelingInfo=e.labelingInfo),null!=e.elevationInfo&&void 0!==e.elevationInfo&&(i.elevationInfo=e.elevationInfo),null!=e.popupTemplate&&void 0!==e.popupTemplate&&(i.popupTemplate=e.popupTemplate),i;case"SceneLayer":var t=new n(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,popupEnabled:e.popupEnabled});return null!=e.renderer&&void 0!==e.renderer&&(t.renderer=e.renderer),null!=e.elevationInfo&&void 0!==e.elevationInfo&&(t.elevationInfo=e.elevationInfo),null!=e.popupTemplate&&void 0!==e.popupTemplate&&(t.popupTemplate=e.popupTemplate),t;case"BuildingSceneLayer":return new u({url:e.url,id:e.id,title:e.title,visible:e.visible,opacity:e.opacity});case"PointCloudLayer":return new c(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode});case"IntegratedMeshLayer":return new p(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode});case"GraphicsLayer":return new b({id:e.id,visible:e.visible,opacity:e.opacity,listMode:e.listMode,title:e.title})}});i.addMany(o)}return i}),t.addMany(o),[2,t]}})})}(m.buildingsLayers,g)];case 3:if(y=e.sent(),d.add(y),void 0!==x.mapStyle){switch(x.mapStyle){case"smap://styles/normal":d.basemap.id="basemap_zw";break;case"smap://styles/dark":d.basemap.id="basemap_as";break;case"smap://styles/image":d.basemap.id="basemap_air";break;default:d.basemap.id="basemap_as"}d.basemap.baseLayers.items.forEach(function(e){e.id===d.basemap.id?e.visible=!0:e.visible=!1}),["model_white_zw","model_air_real","model_white_as"].forEach(function(e){var i=d.findLayerById(e);!1===x.showBuildingBlock?i&&(i.visible=!1):i&&("basemap_zw"===d.basemap.id?i.visible="model_white_zw"===e:"basemap_as"===d.basemap.id?i.visible="model_white_as"===e:"basemap_air"===d.basemap.id&&(i.visible="model_air_real"===e))})}return h=void 0===x.viewMode||"2D"===x.viewMode?"2D":"3D",[4,me(m.smapbussinessLayers.layerGroups,g,h)];case 4:return(b=e.sent(),d.addMany(b),(v=new p({map:d,container:f,spatialReference:{wkid:102100},viewingMode:"local"})).ui.empty("top-left"),v.ui.empty("top-right"),v.ui.empty("bottom-left"),v.ui.empty("bottom-right"),v.padding={top:5,bottom:0,left:0,right:5},v.when(function(){v.qualitySettings.memoryLimit=4096,n.on("dialog-create",function(){n.dialog.open=!0})}),void 0!==x.center&&(v.center=new r({x:x.center[0],y:x.center[1],z:void 0!==x.center[2]?x.center[2]:0,spatialReference:{wkid:102100}})),void 0!==x.zoom&&(v.zoom=x.zoom),void 0===x.pitch)?[3,6]:[4,v.goTo({center:v.center,zoom:v.zoom,tilt:x.pitch,heading:0})];case 5:e.sent(),s.when(v,"animation",function(e){e.when(function(e){void 0!==x.zooms&&v.watch("zoom",function(e){e>=x.zooms[1]&&(v.zoom=x.zooms[1]),e<=x.zooms[0]&&(v.zoom=x.zooms[0])})}).catch(function(e){console.log(e)})}),e.label=6;case 6:return[2,{sceneView:v,mapv:d}]}})})}function ze(b,v,f,m,w){return we(this,void 0,void 0,function(){var i,t,o,r,l,a,n,s,p,c,u,d,y,h;return ge(this,function(e){switch(e.label){case 0:return[4,be(["esri/Map","esri/Basemap","esri/core/urlUtils","esri/config","esri/identity/IdentityManager","esri/geometry/Point","esri/views/MapView"])];case 1:return i=e.sent(),t=i[0],o=i[1],r=i[2],l=i[3],a=i[4],n=i[5],s=i[6],f.useProxy&&f.httpsDomains.map(function(e){r.addProxyRule({proxyUrl:e.proxyUrl,urlPrefix:e.domainName})}),l.geometryServiceUrl=v.geometryserviceUrl,l.fontsUrl=$.fonts.url,""!==m&&a.registerToken({server:v.serverurl,token:m}),a.on("dialog-create",function(){a.dialog.open=!0}),[4,function(a,n){return ve(this,void 0,void 0,function(){var i,t,o,r,l;return fe(this,function(e){switch(e.label){case 0:return[4,be(["esri/geometry/Extent","esri/layers/TileLayer","esri/layers/SceneLayer","esri/layers/SHCTiledMapServiceLayer","esri/layers/GroupLayer","esri/geometry/SpatialReference"])];case 1:return i=e.sent(),t=i[0],o=i[1],i[2],r=i[3],i[4],l=i[5],[2,a.map(function(e){switch(e.mapType){case"SHCTiledMapServiceLayer":var i=new t({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:l.WebMercator});return!0===e.isToken?new r({url:e.url,token:n,fullExtent:i,opacity:e.opacity,title:e.layerCName,id:e.layerEName,visible:e.visible}):new r({url:e.url,fullExtent:i,opacity:e.opacity,title:e.layerCName,id:e.layerEName,visible:e.visible});case"TileLayer":return new o(e.url,{id:e.layerEName,visible:e.visible,opacity:e.opacity,listMode:e.listMode,title:e.layerCName})}})]}})})}(v.baseMapServices.layers,m)];case 2:if(p=e.sent(),c=new o({baseLayers:p,title:"底图",id:"basemap_as"}),u=new t({basemap:c}),void 0!==w.mapStyle){switch(w.mapStyle){case"smap://styles/normal":u.basemap.id="basemap_zw";break;case"smap://styles/dark":u.basemap.id="basemap_as";break;case"smap://styles/image":u.basemap.id="basemap_air";break;default:u.basemap.id="basemap_as"}u.basemap.baseLayers.items.forEach(function(e){e.id===u.basemap.id?e.visible=!0:e.visible=!1})}return d=void 0===w.viewMode||"2D"===w.viewMode?"2D":"3D",[4,me(v.smapbussinessLayers.layerGroups,m,d)];case 3:return y=e.sent(),u.addMany(y),(h=new s({map:u,container:b,spatialReference:{wkid:102100}})).ui.empty("top-left"),h.ui.empty("top-right"),h.ui.empty("bottom-left"),h.ui.empty("bottom-right"),h.padding={top:5,bottom:0,left:0,right:5},void 0!==w.center&&(h.center=new n({x:w.center[0],y:w.center[1],spatialReference:{wkid:102100}})),void 0!==w.zoom&&(h.zoom=w.zoom),void 0!==w.zooms&&(h.constraints.minZoom=w.zooms[0],h.constraints.maxZoom=w.zooms[1]),void 0!==w.rotateEnable&&(h.constraints.rotationEnabled=w.rotateEnable),[2,{mapView:h,mapv:u}]}})})}var ke=(Ce.prototype._addListener=function(e,i,t){if(this.emit("newListener",e,i),this.events.has(e)){var o=this.events.get(e);t?o.unshift(i):o.push(i)}else this.events.set(e,[i]);var r=this.getMaxListeners();if(0<r&&this.listenerCount(e)>r){var l=new Error("Possible EventEmitter memory leak detected.\n         "+this.listenerCount(e)+" "+e.toString()+" listeners.\n         Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",console.warn(l)}return this},Ce.prototype.addListener=function(e,i){return this._addListener(e,i,!1)},Ce.prototype.emit=function(e){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];if(this.events.has(e)){for(var o=0,r=this.events.get(e).slice();o<r.length;o++){var l=r[o];try{l.apply(this,i)}catch(e){this.emit("error",e)}}return!0}if("error"===e)throw 0<i.length?i[0]:Error("Unhandled error.");return!1},Ce.prototype.eventNames=function(){return Array.from(this.events.keys())},Ce.prototype.getMaxListeners=function(){return this.maxListeners||Ce.defaultMaxListeners},Ce.prototype.listenerCount=function(e){return this.events.has(e)?this.events.get(e).length:0},Ce.prototype._listeners=function(e,i,t){if(!e.events.has(i))return[];var o=e.events.get(i);return t?this.unwrapListeners(o):o.slice(0)},Ce.prototype.unwrapListeners=function(e){for(var i=new Array(e.length),t=0;t<e.length;t++)i[t]=e[t].listener||e[t];return i},Ce.prototype.listeners=function(e){return this._listeners(this,e,!0)},Ce.prototype.rawListeners=function(e){return this._listeners(this,e,!1)},Ce.prototype.off=function(e,i){return this.removeListener(e,i)},Ce.prototype.on=function(e,i){return this.addListener(e,i)},Ce.prototype.once=function(e,i){var t=this.onceWrap(e,i);return this.on(e,t),this},Ce.prototype.onceWrap=function(e,i){function t(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.context.removeListener(this.eventName,this.rawListener),this.listener.apply(this.context,e)}var o={eventName:e,listener:i,rawListener:t,context:this},r=t.bind(o);return(o.rawListener=r).listener=i,r},Ce.prototype.prependListener=function(e,i){return this._addListener(e,i,!0)},Ce.prototype.prependOnceListener=function(e,i){var t=this.onceWrap(e,i);return this.prependListener(e,t),this},Ce.prototype.removeAllListeners=function(e){var i=this;if(void 0===this.events)return this;if(this.events.has(e)){var t=this.events.get(e).slice();this.events.delete(e);for(var o=0,r=t;o<r.length;o++){var l=r[o];this.emit("removeListener",e,l)}}else this.eventNames().map(function(e){i.removeAllListeners(e)});return this},Ce.prototype.removeListener=function(e,i){if(this.events.has(e)){var t=this.events.get(e);-1!==t.indexOf(i)&&(t.splice(t.indexOf(i),1),this.emit("removeListener",e,i),0===t.length&&this.events.delete(e))}return this},Ce.prototype.setMaxListeners=function(e){return this.maxListeners=e,this},Ce.defaultMaxListeners=50,Ce);function Ce(){this.events=new Map}var Le,Se,Me,_e,Ee=(Ae.maploaded="maploaded",Ae.zoomchanged="zoomchanged",Ae.extentchanged="extentchanged",Ae.centerchanged="centerchanged",Ae.blur="blur",Ae.click="click",Ae.doubleclick="doubleclick",Ae.drag="drag",Ae.focus="focus",Ae.hold="hold",Ae.keydown="key-down",Ae.keyup="key-up",Ae.mousewheel="mouse-wheel",Ae.pointerdown="pointer-down",Ae.pointerenter="pointer-enter",Ae.pointerleave="pointer-leave",Ae.pointermove="pointer-move",Ae.pointerup="pointer-up",Ae.resize="pointer-up",Ae.popupvisible="popup-visible",Ae);function Ae(){}(Se=Le=Le||{}).noCache="no-cache",Se.default="default",Se.reload="reload",Se.forceCache="force-cache",Se.onlyIfCached="only-if-cached",Se.cache="cache",(_e=Me=Me||{}).noCors="no-cors",_e.sameOrigin="same-origin",_e.cors="cors";var Ie,Te,Re=(Ie=function(e,i){return(Ie=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}Ie(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)}),Oe=function(e,a,n,s){return new(n=n||Promise)(function(t,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function r(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var i;e.done?t(e.value):((i=e.value)instanceof n?i:new n(function(e){e(i)})).then(o,r)}l((s=s.apply(e,a||[])).next())})},Pe=function(t,o){var r,l,a,e,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function i(i){return function(e){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,l&&(a=2&i[0]?l.return:i[0]?l.throw||((a=l.return)&&a.call(l),0):l.next)&&!(a=a.call(l,i[1])).done)return a;switch(l=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,l=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!(a=0<(a=n.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){n=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){n.label=i[1];break}if(6===i[0]&&n.label<a[1]){n.label=a[1],a=i;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(i);break}a[2]&&n.ops.pop(),n.trys.pop();continue}i=o.call(t,n)}catch(e){i=[6,e],l=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,e])}}},De=(Re(je,Te=ke),je.prototype.setlayerRenderer=function(e,i){var t=this.view.map.findLayerById(e);t&&(t.renderer=i)},je.prototype.addLayer=function(e){!function(w,g,x){ve(this,void 0,void 0,function(){return fe(this,function(e){return be(["esri/layers/TileLayer","esri/layers/SceneLayer","esri/layers/FeatureLayer","esri/layers/MapImageLayer","esri/layers/SHCTiledMapServiceLayer","esri/layers/SHCDMapImageLayer","esri/layers/GraphicsLayer","esri/geometry/Extent","esri/geometry/SpatialReference"]).then(function(e){var i=e[0],t=e[1],o=e[2],r=e[3],l=e[4],a=e[5],n=e[6],s=e[7],p=e[8];switch(w.layerType){case"TileLayer":var c=new i({url:w.layerUrl,id:w.layerId,visible:void 0===w.layerVisible||w.layerVisible,opacity:void 0!==w.layerOpacity?w.layerOpacity:1,title:w.layerTitle});w.layerMaxScale&&(c.maxScale=w.layerMaxScale),w.layerMinScale&&(c.minScale=w.layerMinScale);break;case"FeatureLayer":var u=new o({url:w.layerUrl,id:w.layerId,visible:void 0===w.layerVisible||w.layerVisible,opacity:void 0!==w.layerOpacity?w.layerOpacity:1,title:w.layerTitle,popupEnabled:void 0===w.layerPopupEnabled||w.layerPopupEnabled});w.layerPopupTemplate&&(u.popupTemplate=w.layerPopupTemplate),w.layerRenderer&&(u.renderer=w.layerRenderer),w.layerMaxScale&&(u.maxScale=w.layerMaxScale),w.layerMinScale&&(u.minScale=w.layerMinScale),w.layerLabelingInfo&&(u.labelingInfo=w.layerLabelingInfo),w.layerLabelsVisible&&(u.labelsVisible=w.layerLabelsVisible),w.layerelevationInfo&&(u.elevationInfo=w.layerelevationInfo),w.layerdefinitionExpression&&(u.layerdefinitionExpression=w.layerdefinitionExpression),g.map.add(u);break;case"SceneLayer":var d=new t({url:w.layerUrl,id:w.layerId,visible:void 0===w.layerVisible||w.layerVisible,opacity:void 0!==w.layerOpacity?w.layerOpacity:1,title:w.layerTitle,popupEnabled:void 0===w.layerPopupEnabled||w.layerPopupEnabled});w.layerPopupTemplate&&(d.popupTemplate=w.layerPopupTemplate),w.layerRenderer&&(d.renderer=w.layerRenderer),w.layerMaxScale&&(d.maxScale=w.layerMaxScale),w.layerMinScale&&(d.minScale=w.layerMinScale),w.layerelevationInfo&&(d.elevationInfo=w.layerelevationInfo),w.layerdefinitionExpression&&(d.layerdefinitionExpression=w.layerdefinitionExpression),g.map.add(d);break;case"MapImageLayer":var y=new r({url:w.layerUrl,id:w.layerId,visible:void 0===w.layerVisible||w.layerVisible,opacity:void 0!==w.layerOpacity?w.layerOpacity:1,title:w.layerTitle});w.layerMaxScale&&(y.maxScale=w.layerMaxScale),w.layerMinScale&&(y.minScale=w.layerMinScale),w.layerSublayers&&(y.sublayers=w.layerSublayers),g.map.add(y);break;case"SHCDMapImageLayer":var h=new r({url:w.layerUrl,id:w.layerId+"_legend",title:w.layerTitle,visible:!1,opacity:void 0!==w.layerOpacity?w.layerOpacity:1});g.map.add(h);var b=new s({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:p.WebMercator}),v=new a({url:w.layerUrl,fullExtent:b,opacity:void 0!==w.layerOpacity?w.layerOpacity:1,title:w.layerTitle,id:w.layerId,tileUrl:$.bujianurl,visible:void 0===w.layerVisible||w.layerVisible,legendEnabled:!1,sublayers:w.layerSublayers,dLayer:h});g.map.add(v);break;case"SHCTiledMapServiceLayer":var f=new s({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:p.WebMercator});!0===w.isToken?g.map.add(new l({url:w.layerUrl,token:x,fullExtent:f,title:w.layerTitle,opacity:void 0!==w.layerOpacity?w.layerOpacity:1,id:w.layerId,visible:void 0===w.layerVisible||w.layerVisible})):g.map.add(new l({url:w.layerUrl,fullExtent:f,opacity:void 0!==w.layerOpacity?w.layerOpacity:1,title:w.layerTitle,id:w.layerId,visible:void 0===w.layerVisible||w.layerVisible}));break;case"GraphicsLayer":var m=new n({id:w.layerId,visible:void 0===w.layerVisible||w.layerVisible,opacity:void 0!==w.layerOpacity?w.layerOpacity:1,title:w.layerTitle});w.layerMaxScale&&(m.maxScale=w.layerMaxScale),w.layerMinScale&&(m.minScale=w.layerMinScale),w.layerelevationInfo&&(m.elevationInfo=w.layerelevationInfo),g.map.add(m)}}).catch(function(e){console.error(e)}),[2]})})}(e,this.view,this.maptoken)},je.prototype.removeLayer=function(e){var i=this.view.map.findLayerById(e);i&&this.view.map.remove(i)},je.prototype.getZoom=function(){if(this.view)return this.view.zoom},je.prototype.setZoom=function(e){this.view&&(this.view.zoom=e)},je.prototype.panTo=function(t){var o=this;this.view&&be(["esri/geometry/Point"]).then(function(e){var i=new e[0]({x:t[0],y:t[1],z:void 0!==t[2]?t[2]:0,spatialReference:o.view.spatialReference});o.view.center=i}).catch(function(e){console.error(e)})},je.prototype.panBy=function(e,i){if(this.view){var t=this.view.center,o=this.view.toScreen(t);this.view.center=this.view.toMap({x:o.x+e,y:o.y+i})}},je.prototype.getBounds=function(){if(this.view){var e={};return e.southwest=[this.view.extent.xmin.toFixed(6),this.view.extent.ymin.toFixed(6)],"3D"===this.viewMode&&void 0!==this.view.extent.zmin&&e.southwest.push(this.view.extent.zmin.toFixed(6)),e.northeast=[this.view.extent.xmax.toFixed(6),this.view.extent.ymax.toFixed(6)],"3D"===this.viewMode&&void 0!==this.view.extent.zmax&&e.northeast.push(this.view.extent.zmax.toFixed(6)),e}},je.prototype.setBounds=function(o){var r=this;this.view&&be(["esri/geometry/Extent","esri/geometry/SpatialReference"]).then(function(e){var i=e[0],t=(e[1],new i({xmin:o.xmin,ymin:o.ymin,xmax:o.xmax,zmax:o.ymax,spatialReference:r.view.spatialReference}));"3D"===r.viewMode&&void 0!==o.zmin&&void 0!==o.zmax&&(t.zmin=o.zmin,t.zmax=o.zmax),r.view.extent=t}).catch(function(e){console.error(e)})},je.prototype.setCenter=function(r,l,a){return Oe(this,void 0,void 0,function(){var i,t,o;return Pe(this,function(e){switch(e.label){case 0:return this.view?[4,be(["esri/geometry/Point","esri/geometry/SpatialReference"])]:[3,2];case 1:i=e.sent(),t=i[0],i[1],o=null,o="2D"===this.viewMode?new t({x:r,y:l,spatialReference:this.view.spatialReference}):new t({x:r,y:l,z:void 0!==a?a:0,spatialReference:this.view.spatialReference}),this.view.center=o,e.label=2;case 2:return[2]}})})},je.prototype.setZoomAndCenter=function(r,l){return Oe(this,void 0,void 0,function(){var i,t,o;return Pe(this,function(e){switch(e.label){case 0:return this.view?[4,be(["esri/geometry/Point","esri/geometry/SpatialReference"])]:[3,2];case 1:i=e.sent(),t=i[0],i[1],o=null,"2D"===this.viewMode?(this.view.zoom=r,o=new t({x:l[0],y:l[1],spatialReference:this.view.spatialReference}),this.view.center=o):(o=new t({x:l[0],y:l[1],z:void 0!==l[2]?l[2]:0,spatialReference:this.view.spatialReference}),this.view.goTo({center:o,zoom:r,tilt:this.view.camera.tilt,heading:this.view.camera.heading})),e.label=2;case 2:return[2]}})})},je.prototype.getCenter=function(){if(this.view){var e=[];return e.push(this.view.center.x.toFixed(6)),e.push(this.view.center.y.toFixed(6)),"3D"===this.viewMode&&e.push(this.view.center.z.toFixed(6)),e}},je.prototype.getScale=function(){if(this.view)return this.view.scale},je.prototype.setRotation=function(e){this.view&&("2D"===this.viewMode?this.view.rotation=e:this.view.goTo({center:this.view.center,zoom:this.view.zoom,tilt:this.view.camera.tilt,heading:e}))},je.prototype.setPitch=function(e){this.view&&"3D"===this.viewMode&&this.view.goTo({center:this.view.center,zoom:this.view.zoom,tilt:e,heading:this.view.camera.heading})},je.prototype.getPitch=function(){if(this.view&&"3D"===this.viewMode)return this.view.camera.tilt},je.prototype.zoomIn=function(){this.view&&("3D"===this.viewMode?this.view.zoom+1>=this.zooms[0]&&this.view.zoom+1<=this.zooms[1]&&this.view.goTo({center:this.view.center,zoom:this.view.zoom+1,tilt:this.view.camera.tilt,heading:this.view.camera.heading}):this.view.goTo({center:this.view.center,zoom:this.view.zoom+1}))},je.prototype.zoomOut=function(){this.view&&("3D"===this.viewMode?this.view.zoom-1>=this.zooms[0]&&this.view.zoom-1<=this.zooms[1]&&this.view.goTo({center:this.view.center,zoom:this.view.zoom-1,tilt:this.view.camera.tilt,heading:this.view.camera.heading}):this.view.goTo({center:this.view.center,zoom:this.view.zoom-1}))},je.prototype.setMapStyle=function(e){var t=this;if(this.view){switch(e){case"smap://styles/light":this.view.map.basemap.id="basemap_zw";break;case"smap://styles/dark":this.view.map.basemap.id="basemap_as";break;case"smap://styles/image":this.view.map.basemap.id="basemap_air";break;default:return}if(this.view.map.basemap.baseLayers.items.forEach(function(e){e.id===t.view.map.basemap.id?e.visible=!0:e.visible=!1}),"2D"===this.viewMode)return;["model_white_zw","model_air_real","model_white_as"].forEach(function(e){var i=t.view.map.findLayerById(e);!1===t.showBuildingBlock?i.visible=!1:i&&("basemap_zw"===t.view.map.basemap.id?i.visible="model_white_zw"===e:"basemap_as"===t.view.map.basemap.id?i.visible="model_white_as"===e:"basemap_air"===t.view.map.basemap.id&&(i.visible="model_air_real"===e))})}},je.prototype.getMapStyle=function(){if(this.view)switch(this.view.map.basemap.id){case"basemap_zw":return"smap://styles/light";case"basemap_as":return"smap://styles/dark";case"basemap_air":return"smap://styles/image"}},je.prototype.showBuilding=function(e){var t=this;null!==this.view&&"2D"!==this.viewMode&&(this.showBuildingBlock=!!e,["model_white_zw","model_air_real","model_white_as"].forEach(function(e){var i=t.view.map.findLayerById(e);!1===t.showBuildingBlock?i.visible=!1:i&&("basemap_zw"===t.view.map.basemap.id?i.visible="model_white_zw"===e:"basemap_as"===t.view.map.basemap.id?i.visible="model_white_as"===e:"basemap_air"===t.view.map.basemap.id&&(i.visible="model_air_real"===e))}))},je.prototype.addControl=function(l){var a=this;if("toc"===l.controlName.toLowerCase())be(["esri/widgets/LayerList","esri/widgets/Expand"]).then(function(e){var i=e[0],t=e[1],o=new i({container:document.createElement("div"),id:"maplayerlist",view:a.view});if(l.collapse){var r=new t({id:"layerlistonly",view:a.view,content:o.domNode,expandIconClass:"esri-icon-layers",expandTooltip:"专题图层框",group:"top-left"});a.mapControl.push([l.controlName,r]),l.visible&&a.view.ui.add(r,l.position)}else a.mapControl.push([l.controlName,o]),a.view.ui.add(o,l.position)}).catch(function(e){console.error(e)});else if("zoom"===l.controlName.toLowerCase())be(["esri/widgets/Zoom"]).then(function(e){var i=new e[0]({view:a.view});a.mapControl.push([l.controlName,i]),l.visible&&a.view.ui.add(i,l.position)}).catch(function(e){console.error(e)});else if("compass"===l.controlName.toLowerCase())be(["esri/widgets/Compass"]).then(function(e){var i=new e[0]({view:a.view});a.mapControl.push([l.controlName,i]),l.visible&&a.view.ui.add(i,l.position)}).catch(function(e){console.error(e)});else if("home"===l.controlName.toLowerCase())be(["esri/widgets/Home"]).then(function(e){var i=new e[0]({view:a.view});a.mapControl.push([l.controlName,i]),l.visible&&a.view.ui.add(i,l.position)}).catch(function(e){console.error(e)});else if("fullscreen"===l.controlName.toLowerCase())be(["esri/widgets/Fullscreen"]).then(function(e){var i=new e[0]({view:a.view});a.mapControl.push([l.controlName,i]),l.visible&&a.view.ui.add(i,l.position)}).catch(function(e){console.error(e)});else if("undergroundswitch"===l.controlName.toLowerCase()){if("2D"===this.viewMode)return;be(["esri/widgets/AboveBelowModeSwitch"]).then(function(e){var i=new e[0]({view:a.view});a.mapControl.push([l.controlName,i]),l.visible&&a.view.ui.add(i,l.position)}).catch(function(e){console.error(e)})}else if("measurearea"===l.controlName.toLowerCase())"2D"===this.viewMode?be(["esri/widgets/AreaMeasureMentButton2D"]).then(function(e){var i=new e[0]({view:a.view});a.mapControl.push([l.controlName,i]),l.visible&&a.view.ui.add(i,l.position)}).catch(function(e){console.error(e)}):be(["esri/widgets/AreaMeasureMentButton3D"]).then(function(e){var i=new e[0]({view:a.view});a.mapControl.push([l.controlName,i]),l.visible&&a.view.ui.add(i,l.position)}).catch(function(e){console.error(e)});else if("measureline"===l.controlName.toLowerCase())"2D"===this.viewMode?be(["esri/widgets/DistanceMeasureMentButton2D"]).then(function(e){var i=new e[0]({view:a.view});a.mapControl.push([l.controlName,i]),l.visible&&a.view.ui.add(i,l.position)}).catch(function(e){console.error(e)}):be(["esri/widgets/DistanceMeasureMentButton3D"]).then(function(e){var i=new e[0]({view:a.view});a.mapControl.push([l.controlName,i]),l.visible&&a.view.ui.add(i,l.position)}).catch(function(e){console.error(e)});else if("basemaptoggle"===l.controlName.toLowerCase())"2D"===this.viewMode?be(["esri/widgets/BaseMapSwitchButton2D"]).then(function(e){var i=new e[0]({view:a.view});a.mapControl.push([l.controlName,i]),l.visible&&a.view.ui.add(i,l.position)}).catch(function(e){console.error(e)}):be(["esri/widgets/BaseMapSwitchButton3D"]).then(function(e){var i=new e[0]({view:a.view,showBuildingBlock:a.showBuildingBlock});a.mapControl.push([l.controlName,i]),l.visible&&a.view.ui.add(i,l.position)}).catch(function(e){console.error(e)});else if("basemapgallery"===l.controlName.toLowerCase())be(["esri/widgets/BMapGallery_Control"]).then(function(e){var i=new e[0]({view:a.view,showBuildingBlock:a.showBuildingBlock});a.mapControl.push([l.controlName,i]),l.visible&&a.view.ui.add(i,l.position)}).catch(function(e){console.error(e)});else if("basemapgalleryexpand"===l.controlName.toLowerCase())be(["esri/widgets/BMapGallery_Expand"]).then(function(e){var i=new e[0]({view:a.view,showBuildingBlock:a.showBuildingBlock});a.mapControl.push([l.controlName,i]),l.visible&&a.view.ui.add(i,l.position)}).catch(function(e){console.error(e)});else if("bimfilter"===l.controlName.toLowerCase()){if("2D"===this.viewMode)return;be(["esri/widgets/BuildingSencelayerFilter"]).then(function(e){var i=new e[0]({view:a.view,layerid:l.layerid});a.mapControl.push([l.controlName,i]),l.visible&&a.view.ui.add(i,l.position)}).catch(function(e){console.error(e)})}},je.prototype.removeControl=function(o){var r=this;this.mapControl.forEach(function(e,i,t){e[0]===o.controlName&&(r.view.ui.remove(e[1]),r.mapControl.slice(i,1))})},je.prototype.enableThroughGround=function(e){null!==this.view&&"2D"!==this.viewMode&&(e?(this.view.map.ground.surfaceColor="#fff",this.view.map.ground.opacity=0,this.view.map.ground.navigationConstraint={type:"none"}):(this.view.map.ground.surfaceColor=null,this.view.map.ground.opacity=1,this.view.map.ground.navigationConstraint={type:"stay-above"}))},je.prototype.add=function(w){var g=this;be(["esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){var b=e[0],v=e[1],f=(e[2],e[3]),m=e[4];if(w instanceof Array)w.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var i=void 0;i="2D"===g.viewMode?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]};var t=e.attributes;t.uuid=e.uuid;var o=new b({geometry:new v({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:g.view.spatialReference}),symbol:i,attributes:t});if(g.mapoverlayers.push(["smap-default",e.uuid,o]),g.view.graphics.add(o),e.label.visible){var r=new b({geometry:new v({x:"3D"===g.viewMode?e.position[0]+e.label.xoffset:e.position[0],y:"3D"===g.viewMode?e.position[1]+e.label.yoffset:e.position[1],z:"3D"===g.viewMode?e.position[2]+e.label.zoffset:e.position[2],spatialReference:g.view.spatialReference}),symbol:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},attributes:t});g.view.graphics.add(r),g.mapoverlayers.push(["smap-default",e.uuid,r])}}else if("polyline"===e.overlaytype.toLowerCase()){var l={type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin},a=[];e.path.forEach(function(e){a.push([e.X,e.Y,e.Z])});var n=new f({hasZ:!1,hasM:!1,paths:a,spatialReference:g.view.spatialReference}),s=e.attributes;s.uuid=e.uuid;var p=new b({geometry:n,symbol:l,attributes:s});g.mapoverlayers.push(["smap-default",e.uuid,p]),g.view.graphics.add(p),e.label.visible&&(r=new b({geometry:p.geometry.extent.center,symbol:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},attributes:s}),g.view.graphics.add(r),g.mapoverlayers.push(["smap-default",e.uuid,r]))}else if("polygon"===e.overlaytype.toLowerCase()){var c=void 0;c="simple"===e.symboltype?{type:"simple-fill",color:e.fillColor,style:e.style,outline:{color:e.strokeColor,width:e.strokeWeight,style:e.strokestyle}}:{type:"picture-fill",url:e.url,width:e.picwidth,height:e.picheight,outline:{style:e.strokestyle,color:e.strokeColor,width:e.strokeWeight}};var u=[];e.paths.forEach(function(e){u.push([e.X,e.Y,e.Z])});var d=new m({hasZ:!0,hasM:!0,rings:u,spatialReference:g.view.spatialReference}),y=e.attributes;y.uuid=e.uuid;var h=new b({geometry:d,symbol:c,attributes:y});g.mapoverlayers.push(["smap-default",e.uuid,h]),g.view.graphics.add(h),e.label.visible&&(r=new b({geometry:h.geometry.extent.center,symbol:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},attributes:y}),g.view.graphics.add(r),g.mapoverlayers.push(["smap-default",e.uuid,r]))}});else if("group"===w.type)w.overlayers.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var i=void 0;i="2D"===g.viewMode?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]};var t=e.attributes;t.uuid=e.uuid;var o=new b({geometry:new v({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:g.view.spatialReference}),symbol:i,attributes:t});if(g.mapoverlayers.push([w.uuid,e.uuid,o]),g.view.graphics.add(o),e.label.visible){var r=new b({geometry:new v({x:"3D"===g.viewMode?e.position[0]+e.label.xoffset:e.position[0],y:"3D"===g.viewMode?e.position[1]+e.label.yoffset:e.position[1],z:"3D"===g.viewMode?e.position[2]+e.label.zoffset:e.position[2],spatialReference:g.view.spatialReference}),symbol:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},attributes:t});g.view.graphics.add(r),g.mapoverlayers.push([w.uuid,e.uuid,r])}}else if("polyline"===e.overlaytype.toLowerCase()){var l={type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin},a=[];e.path.forEach(function(e){a.push([e.X,e.Y,e.Z])});var n=new f({hasZ:!1,hasM:!1,paths:a,spatialReference:g.view.spatialReference}),s=e.attributes;s.uuid=e.uuid;var p=new b({geometry:n,symbol:l,attributes:s});g.mapoverlayers.push([w.uuid,e.uuid,p]),g.view.graphics.add(p),e.label.visible&&(r=new b({geometry:p.geometry.extent.center,symbol:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},attributes:s}),g.view.graphics.add(r),g.mapoverlayers.push([w.uuid,e.uuid,r]))}else if("polygon"===e.overlaytype.toLowerCase()){var c=void 0;c="simple"===e.symboltype?{type:"simple-fill",color:e.fillColor,style:e.style,outline:{color:e.strokeColor,width:e.strokeWeight,style:e.strokestyle}}:{type:"picture-fill",url:e.url,width:e.picwidth,height:e.picheight,outline:{style:e.strokestyle,color:e.strokeColor,width:e.strokeWeight}};var u=[];e.paths.forEach(function(e){u.push([e.X,e.Y,e.Z])});var d=e.attributes;d.uuid=e.uuid;var y=new m({hasZ:!0,hasM:!0,rings:u,spatialReference:g.view.spatialReference}),h=new b({geometry:y,symbol:c,attributes:d});g.mapoverlayers.push([w.uuid,e.uuid,h]),g.view.graphics.add(h),e.label.visible&&(r=new b({geometry:h.geometry.extent.center,symbol:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},attributes:d}),g.view.graphics.add(r),g.mapoverlayers.push([w.uuid,e.uuid,r]))}});else if("element"===w.type)if("marker"===w.overlaytype.toLowerCase()){var i=void 0;i="2D"===g.viewMode?{type:"picture-marker",url:w.icon.image,width:w.icon.size.width,height:w.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:w.icon.size.width,resource:{href:w.icon.image}}]};var t=w.attributes;t.uuid=w.uuid;var o=new b({geometry:new v({x:w.position[0],y:w.position[1],z:void 0===w.position[2]?0:w.position[2],spatialReference:g.view.spatialReference}),symbol:i,attributes:t});if(g.mapoverlayers.push(["smap-default",w.uuid,o]),g.view.graphics.add(o),w.label.visible){var r=new b({geometry:new v({x:"3D"===g.viewMode?w.position[0]+w.label.xoffset:w.position[0],y:"3D"===g.viewMode?w.position[1]+w.label.yoffset:w.position[1],z:"3D"===g.viewMode?w.position[2]+w.label.zoffset:w.position[2],spatialReference:g.view.spatialReference}),symbol:{type:w.label.type,text:w.label.text,color:w.label.color,angle:w.label.angle,backgroundColor:w.label.backgroundColor,borderLineColor:w.label.borderLineColor,borderLineSize:w.label.borderLineSize,kerning:w.label.kerning,lineHeight:w.label.lineHeight,lineWidth:w.label.lineWidth,rotated:w.label.rotated,haloColor:w.label.haloColor,haloSize:w.label.haloSize,xoffset:w.label.xoffset,yoffset:w.label.yoffset,verticalAlignment:w.label.verticalAlignment,horizontalAlignment:w.label.horizontalAlignment,font:{size:w.label.size,family:"Josefin Slab",weight:w.label.weight}},attributes:t});g.view.graphics.add(r),g.mapoverlayers.push(["smap-default",w.uuid,r])}}else if("polyline"===w.overlaytype.toLowerCase()){var l={type:"simple-line",color:w.strokeColor,style:w.style,width:w.width,cap:w.cap,join:w.lineJoin},a=[];w.path.forEach(function(e){a.push([e.X,e.Y,e.Z])});var n=new f({hasZ:!1,hasM:!1,paths:a,spatialReference:g.view.spatialReference}),s=w.attributes;s.uuid=w.uuid;var p=new b({geometry:n,symbol:l,attributes:s});g.mapoverlayers.push(["smap-default",w.uuid,p]),g.view.graphics.add(p),w.label.visible&&(r=new b({geometry:p.geometry.extent.center,symbol:{type:w.label.type,text:w.label.text,color:w.label.color,angle:w.label.angle,backgroundColor:w.label.backgroundColor,borderLineColor:w.label.borderLineColor,borderLineSize:w.label.borderLineSize,kerning:w.label.kerning,lineHeight:w.label.lineHeight,lineWidth:w.label.lineWidth,rotated:w.label.rotated,haloColor:w.label.haloColor,haloSize:w.label.haloSize,xoffset:w.label.xoffset,yoffset:w.label.yoffset,verticalAlignment:w.label.verticalAlignment,horizontalAlignment:w.label.horizontalAlignment,font:{size:w.label.size,family:"Josefin Slab",weight:w.label.weight}},attributes:s}),g.view.graphics.add(r),g.mapoverlayers.push(["smap-default",w.uuid,r]))}else if("polygon"===w.overlaytype.toLowerCase()){var c=void 0;c="simple"===w.symboltype?{type:"simple-fill",color:w.fillColor,style:w.style,outline:{color:w.strokeColor,width:w.strokeWeight,style:w.strokestyle}}:{type:"picture-fill",url:w.url,width:w.picwidth,height:w.picheight,outline:{style:w.strokestyle,color:w.strokeColor,width:w.strokeWeight}};var u=[];w.paths.forEach(function(e){u.push([e.X,e.Y,e.Z])});var d=w.attributes;d.uuid=w.uuid;var y=new m({hasZ:!0,hasM:!0,rings:u,spatialReference:g.view.spatialReference}),h=new b({geometry:y,symbol:c,attributes:d});g.mapoverlayers.push(["smap-default",w.uuid,h]),g.view.graphics.add(h),w.label.visible&&(r=new b({geometry:h.geometry.extent.center,symbol:{type:w.label.type,text:w.label.text,color:w.label.color,angle:w.label.angle,backgroundColor:w.label.backgroundColor,borderLineColor:w.label.borderLineColor,borderLineSize:w.label.borderLineSize,kerning:w.label.kerning,lineHeight:w.label.lineHeight,lineWidth:w.label.lineWidth,rotated:w.label.rotated,haloColor:w.label.haloColor,haloSize:w.label.haloSize,xoffset:w.label.xoffset,yoffset:w.label.yoffset,verticalAlignment:w.label.verticalAlignment,horizontalAlignment:w.label.horizontalAlignment,font:{size:w.label.size,family:"Josefin Slab",weight:w.label.weight}},attributes:d}),g.view.graphics.add(r),g.mapoverlayers.push(["smap-default",w.uuid,r]))}}).catch(function(e){console.error(e)})},je.prototype.remove=function(i){var t=this;i instanceof Array?i.forEach(function(i){t.mapoverlayers.filter(function(e){return e[1]===i.uuid}).forEach(function(e){t.view.graphics.remove(e[2])}),t.mapoverlayers=t.mapoverlayers.filter(function(e){return e[1]!==i.uuid})}):"group"===i.type?(this.mapoverlayers.filter(function(e){return e[0]===i.uuid}).forEach(function(e){t.view.graphics.remove(e[2])}),this.mapoverlayers=this.mapoverlayers.filter(function(e){return e[0]!==i.uuid})):"element"===i.type&&(this.mapoverlayers.filter(function(e){return e[1]===i.uuid}).forEach(function(e){t.view.graphics.remove(e[2])}),this.mapoverlayers=this.mapoverlayers.filter(function(e){return e[1]!==i.uuid}))},je.prototype.update=function(w){var g=this;be(["esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){var b=e[0],v=e[1],f=(e[2],e[3]),m=e[4];if(w instanceof Array)w.forEach(function(i){if(g.mapoverlayers.filter(function(e){return e[1]===i.uuid}).forEach(function(e){g.view.graphics.remove(e[2])}),g.mapoverlayers=g.mapoverlayers.filter(function(e){return e[1]!==i.uuid}),"marker"===i.overlaytype.toLowerCase()){var e=void 0;e="2D"===g.viewMode?{type:"picture-marker",url:i.icon.image,width:i.icon.size.width,height:i.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:i.icon.size.width,resource:{href:i.icon.image}}]};var t=i.attributes;t.uuid=i.uuid;var o=new b({geometry:new v({x:i.position[0],y:i.position[1],z:void 0===i.position[2]?0:i.position[2],spatialReference:g.view.spatialReference}),symbol:e,attributes:t});if(g.mapoverlayers.push(["smap-default",i.uuid,o]),g.view.graphics.add(o),i.label.visible){var r=new b({geometry:new v({x:"3D"===g.viewMode?i.position[0]+i.label.xoffset:i.position[0],y:"3D"===g.viewMode?i.position[1]+i.label.yoffset:i.position[1],z:"3D"===g.viewMode?i.position[2]+i.label.zoffset:i.position[2],spatialReference:g.view.spatialReference}),symbol:{type:i.label.type,text:i.label.text,color:i.label.color,angle:i.label.angle,backgroundColor:i.label.backgroundColor,borderLineColor:i.label.borderLineColor,borderLineSize:i.label.borderLineSize,kerning:i.label.kerning,lineHeight:i.label.lineHeight,lineWidth:i.label.lineWidth,rotated:i.label.rotated,haloColor:i.label.haloColor,haloSize:i.label.haloSize,xoffset:i.label.xoffset,yoffset:i.label.yoffset,verticalAlignment:i.label.verticalAlignment,horizontalAlignment:i.label.horizontalAlignment,font:{size:i.label.size,family:"Josefin Slab",weight:i.label.weight}},attributes:t});g.view.graphics.add(r),g.mapoverlayers.push(["smap-default",i.uuid,r])}}else if("polyline"===i.overlaytype.toLowerCase()){var l={type:"simple-line",color:i.strokeColor,style:i.style,width:i.width,cap:i.cap,join:i.lineJoin},a=[];i.path.forEach(function(e){a.push([e.X,e.Y,e.Z])});var n=new f({hasZ:!1,hasM:!1,paths:a,spatialReference:g.view.spatialReference}),s=i.attributes;s.uuid=i.uuid;var p=new b({geometry:n,symbol:l,attributes:s});g.mapoverlayers.push(["smap-default",i.uuid,p]),g.view.graphics.add(p),i.label.visible&&(r=new b({geometry:p.geometry.extent.center,symbol:{type:i.label.type,text:i.label.text,color:i.label.color,angle:i.label.angle,backgroundColor:i.label.backgroundColor,borderLineColor:i.label.borderLineColor,borderLineSize:i.label.borderLineSize,kerning:i.label.kerning,lineHeight:i.label.lineHeight,lineWidth:i.label.lineWidth,rotated:i.label.rotated,haloColor:i.label.haloColor,haloSize:i.label.haloSize,xoffset:i.label.xoffset,yoffset:i.label.yoffset,verticalAlignment:i.label.verticalAlignment,horizontalAlignment:i.label.horizontalAlignment,font:{size:i.label.size,family:"Josefin Slab",weight:i.label.weight}},attributes:s}),g.view.graphics.add(r),g.mapoverlayers.push(["smap-default",i.uuid,r]))}else if("polygon"===i.overlaytype.toLowerCase()){var c=void 0;c="simple"===i.symboltype?{type:"simple-fill",color:i.fillColor,style:i.style,outline:{color:i.strokeColor,width:i.strokeWeight,style:i.strokestyle}}:{type:"picture-fill",url:i.url,width:i.picwidth,height:i.picheight,outline:{style:i.strokestyle,color:i.strokeColor,width:i.strokeWeight}};var u=[];i.paths.forEach(function(e){u.push([e.X,e.Y,e.Z])});var d=new m({hasZ:!0,hasM:!0,rings:u,spatialReference:g.view.spatialReference}),y=i.attributes;y.uuid=i.uuid;var h=new b({geometry:d,symbol:c,attributes:y});g.mapoverlayers.push(["smap-default",i.uuid,h]),g.view.graphics.add(h),i.label.visible&&(r=new b({geometry:h.geometry.extent.center,symbol:{type:i.label.type,text:i.label.text,color:i.label.color,angle:i.label.angle,backgroundColor:i.label.backgroundColor,borderLineColor:i.label.borderLineColor,borderLineSize:i.label.borderLineSize,kerning:i.label.kerning,lineHeight:i.label.lineHeight,lineWidth:i.label.lineWidth,rotated:i.label.rotated,haloColor:i.label.haloColor,haloSize:i.label.haloSize,xoffset:i.label.xoffset,yoffset:i.label.yoffset,verticalAlignment:i.label.verticalAlignment,horizontalAlignment:i.label.horizontalAlignment,font:{size:i.label.size,family:"Josefin Slab",weight:i.label.weight}},attributes:y}),g.view.graphics.add(r),g.mapoverlayers.push(["smap-default",i.uuid,r]))}});else if("group"===w.type)g.mapoverlayers.filter(function(e){return e[0]===w.uuid}).forEach(function(e){g.view.graphics.remove(e[2])}),g.mapoverlayers=g.mapoverlayers.filter(function(e){return e[0]!==w.uuid}),w.overlayers.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var i=void 0;i="2D"===g.viewMode?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]};var t=e.attributes;t.uuid=e.uuid;var o=new b({geometry:new v({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:g.view.spatialReference}),symbol:i,attributes:t});if(g.mapoverlayers.push([w.uuid,e.uuid,o]),g.view.graphics.add(o),e.label.visible){var r=new b({geometry:new v({x:"3D"===g.viewMode?e.position[0]+e.label.xoffset:e.position[0],y:"3D"===g.viewMode?e.position[1]+e.label.yoffset:e.position[1],z:"3D"===g.viewMode?e.position[2]+e.label.zoffset:e.position[2],spatialReference:g.view.spatialReference}),symbol:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},attributes:t});g.view.graphics.add(r),g.mapoverlayers.push([w.uuid,e.uuid,r])}}else if("polyline"===e.overlaytype.toLowerCase()){var l={type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin},a=[];e.path.forEach(function(e){a.push([e.X,e.Y,e.Z])});var n=new f({hasZ:!1,hasM:!1,paths:a,spatialReference:g.view.spatialReference}),s=e.attributes;s.uuid=e.uuid;var p=new b({geometry:n,symbol:l,attributes:s});g.mapoverlayers.push([w.uuid,e.uuid,p]),g.view.graphics.add(p),e.label.visible&&(r=new b({geometry:p.geometry.extent.center,symbol:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},attributes:s}),g.view.graphics.add(r),g.mapoverlayers.push([w.uuid,e.uuid,r]))}else if("polygon"===e.overlaytype.toLowerCase()){var c=void 0;c="simple"===w.symboltype?{type:"simple-fill",color:w.fillColor,style:w.style,outline:{color:w.strokeColor,width:w.strokeWeight,style:w.strokestyle}}:{type:"picture-fill",url:w.url,width:w.picwidth,height:w.picheight,outline:{style:w.strokestyle,color:w.strokeColor,width:w.strokeWeight}};var u=[];w.paths.forEach(function(e){u.push([e.X,e.Y,e.Z])});var d=e.attributes;d.uuid=e.uuid;var y=new m({hasZ:!0,hasM:!0,rings:u,spatialReference:g.view.spatialReference}),h=new b({geometry:y,symbol:c,attributes:d});g.mapoverlayers.push(["smap-default",w.uuid,h]),g.view.graphics.add(h),w.label.visible&&(r=new b({geometry:h.geometry.extent.center,symbol:{type:w.label.type,text:w.label.text,color:w.label.color,angle:w.label.angle,backgroundColor:w.label.backgroundColor,borderLineColor:w.label.borderLineColor,borderLineSize:w.label.borderLineSize,kerning:w.label.kerning,lineHeight:w.label.lineHeight,lineWidth:w.label.lineWidth,rotated:w.label.rotated,haloColor:w.label.haloColor,haloSize:w.label.haloSize,xoffset:w.label.xoffset,yoffset:w.label.yoffset,verticalAlignment:w.label.verticalAlignment,horizontalAlignment:w.label.horizontalAlignment,font:{size:w.label.size,family:"Josefin Slab",weight:w.label.weight}},attributes:d}),g.view.graphics.add(r),g.mapoverlayers.push(["smap-default",w.uuid,r]))}});else if("element"===w.type)if(g.mapoverlayers.filter(function(e){return e[1]===w.uuid}).forEach(function(e){g.view.graphics.remove(e[2])}),g.mapoverlayers=g.mapoverlayers.filter(function(e){return e[1]!==w.uuid}),"marker"===w.overlaytype.toLowerCase()){var i=void 0;i="2D"===g.viewMode?{type:"picture-marker",url:w.icon.image,width:w.icon.size.width,height:w.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:w.icon.size.width,resource:{href:w.icon.image}}]};var t=w.attributes;t.uuid=w.uuid;var o=new b({geometry:new v({x:w.position[0],y:w.position[1],z:void 0===w.position[2]?0:w.position[2],spatialReference:g.view.spatialReference}),symbol:i,attributes:t});if(g.mapoverlayers.push(["smap-default",w.uuid,o]),g.view.graphics.add(o),w.label.visible){var r=new b({geometry:new v({x:"3D"===g.viewMode?w.position[0]+w.label.xoffset:w.position[0],y:"3D"===g.viewMode?w.position[1]+w.label.yoffset:w.position[1],z:"3D"===g.viewMode?w.position[2]+w.label.zoffset:w.position[2],spatialReference:g.view.spatialReference}),symbol:{type:w.label.type,text:w.label.text,color:w.label.color,angle:w.label.angle,backgroundColor:w.label.backgroundColor,borderLineColor:w.label.borderLineColor,borderLineSize:w.label.borderLineSize,kerning:w.label.kerning,lineHeight:w.label.lineHeight,lineWidth:w.label.lineWidth,rotated:w.label.rotated,haloColor:w.label.haloColor,haloSize:w.label.haloSize,xoffset:w.label.xoffset,yoffset:w.label.yoffset,verticalAlignment:w.label.verticalAlignment,horizontalAlignment:w.label.horizontalAlignment,font:{size:w.label.size,family:"Josefin Slab",weight:w.label.weight}},attributes:t});g.view.graphics.add(r),g.mapoverlayers.push(["smap-default",w.uuid,r])}}else if("polyline"===w.overlaytype.toLowerCase()){var l={type:"simple-line",color:w.strokeColor,style:w.style,width:w.width,cap:w.cap,join:w.lineJoin},a=[];w.path.forEach(function(e){a.push([e.X,e.Y,e.Z])});var n=new f({hasZ:!1,hasM:!1,paths:a,spatialReference:g.view.spatialReference}),s=w.attributes;s.uuid=w.uuid;var p=new b({geometry:n,symbol:l,attributes:s});g.mapoverlayers.push(["smap-default",w.uuid,p]),g.view.graphics.add(p),w.label.visible&&(r=new b({geometry:p.geometry.extent.center,symbol:{type:w.label.type,text:w.label.text,color:w.label.color,angle:w.label.angle,backgroundColor:w.label.backgroundColor,borderLineColor:w.label.borderLineColor,borderLineSize:w.label.borderLineSize,kerning:w.label.kerning,lineHeight:w.label.lineHeight,lineWidth:w.label.lineWidth,rotated:w.label.rotated,haloColor:w.label.haloColor,haloSize:w.label.haloSize,xoffset:w.label.xoffset,yoffset:w.label.yoffset,verticalAlignment:w.label.verticalAlignment,horizontalAlignment:w.label.horizontalAlignment,font:{size:w.label.size,family:"Josefin Slab",weight:w.label.weight}},attributes:s}),g.view.graphics.add(r),g.mapoverlayers.push(["smap-default",w.uuid,r]))}else if("polygon"===w.overlaytype.toLowerCase()){var c=void 0;c="simple"===w.symboltype?{type:"simple-fill",color:w.fillColor,style:w.style,outline:{color:w.strokeColor,width:w.strokeWeight,style:w.strokestyle}}:{type:"picture-fill",url:w.url,width:w.picwidth,height:w.picheight,outline:{style:w.strokestyle,color:w.strokeColor,width:w.strokeWeight}};var u=[];w.paths.forEach(function(e){u.push([e.X,e.Y,e.Z])});var d=new m({hasZ:!0,hasM:!0,rings:u,spatialReference:g.view.spatialReference}),y=w.attributes;y.uuid=w.uuid;var h=new b({geometry:d,symbol:c,attributes:y});g.mapoverlayers.push(["smap-default",w.uuid,h]),g.view.graphics.add(h),w.label.visible&&(r=new b({geometry:h.geometry.extent.center,symbol:{type:w.label.type,text:w.label.text,color:w.label.color,angle:w.label.angle,backgroundColor:w.label.backgroundColor,borderLineColor:w.label.borderLineColor,borderLineSize:w.label.borderLineSize,kerning:w.label.kerning,lineHeight:w.label.lineHeight,lineWidth:w.label.lineWidth,rotated:w.label.rotated,haloColor:w.label.haloColor,haloSize:w.label.haloSize,xoffset:w.label.xoffset,yoffset:w.label.yoffset,verticalAlignment:w.label.verticalAlignment,horizontalAlignment:w.label.horizontalAlignment,font:{size:w.label.size,family:"Josefin Slab",weight:w.label.weight}},attributes:y}),g.view.graphics.add(r),g.mapoverlayers.push(["smap-default",w.uuid,r]))}})},je.prototype.addfeature=function(b){var v=this;be(["esri/layers/FeatureLayer","esri/layers/support/LabelClass","esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){var s=e[0],p=e[1],c=e[2],u=e[3];if(e[4],e[5],e[6],b instanceof Array)b.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var i=void 0;i="3D"===v.viewMode?{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]}}:{type:"simple",symbol:{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}};var t=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}];Object.keys(e.attributes).forEach(function(e){t.push({name:e,alias:e,type:"string"})});var o=new s({id:e.uuid,title:e.uuid,objectIdField:"OBJECTID",geometryType:"point",renderer:i,screenSizePerspectiveEnabled:!0,popupEnabled:!1,popupTemplate:!1,fields:t,source:[],spatialReference:v.view.spatialReference}),r=e.attributes;r.uuid=e.uuid;var l=new c({geometry:new u({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:v.view.spatialReference}),attributes:r});if(o.source.add(l),v.view.map.add(o),v.mapoverlayersflayer.push([e.uuid,e.uuid,l]),e.label.visible){var a=void 0;a="2D"===v.viewMode?{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:e.label.color},size:e.label.size,halo:{color:e.label.haloColor,size:e.label.haloSize}}]};var n=new p({labelExpressionInfo:{expression:"$feature.NAME"},symbol:a,labelPlacement:e.label.placement,minScale:e.label.minScale,maxScale:e.label.maxScale});o.labelingInfo=[n]}}});else if("group"===b.type){var i,t=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}];if(t.push({name:"style",alias:"样式",type:"string"}),b.datafiled.forEach(function(e){t.push(e)}),"marker"===b.overlaytype.toLowerCase()){i={type:"unique-value",field:"style",uniqueValueInfos:[]},b.style.forEach(function(e){"3D"===v.viewMode?i.uniqueValueInfos.push({value:e.style,label:e.style,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:e.size.height,resource:{href:e.url}}]}}):i.uniqueValueInfos.push({value:e.style,label:e.style,symbol:{type:"picture-marker",url:e.url,width:e.size.height,height:e.size.height}})});var o=new s({id:b.uuid,title:b.uuid,objectIdField:"OBJECTID",geometryType:"point",renderer:i,screenSizePerspectiveEnabled:"3D"===v.viewMode,popupEnabled:!1,popupTemplate:!1,fields:t,source:[],spatialReference:v.view.spatialReference});if(v.view.map.add(o),b.overlayers.forEach(function(e){e.attributes.uuid=e.uuid;var i=new c({geometry:new u({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:v.view.spatialReference}),attributes:e.attributes});o.source.add(i),v.mapoverlayersflayer.push([b.uuid,e.uuid,i])}),100<o.source.items.length&&null!=b.frreduction&&(o.featureReduction={type:b.frreduction.type,clusterRadius:b.frreduction.clusterRadius}),b.label.visible){var r=void 0;r="2D"===v.viewMode?{type:b.label.type,text:b.label.text,color:b.label.color,angle:b.label.angle,backgroundColor:b.label.backgroundColor,borderLineColor:b.label.borderLineColor,borderLineSize:b.label.borderLineSize,kerning:b.label.kerning,lineHeight:b.label.lineHeight,lineWidth:b.label.lineWidth,rotated:b.label.rotated,haloColor:b.label.haloColor,haloSize:b.label.haloSize,xoffset:b.label.xoffset,yoffset:b.label.yoffset,verticalAlignment:b.label.verticalAlignment,horizontalAlignment:b.label.horizontalAlignment,font:{size:b.label.size,family:"Josefin Slab",weight:b.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:b.label.color},size:b.label.size,halo:{color:b.label.haloColor,size:b.label.haloSize}}]};var l=new p({labelExpressionInfo:{expression:"$feature.NAME"},symbol:r,labelPlacement:b.label.placement,minScale:b.label.minScale,maxScale:b.label.maxScale});o.labelingInfo=[l]}}}else if("element"===b.type&&"marker"===b.overlaytype.toLowerCase()){var a=void 0;a="3D"===v.viewMode?{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:b.icon.size.width,resource:{href:b.icon.image}}]}}:{type:"simple",symbol:{type:"picture-marker",url:b.icon.image,width:b.icon.size.width,height:b.icon.size.height}};var n=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}];Object.keys(b.attributes).forEach(function(e){n.push({name:e,alias:e,type:"string"})});var d=new s({id:b.uuid,title:b.uuid,objectIdField:"OBJECTID",geometryType:"point",renderer:a,screenSizePerspectiveEnabled:!0,popupEnabled:!1,popupTemplate:!1,fields:n,source:[],spatialReference:v.view.spatialReference}),y=b.attributes;y.uuid=b.uuid;var h=new c({geometry:new u({x:b.position[0],y:b.position[1],z:void 0===b.position[2]?0:b.position[2],spatialReference:v.view.spatialReference}),attributes:y});d.source.add(h),v.view.map.add(d),v.mapoverlayersflayer.push([b.uuid,b.uuid,h]),b.label.visible&&(r=void 0,r="2D"===v.viewMode?{type:b.label.type,text:b.label.text,color:b.label.color,angle:b.label.angle,backgroundColor:b.label.backgroundColor,borderLineColor:b.label.borderLineColor,borderLineSize:b.label.borderLineSize,kerning:b.label.kerning,lineHeight:b.label.lineHeight,lineWidth:b.label.lineWidth,rotated:b.label.rotated,haloColor:b.label.haloColor,haloSize:b.label.haloSize,xoffset:b.label.xoffset,yoffset:b.label.yoffset,verticalAlignment:b.label.verticalAlignment,horizontalAlignment:b.label.horizontalAlignment,font:{size:b.label.size,family:"Josefin Slab",weight:b.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:b.label.color},size:b.label.size,halo:{color:b.label.haloColor,size:b.label.haloSize}}]},l=new p({labelExpressionInfo:{expression:"$feature.NAME"},symbol:r,labelPlacement:b.label.placement,minScale:b.label.minScale,maxScale:b.label.maxScale}),d.labelingInfo=[l])}})},je.prototype.updatefeature=function(l){var s=this;be(["esri/layers/FeatureLayer","esri/layers/support/LabelClass","esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){e[0];var a=e[1],n=(e[2],e[3]);if(e[4],e[5],e[6],l instanceof Array)l.forEach(function(l){"marker"===l.overlaytype.toLowerCase()&&s.mapoverlayersflayer.filter(function(e){return e[1]===l.uuid}).forEach(function(i){var e=[],t=new n({x:l.position[0],y:l.position[1],z:void 0===l.position[2]?0:l.position[2],spatialReference:s.view.spatialReference});i[2].geometry=t,Object.keys(l.attributes).map(function(e){"objectId"!==e&&i[2].setAttribute(e,l.attributes[e])}),e.push(i[2]);var r=s.view.map.findLayerById(i[0]);null!==r&&r.applyEdits({updateFeatures:e}).then(function(e){var i;if(i="3D"===s.viewMode?{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:l.icon.size.width,resource:{href:l.icon.image}}]}}:{type:"simple",symbol:{type:"picture-marker",url:l.icon.image,width:l.icon.size.width,height:l.icon.size.height}},l.label.visible){var t=void 0;t="2D"===s.viewMode?{type:l.label.type,text:l.label.text,color:l.label.color,angle:l.label.angle,backgroundColor:l.label.backgroundColor,borderLineColor:l.label.borderLineColor,borderLineSize:l.label.borderLineSize,kerning:l.label.kerning,lineHeight:l.label.lineHeight,lineWidth:l.label.lineWidth,rotated:l.label.rotated,haloColor:l.label.haloColor,haloSize:l.label.haloSize,xoffset:l.label.xoffset,yoffset:l.label.yoffset,verticalAlignment:l.label.verticalAlignment,horizontalAlignment:l.label.horizontalAlignment,font:{size:l.label.size,family:"Josefin Slab",weight:l.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:l.label.color},size:l.label.size,halo:{color:l.label.haloColor,size:l.label.haloSize}}]};var o=new a({labelExpressionInfo:{expression:"$feature.NAME"},symbol:t,labelPlacement:l.label.placement,minScale:l.label.minScale,maxScale:l.label.maxScale});r.labelingInfo=[o]}r.renderer=i,r.refresh()})})});else if("group"===l.type){var o=[];l.overlayers.forEach(function(i){var t=s.mapoverlayersflayer.filter(function(e){return e[1]===i.uuid});if(1===t.length){i.attributes.uuid=i.uuid;var e=new n({x:i.position[0],y:i.position[1],z:void 0===i.position[2]?0:i.position[2],spatialReference:s.view.spatialReference});t[0][2].geometry=e,Object.keys(i.attributes).map(function(e){"objectId"!==e&&t[0][2].setAttribute(e,i.attributes[e])}),o.push(t[0][2])}});var r=s.view.map.findLayerById(l.uuid);null!==r&&r.applyEdits({updateFeatures:o}).then(function(e){var i={type:"unique-value",field:"style",uniqueValueInfos:[]};if(l.style.forEach(function(e){"3D"===s.viewMode?i.uniqueValueInfos.push({value:e.style,label:e.style,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:e.size.height,resource:{href:e.url}}]}}):i.uniqueValueInfos.push({value:e.style,label:e.style,symbol:{type:"picture-marker",url:e.url,width:e.size.height,height:e.size.height}})}),r.renderer=i,100<r.source.items.length&&null!=l.frreduction&&(r.featureReduction={type:l.frreduction.type,clusterRadius:l.frreduction.clusterRadius}),l.label.visible){var t=void 0;t="2D"===s.viewMode?{type:l.label.type,text:l.label.text,color:l.label.color,angle:l.label.angle,backgroundColor:l.label.backgroundColor,borderLineColor:l.label.borderLineColor,borderLineSize:l.label.borderLineSize,kerning:l.label.kerning,lineHeight:l.label.lineHeight,lineWidth:l.label.lineWidth,rotated:l.label.rotated,haloColor:l.label.haloColor,haloSize:l.label.haloSize,xoffset:l.label.xoffset,yoffset:l.label.yoffset,verticalAlignment:l.label.verticalAlignment,horizontalAlignment:l.label.horizontalAlignment,font:{size:l.label.size,family:"Josefin Slab",weight:l.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:l.label.color},size:l.label.size,halo:{color:l.label.haloColor,size:l.label.haloSize}}]};var o=new a({labelExpressionInfo:{expression:"$feature.NAME"},symbol:t,labelPlacement:l.label.placement,minScale:l.label.minScale,maxScale:l.label.maxScale});r.labelingInfo=[o]}r.refresh()})}else"element"===l.type&&s.mapoverlayersflayer.filter(function(e){return e[1]===l.uuid}).forEach(function(t){var e=[];l.attributes.uuid=l.uuid;var i=new n({x:l.position[0],y:l.position[1],z:void 0===l.position[2]?0:l.position[2],spatialReference:s.view.spatialReference});t[2].geometry=i,Object.keys(l.attributes).map(function(e){"objectId"!==e&&t[2].setAttribute(e,l.attributes[e])}),e.push(t[2]);var o=s.view.map.findLayerById(t[0]);null!==o&&o.applyEdits({updateFeatures:e}).then(function(e){var i;t[0]===t[1]&&(i="3D"===s.viewMode?{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:l.icon.size.width,resource:{href:l.icon.image}}]}}:{type:"simple",symbol:{type:"picture-marker",url:l.icon.image,width:l.icon.size.width,height:l.icon.size.height}},o.renderer=i,l.label.visible)&&("2D"===s.viewMode?(l.label.type,l.label.text,l.label.color,l.label.angle,l.label.backgroundColor,l.label.borderLineColor,l.label.borderLineSize,l.label.kerning,l.label.lineHeight,l.label.lineWidth,l.label.rotated,l.label.haloColor,l.label.haloSize,l.label.xoffset,l.label.yoffset,l.label.verticalAlignment,l.label.horizontalAlignment,l.label.size,l.label.weight):(l.label.color,l.label.size,l.label.haloColor,l.label.haloSize),o.refresh())})})})},je.prototype.removefeature=function(i){var t=this;if(i instanceof Array)i.forEach(function(i){t.mapoverlayersflayer.filter(function(e){return e[1]===i.uuid}).forEach(function(e){var i=t.view.map.findLayerById(e[0]);null!==i&&i.applyEdits({deleteFeatures:[e[2]]}).then(function(e){i.queryFeatures().then(function(e){0===e.features.length&&t.view.map.remove(i)})})}),t.mapoverlayersflayer=t.mapoverlayersflayer.filter(function(e){return e[1]!==i.uuid})});else if("group"===i.type){var e=this.view.map.findLayerById(i.uuid);null!==e&&this.view.map.remove(e),this.mapoverlayersflayer=this.mapoverlayersflayer.filter(function(e){return e[0]!==i.uuid})}else"element"===i.type&&(this.mapoverlayersflayer.filter(function(e){return e[1]===i.uuid}).forEach(function(e){var i=t.view.map.findLayerById(e[0]);null!==i&&i.applyEdits({deleteFeatures:[e[2]]}).then(function(e){i.queryFeatures().then(function(e){0===e.features.length&&t.view.map.remove(i)})})}),this.mapoverlayersflayer=this.mapoverlayersflayer.filter(function(e){return e[1]!==i.uuid}))},je.prototype.clearMap=function(){this.view.graphics.removeAll(),this.mapoverlayers=[]},je.prototype.setExtentConstrain=function(a,n){var s=this;be(["esri/geometry/Extent","esri/geometry/geometryEngine","esri/core/watchUtils"]).then(function(e){var i=e[0],t=e[1],o=e[2],r=new i({xmin:a[0],ymin:a[1],xmax:n[0],ymax:n[1],spatialReference:s.view.spatialReference});s.view.extent=r;var l=o.whenTrue(s.view,"stationary",function(){t.contains(r,s.view.extent)||(s.view.extent=r)});s.watchHandles.push(["extentcontrain",l])})},je.prototype.removeExtentConstrain=function(){this.watchHandles.filter(function(e){return"extentcontrain"===e[0]}).forEach(function(e){e[1].remove()}),this.watchHandles=this.watchHandles.filter(function(e){return"extentcontrain"!==e[0]})},je.prototype.setmaskboundary=function(y){var h=this;be(["esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Polygon","esri/geometry/geometryEngineAsync","esri/geometry/SpatialReference","esri/Color"]).then(function(e){var p=e[0],i=e[1],t=e[2],c=e[3],u=(e[4],e[5]),o=null;"qx_boundary"===y.boundaryType?o=h.view.map.findLayerById("qx_boundary"):"jd_boundary"===y.boundaryType?o=h.view.map.findLayerById("jd_boundary"):"jwh_boundary"===y.boundaryType&&(o=h.view.map.findLayerById("jwh_boundary"));var d=h.view.map.findLayerById("mask_boundary_graphiclayer");if(null==d&&(d=new i({id:"mask_boundary_graphiclayer",title:"遮罩层",listMode:"hide"}),h.view.map.add(d)),d.removeAll(),y.inputgeometry){if(null===(o=h.view.map.findLayerById("qx_boundary")))return;var r=new t({rings:y.inputgeometry,spatialReference:h.view.spatialReference}),l=o.fullExtent;l.spatialReference=h.view.spatialReference;var s=r;s.spatialReference=h.view.spatialReference,c.buffer(s,y.boundarydistance,"meters").then(function(e){c.difference(l,e).then(function(e){var i;i="3D"===h.viewMode?y.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:y.maskColor},size:y.symbol.size,edges:{type:"solid",color:y.maskColor}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:y.maskColor},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:y.maskColor,style:"solid",outline:{color:y.maskColor,width:1}};var t=new p({geometry:e,symbol:i});d.add(t);for(var r=void 0===y.bounarycount?30:y.bounarycount,l=Math.ceil(y.boundarydistance/r),a=new u(y.boundaryColor).toRgba(),o=function(o){c.buffer(s,o*r,"meters").then(function(i){c.buffer(s,(o-1)*r,"meters").then(function(e){c.difference(i,e).then(function(e){var i;a[3]=1/l*o,i="3D"===h.viewMode?y.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:a},size:y.symbol.size,edges:{type:"solid",color:a}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:a},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:a,style:"solid",outline:{color:a,width:1}};var t=new p({geometry:e,symbol:i});d.add(t)})})})},n=1;n<=l;n++)o(n)})})}else{if(null===o)return;var a=o.createQuery();a.where=y.boundaryDefinition,o.queryFeatures(a).then(function(e){if(e.features.length){var i=o.fullExtent;i.spatialReference=h.view.spatialReference;var s=e.features[0].geometry;s.spatialReference=h.view.spatialReference,c.buffer(s,y.boundarydistance,"meters").then(function(e){c.difference(i,e).then(function(e){var i;i="3D"===h.viewMode?y.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:y.maskColor},size:y.symbol.size,edges:{type:"solid",color:y.maskColor}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:y.maskColor},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:y.maskColor,style:"solid",outline:{color:y.maskColor,width:1}};var t=new p({geometry:e,symbol:i});d.add(t);for(var r=void 0===y.bounarycount?30:y.bounarycount,l=Math.ceil(y.boundarydistance/r),a=new u(y.boundaryColor).toRgba(),o=function(o){c.buffer(s,o*r,"meters").then(function(i){c.buffer(s,(o-1)*r,"meters").then(function(e){c.difference(i,e).then(function(e){var i;a[3]=1/l*o,i="3D"===h.viewMode?y.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:a},size:y.symbol.size,edges:{type:"solid",color:a}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:a},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:a,style:"solid",outline:{color:a,width:1}};var t=new p({geometry:e,symbol:i});d.add(t)})})})},n=1;n<=l;n++)o(n)})})}})}}).catch(function(e){console.error(e)})},je.prototype.init=function(c,u,d){return Oe(this,void 0,void 0,function(){var i=this;return Pe(this,function(e){return this.maplayers=$.gisService,be(["smiapi/utils/xhrutils"]).then(function(e){var p=e[0];return Oe(i,void 0,void 0,function(){var i,t,o,r,l,a,n,s=this;return Pe(this,function(e){switch(e.label){case 0:return"back"!==$.tokenserver.tokenType?[3,1]:(i=void 0===d.tokenconfigname?$.tokenserver.token_black.tokenconfigname:d.tokenconfigname,t=window.location.host,o=$.tokenserver.token_black.url,p.maptoken_backend($.proxyConifg.url,o,i,t).then(function(t){return Oe(s,void 0,void 0,function(){var i;return Pe(this,function(e){switch(e.label){case 0:return this.maptoken=JSON.parse(t.data).token,"3D"!==this.viewMode?[3,2]:[4,xe(c,$.gisService,$.proxyConifg,this.maptoken,d)];case 1:return i=e.sent(),this.view=i.sceneView,[3,4];case 2:return[4,ze(c,$.gisService,$.proxyConifg,this.maptoken,d)];case 3:i=e.sent(),this.view=i.mapView,e.label=4;case 4:return this.initEvent(),[2]}})})}),[3,7]);case 1:return"free"!==$.tokenserver.tokenType?[3,6]:"3D"!==this.viewMode?[3,3]:[4,xe(c,$.gisService,$.proxyConifg,"",d)];case 2:return r=e.sent(),this.view=r.sceneView,[3,5];case 3:return[4,ze(c,$.gisService,$.proxyConifg,"",d)];case 4:r=e.sent(),this.view=r.mapView,e.label=5;case 5:return this.initEvent(),[3,7];case 6:l=$.tokenserver.token_front.url,a=$.tokenserver.token_front.user,n=$.tokenserver.token_front.password,p.maptoken_front(l,a,n).then(function(t){return Oe(s,void 0,void 0,function(){var i;return Pe(this,function(e){switch(e.label){case 0:return this.maptoken=t.token,"3D"!==u?[3,2]:[4,xe(c,$.gisService,$.proxyConifg,this.maptoken,d)];case 1:return i=e.sent(),this.view=i.sceneView,[3,4];case 2:return[4,ze(c,$.gisService,$.proxyConifg,this.maptoken,d)];case 3:i=e.sent(),this.view=i.mapView,e.label=4;case 4:return this.initEvent(),[2]}})})}),e.label=7;case 7:return[2]}})})}),[2]})})},je.prototype.init1=function(l,a,n){return Oe(this,void 0,void 0,function(){var i,t,r=this;return Pe(this,function(e){switch(e.label){case 0:return"back"!==$.tokenserver.tokenType?[3,1]:(i={tokenconfigname:void 0===n.tokenconfigname?"smiapi_new":n.tokenconfigname,domainName:window.location.host},function(e,i,t,o,r){void 0===t&&(t={}),o=o||Me.sameOrigin;var l={cache:r=r||Le.default,credentials:"same-origin",headers:{"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json","X-Authorization":"Bearer"+i},method:"GET",redirect:"follow",referrer:"no-referrer"},a=encodeURIComponent;return e+="?"+Object.keys(t).map(function(e){return a(e)+"="+a(t[e])}).join("&"),fetch(e,l).then(function(e){return e.json()}).then(function(e){return e.error?(e.error.statusCode,Promise.reject(new Error(e.error))):Promise.resolve(e)})}($.tokenserver.token_black.url,"",i,Me.noCors,Le.forceCache).then(function(o){return Oe(r,void 0,void 0,function(){var i,t;return Pe(this,function(e){switch(e.label){case 0:return i=JSON.parse(o.data).token,"3D"!==this.viewMode?[3,2]:[4,xe(l,$.gisService,$.proxyConifg,i,n)];case 1:return t=e.sent(),this.view=t.sceneView,[3,4];case 2:return[4,ze(l,$.gisService,$.proxyConifg,i,n)];case 3:t=e.sent(),this.view=t.mapView,e.label=4;case 4:return this.initEvent(),[2]}})})}),[3,7]);case 1:return"free"!==$.tokenserver.tokenType?[3,6]:"3D"!==this.viewMode?[3,3]:[4,xe(l,$.gisService,$.proxyConifg,"",n)];case 2:return t=e.sent(),this.view=t.sceneView,[3,5];case 3:return[4,ze(l,$.gisService,$.proxyConifg,"",n)];case 4:t=e.sent(),this.view=t.mapView,e.label=5;case 5:return this.initEvent(),[3,7];case 6:(function(e,i,t,o,r){o=o||Me.sameOrigin,r=r||Le.default;var l={body:JSON.stringify(t),cache:r,credentials:"same-origin",headers:{"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json","X-Authorization":"Bearer"+i},method:"POST",mode:o,redirect:"follow",referrer:"no-referrer"};return fetch(e,l).then(function(e){return 200!=e.status&&204!=e.status?e.json().then(function(e){return Promise.reject(e)}):"No Content"==e.statusText?void 0:e.json()})})($.tokenserver.token_front.url+"?request=getToken&username="+$.tokenserver.token_front.user+"&password="+$.tokenserver.token_front.password+"&clientid=ref."+window.location.host+"&expiration=1440&f=json","","",Me.noCors,Le.default).then(function(o){return Oe(r,void 0,void 0,function(){var i,t;return Pe(this,function(e){switch(e.label){case 0:return i=o.token,"3D"!==a?[3,2]:[4,xe(l,$.gisService,$.proxyConifg,i,n)];case 1:return t=e.sent(),this.view=t.sceneView,[3,4];case 2:return[4,ze(l,$.gisService,$.proxyConifg,i,n)];case 3:t=e.sent(),this.view=t.mapView,e.label=4;case 4:return this.initEvent(),[2]}})})}),e.label=7;case 7:return[2]}})})},je.prototype.initEvent=function(){return Oe(this,void 0,void 0,function(){var t=this;return Pe(this,function(e){return be(["esri/core/watchUtils"]).then(function(e){var i=e[0];t.view.when(function(){i.whenTrueOnce(t.view,"ready",function(){t.emit(Ee.maploaded,t.view)}),i.whenTrue(t.view,"stationary",function(){if(t.view.extent){var e={xmin:t.view.extent.xmin.toFixed(6),ymin:t.view.extent.ymin.toFixed(6),xmax:t.view.extent.xmax.toFixed(6),ymax:t.view.extent.ymax.toFixed(6)};if("2D"===t.viewMode)t.emit(Ee.extentchanged,e);else{var i={xmin:t.view.extent.xmin.toFixed(6),ymin:t.view.extent.ymin.toFixed(6),xmax:t.view.extent.xmax.toFixed(6),ymax:t.view.extent.ymax.toFixed(6),zmin:t.view.extent.zmin,zmax:t.view.extent.zmax};t.emit(Ee.extentchanged,i)}t.view.center&&("2D"===t.viewMode?t.emit(Ee.centerchanged,{x:t.view.center.x.toFixed(6),y:t.view.center.y.toFixed(6)}):t.emit(Ee.centerchanged,{x:t.view.center.x.toFixed(6),y:t.view.center.y.toFixed(6),z:t.view.center.z})),t.view.zoom&&t.emit(Ee.zoomchanged,t.view.zoom)}}),t.view.popup.watch("visible",function(e){t.emit(Ee.popupvisible,e)}),t.view.on("blur",function(e){t.emit(Ee.blur,t.view,e)}),t.view.on("click",function(e){t.emit(Ee.click,t.view,e)}),t.view.on("double-click",function(e){t.emit(Ee.doubleclick,t.view,e)}),t.view.on("drag",function(e){t.emit(Ee.drag,t.view,e)}),t.view.on("focus",function(e){t.emit(Ee.focus,t.view,e)}),t.view.on("hold",function(e){t.emit(Ee.hold,t.view,e)}),t.view.on("key-down",function(e){t.emit(Ee.keydown,t.view,e)}),t.view.on("key-up",function(e){t.emit(Ee.keyup,t.view,e)}),t.view.on("mouse-wheel",function(e){t.emit(Ee.mousewheel,t.view,e)}),t.view.on("pointer-down",function(e){t.emit(Ee.pointerdown,t.view,e)}),t.view.on("pointer-enter",function(e){t.emit(Ee.pointerenter,t.view,e)}),t.view.on("pointer-leave",function(e){t.emit(Ee.pointerleave,t.view,e)}),t.view.on("pointer-move",function(e){t.emit(Ee.pointermove,t.view,e)}),t.view.on("pointer-up",function(e){t.emit(Ee.pointerup,t.view,e)}),t.view.on("resize",function(e){t.emit(Ee.resize,t.view,e)})})}),[2]})})},je);function je(e,i){void 0===i&&(i={});var t=Te.call(this)||this;return t.maplayers=null,t.viewMode="2D",t.showBuildingBlock=!1,t.view=null,t.maptoken="",t.mapControl=[],t.mapoverlayers=[],t.mapoverlayersflayer=[],t.watchHandles=[],t.viewMode=void 0===i.viewMode||"2D"===i.viewMode?"2D":"3D",t.zooms=void 0===i.zooms?[0,11]:i.zooms,t.showBuildingBlock=!!i.showBuildingBlock,t.init(e,t.viewMode,i),t}function He(e){this.type="text",this.type=void 0===e.type?"cluster":e.type,this.clusterRadius=void 0===e.clusterRadius?100:e.clusterRadius}function Ne(e){this.size=e.size,this.image=e.image}function Be(e){this.type="text",this.color="white",this.visible=!0,this.size=12,this.weight="normal",this.angle=0,this.backgroundColor="red",this.borderLineColor="blue",this.borderLineSize=200,this.haloColor="yellow",this.haloSize=20,this.horizontalAlignment="right",this.verticalAlignment="top",this.kerning=!0,this.lineHeight=25,this.lineWidth=200,this.rotated=!1,this.xoffset=0,this.yoffset=0,this.zoffset=0,this.placement="above-right",this.maxScale=0,this.minScale=0,this.text=void 0===e.text?"标注":e.text,this.color=void 0===e.color?"white":e.color,this.visible=void 0===e.visible||e.visible,this.size=void 0===e.size?12:e.size,this.weight=void 0===e.weight?"normal":e.weight,this.angle=void 0===e.angle?0:e.angle,this.backgroundColor=void 0===e.backgroundColor?"red":e.backgroundColor,this.borderLineColor=void 0===e.borderLineColor?"blue":e.borderLineColor,this.borderLineSize=void 0===e.borderLineSize?200:e.borderLineSize,this.haloColor=void 0===e.haloColor?"yellow":e.haloColor,this.haloSize=void 0===e.haloSize?0:e.haloSize,this.horizontalAlignment=void 0===e.horizontalAlignment?"right":e.horizontalAlignment,this.verticalAlignment=void 0===e.verticalAlignment?"top":e.verticalAlignment,this.kerning=void 0===e.kerning||e.kerning,this.lineHeight=void 0===e.lineHeight?25:e.lineHeight,this.lineWidth=void 0===e.lineWidth?200:e.lineWidth,this.rotated=void 0!==e.rotated&&e.rotated,this.xoffset=void 0===e.xoffset?0:e.xoffset,this.yoffset=void 0===e.yoffset?0:e.yoffset,this.zoffset=void 0===e.zoffset?0:e.zoffset,this.placement=void 0===e.placement?"center-right":e.placement,this.maxScale=void 0===e.maxScale?0:e.maxScale,this.minScale=void 0===e.minScale?0:e.minScale}var We=(Fe.prototype.S4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},Fe.prototype.get_uuid=function(){return this.S4()+this.S4()+"-"+this.S4()+"-"+this.S4()+"-"+this.S4()+"-"+this.S4()+this.S4()+this.S4()},Fe);function Fe(){this.uuid=this.get_uuid()}function Ge(e){this.uuid=(new We).uuid,this.label=e.label,this.attributes=void 0===e.attributes?{}:e.attributes,this.type="element"}var Je,Ve,Ze=((Je=function(e,i){return(Je=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}Je(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)})(Ue,Ve=Ge),Ue);function Ue(e){var i=Ve.call(this,e)||this;return i.overlaytype="Marker",i.icon=e.icon,i.position=e.position,i}function qe(e,i){this.uuid=(new We).uuid,this.overlayers=e,this.type="group",this.overlaytype=void 0===i.overlaytype?"marker":i.overlaytype,this.datafiled=void 0===i.datafiled?[]:i.datafiled,this.style=void 0===i.style?[]:i.style,this.label=void 0===i.label?null:i.label,this.frreduction=void 0===i.frreduction?null:i.frreduction}var Xe,Ye,$e,Qe,Ke=((Xe=function(e,i){return(Xe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}Xe(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)})(ei,Ye=Ge),ei);function ei(e){var i=Ye.call(this,e)||this;return i.overlaytype="polygon",i.paths=e.paths,i.symboltype=void 0===e.symboltype?"simple":e.symboltype,i.fillColor=void 0===e.fillColor?"white":e.fillColor,i.style=void 0===e.style?"solid":e.style,i.strokeColor=void 0===e.strokeColor?"red":e.strokeColor,i.strokestyle=void 0===e.strokestyle?"solid":e.strokestyle,i.strokeWeight=void 0===e.strokeWeight?2:e.strokeWeight,i.url=void 0===e.url?"":e.url,i.picwidth=void 0===e.picwidth?20:e.picwidth,i.picheight=void 0===e.picheight?20:e.picheight,i}function ii(e){var i=Qe.call(this,e)||this;return i.overlaytype="Polyline",i.path=e.path,i.cap=void 0===e.cap?"square":e.cap,i.strokeColor=void 0===e.strokeColor?"red":e.strokeColor,i.style=void 0===e.style?"solid":e.style,i.lineJoin=void 0===e.lineJoin?"round":e.lineJoin,i.width=void 0===e.width?5:e.width,i}return{load:be,Bounds:e,LayerListControl:R,Zoom:X,Home:E,Compass:x,Fullscreen:L,MeasureArea:j,MeasureLine:W,BasemapToggle:l,BMapGallery:y,BMapGalleryExpand:f,UndergroundSwitch:V,BIMFilterControl:p,Marker:Ze,Icon:Ne,Size:function(e,i){this.width=e,this.height=i},Label:Be,FeatureReduction:He,OverlayGroup:qe,LngLat:i,Polyline:(($e=function(e,i){return($e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}$e(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)})(ii,Qe=Ge),ii),Polygon:Ke,MapEvent:Ee,Map:De}});
//# sourceMappingURL=SMap.min.js.map

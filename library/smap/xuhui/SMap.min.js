!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):e.SMap=i()}(this,function(){"use strict";function e(e,i){this.northeast=i,this.southwest=e,this.xmin=e[0],this.ymin=e[1],this.zmin=void 0!==e[2]?e[2]:void 0,this.xmax=i[0],this.ymax=i[1],this.zmax=void 0!==i[2]?i[2]:void 0}function i(e,i,l){this.X=e,this.Y=i,this.Z=void 0===l?.1:l}function l(e){this.visible=!(void 0!==e.visible&&!e.visible),this.position=void 0===e.position||"top-right"===e.position?"top-right":e.position,this.collapse=!0===e.collapse}var t,a,o=((t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(r,a=l),r);function r(e){var i=a.call(this,e)||this;return i.controlName="basemaptoggle",i}var n,s,p=((n=function(e,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}n(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(c,s=l),c);function c(e){var i=s.call(this,e)||this;return i.controlName="bimfilter",i.layerid=e.layerid,i}var u,y,d=((u=function(e,i){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}u(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(b,y=l),b);function b(e){var i=y.call(this,e)||this;return i.controlName="basemapgallery",i}var f,v,h=((f=function(e,i){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}f(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(m,v=l),m);function m(e){var i=v.call(this,e)||this;return i.controlName="baseMapGalleryExpand",i}var g,w,x=((g=function(e,i){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}g(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(S,w=l),S);function S(e){var i=w.call(this,e)||this;return i.controlName="compass",i}var z,L,M=((z=function(e,i){return(z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}z(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(k,L=l),k);function k(e){var i=L.call(this,e)||this;return i.controlName="fullscreen",i}var C,I,_=((C=function(e,i){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}C(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(E,I=l),E);function E(e){var i=I.call(this,e)||this;return i.controlName="home",i}var T,A,P=((T=function(e,i){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}T(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(R,A=l),R);function R(e){var i=A.call(this,e)||this;return i.controlName="toc",i}var O,j,H=((O=function(e,i){return(O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}O(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(B,j=l),B);function B(e){var i=j.call(this,e)||this;return i.controlName="measurearea",i}var D,V,F=((D=function(e,i){return(D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}D(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(W,V=l),W);function W(e){var i=V.call(this,e)||this;return i.controlName="measureline",i}var N,G,J=((N=function(e,i){return(N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}N(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(U,G=l),U);function U(e){var i=G.call(this,e)||this;return i.controlName="performanceinfo",i.layerid=e.layerid,i}var Z,q,X=((Z=function(e,i){return(Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}Z(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(Y,q=l),Y);function Y(e){var i=q.call(this,e)||this;return i.controlName="undergroundswitch",i}var $,Q,K=(($=function(e,i){return($=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}$(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(ee,Q=l),ee);function ee(e){var i=Q.call(this,e)||this;return i.controlName="zoom",i}var ie,le,te=((ie=function(e,i){return(ie=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}ie(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(ae,le=function(e){this.type="layer",this.layerType=e.layerType,this.layerUrl=e.layerUrl,this.layerId=e.layerId,this.layerTitle=e.layerTitle,this.isToken=void 0!==e.isToken&&e.isToken,this.layerOpacity=void 0!==e.layerOpacity?e.layerOpacity:1,this.layerVisible=void 0===e.layerVisible||e.layerVisible,this.layerLabelingInfo=void 0!==e.layerLabelingInfo?e.layerLabelingInfo:null,this.layerMaxScale=void 0!==e.layerMaxScale?e.layerMaxScale:0,this.layerMinScale=void 0!==e.layerMinScale?e.layerMinScale:0,this.layerdefinitionExpression=void 0!==e.layerdefinitionExpression?e.layerdefinitionExpression:null,this.layerelevationInfo=void 0!==e.layerelevationInfo?e.layerelevationInfo:null,this.layerPopupEnabled=void 0===e.layerPopupEnabled||e.layerPopupEnabled,this.layerPopupTemplate=void 0!==e.layerPopupTemplate?e.layerPopupTemplate:null,this.layerLabelsVisible=void 0===e.layerLabelsVisible||e.layerLabelsVisible,this.layerRenderer=void 0!==e.layerRenderer?e.layerRenderer:null,this.layerSublayers=void 0!==e.layerSublayers?e.layerSublayers:null,this.layerlistMode=void 0===e.layerlistMode||e.layerlistMode}),ae);function ae(e){return le.call(this,e)||this}function oe(e){this.type="layergroup",this.layers=e}var re=(ne.jsapi="http://10.201.37.225:8080/smiapi/arcgis",ne.bujianurl="http://10.201.37.225:8080/smiapi/arcgis/4.16/esri/layers/json/tileJson.json",ne.jsapiversion4X="4.16",ne.tokenserver={tokenType:"free",token_front:{url:"http://10.108.3.52:8080/onemap/tokens/generateToken",user:"none",password:"none"},token_black:{url:"http://10.108.3.16:8401/mapconfig/gistoken",tokenconfigname:"smiapi_new"}},ne.proxyConifg={useProxy:!0,url:"http://10.201.37.225:8080/mapkProx/proxy.jsp?",httpsDomains:[]},ne.fonts={url:"http://10.201.37.225:8080/smiapi/arcgis/4.16/fonts"},ne.gisService={geometryServiceUrl:"http:///mapserver.smi.sh.cegn.cn:8080/OneMapServer/rest/services/Geometry/GeometryServer",serverurl:"http://mapserver.smi.sh.cegn.cn:8080/OneMapServer/rest/services",baseMapServices:{isToken:!0,tokenType:"OneMap",layers:[{url:"http://10.201.37.222/arcgis/rest/services/Air2020/MapServer",layerEName:"basemap_air",isToken:!1,visible:!1,opacity:1,mapType:"SHCTiledMapServiceLayer",tag:"影像底图",layerCName:"影像底图",type:"basemap_air"},{url:"http://10.201.37.222/arcgis/rest/services/BaseMap/MapServer",layerEName:"basemap_zw",isToken:!1,visible:!1,opacity:1,mapType:"SHCTiledMapServiceLayer",tag:"政务底图",layerCName:"政务底图",type:"basemap_zw"},{url:"http://10.201.37.222/arcgis/rest/services/shbm/MapServer",layerEName:"basemap_as",isToken:!1,visible:!0,opacity:1,mapType:"TileLayer",tag:"暗色底图",layerCName:"暗色底图",type:"basemap_as"}]},buildingsLayers:{id:"buildings_3d_layers",title:"空间基础",tag:"buildings_3d_layers",listMode:"show",visible:!0,layerGroups:[{id:"buildings_3d_above_layers",title:"地上",tag:"buildings_3d_above_layers",visible:!0,listMode:"show",layerGroups:[],layers:[{url:"http://10.201.37.222/arcgis/rest/services/Hosted/XuHuiJingMo/SceneServer",id:"model_air_real",isToken:!1,visible:!1,opacity:1,maptype:"SceneLayer",tag:"影像底图精模",title:"影像底图精模",elevationInfo:{mode:"absolute-height",offset:-4},type:"model_air_real",popupEnabled:!0,listMode:"show"},{url:"http://10.201.37.224/arcgis/rest/services/Hosted/xuhuibaimo/SceneServer",id:"model_white_zw",isToken:!1,visible:!0,opacity:1,maptype:"SceneLayer",tag:"政务白模型",title:"政务白模型",type:"model_white_zw",popupEnabled:!0,listMode:"show",renderer:{type:"simple",symbol:{type:"mesh-3d",symbolLayers:[{type:"fill",material:{color:[255,255,255,.6],colorMixMode:"replace"},edges:{type:"solid",color:[0,0,0,.5],size:2}}]}}},{url:"http://10.201.37.224/arcgis/rest/services/Hosted/xuhuibaimo/SceneServer",id:"model_white_as",isToken:!1,visible:!1,opacity:1,maptype:"SceneLayer",tag:"暗色白模型",title:"暗色白模型",elevationInfo:{mode:"absolute-height",offset:.5},type:"model_white_as",popupEnabled:!0,listMode:"show",renderer:{authoringInfo:{visualVariables:[{field:"HEIGHT",maxSliderValue:200,minSliderValue:1,theme:"high-to-low",type:"color"}]},type:"class-breaks",visualVariables:[{type:"color",field:"HEIGHT",stops:[{value:"",color:[20,96,166,.7],label:"暂缺"},{value:1,color:[20,96,166,.7],label:"< 1"},{value:40,color:[55,135,192,.7]},{value:80,color:[148,195,223,.7],label:"80"},{value:120,color:[230,238,251,.7]},{value:160,color:[235,240,249,.7],label:"> 160"}]}],classBreakInfos:[{maxValue:17976931348623157e292,symbol:{type:"mesh-3d",symbolLayers:[{material:{color:[170,170,170],colorMixMode:"replace"},type:"fill",edges:{type:"solid",color:[0,0,0],transparency:60,size:.5}}]},minValue:-17976931348623157e292}],field:"HEIGHT"}}]}]},smapbussinessLayers:{serverurl:"http://10.201.37.222/arcgis/rest/services",istoken:!1,tokenType:"OneMap",layerGroups:[{id:"smap_3D_layers",title:"三维业务组",grouptype:"3D",tag:"smap_3D_layers",visible:!0,listMode:"show",layerGroups:[],layers:[{url:"http://10.201.37.222/arcgis/rest/services/Hosted/lake/FeatureServer",id:"xh_lake",istoken:!0,visible:!0,opacity:1,maptype:"FeatureLayer",tag:"xh_lake",title:"徐汇河流",MinScale:128e3,MaxScale:250,elevationInfo:{mode:"on-the-ground"},renderer:{type:"simple",symbol:{type:"polygon-3d",symbolLayers:[{type:"water",waveDirection:180,color:[0,47,71,.5],waveStrength:"moderate",waterbodySize:"large"}]}},type:"image",listMode:"show"},{url:"http://10.201.37.222/arcgis/rest/services/XU_JD/FeatureServer",id:"xh_jd_cluster",istoken:!0,visible:!1,opacity:1,maptype:"FeatureLayer",tag:"xh_jd_cluster",title:"徐汇街道",elevationInfo:{mode:"on-the-ground"},renderer:{type:"simple",symbol:{type:"simple-fill",color:[0,227,229,0],outline:{color:[0,0,255,1],width:"0px"}}},type:"image",listMode:"show"}]},{id:"smap_2D_layers",title:"二维业务组",grouptype:"2D",tag:"smap_2D_layers",visible:!0,listMode:"show",layerGroups:[{id:"shanghaiboundary",title:"上海边界范围数据",tag:"shanghaiboundary",visible:!0,listMode:"show",layers:[{url:"http://10.201.37.220/server/rest/services/Hosted/sh_qx_boundary/FeatureServer",id:"qx_boundary",istoken:!0,visible:!1,opacity:1,maptype:"FeatureLayer",tag:"qx_boundary",title:"上海区县边界",renderer:{type:"simple",symbol:{type:"simple-fill",color:[0,227,229,0],outline:{color:[0,0,255,1],width:"2px"}}},type:"image",listMode:"show"},{url:"http://10.201.37.220/server/rest/services/Hosted/sh_jd_boundary/FeatureServer",id:"jd_boundary",istoken:!0,visible:!1,opacity:1,maptype:"FeatureLayer",tag:"jd_boundary",title:"上海街道边界",renderer:{type:"simple",symbol:{type:"simple-fill",color:[0,227,229,0],outline:{color:[0,255,0,1],width:"2px"}}},type:"image",listMode:"show"},{url:"http://10.201.37.220/server/rest/services/Hosted/sh_jwh_boundary/FeatureServer",id:"jwh_boundary",istoken:!0,visible:!1,opacity:1,maptype:"FeatureLayer",tag:"jwh_boundary",title:"上海居委会边界",renderer:{type:"simple",symbol:{type:"simple-fill",color:[0,227,229,0],outline:{color:[255,0,0,1],width:"2px"}}},type:"image",listMode:"show"}]}],layers:[{id:"Hight_Graphiclayer",istoken:!1,visible:!0,opacity:1,maptype:"GraphicsLayer",tag:"辅助显示图层",title:"辅助显示图层",type:"image",listMode:"hide"},{id:"location_Hightlight",istoken:!1,visible:!0,opacity:1,maptype:"GraphicsLayer",tag:"地名地址高亮",title:"地名地址高亮",type:"image",listMode:"hide"}]}]},smaplabel3d:{serverurl:"http://10.201.37.222/arcgis/rest/services",istoken:!1,tokenType:"OneMap",layerGroups:[{id:"smap_3d_labelGroup",title:"三维标注",grouptype:"3D",tag:"smap_3d_labelGroup",visible:!0,listMode:"show",layerGroups:[{id:"smap_3d_road_labelGroup",title:"三维标注_路",tag:"smap_3d_road_labelGroup",visible:!0,listMode:"show",layers:[{url:"http://10.201.37.224/arcgis/rest/services/POI_test1015/FeatureServer/0",id:"roadstreet",istoken:!0,visible:!0,opacity:1,maptype:"FeatureLayer",tag:"roadlabel",title:"道路街道标注标注",renderer:null,popupTemplate:null,popupEnabled:!1,screenSizePerspectiveEnabled:!1,elevationInfo:{mode:"absolute-height",offset:0},MaxScale:0,MinScale:4e3,labelsVisible:!0,labelingInfo:[{symbol:{type:"label-3d",symbolLayers:[{type:"text",material:{color:"#46B489"},halo:{size:1,color:"black"},font:{family:"Ubuntu Mono Regular",size:32,weight:"bold"},size:36}]},labelPlacement:"center-center",labelExpressionInfo:{expression:"$feature.text"}}],type:"image",listMode:"show"},{url:"http://10.201.37.224/arcgis/rest/services/POI_test1015/FeatureServer/1",id:"sroad4000",istoken:!0,visible:!0,opacity:1,maptype:"FeatureLayer",tag:"roadlabel",title:"道路标注4000-0",renderer:null,popupTemplate:null,popupEnabled:!1,screenSizePerspectiveEnabled:!1,definitionExpression:"ReferenceScale ='4000'",elevationInfo:{mode:"absolute-height",offset:0},MaxScale:0,MinScale:4e3,labelsVisible:!0,labelingInfo:[{symbol:{type:"label-3d",symbolLayers:[{type:"text",material:{color:"#46B489"},halo:{size:1,color:"black"},font:{family:"Ubuntu Mono Regular",size:32,weight:"bold"},size:36}]},labelPlacement:"center-center",labelExpressionInfo:{expression:"$feature.text"}}],type:"image",listMode:"show"},{url:"http://10.201.37.224/arcgis/rest/services/POI_test1015/FeatureServer/2",id:"xhpoi",istoken:!0,visible:!0,opacity:1,maptype:"FeatureLayer",tag:"徐汇兴趣点标注",title:"徐汇兴趣点标注",popupEnabled:!1,screenSizePerspectiveEnabled:!1,elevationInfo:{mode:"absolute-height",offset:0},MaxScale:0,MinScale:8e3,labelsVisible:!0,labelingInfo:[{symbol:{type:"label-3d",symbolLayers:[{type:"text",material:{color:"#46B489"},halo:{size:1,color:"black"},font:{family:"Ubuntu Mono Regular",size:32,weight:"bold"},size:36}]},labelPlacement:"above-center",labelExpressionInfo:{expression:"$feature.NAME"}}],type:"image",listMode:"show"},{url:"http://10.201.37.224/arcgis/rest/services/POI_test1015/FeatureServer/3",id:"residential",istoken:!0,visible:!0,opacity:1,maptype:"FeatureLayer",tag:"小区标注",title:"小区标注",popupEnabled:!1,screenSizePerspectiveEnabled:!1,elevationInfo:{mode:"absolute-height",offset:0},type:"image",listMode:"show"}]}],layers:[]}]}},ne);function ne(){}var se=re.jsapiversion4X,pe="next";function ce(e){if(null===e&&(e=se),e.toString().toLowerCase()===pe)return pe;var i=e&&e.match(/^(\d)\.(\d+)/);return i&&{major:parseInt(i[1],10),minor:parseInt(i[2],10)}}function ue(e){return void 0===e&&(e=se),re.jsapi+"/"+e+"/init.js"}function ye(e){var i=document.createElement("link");return i.rel="stylesheet",i.href=e,i}function de(e,i){if(i){var l=document.querySelector(i);l.parentNode.insertBefore(e,l)}else document.head.appendChild(e)}function be(e){return document.querySelector('link[href*="'+e+'"]')}function fe(e){return!e||ce(e)?function(e){void 0===e&&(e=se),null===e&&(e=se);var i=ue(e),l=i.substring(0,i.indexOf("init.js")),t=ce(e);return t===pe||3!==t.major?l+"esri/themes/light/main.css":l+(t.minor<=10?"js/":"")+"esri/css/esri.css"}(e):e}function ve(e,i){var l=fe(e),t=be(l);if(t||de(t=ye(l),i),4===function(e){null===e&&(e=se);var i=e&&e.match(/^(\d)\.(\d+)/);return i&&{major:parseInt(i[1],10),minor:parseInt(i[2],10)}}(e).major){var a=l.substring(0,l.indexOf("esri/themes/"))+"esri/themes/gis/css/gis.css",o=be(a);o||de(o=ye(a),i)}return t}var he={Promise:"undefined"!=typeof window?window.Promise:void 0},me={};function ge(e,i,l){var t,a,o,r;l&&(o=l,r=function(e){o(e.error||new Error("There was an error attempting to load "+a.src)),a.removeEventListener("error",r,!1)},(a=e).addEventListener("error",r,!1),t=r);var n=function(){i(e),e.removeEventListener("load",n,!1),t&&e.removeEventListener("error",t,!1)};e.addEventListener("load",n,!1)}function we(){return document.querySelector("script[data-shsmi]")}function xe(){var e=window.require;return e&&e.on}function Se(e){void 0===e&&(e={});var s={};[me,e].forEach(function(e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i])});var p=s.version,c=s.url||ue(p);return new he.Promise(function(e,i){var l,t,a=we();if(a){var o=a.getAttribute("src");o!==c?i(new Error("The ArcGIS API for JavaScript is already loaded ("+o+").")):xe()?e(a):ge(a,e,i)}else if(xe())i(new Error("The ArcGIS API for JavaScript is already loaded."));else{var r=s.css;if(r)ve(!0===r?p:r,s.insertCssBefore);else ve(null,s.insertCssBefore);if(s.dojoConfig)window.dojoConfig=s.dojoConfig;else{var n={async:!0,packages:[{location:re.jsapi+"/extensions",name:"82B44794-5CE0-A64A-9047F07CAF08BD2C"},{location:re.jsapi+"/extensions/geolocation",name:"geolocate",main:"geolocate"}],deps:["@dojo/framework/shim/main"],has:{"esri-promise-compatibility":1,"esri-featurelayer-webgl":1}};window.dojoConfig=n}l=c,(t=document.createElement("script")).type="text/javascript",t.src=l,t.setAttribute("data-shsmi","loading"),ge(a=t,function(){a.setAttribute("data-shsmi","loaded"),e(a)},i),document.head.appendChild(a)}})}function ze(i){return new he.Promise(function(l,e){var t=window.require.on("error",e);window.require(i,function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.remove(),l(e)})})}function Le(e,i){if(void 0===i&&(i={}),xe())return ze(e);var l=we(),t=l&&l.getAttribute("src");return!i.url&&t&&(i.url=t),Se(i).then(function(){return ze(e)})}var Me=function(e,r,n,s){return new(n=n||Promise)(function(l,i){function t(e){try{o(s.next(e))}catch(e){i(e)}}function a(e){try{o(s.throw(e))}catch(e){i(e)}}function o(e){var i;e.done?l(e.value):((i=e.value)instanceof n?i:new n(function(e){e(i)})).then(t,a)}o((s=s.apply(e,r||[])).next())})},ke=function(l,t){var a,o,r,e,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return e={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function i(i){return function(e){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;n;)try{if(a=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,o=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!(r=0<(r=n.trys).length&&r[r.length-1])&&(6===i[0]||2===i[0])){n=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){n.label=i[1];break}if(6===i[0]&&n.label<r[1]){n.label=r[1],r=i;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(i);break}r[2]&&n.ops.pop(),n.trys.pop();continue}i=t.call(l,n)}catch(e){i=[6,e],o=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,e])}}};function Ce(l,w,r){return Me(this,void 0,void 0,function(){var i,n,s,p,c,u,y,d,b,a,f,v,h,m,g,o;return ke(this,function(e){switch(e.label){case 0:return[4,Le(["esri/layers/TileLayer","esri/layers/SceneLayer","esri/layers/VectorTileLayer","esri/layers/MapImageLayer","esri/layers/IntegratedMeshLayer","esri/layers/PointCloudLayer","esri/layers/BuildingSceneLayer","esri/layers/SHCTiledMapServiceLayer","esri/layers/SHCMapServiceLayer","esri/layers/GroupLayer","esri/layers/GeoJSONLayer","esri/layers/FeatureLayer","esri/layers/GraphicsLayer","esri/geometry/Extent","esri/geometry/SpatialReference"])];case 1:return i=e.sent(),n=i[0],s=i[1],i[2],p=i[3],c=i[4],u=i[5],y=i[6],d=i[7],b=i[8],a=i[9],f=i[10],v=i[11],h=i[12],m=i[13],g=i[14],o=[],l.map(function(e){var i=new a({id:e.id,title:e.title,visible:e.visible,listMode:e.listMode});if(null!=e.layerGroups){var l=e.layerGroups.reverse().map(function(e){var r=new a({id:e.id,title:e.title,visible:e.visible,listMode:e.listMode});return e.layers.reverse().map(function(e){switch(e.maptype){case"TileLayer":r.add(new n(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));break;case"MapImageLayer":r.add(new p(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));break;case"GeoJSONLayer":r.add(new f({url:e.url,id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));break;case"localFeatureLayer":var i=new v({id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode,popupTemplate:e.popupTemplate,popupEnabled:e.popupEnabled,source:[]});null!=e.renderer&&void 0!==e.renderer&&(i.renderer=e.renderer),r.add(i);break;case"FeatureLayer":var l=new v({url:e.url,id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode,popupTemplate:e.popupTemplate,popupEnabled:e.popupEnabled});e.MaxScale&&(l.maxScale=e.MaxScale),e.MinScale&&(l.minScale=e.MinScale),null!=e.renderer&&void 0!==e.renderer&&(l.renderer=e.renderer),null!=e.elevationInfo&&void 0!==e.elevationInfo&&(l.elevationInfo=e.elevationInfo),null!=e.labelingInfo&&void 0!==e.labelingInfo&&(l.labelingInfo=e.labelingInfo),null!=e.popupTemplate&&void 0!==e.popupTemplate&&(l.popupTemplate=e.popupTemplate),r.add(l);break;case"SceneLayer":var t=new s({url:e.url,id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,renderer:e.renderer,popupTemplate:e.popupTemplate,popupEnabled:e.popupEnabled,elevationInfo:e.elevationInfo});e.MaxScale&&(t.maxScale=e.MaxScale),e.MinScale&&(t.minScale=e.MinScale),null!=t.renderer&&void 0!==t.renderer&&(t.renderer=e.renderer),null!=e.elevationInfo&&void 0!==e.elevationInfo&&(t.elevationInfo=e.elevationInfo),null!=e.popupTemplate&&void 0!==e.popupTemplate&&(t.popupTemplate=e.popupTemplate),r.add(t);break;case"BuildingSceneLayer":r.add(new y({url:e.url,id:e.id,title:e.title,visible:e.visible,opacity:e.opacity}));break;case"PointCloudLayer":r.add(new u(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));break;case"IntegratedMeshLayer":r.add(new c({url:e.url,id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));case"GraphicsLayer":r.add(new h({id:e.id,visible:e.visible,opacity:e.opacity,listMode:e.listMode,title:e.title}));break;case"SHCTiledMapServiceLayer":var a=new m({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:g.WebMercator});!0===e.istoken?r.add(new d({url:e.url,token:w,fullExtent:a,opacity:e.opacity,title:e.title,id:e.id,visible:e.visible})):r.add(new d({url:e.url,fullExtent:a,opacity:e.opacity,title:e.title,id:e.id,visible:e.visible}));break;case"SHCMapServiceLayer":var o=new m({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:g.WebMercator});!0===e.istoken?r.add(new b({url:e.url,token:w,fullExtent:o,opacity:e.opacity,title:e.title,id:e.id,visible:e.visible})):r.add(new b({url:e.url,fullExtent:o,opacity:e.opacity,title:e.title,id:e.id,visible:e.visible}))}}),r});i.addMany(l)}if(null!=e.layers){var t=e.layers.reverse().map(function(e){switch(e.maptype){case"TileLayer":return new n(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity});case"MapImageLayer":return new p(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity});case"FeatureLayer":var i=new v({url:e.url,id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,popupEnabled:e.popupEnabled});return e.MaxScale&&(i.maxScale=e.MaxScale),e.MinScale&&(i.minScale=e.MinScale),null!=e.renderer&&void 0!==e.renderer&&(i.renderer=e.renderer),null!=e.labelingInfo&&void 0!==e.labelingInfo&&(i.labelingInfo=e.labelingInfo),null!=e.popupTemplate&&void 0!==e.popupTemplate&&(i.popupTemplate=e.popupTemplate),null!=e.elevationInfo&&void 0!==e.elevationInfo&&(i.elevationInfo=e.elevationInfo),i;case"SceneLayer":var l=new s({url:e.url,id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,popupEnabled:e.popupEnabled});return e.MaxScale&&(l.maxScale=e.MaxScale),e.MinScale&&(l.minScale=e.MinScale),null!=e.renderer&&void 0!==e.renderer&&(l.renderer=e.renderer),null!=e.popupTemplate&&void 0!==e.popupTemplate&&(l.popupTemplate=e.popupTemplate),null!=e.elevationInfo&&void 0!==e.elevationInfo&&(l.elevationInfo=e.elevationInfo),l;case"BuildingSceneLayer":return new y({url:e.url,id:e.id,title:e.title,visible:e.visible,opacity:e.opacity});case"PointCloudLayer":return new u(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode});case"IntegratedMeshLayer":return new c(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode});case"GraphicsLayer":return new h({id:e.id,visible:e.visible,opacity:e.opacity,listMode:e.listMode,title:e.title})}});i.addMany(t)}"2D"===r&&"2D"!==e.grouptype||o.push(i)}),[2,o]}})})}var Ie=function(e,r,n,s){return new(n=n||Promise)(function(l,i){function t(e){try{o(s.next(e))}catch(e){i(e)}}function a(e){try{o(s.throw(e))}catch(e){i(e)}}function o(e){var i;e.done?l(e.value):((i=e.value)instanceof n?i:new n(function(e){e(i)})).then(t,a)}o((s=s.apply(e,r||[])).next())})},_e=function(l,t){var a,o,r,e,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return e={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function i(i){return function(e){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;n;)try{if(a=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,o=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!(r=0<(r=n.trys).length&&r[r.length-1])&&(6===i[0]||2===i[0])){n=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){n.label=i[1];break}if(6===i[0]&&n.label<r[1]){n.label=r[1],r=i;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(i);break}r[2]&&n.ops.pop(),n.trys.pop();continue}i=t.call(l,n)}catch(e){i=[6,e],o=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,e])}}};function Ee(h,m,g,w,x){return Ie(this,void 0,void 0,function(){var i,l,t,a,o,r,n,s,p,c,u,y,d,b,f,v;return _e(this,function(e){switch(e.label){case 0:return[4,Le(["esri/Map","esri/Basemap","esri/geometry/Point","esri/core/urlUtils","esri/config","esri/identity/IdentityManager","esri/core/watchUtils","esri/views/SceneView"])];case 1:return i=e.sent(),l=i[0],t=i[1],a=i[2],o=i[3],r=i[4],n=i[5],s=i[6],p=i[7],g.useProxy&&g.httpsDomains.map(function(e){o.addProxyRule({proxyUrl:e.proxyUrl,urlPrefix:e.domainName})}),r.geometryServiceUrl=m.geometryServiceUrl,""!==w&&n.registerToken({server:m.serverurl,token:w}),n.on("dialog-create",function(){n.dialog.open=!0}),[4,function(n,s){return Me(this,void 0,void 0,function(){var i,l,t,a,o,r;return ke(this,function(e){switch(e.label){case 0:return[4,Le(["esri/geometry/Extent","esri/layers/SHCTiledMapServiceLayer","esri/layers/TileLayer","esri/layers/VectorTileLayer","esri/geometry/SpatialReference"])];case 1:return i=e.sent(),l=i[0],t=i[1],a=i[2],o=i[3],r=i[4],[2,n.map(function(e){switch(e.mapType){case"SHCTiledMapServiceLayer":var i=new l({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:r.WebMercator});return!0===e.isToken?new t({url:e.url,token:s,fullExtent:i,opacity:e.opacity,title:e.layerCName,id:e.layerEName,visible:e.visible}):new t({url:e.url,fullExtent:i,opacity:e.opacity,title:e.layerCName,id:e.layerEName,visible:e.visible});case"TileLayer":return new a({url:e.url,id:e.layerEName,visible:e.visible,opacity:e.opacity,listMode:e.listMode,title:e.layerCName});case"VectorTileLayer":return new o({url:e.url,id:e.layerEName,visible:e.visible,opacity:e.opacity,listMode:e.listMode,title:e.layerCName})}})]}})})}(m.baseMapServices.layers,w)];case 2:return c=e.sent(),u=new t({baseLayers:c,title:"底图",id:"basemap_as"}),y=new l({basemap:u,ground:{navigationConstraint:{type:"none"}}}),[4,function(o,m){return Me(this,void 0,void 0,function(){var i,r,n,s,p,c,u,y,d,a,b,f,v,h,l,t;return ke(this,function(e){switch(e.label){case 0:return[4,Le(["esri/layers/TileLayer","esri/layers/SceneLayer","esri/layers/VectorTileLayer","esri/layers/MapImageLayer","esri/layers/IntegratedMeshLayer","esri/layers/PointCloudLayer","esri/layers/BuildingSceneLayer","esri/layers/SHCTiledMapServiceLayer","esri/layers/SHCMapServiceLayer","esri/layers/GroupLayer","esri/layers/FeatureLayer","esri/layers/GraphicsLayer","esri/geometry/Extent","esri/geometry/SpatialReference"])];case 1:return i=e.sent(),r=i[0],n=i[1],i[2],s=i[3],p=i[4],c=i[5],u=i[6],y=i[7],d=i[8],a=i[9],b=i[10],f=i[11],v=i[12],h=i[13],l=new a({id:o.id,title:o.title,visible:o.visible,listMode:o.listMode}),t=o.layerGroups.map(function(e){var i=new a({id:e.id,title:e.title,visible:e.visible,listMode:e.listMode});if(null!=e.layerGroups){var l=e.layerGroups.reverse().map(function(e){var o=new a({id:e.id,title:e.title,visible:e.visible,listMode:e.listMode});return e.layers.reverse().map(function(e){switch(e.maptype){case"TileLayer":o.add(new r(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));break;case"MapImageLayer":o.add(new s(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));break;case"FeatureLayer":var i=new b(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode,popupEnabled:e.popupEnabled});return null!=e.renderer&&void 0!==e.renderer&&(i.renderer=e.renderer),null!=e.labelingInfo&&void 0!==e.labelingInfo&&(i.labelingInfo=e.labelingInfo),null!=e.elevationInfo&&void 0!==e.elevationInfo&&(i.elevationInfo=e.elevationInfo),null!=e.popupTemplate&&void 0!==e.popupTemplate&&(i.popupTemplate=e.popupTemplate),i;case"SceneLayer":var l=new n(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,popupEnabled:e.popupEnabled});null!=e.renderer&&void 0!==e.renderer&&(l.renderer=e.renderer),null!=e.elevationInfo&&void 0!==e.elevationInfo&&(l.elevationInfo=e.elevationInfo),null!=e.popupTemplate&&void 0!==e.popupTemplate&&(l.popupTemplate=e.popupTemplate),o.add(l);break;case"BuildingSceneLayer":o.add(new u({url:e.url,id:e.id,title:e.title,visible:e.visible,opacity:e.opacity}));break;case"PointCloudLayer":o.add(new c(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));break;case"IntegratedMeshLayer":o.add(new p(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode}));case"GraphicsLayer":o.add(new f({id:e.id,visible:e.visible,opacity:e.opacity,listMode:e.listMode,title:e.title}));break;case"SHCTiledMapServiceLayer":var t=new v({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:h.WebMercator});!0===e.istoken?o.add(new y({url:e.url,token:m,fullExtent:t,opacity:e.opacity,title:e.title,id:e.id,visible:e.visible})):o.add(new y({url:e.url,fullExtent:t,opacity:e.opacity,title:e.title,id:e.id,visible:e.visible}));break;case"SHCMapServiceLayer":var a=new v({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:h.WebMercator});!0===e.istoken?o.add(new d({url:e.url,token:m,fullExtent:a,opacity:e.opacity,title:e.title,id:e.id,visible:e.visible})):o.add(new d({url:e.url,fullExtent:a,opacity:e.opacity,title:e.title,id:e.id,visible:e.visible}))}}),o});i.addMany(l)}if(null!=e.layers){var t=e.layers.reverse().map(function(e){switch(e.maptype){case"TileLayer":return new r(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity});case"MapImageLayer":return new s(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity});case"FeatureLayer":var i=new b(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,popupEnabled:e.popupEnabled});return null!=e.renderer&&void 0!==e.renderer&&(i.renderer=e.renderer),null!=e.labelingInfo&&void 0!==e.labelingInfo&&(i.labelingInfo=e.labelingInfo),null!=e.elevationInfo&&void 0!==e.elevationInfo&&(i.elevationInfo=e.elevationInfo),null!=e.popupTemplate&&void 0!==e.popupTemplate&&(i.popupTemplate=e.popupTemplate),i;case"SceneLayer":var l=new n(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,popupEnabled:e.popupEnabled});return null!=e.renderer&&void 0!==e.renderer&&(l.renderer=e.renderer),null!=e.elevationInfo&&void 0!==e.elevationInfo&&(l.elevationInfo=e.elevationInfo),null!=e.popupTemplate&&void 0!==e.popupTemplate&&(l.popupTemplate=e.popupTemplate),l;case"BuildingSceneLayer":return new u({url:e.url,id:e.id,title:e.title,visible:e.visible,opacity:e.opacity});case"PointCloudLayer":return new c(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode});case"IntegratedMeshLayer":return new p(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode});case"GraphicsLayer":return new f({id:e.id,visible:e.visible,opacity:e.opacity,listMode:e.listMode,title:e.title})}});i.addMany(t)}return i}),l.addMany(t),[2,l]}})})}(m.buildingsLayers,w)];case 3:if(d=e.sent(),y.add(d),void 0!==x.mapStyle)switch(x.mapStyle){case"smap://styles/light":y.basemap.id="basemap_zw",y.ground.surfaceColor="#EDEDED";break;case"smap://styles/dark":y.basemap.id="basemap_as",y.ground.surfaceColor="#021425";break;case"smap://styles/image":y.basemap.id="basemap_air",y.ground.surfaceColor="#021425";break;default:y.basemap.id="basemap_as",y.ground.surfaceColor="#021425"}else y.basemap.id="basemap_as",y.ground.surfaceColor="#021425";return y.basemap.baseLayers.items.forEach(function(e){e.id===y.basemap.id?e.visible=!0:e.visible=!1}),["model_white_zw","model_air_real","model_white_as"].forEach(function(e){var i=y.findLayerById(e);!1===x.showBuildingBlock?i&&(i.visible=!1):i&&("basemap_zw"===y.basemap.id?i.visible="model_white_zw"===e:"basemap_as"===y.basemap.id?i.visible="model_white_as"===e:"basemap_air"===y.basemap.id&&(i.visible="model_air_real"===e))}),b=void 0===x.viewMode||"2D"===x.viewMode?"2D":"3D",[4,Ce(m.smapbussinessLayers.layerGroups,w,b)];case 4:return(f=e.sent(),y.addMany(f),(v=new p({map:y,container:h,spatialReference:{wkid:102100},viewingMode:"local",alphaCompositingEnabled:!0,environment:{background:{type:"color",color:"#021425"},starsEnabled:!1,atmosphereEnabled:!1}})).ui.empty("top-left"),v.ui.empty("top-right"),v.ui.empty("bottom-left"),v.ui.empty("bottom-right"),v.padding={top:5,bottom:0,left:0,right:5},v.when(function(){n.on("dialog-create",function(){n.dialog.open=!0})}),void 0!==x.center&&(v.center=new a({x:x.center[0],y:x.center[1],z:void 0!==x.center[2]?x.center[2]:0,spatialReference:{wkid:102100}})),void 0!==x.zoom&&(v.zoom=x.zoom),void 0===x.pitch)?[3,6]:[4,v.goTo({center:v.center,zoom:v.zoom,tilt:x.pitch,heading:0})];case 5:e.sent(),s.when(v,"animation",function(e){e.when(function(e){void 0!==x.zooms&&v.watch("zoom",function(e){e>=x.zooms[1]&&(v.zoom=x.zooms[1]),e<=x.zooms[0]&&(v.zoom=x.zooms[0])})}).catch(function(e){console.log(e)})}),e.label=6;case 6:return[2,{sceneView:v,mapv:y}]}})})}function Te(f,v,h,m,g){return Ie(this,void 0,void 0,function(){var i,l,t,a,o,r,n,s,p,c,u,y,d,b;return _e(this,function(e){switch(e.label){case 0:return[4,Le(["esri/Map","esri/Basemap","esri/core/urlUtils","esri/config","esri/identity/IdentityManager","esri/geometry/Point","esri/views/MapView"])];case 1:return i=e.sent(),l=i[0],t=i[1],a=i[2],o=i[3],r=i[4],n=i[5],s=i[6],h.useProxy&&h.httpsDomains.map(function(e){a.addProxyRule({proxyUrl:e.proxyUrl,urlPrefix:e.domainName})}),o.geometryServiceUrl=v.geometryserviceUrl,o.fontsUrl=re.fonts.url,""!==m&&r.registerToken({server:v.serverurl,token:m}),r.on("dialog-create",function(){r.dialog.open=!0}),[4,function(n,s){return Me(this,void 0,void 0,function(){var i,l,t,a,o,r;return ke(this,function(e){switch(e.label){case 0:return[4,Le(["esri/geometry/Extent","esri/layers/TileLayer","esri/layers/VectorTileLayer","esri/layers/SceneLayer","esri/layers/SHCTiledMapServiceLayer","esri/layers/GroupLayer","esri/geometry/SpatialReference"])];case 1:return i=e.sent(),l=i[0],t=i[1],a=i[2],i[3],o=i[4],i[5],r=i[6],[2,n.map(function(e){switch(e.mapType){case"SHCTiledMapServiceLayer":var i=new l({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:r.WebMercator});return!0===e.isToken?new o({url:e.url,token:s,fullExtent:i,opacity:e.opacity,title:e.layerCName,id:e.layerEName,visible:e.visible}):new o({url:e.url,fullExtent:i,opacity:e.opacity,title:e.layerCName,id:e.layerEName,visible:e.visible});case"TileLayer":return new t(e.url,{id:e.layerEName,visible:e.visible,opacity:e.opacity,listMode:e.listMode,title:e.layerCName});case"VectorTileLayer":return new a({url:e.url,id:e.layerEName,visible:e.visible,opacity:e.opacity,listMode:e.listMode,title:e.layerCName})}})]}})})}(v.baseMapServices.layers,m)];case 2:if(p=e.sent(),c=new t({baseLayers:p,title:"底图",id:"basemap_as"}),u=new l({basemap:c}),void 0!==g.mapStyle)switch(g.mapStyle){case"smap://styles/light":u.basemap.id="basemap_zw",u.ground.surfaceColor="#EDEDED";break;case"smap://styles/dark":u.basemap.id="basemap_as",u.ground.surfaceColor="#021425";break;case"smap://styles/image":u.basemap.id="basemap_air",u.ground.surfaceColor="#021425";break;default:u.basemap.id="basemap_as",u.ground.surfaceColor="#021425"}else u.basemap.id="basemap_as",u.ground.surfaceColor="#021425";return u.basemap.baseLayers.items.forEach(function(e){e.id===u.basemap.id?e.visible=!0:e.visible=!1}),y=void 0===g.viewMode||"2D"===g.viewMode?"2D":"3D",[4,Ce(v.smapbussinessLayers.layerGroups,m,y)];case 3:return d=e.sent(),u.addMany(d),(b=new s({map:u,container:f,spatialReference:{wkid:102100}})).ui.empty("top-left"),b.ui.empty("top-right"),b.ui.empty("bottom-left"),b.ui.empty("bottom-right"),b.padding={top:5,bottom:0,left:0,right:5},void 0!==g.center&&(b.center=new n({x:g.center[0],y:g.center[1],spatialReference:{wkid:102100}})),void 0!==g.zoom&&(b.zoom=g.zoom),void 0!==g.zooms&&(b.constraints.minZoom=g.zooms[0],b.constraints.maxZoom=g.zooms[1]),void 0!==g.rotateEnable&&(b.constraints.rotationEnabled=g.rotateEnable),[2,{mapView:b,mapv:u}]}})})}var Ae=(Pe.prototype._addListener=function(e,i,l){if(this.emit("newListener",e,i),this.events.has(e)){var t=this.events.get(e);l?t.unshift(i):t.push(i)}else this.events.set(e,[i]);var a=this.getMaxListeners();if(0<a&&this.listenerCount(e)>a){var o=new Error("Possible EventEmitter memory leak detected.\n         "+this.listenerCount(e)+" "+e.toString()+" listeners.\n         Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",console.warn(o)}return this},Pe.prototype.addListener=function(e,i){return this._addListener(e,i,!1)},Pe.prototype.emit=function(e){for(var i=[],l=1;l<arguments.length;l++)i[l-1]=arguments[l];if(this.events.has(e)){for(var t=0,a=this.events.get(e).slice();t<a.length;t++){var o=a[t];try{o.apply(this,i)}catch(e){this.emit("error",e)}}return!0}if("error"===e)throw 0<i.length?i[0]:Error("Unhandled error.");return!1},Pe.prototype.eventNames=function(){return Array.from(this.events.keys())},Pe.prototype.getMaxListeners=function(){return this.maxListeners||Pe.defaultMaxListeners},Pe.prototype.listenerCount=function(e){return this.events.has(e)?this.events.get(e).length:0},Pe.prototype._listeners=function(e,i,l){if(!e.events.has(i))return[];var t=e.events.get(i);return l?this.unwrapListeners(t):t.slice(0)},Pe.prototype.unwrapListeners=function(e){for(var i=new Array(e.length),l=0;l<e.length;l++)i[l]=e[l].listener||e[l];return i},Pe.prototype.listeners=function(e){return this._listeners(this,e,!0)},Pe.prototype.rawListeners=function(e){return this._listeners(this,e,!1)},Pe.prototype.off=function(e,i){return this.removeListener(e,i)},Pe.prototype.on=function(e,i){return this.addListener(e,i)},Pe.prototype.once=function(e,i){var l=this.onceWrap(e,i);return this.on(e,l),this},Pe.prototype.onceWrap=function(e,i){function l(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.context.removeListener(this.eventName,this.rawListener),this.listener.apply(this.context,e)}var t={eventName:e,listener:i,rawListener:l,context:this},a=l.bind(t);return(t.rawListener=a).listener=i,a},Pe.prototype.prependListener=function(e,i){return this._addListener(e,i,!0)},Pe.prototype.prependOnceListener=function(e,i){var l=this.onceWrap(e,i);return this.prependListener(e,l),this},Pe.prototype.removeAllListeners=function(e){var i=this;if(void 0===this.events)return this;if(this.events.has(e)){var l=this.events.get(e).slice();this.events.delete(e);for(var t=0,a=l;t<a.length;t++){var o=a[t];this.emit("removeListener",e,o)}}else this.eventNames().map(function(e){i.removeAllListeners(e)});return this},Pe.prototype.removeListener=function(e,i){if(this.events.has(e)){var l=this.events.get(e);-1!==l.indexOf(i)&&(l.splice(l.indexOf(i),1),this.emit("removeListener",e,i),0===l.length&&this.events.delete(e))}return this},Pe.prototype.setMaxListeners=function(e){return this.maxListeners=e,this},Pe.defaultMaxListeners=50,Pe);function Pe(){this.events=new Map}var Re=(Oe.maploaded="maploaded",Oe.zoomchanged="zoomchanged",Oe.extentchanged="extentchanged",Oe.centerchanged="centerchanged",Oe.blur="blur",Oe.click="click",Oe.doubleclick="doubleclick",Oe.drag="drag",Oe.focus="focus",Oe.hold="hold",Oe.keydown="key-down",Oe.keyup="key-up",Oe.mousewheel="mouse-wheel",Oe.pointerdown="pointer-down",Oe.pointerenter="pointer-enter",Oe.pointerleave="pointer-leave",Oe.pointermove="pointer-move",Oe.pointerup="pointer-up",Oe.resize="pointer-up",Oe.popupvisible="popup-visible",Oe);function Oe(){}var je,He,Be=(je=function(e,i){return(je=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}je(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)}),De=function(e,r,n,s){return new(n=n||Promise)(function(l,i){function t(e){try{o(s.next(e))}catch(e){i(e)}}function a(e){try{o(s.throw(e))}catch(e){i(e)}}function o(e){var i;e.done?l(e.value):((i=e.value)instanceof n?i:new n(function(e){e(i)})).then(t,a)}o((s=s.apply(e,r||[])).next())})},Ve=function(l,t){var a,o,r,e,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return e={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function i(i){return function(e){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;n;)try{if(a=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,o=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!(r=0<(r=n.trys).length&&r[r.length-1])&&(6===i[0]||2===i[0])){n=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){n.label=i[1];break}if(6===i[0]&&n.label<r[1]){n.label=r[1],r=i;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(i);break}r[2]&&n.ops.pop(),n.trys.pop();continue}i=t.call(l,n)}catch(e){i=[6,e],o=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,e])}}},Fe=(Be(We,He=Ae),We.prototype.setlayerRenderer=function(e,i){var l=this.view.map.findLayerById(e);l&&(l.renderer=i)},We.prototype.addLayer=function(e){!function(g,w,x){Me(this,void 0,void 0,function(){return ke(this,function(e){return Le(["esri/layers/TileLayer","esri/layers/SceneLayer","esri/layers/FeatureLayer","esri/layers/MapImageLayer","esri/layers/SHCTiledMapServiceLayer","esri/layers/SHCDMapImageLayer","esri/layers/GraphicsLayer","esri/geometry/Extent","esri/geometry/SpatialReference"]).then(function(e){var i=e[0],l=e[1],t=e[2],a=e[3],o=e[4],r=e[5],n=e[6],s=e[7],p=e[8];switch(g.layerType){case"TileLayer":var c=new i({url:g.layerUrl,id:g.layerId,visible:void 0===g.layerVisible||g.layerVisible,opacity:void 0!==g.layerOpacity?g.layerOpacity:1,title:g.layerTitle});g.layerMaxScale&&(c.maxScale=g.layerMaxScale),g.layerMinScale&&(c.minScale=g.layerMinScale),w.map.add(c);break;case"FeatureLayer":var u=new t({url:g.layerUrl,id:g.layerId,title:g.layerTitle,visible:void 0===g.layerVisible||g.layerVisible,opacity:void 0!==g.layerOpacity?g.layerOpacity:1});g.layerPopupEnabled&&(u.popupEnabled=g.layerPopupEnabled,g.layerPopupTemplate&&(u.popupTemplate=g.layerPopupTemplate)),g.layerRenderer&&(u.renderer=g.layerRenderer),g.layerMaxScale&&(u.maxScale=g.layerMaxScale),g.layerMinScale&&(u.minScale=g.layerMinScale),g.layerLabelsVisible&&(u.labelsVisible=g.layerLabelsVisible,g.layerLabelingInfo&&(u.labelingInfo=g.layerLabelingInfo)),g.layerelevationInfo&&(u.elevationInfo=g.layerelevationInfo),g.layerdefinitionExpression&&(u.definitionExpression=g.layerdefinitionExpression),w.map.add(u);break;case"SceneLayer":var y=new l({url:g.layerUrl,id:g.layerId,visible:void 0===g.layerVisible||g.layerVisible,opacity:void 0!==g.layerOpacity?g.layerOpacity:1,title:g.layerTitle});g.layerPopupEnabled&&(y.popupEnabled=g.layerPopupEnabled,g.layerPopupTemplate&&(y.popupTemplate=g.layerPopupTemplate)),g.layerRenderer&&(y.renderer=g.layerRenderer),g.layerMaxScale&&(y.maxScale=g.layerMaxScale),g.layerMinScale&&(y.minScale=g.layerMinScale),g.layerelevationInfo&&(y.elevationInfo=g.layerelevationInfo),g.layerdefinitionExpression&&(y.definitionExpression=g.layerdefinitionExpression),w.map.add(y);break;case"MapImageLayer":var d=new a({url:g.layerUrl,id:g.layerId,title:g.layerTitle,visible:void 0===g.layerVisible||g.layerVisible,opacity:void 0!==g.layerOpacity?g.layerOpacity:1});g.layerMaxScale&&(d.maxScale=g.layerMaxScale),g.layerMinScale&&(d.minScale=g.layerMinScale),g.layerSublayers&&(d.sublayers=g.layerSublayers),w.map.add(d);break;case"SHCDMapImageLayer":var b=new a({url:g.layerUrl,id:g.layerId+"_legend",title:g.layerTitle,visible:!1,sublayers:g.layerSublayers,opacity:void 0!==g.layerOpacity?g.layerOpacity:1});w.map.add(b);var f=new s({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:p.WebMercator}),v=new r({url:g.layerUrl,fullExtent:f,opacity:void 0!==g.layerOpacity?g.layerOpacity:1,title:g.layerTitle,id:g.layerId,tileUrl:re.bujianurl,visible:void 0===g.layerVisible||g.layerVisible,legendEnabled:!1,sublayers:g.layerSublayers,dLayer:b});w.map.add(v);break;case"SHCTiledMapServiceLayer":var h=new s({xmin:-65e3,ymin:-76e3,xmax:75000.00000000003,ymax:72000.00000000003,spatialReference:p.WebMercator});!0===g.isToken?w.map.add(new o({url:g.layerUrl,token:x,fullExtent:h,title:g.layerTitle,opacity:void 0!==g.layerOpacity?g.layerOpacity:1,id:g.layerId,visible:void 0===g.layerVisible||g.layerVisible})):w.map.add(new o({url:g.layerUrl,fullExtent:h,opacity:void 0!==g.layerOpacity?g.layerOpacity:1,title:g.layerTitle,id:g.layerId,visible:void 0===g.layerVisible||g.layerVisible}));break;case"GraphicsLayer":var m=new n({id:g.layerId,visible:void 0===g.layerVisible||g.layerVisible,opacity:void 0!==g.layerOpacity?g.layerOpacity:1,title:g.layerTitle});g.layerMaxScale&&(m.maxScale=g.layerMaxScale),g.layerMinScale&&(m.minScale=g.layerMinScale),g.layerelevationInfo&&(m.elevationInfo=g.layerelevationInfo),w.map.add(m)}}).catch(function(e){console.error(e)}),[2]})})}(e,this.view,this.maptoken)},We.prototype.addLayers=function(e){!function(p,c){Me(this,void 0,void 0,function(){return ke(this,function(e){return Le(["esri/layers/TileLayer","esri/layers/SceneLayer","esri/layers/FeatureLayer","esri/layers/MapImageLayer","esri/layers/GroupLayer"]).then(function(e){var o=e[0],r=e[1],n=e[2],s=(e[3],e[4]);if(p instanceof Array)p.forEach(function(e){switch(e.layerType){case"TileLayer":var i=new o({url:e.layerUrl,id:e.layerId,title:e.layerTitle,visible:e.layerVisible,opacity:e.layerOpacity,listMode:e.layerlistMode});e.layerMaxScale&&(i.maxScale=e.layerMaxScale),e.layerMinScale&&(i.minScale=e.layerMinScale),c.map.add(i);break;case"FeatureLayer":var l=new n({url:e.layerUrl,id:e.layerId,title:e.layerTitle,visible:e.layerVisible,opacity:e.layerOpacity,listMode:e.layerlistMode,popupEnabled:e.layerPopupEnabled});e.layerPopupTemplate&&(l.popupTemplate=e.layerPopupTemplate),e.layerRenderer&&(l.renderer=e.layerRenderer),e.layerMaxScale&&(l.maxScale=e.layerMaxScale),e.layerMinScale&&(l.minScale=e.layerMinScale),e.layerLabelsVisible&&(l.labelsVisible=e.layerLabelsVisible,e.layerLabelingInfo&&(l.labelingInfo=e.layerLabelingInfo)),e.layerelevationInfo&&(l.elevationInfo=e.layerelevationInfo),e.layerdefinitionExpression&&(l.definitionExpression=e.layerdefinitionExpression),c.map.add(l);break;case"SceneLayer":var t=new r({url:e.layerUrl,id:e.layerId,title:e.layerTitle,visible:e.layerVisible,opacity:e.layerOpacity,listMode:e.layerlistMode,popupEnabled:e.layerPopupEnabled});e.layerPopupTemplate&&(t.popupTemplate=e.layerPopupTemplate),e.layerRenderer&&(t.renderer=e.layerRenderer),e.layerMaxScale&&(t.maxScale=e.layerMaxScale),e.layerMinScale&&(t.minScale=e.layerMinScale),e.layerelevationInfo&&(t.elevationInfo=e.layerelevationInfo),e.layerdefinitionExpression&&(t.definitionExpression=e.layerdefinitionExpression),c.map.add(t)}});else if("layergroup"===p.type){var a=[];p.layers.layerGroups.map(function(e){var i=new s({id:e.layerId,title:e.layerTitle,visible:e.layerVisible,listMode:e.listMode});if(null!=e.layerGroups){var l=e.layerGroups.reverse().map(function(e){var a=new s({id:e.layerId,title:e.layerTitle,visible:e.layerVisible,listMode:e.listMode});return e.layers.reverse().map(function(e){switch(e.layerType){case"TileLayer":var i=new o({url:e.layerUrl,id:e.layerId,title:e.layerTitle,visible:e.layerVisible,opacity:e.layerOpacity,listMode:e.listMode});e.layerMaxScale&&(i.maxScale=e.layerMaxScale),e.layerMinScale&&(i.minScale=e.layerMinScale),a.add(i);break;case"FeatureLayer":var l=new n({url:e.layerUrl,id:e.layerId,title:e.layerTitle,visible:e.layerVisible,opacity:e.layerOpacity,listMode:e.listMode});e.layerPopupEnabled&&(l.popupEnabled=e.layerPopupEnabled,e.layerPopupTemplate&&(l.popupTemplate=e.layerPopupTemplate)),e.layerRenderer&&(l.renderer=e.layerRenderer),e.layerMaxScale&&(l.maxScale=e.layerMaxScale),e.layerMinScale&&(l.minScale=e.layerMinScale),e.layerLabelsVisible&&(l.labelsVisible=e.layerLabelsVisible,e.layerLabelingInfo&&(l.labelingInfo=e.layerLabelingInfo)),e.layerelevationInfo&&(l.elevationInfo=e.layerelevationInfo),e.layerdefinitionExpression&&(l.definitionExpression=e.layerdefinitionExpression),a.add(l);break;case"SceneLayer":var t=new r({url:e.layerUrl,id:e.layerId,title:e.layerTitle,visible:e.layerVisible,opacity:e.layerOpacity,listMode:e.listMode});e.layerPopupEnabled&&(t.popupEnabled=e.layerPopupEnabled,e.layerPopupTemplate&&(t.popupTemplate=e.layerPopupTemplate)),e.layerRenderer&&(t.renderer=e.layerRenderer),e.layerMaxScale&&(t.maxScale=e.layerMaxScale),e.layerMinScale&&(t.minScale=e.layerMinScale),e.layerelevationInfo&&(t.elevationInfo=e.layerelevationInfo),e.layerdefinitionExpression&&(t.definitionExpression=e.layerdefinitionExpression),a.add(t)}}),a});i.addMany(l)}if(null!=e.layers){var t=e.layers.reverse().map(function(e){switch(e.layerType){case"TileLayer":var i=new o({url:e.layerUrl,id:e.layerId,title:e.layerTitle,visible:e.layerVisible,opacity:e.layerOpacity});return e.layerMaxScale&&(i.maxScale=e.layerMaxScale),e.layerMinScale&&(i.minScale=e.layerMinScale),i;case"FeatureLayer":var l=new n({url:e.layerUrl,id:e.layerId,title:e.layerTitle,visible:e.layerVisible,opacity:e.layerOpacity,listMode:e.listMode});return e.layerPopupEnabled&&(l.popupEnabled=e.layerPopupEnabled,e.layerPopupTemplate&&(l.popupTemplate=e.layerPopupTemplate)),e.layerRenderer&&(l.renderer=e.layerRenderer),e.layerMaxScale&&(l.maxScale=e.layerMaxScale),e.layerMinScale&&(l.minScale=e.layerMinScale),e.layerLabelsVisible&&(l.labelsVisible=e.layerLabelsVisible,e.layerLabelingInfo&&(l.labelingInfo=e.layerLabelingInfo)),e.layerelevationInfo&&(l.elevationInfo=e.layerelevationInfo),e.layerdefinitionExpression&&(l.definitionExpression=e.layerdefinitionExpression),l;case"SceneLayer":var t=new r({url:e.layerUrl,id:e.layerId,title:e.layerTitle,visible:e.layerVisible,opacity:e.layerOpacity});return e.layerPopupEnabled&&(t.popupEnabled=e.layerPopupEnabled,e.layerPopupTemplate&&(t.popupTemplate=e.layerPopupTemplate)),e.layerRenderer&&(t.renderer=e.layerRenderer),e.layerMaxScale&&(t.maxScale=e.layerMaxScale),e.layerMinScale&&(t.minScale=e.layerMinScale),e.layerelevationInfo&&(t.elevationInfo=e.layerelevationInfo),e.layerdefinitionExpression&&(t.definitionExpression=e.layerdefinitionExpression),t}});i.addMany(t)}"2d"===c.type&&"2d"!==e.grouptype||a.push(i)}),c.map.addMany(a)}else if("layer"===p.type)switch(p.layerType){case"TileLayer":var i=new o({url:p.layerUrl,id:p.layerId,title:p.layerTitle,visible:p.layerVisible,opacity:p.layerOpacity,listMode:p.layerlistMode});p.layerMaxScale&&(i.maxScale=p.layerMaxScale),p.layerMinScale&&(i.minScale=p.layerMinScale),c.map.add(i);break;case"FeatureLayer":var l=new n({url:p.layerUrl,id:p.layerId,title:p.layerTitle,visible:p.layerVisible,opacity:p.layerOpacity,listMode:p.layerlistMode});p.layerPopupEnabled&&(l.popupEnabled=p.layerPopupEnabled,p.layerPopupTemplate&&(l.popupTemplate=p.layerPopupTemplate)),p.layerRenderer&&(l.renderer=p.layerRenderer),p.layerMaxScale&&(l.maxScale=p.layerMaxScale),p.layerMinScale&&(l.minScale=p.layerMinScale),p.layerLabelsVisible&&(l.labelsVisible=p.layerLabelsVisible,p.layerLabelingInfo&&(l.labelingInfo=p.layerLabelingInfo)),p.layerelevationInfo&&(l.elevationInfo=p.layerelevationInfo),p.layerdefinitionExpression&&(l.definitionExpression=p.layerdefinitionExpression),c.map.add(l);break;case"SceneLayer":var t=new r({url:p.layerUrl,id:p.layerId,title:p.layerTitle,visible:p.layerVisible,opacity:p.layerOpacity,listMode:p.layerlistMode});p.layerPopupEnabled&&(t.popupEnabled=p.layerPopupEnabled,p.layerPopupTemplate&&(t.popupTemplate=p.layerPopupTemplate)),p.layerRenderer&&(t.renderer=p.layerRenderer),p.layerMaxScale&&(t.maxScale=p.layerMaxScale),p.layerMinScale&&(t.minScale=p.layerMinScale),p.layerelevationInfo&&(t.elevationInfo=p.layerelevationInfo),p.layerdefinitionExpression&&(t.definitionExpression=p.layerdefinitionExpression),c.map.add(t)}}),[2]})})}(e,this.view,this.maptoken)},We.prototype.getLayer=function(e){return this.view.map.findLayerById(e)},We.prototype.setLayerProperties=function(e){!function(l,t){Me(this,void 0,void 0,function(){var i;return ke(this,function(e){return l.layerId&&(i=t.map.findLayerById(l.layerId))&&(void 0!==l.layerTitle&&(i.title=l.layerTitle),void 0!==l.layerVisible&&(i.visible=l.layerVisible),void 0!==l.layerVisible&&(i.opacity=l.layerOpacity),void 0!==l.layerPopupEnabled&&(i.popupEnabled=l.layerPopupEnabled),void 0!==l.layerPopupTemplate&&(i.popupTemplate=l.layerPopupTemplate),void 0!==l.layerMaxScale&&(i.maxScale=l.layerMaxScale),void 0!==l.layerMinScale&&(i.minScale=l.layerMinScale),void 0!==l.layerLabelsVisible&&(i.labelsVisible=l.layerLabelsVisible),void 0!==l.layerLabelingInfo&&(i.labelingInfo=l.layerLabelingInfo),void 0!==l.layerRenderer&&(i.renderer=l.layerRenderer),void 0!==l.layerSublayers&&(i.sublayers=l.layerSublayers),void 0!==l.layerdefinitionExpression&&(i.definitionExpression=l.layerdefinitionExpression),void 0!==l.layerelevationInfo&&(i.elevationInfo=l.layerelevationInfo),void 0!==l.layerlistMode&&(i.layerlistMode=l.layerlistMode)),[2]})})}(e,this.view)},We.prototype.set3dlabel=function(){"2d"!==this.view.type&&function(n){Me(this,void 0,void 0,function(){var i,a,o,r;return ke(this,function(e){switch(e.label){case 0:return[4,Le(["esri/layers/FeatureLayer","esri/layers/GroupLayer"])];case 1:return i=e.sent(),a=i[0],o=i[1],r=[],re.gisService.smaplabel3d.layerGroups.map(function(e){var i=new o({id:e.id,title:e.title,visible:e.visible,listMode:e.listMode});if(null!=e.layerGroups){var l=e.layerGroups.reverse().map(function(e){var l=new o({id:e.id,title:e.title,visible:e.visible,listMode:e.listMode});return e.layers.reverse().map(function(e){switch(e.maptype){case"FeatureLayer":var i=new a({url:e.url,id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,listMode:e.listMode});e.MaxScale&&(i.maxScale=e.MaxScale),e.MinScale&&(i.minScale=e.MinScale),e.renderer&&(i.renderer=e.renderer),e.screenSizePerspectiveEnabled&&(i.screenSizePerspectiveEnabled=e.screenSizePerspectiveEnabled),e.elevationInfo&&(i.elevationInfo=e.elevationInfo),e.labelsVisible&&(i.labelsVisible=e.labelsVisible,e.labelingInfo&&(i.labelingInfo=e.labelingInfo)),e.popupEnabled&&(i.popupEnabled=e.popupEnabled,e.popupTemplate&&(i.popupTemplate=e.popupTemplate)),l.add(i)}}),l});i.addMany(l)}if(null!=e.layers){var t=e.layers.reverse().map(function(e){switch(e.maptype){case"FeatureLayer":var i=new a(e.url,{id:e.id,title:e.title,visible:e.visible,opacity:e.opacity,popupEnabled:e.popupEnabled});return e.MaxScale&&(i.maxScale=e.MaxScale),e.MinScale&&(i.minScale=e.MinScale),e.renderer&&(i.renderer=e.renderer),e.screenSizePerspectiveEnabled&&(i.screenSizePerspectiveEnabled=e.screenSizePerspectiveEnabled),e.elevationInfo&&(i.elevationInfo=e.elevationInfo),e.labelsVisible&&(i.labelsVisible=e.labelsVisible,e.labelingInfo&&(i.labelingInfo=e.labelingInfo)),e.popupEnabled&&(i.popupEnabled=e.popupEnabled,e.popupTemplate&&(i.popupTemplate=e.popupTemplate)),i}});i.addMany(t)}"2d"===n.type&&"2D"!==e.grouptype||r.push(i)}),n.map.addMany(r),[2]}})})}(this.view)},We.prototype.del3dlabel=function(){if("2d"!==this.view.type){var e=this.view.map.findLayerById("smap_3d_labelGroup");e&&this.view.map.remove(e)}},We.prototype.setmemoryLimit=function(e){this.view.qualitySettings.memoryLimit=e},We.prototype.removeLayer=function(e){var i=this.view.map.findLayerById(e);i&&this.view.map.remove(i)},We.prototype.getZoom=function(){if(this.view)return this.view.zoom},We.prototype.setZoom=function(e){this.view&&(this.view.zoom=e)},We.prototype.panTo=function(l){var t=this;this.view&&Le(["esri/geometry/Point"]).then(function(e){var i=new e[0]({x:l[0],y:l[1],z:void 0!==l[2]?l[2]:0,spatialReference:t.view.spatialReference});t.view.center=i}).catch(function(e){console.error(e)})},We.prototype.panBy=function(e,i){if(this.view){var l=this.view.center,t=this.view.toScreen(l);this.view.center=this.view.toMap({x:t.x+e,y:t.y+i})}},We.prototype.getBounds=function(){if(this.view){var e={};return e.southwest=[this.view.extent.xmin.toFixed(6),this.view.extent.ymin.toFixed(6)],"3D"===this.viewMode&&void 0!==this.view.extent.zmin&&e.southwest.push(this.view.extent.zmin.toFixed(6)),e.northeast=[this.view.extent.xmax.toFixed(6),this.view.extent.ymax.toFixed(6)],"3D"===this.viewMode&&void 0!==this.view.extent.zmax&&e.northeast.push(this.view.extent.zmax.toFixed(6)),e}},We.prototype.setBounds=function(t){var a=this;this.view&&Le(["esri/geometry/Extent","esri/geometry/SpatialReference"]).then(function(e){var i=e[0],l=(e[1],new i({xmin:t.xmin,ymin:t.ymin,xmax:t.xmax,zmax:t.ymax,spatialReference:a.view.spatialReference}));"3D"===a.viewMode&&void 0!==t.zmin&&void 0!==t.zmax&&(l.zmin=t.zmin,l.zmax=t.zmax),a.view.extent=l}).catch(function(e){console.error(e)})},We.prototype.setCenter=function(a,o,r){return De(this,void 0,void 0,function(){var i,l,t;return Ve(this,function(e){switch(e.label){case 0:return this.view?[4,Le(["esri/geometry/Point","esri/geometry/SpatialReference"])]:[3,2];case 1:i=e.sent(),l=i[0],i[1],t=null,t="2D"===this.viewMode?new l({x:a,y:o,spatialReference:this.view.spatialReference}):new l({x:a,y:o,z:void 0!==r?r:0,spatialReference:this.view.spatialReference}),this.view.center=t,e.label=2;case 2:return[2]}})})},We.prototype.setZoomAndCenter=function(a,o){return De(this,void 0,void 0,function(){var i,l,t;return Ve(this,function(e){switch(e.label){case 0:return this.view?[4,Le(["esri/geometry/Point","esri/geometry/SpatialReference"])]:[3,2];case 1:i=e.sent(),l=i[0],i[1],t=null,"2D"===this.viewMode?(this.view.zoom=a,t=new l({x:o[0],y:o[1],spatialReference:this.view.spatialReference}),this.view.center=t):(t=new l({x:o[0],y:o[1],z:void 0!==o[2]?o[2]:0,spatialReference:this.view.spatialReference}),this.view.goTo({center:t,zoom:a,tilt:this.view.camera.tilt,heading:this.view.camera.heading})),e.label=2;case 2:return[2]}})})},We.prototype.getCenter=function(){if(this.view){var e=[];return e.push(this.view.center.x.toFixed(6)),e.push(this.view.center.y.toFixed(6)),"3D"===this.viewMode&&e.push(this.view.center.z.toFixed(6)),e}},We.prototype.getScale=function(){if(this.view)return this.view.scale},We.prototype.setRotation=function(e){this.view&&("2D"===this.viewMode?this.view.rotation=e:this.view.goTo({center:this.view.center,zoom:this.view.zoom,tilt:this.view.camera.tilt,heading:e}))},We.prototype.setPitch=function(e){this.view&&"3D"===this.viewMode&&this.view.goTo({center:this.view.center,zoom:this.view.zoom,tilt:e,heading:this.view.camera.heading})},We.prototype.getPitch=function(){if(this.view&&"3D"===this.viewMode)return this.view.camera.tilt},We.prototype.zoomIn=function(){this.view&&("3D"===this.viewMode?this.view.zoom+1>=this.zooms[0]&&this.view.zoom+1<=this.zooms[1]&&this.view.goTo({center:this.view.center,zoom:this.view.zoom+1,tilt:this.view.camera.tilt,heading:this.view.camera.heading}):this.view.goTo({center:this.view.center,zoom:this.view.zoom+1}))},We.prototype.zoomOut=function(){this.view&&("3D"===this.viewMode?this.view.zoom-1>=this.zooms[0]&&this.view.zoom-1<=this.zooms[1]&&this.view.goTo({center:this.view.center,zoom:this.view.zoom-1,tilt:this.view.camera.tilt,heading:this.view.camera.heading}):this.view.goTo({center:this.view.center,zoom:this.view.zoom-1}))},We.prototype.toggleBuildingBlock=function(){switch(this.showBuildingBlock=!this.showBuildingBlock,this.view.map.basemap.id){case"basemap_zw":var e=this.view.map.findLayerById("model_white_zw");e&&(this.showBuildingBlock?e.visible=!0:e.visible=!1);break;case"basemap_as":var i=this.view.map.findLayerById("model_white_as");i&&(this.showBuildingBlock?i.visible=!0:i.visible=!1);break;case"basemap_air":var l=this.view.map.findLayerById("model_air_real");l&&(this.showBuildingBlock?l.visible=!0:l.visible=!1)}},We.prototype.setMapStyle=function(e){var l=this;if(this.view){switch(e){case"smap://styles/light":this.view.map.basemap.id="basemap_zw",this.view.map.ground.surfaceColor="#EDEDED";break;case"smap://styles/dark":this.view.map.basemap.id="basemap_as",this.view.map.ground.surfaceColor="#021425";break;case"smap://styles/image":this.view.map.basemap.id="basemap_air",this.view.map.ground.surfaceColor="#021425";break;default:return this.view.map.basemap.id="basemap_as",void(this.view.map.ground.surfaceColor="#021425")}if(this.view.map.basemap.baseLayers.items.forEach(function(e){e.id===l.view.map.basemap.id?e.visible=!0:e.visible=!1}),"2D"===this.viewMode)return;["model_white_zw","model_air_real","model_white_as"].forEach(function(e){var i=l.view.map.findLayerById(e);!1===l.showBuildingBlock?i&&(i.visible=!1):i&&("basemap_zw"===l.view.map.basemap.id?i.visible="model_white_zw"===e:"basemap_as"===l.view.map.basemap.id?i.visible="model_white_as"===e:"basemap_air"===l.view.map.basemap.id&&(i.visible="model_air_real"===e))})}},We.prototype.getMapStyle=function(){if(this.view)switch(this.view.map.basemap.id){case"basemap_zw":return"smap://styles/light";case"basemap_as":return"smap://styles/dark";case"basemap_air":return"smap://styles/image"}},We.prototype.cameraTiltConstraint=function(l){var t=this;"2d"!==this.view.type&&(l?Le(["esri/core/watchUtils"]).then(function(e){var i=e[0].init(t.view,"camera.tilt",function(e){if(console.log(e),l<e){var i=t.view.camera.clone();i.tilt=l,t.view.camera=i}});t.watchHandles.push(["cameratiltConstraint",i])}):this.watchHandles.filter(function(e){return"cameratiltConstraint"===e[0]}).forEach(function(e){e&&e[1].remove()}))},We.prototype.enableMouseEvent=function(e){if(e)this.watchHandles.filter(function(e){return"EnablemouseEventdraghandler"===e[0]||"EnablemouseEventdoubleclickhandler"===e[0]||"EnablemouseEventmouseWheelhandler"===e[0]}).forEach(function(e){e[1].remove()}),this.watchHandles=this.watchHandles.filter(function(e){return"EnablemouseEventdraghandler"!==e[0]&&"EnablemouseEventdoubleclickhandler"!==e[0]&&"EnablemouseEventmouseWheelhandler"!==e[0]});else{var i=this.view.on("drag",function(e){e.stopPropagation()});this.watchHandles.push(["EnablemouseEventdraghandler",i]),this.view.on("double-click",function(e){e.stopPropagation()}),this.watchHandles.push(["EnablemouseEventdoubleclickhandler",i]),this.view.on("mouse-wheel",function(e){e.stopPropagation()}),this.watchHandles.push(["EnablemouseEventmouseWheelhandler",i])}},We.prototype.switchMode=function(e){if("2d"===e){this.view.goTo({heading:0,tilt:0});var i=this.view.on("drag",function(e){2===e.button&&e.stopPropagation()});this.watchHandles.push(["viewmodeswitchhandler",i])}else this.view.goTo({heading:0,tilt:60}),this.watchHandles.filter(function(e){return"viewmodeswitchhandler"===e[0]}).forEach(function(e){e[1].remove()}),this.watchHandles=this.watchHandles.filter(function(e){return"viewmodeswitchhandler"!==e[0]})},We.prototype.showBuilding=function(e){var l=this;null!==this.view&&"2D"!==this.viewMode&&(this.showBuildingBlock=!!e,["model_white_zw","model_air_real","model_white_as"].forEach(function(e){var i=l.view.map.findLayerById(e);!1===l.showBuildingBlock?i&&(i.visible=!1):i&&("basemap_zw"===l.view.map.basemap.id?i.visible="model_white_zw"===e:"basemap_as"===l.view.map.basemap.id?i.visible="model_white_as"===e:"basemap_air"===l.view.map.basemap.id&&(i.visible="model_air_real"===e))}))},We.prototype.addControl=function(o){var r=this;if("toc"===o.controlName.toLowerCase())Le(["esri/widgets/LayerList","esri/widgets/Expand"]).then(function(e){var i=e[0],l=e[1],t=new i({container:document.createElement("div"),id:"maplayerlist",view:r.view});if(o.collapse){var a=new l({id:"layerlistonly",view:r.view,content:t.domNode,expandIconClass:"esri-icon-layers",expandTooltip:"专题图层框",group:"top-left"});r.mapControl.push([o.controlName,a]),o.visible&&r.view.ui.add(a,o.position)}else r.mapControl.push([o.controlName,t]),r.view.ui.add(t,o.position)}).catch(function(e){console.error(e)});else if("zoom"===o.controlName.toLowerCase())Le(["esri/widgets/Zoom"]).then(function(e){var i=new e[0]({view:r.view});r.mapControl.push([o.controlName,i]),o.visible&&r.view.ui.add(i,o.position)}).catch(function(e){console.error(e)});else if("compass"===o.controlName.toLowerCase())Le(["esri/widgets/Compass"]).then(function(e){var i=new e[0]({view:r.view});r.mapControl.push([o.controlName,i]),o.visible&&r.view.ui.add(i,o.position)}).catch(function(e){console.error(e)});else if("home"===o.controlName.toLowerCase())Le(["esri/widgets/Home"]).then(function(e){var i=new e[0]({view:r.view});r.mapControl.push([o.controlName,i]),o.visible&&r.view.ui.add(i,o.position)}).catch(function(e){console.error(e)});else if("fullscreen"===o.controlName.toLowerCase())Le(["esri/widgets/Fullscreen"]).then(function(e){var i=new e[0]({view:r.view});r.mapControl.push([o.controlName,i]),o.visible&&r.view.ui.add(i,o.position)}).catch(function(e){console.error(e)});else if("undergroundswitch"===o.controlName.toLowerCase()){if("2D"===this.viewMode)return;Le(["esri/widgets/AboveBelowModeSwitch"]).then(function(e){var i=new e[0]({view:r.view});r.mapControl.push([o.controlName,i]),o.visible&&r.view.ui.add(i,o.position)}).catch(function(e){console.error(e)})}else if("measurearea"===o.controlName.toLowerCase())"2D"===this.viewMode?Le(["esri/widgets/AreaMeasureMentButton2D"]).then(function(e){var i=new e[0]({view:r.view});r.mapControl.push([o.controlName,i]),o.visible&&r.view.ui.add(i,o.position)}).catch(function(e){console.error(e)}):Le(["esri/widgets/AreaMeasureMentButton3D"]).then(function(e){var i=new e[0]({view:r.view});r.mapControl.push([o.controlName,i]),o.visible&&r.view.ui.add(i,o.position)}).catch(function(e){console.error(e)});else if("measureline"===o.controlName.toLowerCase())"2D"===this.viewMode?Le(["esri/widgets/DistanceMeasureMentButton2D"]).then(function(e){var i=new e[0]({view:r.view});r.mapControl.push([o.controlName,i]),o.visible&&r.view.ui.add(i,o.position)}).catch(function(e){console.error(e)}):Le(["esri/widgets/DistanceMeasureMentButton3D"]).then(function(e){var i=new e[0]({view:r.view});r.mapControl.push([o.controlName,i]),o.visible&&r.view.ui.add(i,o.position)}).catch(function(e){console.error(e)});else if("basemaptoggle"===o.controlName.toLowerCase())"2D"===this.viewMode?Le(["esri/widgets/BaseMapSwitchButton2D"]).then(function(e){var i=new e[0]({view:r.view});r.mapControl.push([o.controlName,i]),o.visible&&r.view.ui.add(i,o.position)}).catch(function(e){console.error(e)}):Le(["esri/widgets/BaseMapSwitchButton3D"]).then(function(e){var i=new e[0]({view:r.view,showBuildingBlock:r.showBuildingBlock});r.mapControl.push([o.controlName,i]),o.visible&&r.view.ui.add(i,o.position)}).catch(function(e){console.error(e)});else if("basemapgallery"===o.controlName.toLowerCase())Le(["esri/widgets/BMapGallery_Control"]).then(function(e){var i=new e[0]({view:r.view,showBuildingBlock:r.showBuildingBlock});r.mapControl.push([o.controlName,i]),o.visible&&r.view.ui.add(i,o.position)}).catch(function(e){console.error(e)});else if("basemapgalleryexpand"===o.controlName.toLowerCase())Le(["esri/widgets/BMapGallery_Expand"]).then(function(e){var i=new e[0]({view:r.view,showBuildingBlock:r.showBuildingBlock});r.mapControl.push([o.controlName,i]),o.visible&&r.view.ui.add(i,o.position)}).catch(function(e){console.error(e)});else if("bimfilter"===o.controlName.toLowerCase()){if("2D"===this.viewMode)return;Le(["esri/widgets/BuildingSencelayerFilter"]).then(function(e){var i=new e[0]({view:r.view,layerid:o.layerid});r.mapControl.push([o.controlName,i]),o.visible&&r.view.ui.add(i,o.position)}).catch(function(e){console.error(e)})}else if("performanceinfo"===o.controlName.toLowerCase()){if("2D"===this.viewMode)return;Le(["esri/widgets/PerformanceInfo"]).then(function(e){var i=new e[0]({view:r.view});r.mapControl.push([o.controlName,i]),o.visible&&r.view.ui.add(i,o.position)}).catch(function(e){console.error(e)})}},We.prototype.removeControl=function(t){var a=this;this.mapControl.forEach(function(e,i,l){e[0]===t.controlName&&(a.view.ui.remove(e[1]),a.mapControl.slice(i,1))})},We.prototype.enableThroughGround=function(e){null!==this.view&&"2D"!==this.viewMode&&(e?(this.view.map.ground.surfaceColor="#fff",this.view.map.ground.opacity=0,this.view.map.ground.navigationConstraint={type:"none"}):(this.view.map.ground.surfaceColor=null,this.view.map.ground.opacity=1,this.view.map.ground.navigationConstraint={type:"stay-above"}))},We.prototype.add=function(S){var z=this;Le(["esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){var m=e[0],g=e[1],w=(e[2],e[3]),x=e[4];if(S instanceof Array)S.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var i=void 0;i=e.symbol?e.symbol:"2d"===z.view.type?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]};var l=e.attributes;l.uuid=e.uuid;var t=new m({geometry:new g({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:z.view.spatialReference}),symbol:i,attributes:l});if(z.mapoverlayers.push(["smap-default",e.uuid,t]),z.view.graphics.add(t),e.label.visible){var a=null;a=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}};var o=new m({geometry:new g({x:"3d"===z.view.type?e.position[0]+e.label.xoffset:e.position[0],y:"3d"===z.view.type?e.position[1]+e.label.yoffset:e.position[1],z:"3d"===z.view.type?e.position[2]+e.label.zoffset:e.position[2],spatialReference:z.view.spatialReference}),symbol:a,attributes:l});z.view.graphics.add(o),z.mapoverlayers.push(["smap-default",e.uuid,o])}}else if("polyline"===e.overlaytype.toLowerCase()){var r=null;r=e.symbol?e.symbol:{type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin};var n=[];e.path.forEach(function(e){n.push([e.X,e.Y,e.Z])});var s=new w({hasZ:!1,hasM:!1,paths:n,spatialReference:z.view.spatialReference}),p=e.attributes;p.uuid=e.uuid;var c=new m({geometry:s,symbol:r,attributes:p});if(z.mapoverlayers.push(["smap-default",e.uuid,c]),z.view.graphics.add(c),e.label.visible){var u=null;u=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},o=new m({geometry:c.geometry.extent.center,symbol:u,attributes:p}),z.view.graphics.add(o),z.mapoverlayers.push(["smap-default",e.uuid,o])}}else if("polygon"===e.overlaytype.toLowerCase()){var y=void 0;y=e.symbol?e.symbol:"simple"===e.symboltype?{type:"simple-fill",color:e.fillColor,style:e.style,outline:{color:e.strokeColor,width:e.strokeWeight,style:e.strokestyle}}:{type:"picture-fill",url:e.url,width:e.picwidth,height:e.picheight,outline:{style:e.strokestyle,color:e.strokeColor,width:e.strokeWeight}};var d=[];e.paths.forEach(function(e){d.push([e.X,e.Y,e.Z])});var b=new x({hasZ:!0,hasM:!0,rings:d,spatialReference:z.view.spatialReference}),f=e.attributes;f.uuid=e.uuid;var v=new m({geometry:b,symbol:y,attributes:f});if(z.mapoverlayers.push(["smap-default",e.uuid,v]),z.view.graphics.add(v),e.label.visible){var h=null;h=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},o=new m({geometry:v.geometry.extent.center,symbol:h,attributes:f}),z.view.graphics.add(o),z.mapoverlayers.push(["smap-default",e.uuid,o])}}});else if("group"===S.type)S.overlayers.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var i=void 0;i=e.symbol?e.symbol:"2d"===z.view.type?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]};var l=e.attributes;l.uuid=e.uuid;var t=new m({geometry:new g({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:z.view.spatialReference}),symbol:i,attributes:l});if(z.mapoverlayers.push([S.uuid,e.uuid,t]),z.view.graphics.add(t),e.label.visible){var a=null;a=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}};var o=new m({geometry:new g({x:"3d"===z.view.type?e.position[0]+e.label.xoffset:e.position[0],y:"3d"===z.view.type?e.position[1]+e.label.yoffset:e.position[1],z:"3d"===z.view.type?e.position[2]+e.label.zoffset:e.position[2],spatialReference:z.view.spatialReference}),symbol:a,attributes:l});z.view.graphics.add(o),z.mapoverlayers.push([S.uuid,e.uuid,o])}}else if("polyline"===e.overlaytype.toLowerCase()){var r=null;r=e.symbol?e.symbol:{type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin};var n=[];e.path.forEach(function(e){n.push([e.X,e.Y,e.Z])});var s=new w({hasZ:!1,hasM:!1,paths:n,spatialReference:z.view.spatialReference}),p=e.attributes;p.uuid=e.uuid;var c=new m({geometry:s,symbol:r,attributes:p});if(z.mapoverlayers.push([S.uuid,e.uuid,c]),z.view.graphics.add(c),e.label.visible){var u=null;u=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},o=new m({geometry:c.geometry.extent.center,symbol:u,attributes:p}),z.view.graphics.add(o),z.mapoverlayers.push([S.uuid,e.uuid,o])}}else if("polygon"===e.overlaytype.toLowerCase()){var y=void 0;y=e.symbol?e.symbol:"simple"===e.symboltype?{type:"simple-fill",color:e.fillColor,style:e.style,outline:{color:e.strokeColor,width:e.strokeWeight,style:e.strokestyle}}:{type:"picture-fill",url:e.url,width:e.picwidth,height:e.picheight,outline:{style:e.strokestyle,color:e.strokeColor,width:e.strokeWeight}};var d=[];e.paths.forEach(function(e){d.push([e.X,e.Y,e.Z])});var b=e.attributes;b.uuid=e.uuid;var f=new x({hasZ:!0,hasM:!0,rings:d,spatialReference:z.view.spatialReference}),v=new m({geometry:f,symbol:y,attributes:b});if(z.mapoverlayers.push([S.uuid,e.uuid,v]),z.view.graphics.add(v),e.label.visible){var h=null;h=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},o=new m({geometry:v.geometry.extent.center,symbol:h,attributes:b}),z.view.graphics.add(o),z.mapoverlayers.push([S.uuid,e.uuid,o])}}});else if("element"===S.type)if("marker"===S.overlaytype.toLowerCase()){var i=void 0;i=S.symbol?S.symbol:"2d"===z.view.type?{type:"picture-marker",url:S.icon.image,width:S.icon.size.width,height:S.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:S.icon.size.width,resource:{href:S.icon.image}}]};var l=S.attributes;l.uuid=S.uuid;var t=new m({geometry:new g({x:S.position[0],y:S.position[1],z:void 0===S.position[2]?0:S.position[2],spatialReference:z.view.spatialReference}),symbol:i,attributes:l});if(z.mapoverlayers.push(["smap-default",S.uuid,t]),z.view.graphics.add(t),S.label.visible){var a=null;a=S.label.labelingInfo?S.label.labelingInfo:{type:S.label.type,text:S.label.text,color:S.label.color,angle:S.label.angle,backgroundColor:S.label.backgroundColor,borderLineColor:S.label.borderLineColor,borderLineSize:S.label.borderLineSize,kerning:S.label.kerning,lineHeight:S.label.lineHeight,lineWidth:S.label.lineWidth,rotated:S.label.rotated,haloColor:S.label.haloColor,haloSize:S.label.haloSize,xoffset:S.label.xoffset,yoffset:S.label.yoffset,verticalAlignment:S.label.verticalAlignment,horizontalAlignment:S.label.horizontalAlignment,font:{size:S.label.size,family:"Josefin Slab",weight:S.label.weight}};var o=new m({geometry:new g({x:"3d"===z.view.type?S.position[0]+S.label.xoffset:S.position[0],y:"3d"===z.view.type?S.position[1]+S.label.yoffset:S.position[1],z:"3d"===z.view.type?S.position[2]+S.label.zoffset:S.position[2],spatialReference:z.view.spatialReference}),symbol:a,attributes:l});z.view.graphics.add(o),z.mapoverlayers.push(["smap-default",S.uuid,o])}}else if("polyline"===S.overlaytype.toLowerCase()){var r=null;r=S.symbol?S.symbol:{type:"simple-line",color:S.strokeColor,style:S.style,width:S.width,cap:S.cap,join:S.lineJoin};var n=[];S.path.forEach(function(e){n.push([e.X,e.Y,e.Z])});var s=new w({hasZ:!1,hasM:!1,paths:n,spatialReference:z.view.spatialReference}),p=S.attributes;p.uuid=S.uuid;var c=new m({geometry:s,symbol:r,attributes:p});if(z.mapoverlayers.push(["smap-default",S.uuid,c]),z.view.graphics.add(c),S.label.visible){var u=null;u=S.label.labelingInfo?S.label.labelingInfo:{type:S.label.type,text:S.label.text,color:S.label.color,angle:S.label.angle,backgroundColor:S.label.backgroundColor,borderLineColor:S.label.borderLineColor,borderLineSize:S.label.borderLineSize,kerning:S.label.kerning,lineHeight:S.label.lineHeight,lineWidth:S.label.lineWidth,rotated:S.label.rotated,haloColor:S.label.haloColor,haloSize:S.label.haloSize,xoffset:S.label.xoffset,yoffset:S.label.yoffset,verticalAlignment:S.label.verticalAlignment,horizontalAlignment:S.label.horizontalAlignment,font:{size:S.label.size,family:"Josefin Slab",weight:S.label.weight}},o=new m({geometry:c.geometry.extent.center,symbol:u,attributes:p}),z.view.graphics.add(o),z.mapoverlayers.push(["smap-default",S.uuid,o])}}else if("polygon"===S.overlaytype.toLowerCase()){var y=void 0;y=S.symbol?S.symbol:"simple"===S.symboltype?{type:"simple-fill",color:S.fillColor,style:S.style,outline:{color:S.strokeColor,width:S.strokeWeight,style:S.strokestyle}}:{type:"picture-fill",url:S.url,width:S.picwidth,height:S.picheight,outline:{style:S.strokestyle,color:S.strokeColor,width:S.strokeWeight}};var d=[];S.paths.forEach(function(e){d.push([e.X,e.Y,e.Z])});var b=S.attributes;b.uuid=S.uuid;var f=new x({hasZ:!0,hasM:!0,rings:d,spatialReference:z.view.spatialReference}),v=new m({geometry:f,symbol:y,attributes:b});z.mapoverlayers.push(["smap-default",S.uuid,v]),z.view.graphics.add(v),S.label.visible&&(u=null,u=S.label.labelingInfo?S.label.labelingInfo:{type:S.label.type,text:S.label.text,color:S.label.color,angle:S.label.angle,backgroundColor:S.label.backgroundColor,borderLineColor:S.label.borderLineColor,borderLineSize:S.label.borderLineSize,kerning:S.label.kerning,lineHeight:S.label.lineHeight,lineWidth:S.label.lineWidth,rotated:S.label.rotated,haloColor:S.label.haloColor,haloSize:S.label.haloSize,xoffset:S.label.xoffset,yoffset:S.label.yoffset,verticalAlignment:S.label.verticalAlignment,horizontalAlignment:S.label.horizontalAlignment,font:{size:S.label.size,family:"Josefin Slab",weight:S.label.weight}},o=new m({geometry:v.geometry.extent.center,symbol:u,attributes:b}),z.view.graphics.add(o),z.mapoverlayers.push(["smap-default",S.uuid,o]))}}).catch(function(e){console.error(e)})},We.prototype.remove=function(i){var l=this;i instanceof Array?i.forEach(function(i){l.mapoverlayers.filter(function(e){return e[1]===i.uuid}).forEach(function(e){l.view.graphics.remove(e[2])}),l.mapoverlayers=l.mapoverlayers.filter(function(e){return e[1]!==i.uuid})}):"group"===i.type?(this.mapoverlayers.filter(function(e){return e[0]===i.uuid}).forEach(function(e){l.view.graphics.remove(e[2])}),this.mapoverlayers=this.mapoverlayers.filter(function(e){return e[0]!==i.uuid})):"element"===i.type&&(this.mapoverlayers.filter(function(e){return e[1]===i.uuid}).forEach(function(e){l.view.graphics.remove(e[2])}),this.mapoverlayers=this.mapoverlayers.filter(function(e){return e[1]!==i.uuid}))},We.prototype.update=function(S){var z=this;Le(["esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){var m=e[0],g=e[1],w=(e[2],e[3]),x=e[4];if(S instanceof Array)S.forEach(function(i){if(z.mapoverlayers.filter(function(e){return e[1]===i.uuid}).forEach(function(e){z.view.graphics.remove(e[2])}),z.mapoverlayers=z.mapoverlayers.filter(function(e){return e[1]!==i.uuid}),"marker"===i.overlaytype.toLowerCase()){var e=void 0;e=i.symbol?i.symbol:"2d"===z.view.type?{type:"picture-marker",url:i.icon.image,width:i.icon.size.width,height:i.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:i.icon.size.width,resource:{href:i.icon.image}}]};var l=i.attributes;l.uuid=i.uuid;var t=new m({geometry:new g({x:i.position[0],y:i.position[1],z:void 0===i.position[2]?0:i.position[2],spatialReference:z.view.spatialReference}),symbol:e,attributes:l});if(z.mapoverlayers.push(["smap-default",i.uuid,t]),z.view.graphics.add(t),i.label.visible){var a=null;a=i.label.labelingInfo?i.label.labelingInfo:{type:i.label.type,text:i.label.text,color:i.label.color,angle:i.label.angle,backgroundColor:i.label.backgroundColor,borderLineColor:i.label.borderLineColor,borderLineSize:i.label.borderLineSize,kerning:i.label.kerning,lineHeight:i.label.lineHeight,lineWidth:i.label.lineWidth,rotated:i.label.rotated,haloColor:i.label.haloColor,haloSize:i.label.haloSize,xoffset:i.label.xoffset,yoffset:i.label.yoffset,verticalAlignment:i.label.verticalAlignment,horizontalAlignment:i.label.horizontalAlignment,font:{size:i.label.size,family:"Josefin Slab",weight:i.label.weight}};var o=new m({geometry:new g({x:"3d"===z.view.type?i.position[0]+i.label.xoffset:i.position[0],y:"3d"===z.view.type?i.position[1]+i.label.yoffset:i.position[1],z:"3d"===z.view.type?i.position[2]+i.label.zoffset:i.position[2],spatialReference:z.view.spatialReference}),symbol:a,attributes:l});z.view.graphics.add(o),z.mapoverlayers.push(["smap-default",i.uuid,o])}}else if("polyline"===i.overlaytype.toLowerCase()){var r=null;r=i.symbol?i.symbol:{type:"simple-line",color:i.strokeColor,style:i.style,width:i.width,cap:i.cap,join:i.lineJoin};var n=[];i.path.forEach(function(e){n.push([e.X,e.Y,e.Z])});var s=new w({hasZ:!1,hasM:!1,paths:n,spatialReference:z.view.spatialReference}),p=i.attributes;p.uuid=i.uuid;var c=new m({geometry:s,symbol:r,attributes:p});if(z.mapoverlayers.push(["smap-default",i.uuid,c]),z.view.graphics.add(c),i.label.visible){var u=null;u=i.label.labelingInfo?i.label.labelingInfo:{type:i.label.type,text:i.label.text,color:i.label.color,angle:i.label.angle,backgroundColor:i.label.backgroundColor,borderLineColor:i.label.borderLineColor,borderLineSize:i.label.borderLineSize,kerning:i.label.kerning,lineHeight:i.label.lineHeight,lineWidth:i.label.lineWidth,rotated:i.label.rotated,haloColor:i.label.haloColor,haloSize:i.label.haloSize,xoffset:i.label.xoffset,yoffset:i.label.yoffset,verticalAlignment:i.label.verticalAlignment,horizontalAlignment:i.label.horizontalAlignment,font:{size:i.label.size,family:"Josefin Slab",weight:i.label.weight}},o=new m({geometry:c.geometry.extent.center,symbol:u,attributes:p}),z.view.graphics.add(o),z.mapoverlayers.push(["smap-default",i.uuid,o])}}else if("polygon"===i.overlaytype.toLowerCase()){var y=void 0;y=i.symbol?i.symbol:"simple"===i.symboltype?{type:"simple-fill",color:i.fillColor,style:i.style,outline:{color:i.strokeColor,width:i.strokeWeight,style:i.strokestyle}}:{type:"picture-fill",url:i.url,width:i.picwidth,height:i.picheight,outline:{style:i.strokestyle,color:i.strokeColor,width:i.strokeWeight}};var d=[];i.paths.forEach(function(e){d.push([e.X,e.Y,e.Z])});var b=new x({hasZ:!0,hasM:!0,rings:d,spatialReference:z.view.spatialReference}),f=i.attributes;f.uuid=i.uuid;var v=new m({geometry:b,symbol:y,attributes:f});if(z.mapoverlayers.push(["smap-default",i.uuid,v]),z.view.graphics.add(v),i.label.visible){var h=null;h=i.label.labelingInfo?i.label.labelingInfo:{type:i.label.type,text:i.label.text,color:i.label.color,angle:i.label.angle,backgroundColor:i.label.backgroundColor,borderLineColor:i.label.borderLineColor,borderLineSize:i.label.borderLineSize,kerning:i.label.kerning,lineHeight:i.label.lineHeight,lineWidth:i.label.lineWidth,rotated:i.label.rotated,haloColor:i.label.haloColor,haloSize:i.label.haloSize,xoffset:i.label.xoffset,yoffset:i.label.yoffset,verticalAlignment:i.label.verticalAlignment,horizontalAlignment:i.label.horizontalAlignment,font:{size:i.label.size,family:"Josefin Slab",weight:i.label.weight}},o=new m({geometry:v.geometry.extent.center,symbol:h,attributes:f}),z.view.graphics.add(o),z.mapoverlayers.push(["smap-default",i.uuid,o])}}});else if("group"===S.type)z.mapoverlayers.filter(function(e){return e[0]===S.uuid}).forEach(function(e){z.view.graphics.remove(e[2])}),z.mapoverlayers=z.mapoverlayers.filter(function(e){return e[0]!==S.uuid}),S.overlayers.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var i=void 0;i=e.symbol?e.symbol:"2d"===z.view.type?{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]};var l=e.attributes;l.uuid=e.uuid;var t=new m({geometry:new g({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:z.view.spatialReference}),symbol:i,attributes:l});if(z.mapoverlayers.push([S.uuid,e.uuid,t]),z.view.graphics.add(t),e.label.visible){var a=null;a=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}};var o=new m({geometry:new g({x:"3d"===z.view.type?e.position[0]+e.label.xoffset:e.position[0],y:"3d"===z.view.type?e.position[1]+e.label.yoffset:e.position[1],z:"3d"===z.view.type?e.position[2]+e.label.zoffset:e.position[2],spatialReference:z.view.spatialReference}),symbol:a,attributes:l});z.view.graphics.add(o),z.mapoverlayers.push([S.uuid,e.uuid,o])}}else if("polyline"===e.overlaytype.toLowerCase()){var r=null;r=e.symbol?e.symbol:{type:"simple-line",color:e.strokeColor,style:e.style,width:e.width,cap:e.cap,join:e.lineJoin};var n=[];e.path.forEach(function(e){n.push([e.X,e.Y,e.Z])});var s=new w({hasZ:!1,hasM:!1,paths:n,spatialReference:z.view.spatialReference}),p=e.attributes;p.uuid=e.uuid;var c=new m({geometry:s,symbol:r,attributes:p});if(z.mapoverlayers.push([S.uuid,e.uuid,c]),z.view.graphics.add(c),e.label.visible){var u=null;u=e.label.labelingInfo?e.label.labelingInfo:{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}},o=new m({geometry:c.geometry.extent.center,symbol:u,attributes:p}),z.view.graphics.add(o),z.mapoverlayers.push([S.uuid,e.uuid,o])}}else if("polygon"===e.overlaytype.toLowerCase()){var y=void 0;y=e.symbol?e.symbol:"simple"===S.symboltype?{type:"simple-fill",color:S.fillColor,style:S.style,outline:{color:S.strokeColor,width:S.strokeWeight,style:S.strokestyle}}:{type:"picture-fill",url:S.url,width:S.picwidth,height:S.picheight,outline:{style:S.strokestyle,color:S.strokeColor,width:S.strokeWeight}};var d=[];S.paths.forEach(function(e){d.push([e.X,e.Y,e.Z])});var b=e.attributes;b.uuid=e.uuid;var f=new x({hasZ:!0,hasM:!0,rings:d,spatialReference:z.view.spatialReference}),v=new m({geometry:f,symbol:y,attributes:b});if(z.mapoverlayers.push(["smap-default",S.uuid,v]),z.view.graphics.add(v),S.label.visible){var h=null;h=e.label.labelingInfo?e.label.labelingInfo:{type:S.label.type,text:S.label.text,color:S.label.color,angle:S.label.angle,backgroundColor:S.label.backgroundColor,borderLineColor:S.label.borderLineColor,borderLineSize:S.label.borderLineSize,kerning:S.label.kerning,lineHeight:S.label.lineHeight,lineWidth:S.label.lineWidth,rotated:S.label.rotated,haloColor:S.label.haloColor,haloSize:S.label.haloSize,xoffset:S.label.xoffset,yoffset:S.label.yoffset,verticalAlignment:S.label.verticalAlignment,horizontalAlignment:S.label.horizontalAlignment,font:{size:S.label.size,family:"Josefin Slab",weight:S.label.weight}},o=new m({geometry:v.geometry.extent.center,symbol:h,attributes:b}),z.view.graphics.add(o),z.mapoverlayers.push(["smap-default",S.uuid,o])}}});else if("element"===S.type)if(z.mapoverlayers.filter(function(e){return e[1]===S.uuid}).forEach(function(e){z.view.graphics.remove(e[2])}),z.mapoverlayers=z.mapoverlayers.filter(function(e){return e[1]!==S.uuid}),"marker"===S.overlaytype.toLowerCase()){var i=void 0;i=S.symbol?S.symbol:"2d"===z.view.type?{type:"picture-marker",url:S.icon.image,width:S.icon.size.width,height:S.icon.size.height}:{type:"point-3d",symbolLayers:[{type:"icon",size:S.icon.size.width,resource:{href:S.icon.image}}]};var l=S.attributes;l.uuid=S.uuid;var t=new m({geometry:new g({x:S.position[0],y:S.position[1],z:void 0===S.position[2]?0:S.position[2],spatialReference:z.view.spatialReference}),symbol:i,attributes:l});if(z.mapoverlayers.push(["smap-default",S.uuid,t]),z.view.graphics.add(t),S.label.visible){var a=null;a=S.label.labelingInfo?S.label.labelingInfo:{type:S.label.type,text:S.label.text,color:S.label.color,angle:S.label.angle,backgroundColor:S.label.backgroundColor,borderLineColor:S.label.borderLineColor,borderLineSize:S.label.borderLineSize,kerning:S.label.kerning,lineHeight:S.label.lineHeight,lineWidth:S.label.lineWidth,rotated:S.label.rotated,haloColor:S.label.haloColor,haloSize:S.label.haloSize,xoffset:S.label.xoffset,yoffset:S.label.yoffset,verticalAlignment:S.label.verticalAlignment,horizontalAlignment:S.label.horizontalAlignment,font:{size:S.label.size,family:"Josefin Slab",weight:S.label.weight}};var o=new m({geometry:new g({x:"3d"===z.view.type?S.position[0]+S.label.xoffset:S.position[0],y:"3d"===z.view.type?S.position[1]+S.label.yoffset:S.position[1],z:"3d"===z.view.type?S.position[2]+S.label.zoffset:S.position[2],spatialReference:z.view.spatialReference}),symbol:a,attributes:l});z.view.graphics.add(o),z.mapoverlayers.push(["smap-default",S.uuid,o])}}else if("polyline"===S.overlaytype.toLowerCase()){var r=null;r=S.symbol?S.symbol:{type:"simple-line",color:S.strokeColor,style:S.style,width:S.width,cap:S.cap,join:S.lineJoin};var n=[];S.path.forEach(function(e){n.push([e.X,e.Y,e.Z])});var s=new w({hasZ:!1,hasM:!1,paths:n,spatialReference:z.view.spatialReference}),p=S.attributes;p.uuid=S.uuid;var c=new m({geometry:s,symbol:r,attributes:p});if(z.mapoverlayers.push(["smap-default",S.uuid,c]),z.view.graphics.add(c),S.label.visible){var u=null;u=S.label.labelingInfo?S.label.labelingInfo:{type:S.label.type,text:S.label.text,color:S.label.color,angle:S.label.angle,backgroundColor:S.label.backgroundColor,borderLineColor:S.label.borderLineColor,borderLineSize:S.label.borderLineSize,kerning:S.label.kerning,lineHeight:S.label.lineHeight,lineWidth:S.label.lineWidth,rotated:S.label.rotated,haloColor:S.label.haloColor,haloSize:S.label.haloSize,xoffset:S.label.xoffset,yoffset:S.label.yoffset,verticalAlignment:S.label.verticalAlignment,horizontalAlignment:S.label.horizontalAlignment,font:{size:S.label.size,family:"Josefin Slab",weight:S.label.weight}},o=new m({geometry:c.geometry.extent.center,symbol:u,attributes:p}),z.view.graphics.add(o),z.mapoverlayers.push(["smap-default",S.uuid,o])}}else if("polygon"===S.overlaytype.toLowerCase()){var y=void 0;y=S.symbol?S.symbol:"simple"===S.symboltype?{type:"simple-fill",color:S.fillColor,style:S.style,outline:{color:S.strokeColor,width:S.strokeWeight,style:S.strokestyle}}:{type:"picture-fill",url:S.url,width:S.picwidth,height:S.picheight,outline:{style:S.strokestyle,color:S.strokeColor,width:S.strokeWeight}};var d=[];S.paths.forEach(function(e){d.push([e.X,e.Y,e.Z])});var b=new x({hasZ:!0,hasM:!0,rings:d,spatialReference:z.view.spatialReference}),f=S.attributes;f.uuid=S.uuid;var v=new m({geometry:b,symbol:y,attributes:f});z.mapoverlayers.push(["smap-default",S.uuid,v]),z.view.graphics.add(v),S.label.visible&&(u=null,u=S.label.labelingInfo?S.label.labelingInfo:{type:S.label.type,text:S.label.text,color:S.label.color,angle:S.label.angle,backgroundColor:S.label.backgroundColor,borderLineColor:S.label.borderLineColor,borderLineSize:S.label.borderLineSize,kerning:S.label.kerning,lineHeight:S.label.lineHeight,lineWidth:S.label.lineWidth,rotated:S.label.rotated,haloColor:S.label.haloColor,haloSize:S.label.haloSize,xoffset:S.label.xoffset,yoffset:S.label.yoffset,verticalAlignment:S.label.verticalAlignment,horizontalAlignment:S.label.horizontalAlignment,font:{size:S.label.size,family:"Josefin Slab",weight:S.label.weight}},o=new m({geometry:v.geometry.extent.center,symbol:u,attributes:f}),z.view.graphics.add(o),z.mapoverlayers.push(["smap-default",S.uuid,o]))}})},We.prototype.addfeature=function(f){var v=this;Le(["esri/layers/FeatureLayer","esri/layers/support/LabelClass","esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){var s=e[0],p=e[1],c=e[2],u=e[3];if(e[4],e[5],e[6],f instanceof Array)f.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var i=void 0;i=e.renderer?e.renderer:"3D"===v.viewMode?{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]}}:{type:"simple",symbol:{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}};var l=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}];Object.keys(e.attributes).forEach(function(e){l.push({name:e,alias:e,type:"string"})});var t=new s({id:e.uuid,title:e.uuid,objectIdField:"OBJECTID",geometryType:"point",renderer:i,screenSizePerspectiveEnabled:!0,popupEnabled:!1,popupTemplate:!1,visible:e.visible,maxScale:e.maxScale,minScale:e.minScale,fields:l,source:[],spatialReference:v.view.spatialReference});e.elevationInfo&&"3d"===v.view.type&&(t.elevationInfo=e.elevationInfo);var a=e.attributes;a.uuid=e.uuid;var o=new c({geometry:new u({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:v.view.spatialReference}),attributes:a});if(t.source.add(o),v.view.map.add(t),v.mapoverlayersflayer.push([e.uuid,e.uuid,o]),e.label.visible){var r=void 0;if(e.label.labelingInfo)r=e.label.labelingInfo,t.labelingInfo=r;else{r="2D"===v.viewMode?{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:e.label.color},size:e.label.size,halo:{color:e.label.haloColor,size:e.label.haloSize}}]};var n=new p({labelExpressionInfo:{expression:"$feature.NAME"},symbol:r,labelPlacement:e.label.placement,minScale:e.label.minScale,maxScale:e.label.maxScale});t.labelingInfo=[n]}}}});else if("group"===f.type){var i,l=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}];if(l.push({name:"style",alias:"样式",type:"string"}),f.datafiled.forEach(function(e){l.push(e)}),"marker"===f.overlaytype.toLowerCase()){f.renderer?i=f.renderer:(i={type:"unique-value",field:"style",uniqueValueInfos:[]},f.style.forEach(function(e){"3D"===v.viewMode?i.uniqueValueInfos.push({value:e.style,label:e.style,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:e.size.height,resource:{href:e.url}}]}}):i.uniqueValueInfos.push({value:e.style,label:e.style,symbol:{type:"picture-marker",url:e.url,width:e.size.width,height:e.size.height}})}));var t=new s({id:f.uuid,title:f.uuid,visible:f.visible,objectIdField:"OBJECTID",geometryType:"point",renderer:i,screenSizePerspectiveEnabled:!1,popupEnabled:!1,popupTemplate:!1,maxScale:f.maxScale,minScale:f.minScale,fields:l,source:[],spatialReference:v.view.spatialReference});if(f.elevationInfo&&"3d"===v.view.type&&(t.elevationInfo=f.elevationInfo),f.frreduction&&("3d"===v.view.type?t.featureReduction={type:f.frreduction.type}:t.featureReduction=f.frreduction.clusterConfig),v.view.map.add(t),f.overlayers.forEach(function(e){e.attributes.uuid=e.uuid;var i=new c({geometry:new u({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:v.view.spatialReference}),attributes:e.attributes});t.source.add(i),v.mapoverlayersflayer.push([f.uuid,e.uuid,i])}),f.label.visible){var a=void 0;if(f.label.labelingInfo)a=f.label.labelingInfo,t.labelingInfo=a;else{a="2D"===v.viewMode?{type:f.label.type,text:f.label.text,color:f.label.color,angle:f.label.angle,backgroundColor:f.label.backgroundColor,borderLineColor:f.label.borderLineColor,borderLineSize:f.label.borderLineSize,kerning:f.label.kerning,lineHeight:f.label.lineHeight,lineWidth:f.label.lineWidth,rotated:f.label.rotated,haloColor:f.label.haloColor,haloSize:f.label.haloSize,xoffset:f.label.xoffset,yoffset:f.label.yoffset,verticalAlignment:f.label.verticalAlignment,horizontalAlignment:f.label.horizontalAlignment,font:{size:f.label.size,family:"Josefin Slab",weight:f.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:f.label.color},size:f.label.size,halo:{color:f.label.haloColor,size:f.label.haloSize}}]};var o=new p({labelExpressionInfo:{expression:"$feature.NAME"},symbol:a,labelPlacement:f.label.placement,minScale:f.label.minScale,maxScale:f.label.maxScale});t.labelingInfo=[o]}}}}else if("element"===f.type&&"marker"===f.overlaytype.toLowerCase()){var r=void 0;r=f.renderer?f.renderer:"3D"===v.viewMode?{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:f.icon.size.width,resource:{href:f.icon.image}}]}}:{type:"simple",symbol:{type:"picture-marker",url:f.icon.image,width:f.icon.size.width,height:f.icon.size.height}};var n=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}];Object.keys(f.attributes).forEach(function(e){n.push({name:e,alias:e,type:"string"})});var y=new s({id:f.uuid,title:f.uuid,objectIdField:"OBJECTID",geometryType:"point",renderer:r,screenSizePerspectiveEnabled:!0,popupEnabled:!1,popupTemplate:!1,visible:f.visible,maxScale:f.maxScale,minScale:f.minScale,fields:n,source:[],spatialReference:v.view.spatialReference});f.elevationInfo&&"3d"===v.view.type&&(y.elevationInfo=f.elevationInfo);var d=f.attributes;d.uuid=f.uuid;var b=new c({geometry:new u({x:f.position[0],y:f.position[1],z:void 0===f.position[2]?0:f.position[2],spatialReference:v.view.spatialReference}),attributes:d});y.source.add(b),v.view.map.add(y),v.mapoverlayersflayer.push([f.uuid,f.uuid,b]),f.label.visible&&(a=void 0,f.label.labelingInfo?(a=f.label.labelingInfo,y.labelingInfo=a):(a="2D"===v.viewMode?{type:f.label.type,text:f.label.text,color:f.label.color,angle:f.label.angle,backgroundColor:f.label.backgroundColor,borderLineColor:f.label.borderLineColor,borderLineSize:f.label.borderLineSize,kerning:f.label.kerning,lineHeight:f.label.lineHeight,lineWidth:f.label.lineWidth,rotated:f.label.rotated,haloColor:f.label.haloColor,haloSize:f.label.haloSize,xoffset:f.label.xoffset,yoffset:f.label.yoffset,verticalAlignment:f.label.verticalAlignment,horizontalAlignment:f.label.horizontalAlignment,font:{size:f.label.size,family:"Josefin Slab",weight:f.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:f.label.color},size:f.label.size,halo:{color:f.label.haloColor,size:f.label.haloSize}}]},o=new p({labelExpressionInfo:{expression:"$feature.NAME"},symbol:a,labelPlacement:f.label.placement,minScale:f.label.minScale,maxScale:f.label.maxScale}),y.labelingInfo=[o]))}})},We.prototype.updatefeature=function(n){var s=this;Le(["esri/layers/FeatureLayer","esri/layers/support/LabelClass","esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/Polyline","esri/geometry/Polygon"]).then(function(e){e[0];var r=e[1],t=(e[2],e[3]);if(e[4],e[5],e[6],n instanceof Array)n.forEach(function(o){"marker"===o.overlaytype.toLowerCase()&&s.mapoverlayersflayer.filter(function(e){return e[1]===o.uuid}).forEach(function(i){var e=[],l=new t({x:o.position[0],y:o.position[1],z:void 0===o.position[2]?0:o.position[2],spatialReference:s.view.spatialReference});i[2].geometry=l,Object.keys(o.attributes).map(function(e){"objectId"!==e&&i[2].setAttribute(e,o.attributes[e])}),e.push(i[2]);var a=s.view.map.findLayerById(i[0]);null!==a&&a.applyEdits({updateFeatures:e}).then(function(e){var i;if(i=o.renderer?o.renderer:"3D"===s.viewMode?{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:o.icon.size.width,resource:{href:o.icon.image}}]}}:{type:"simple",symbol:{type:"picture-marker",url:o.icon.image,width:o.icon.size.width,height:o.icon.size.height}},o.label.visible){var l=void 0;if(o.label.labelingInfo)l=o.label.labelingInfo,a.labelingInfo=l;else{l="2D"===s.viewMode?{type:o.label.type,text:o.label.text,color:o.label.color,angle:o.label.angle,backgroundColor:o.label.backgroundColor,borderLineColor:o.label.borderLineColor,borderLineSize:o.label.borderLineSize,kerning:o.label.kerning,lineHeight:o.label.lineHeight,lineWidth:o.label.lineWidth,rotated:o.label.rotated,haloColor:o.label.haloColor,haloSize:o.label.haloSize,xoffset:o.label.xoffset,yoffset:o.label.yoffset,verticalAlignment:o.label.verticalAlignment,horizontalAlignment:o.label.horizontalAlignment,font:{size:o.label.size,family:"Josefin Slab",weight:o.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:o.label.color},size:o.label.size,halo:{color:o.label.haloColor,size:o.label.haloSize}}]};var t=new r({labelExpressionInfo:{expression:"$feature.NAME"},symbol:l,labelPlacement:o.label.placement,minScale:o.label.minScale,maxScale:o.label.maxScale});a.labelingInfo=[t]}}a.renderer=i,a.refresh()})})});else if("group"===n.type){var a=[];n.overlayers.forEach(function(i){var l=s.mapoverlayersflayer.filter(function(e){return e[1]===i.uuid});if(1===l.length){i.attributes.uuid=i.uuid;var e=new t({x:i.position[0],y:i.position[1],z:void 0===i.position[2]?0:i.position[2],spatialReference:s.view.spatialReference});l[0][2].geometry=e,Object.keys(i.attributes).map(function(e){"objectId"!==e&&l[0][2].setAttribute(e,i.attributes[e])}),a.push(l[0][2])}});var o=s.view.map.findLayerById(n.uuid);null!==o&&o.applyEdits({updateFeatures:a}).then(function(e){var i;if(n.renderer?i=n.renderer:(i={type:"unique-value",field:"style",uniqueValueInfos:[]},n.style.forEach(function(e){"3D"===s.viewMode?i.uniqueValueInfos.push({value:e.style,label:e.style,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:e.size.height,resource:{href:e.url}}]}}):i.uniqueValueInfos.push({value:e.style,label:e.style,symbol:{type:"picture-marker",url:e.url,width:e.size.width,height:e.size.height}})})),o.renderer=i,100<o.source.items.length&&null!=n.frreduction&&(o.featureReduction={type:n.frreduction.type,clusterRadius:n.frreduction.clusterRadius}),n.label.visible){var l=void 0;if(n.label.labelingInfo)l=n.label.labelingInfo;else{l="2D"===s.viewMode?{type:n.label.type,text:n.label.text,color:n.label.color,angle:n.label.angle,backgroundColor:n.label.backgroundColor,borderLineColor:n.label.borderLineColor,borderLineSize:n.label.borderLineSize,kerning:n.label.kerning,lineHeight:n.label.lineHeight,lineWidth:n.label.lineWidth,rotated:n.label.rotated,haloColor:n.label.haloColor,haloSize:n.label.haloSize,xoffset:n.label.xoffset,yoffset:n.label.yoffset,verticalAlignment:n.label.verticalAlignment,horizontalAlignment:n.label.horizontalAlignment,font:{size:n.label.size,family:"Josefin Slab",weight:n.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:n.label.color},size:n.label.size,halo:{color:n.label.haloColor,size:n.label.haloSize}}]};var t=new r({labelExpressionInfo:{expression:"$feature.NAME"},symbol:l,labelPlacement:n.label.placement,minScale:n.label.minScale,maxScale:n.label.maxScale});o.labelingInfo=[t]}}o.refresh()})}else"element"===n.type&&s.mapoverlayersflayer.filter(function(e){return e[1]===n.uuid}).forEach(function(a){var e=[];n.attributes.uuid=n.uuid;var i=new t({x:n.position[0],y:n.position[1],z:void 0===n.position[2]?0:n.position[2],spatialReference:s.view.spatialReference});a[2].geometry=i,Object.keys(n.attributes).map(function(e){"objectId"!==e&&a[2].setAttribute(e,n.attributes[e])}),e.push(a[2]);var o=s.view.map.findLayerById(a[0]);null!==o&&o.applyEdits({updateFeatures:e}).then(function(e){var i;if(a[0]===a[1]&&(i=n.renderer?"3D"===s.viewMode?{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:n.icon.size.width,resource:{href:n.icon.image}}]}}:{type:"simple",symbol:{type:"picture-marker",url:n.icon.image,width:n.icon.size.width,height:n.icon.size.height}}:n.renderer,o.renderer=i,n.label.visible)){var l=void 0;if(n.label.labelingInfo)l=n.label.labelingInfo,o.labelingInfo=l;else{l="2D"===s.viewMode?{type:n.label.type,text:n.label.text,color:n.label.color,angle:n.label.angle,backgroundColor:n.label.backgroundColor,borderLineColor:n.label.borderLineColor,borderLineSize:n.label.borderLineSize,kerning:n.label.kerning,lineHeight:n.label.lineHeight,lineWidth:n.label.lineWidth,rotated:n.label.rotated,haloColor:n.label.haloColor,haloSize:n.label.haloSize,xoffset:n.label.xoffset,yoffset:n.label.yoffset,verticalAlignment:n.label.verticalAlignment,horizontalAlignment:n.label.horizontalAlignment,font:{size:n.label.size,family:"Josefin Slab",weight:n.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:n.label.color},size:n.label.size,halo:{color:n.label.haloColor,size:n.label.haloSize}}]};var t=new r({labelExpressionInfo:{expression:"$feature.NAME"},symbol:l,labelPlacement:n.label.placement,minScale:n.label.minScale,maxScale:n.label.maxScale});o.labelingInfo=[t]}o.refresh()}})})})},We.prototype.removefeature=function(i){var l=this;if(i instanceof Array)i.forEach(function(i){l.mapoverlayersflayer.filter(function(e){return e[1]===i.uuid}).forEach(function(e){var i=l.view.map.findLayerById(e[0]);null!==i&&i.applyEdits({deleteFeatures:[e[2]]}).then(function(e){i.queryFeatures().then(function(e){0===e.features.length&&l.view.map.remove(i)})})}),l.mapoverlayersflayer=l.mapoverlayersflayer.filter(function(e){return e[1]!==i.uuid})});else if("group"===i.type){var e=this.view.map.findLayerById(i.uuid);null!==e&&this.view.map.remove(e),this.mapoverlayersflayer=this.mapoverlayersflayer.filter(function(e){return e[0]!==i.uuid})}else"element"===i.type&&(this.mapoverlayersflayer.filter(function(e){return e[1]===i.uuid}).forEach(function(e){var i=l.view.map.findLayerById(e[0]);null!==i&&i.applyEdits({deleteFeatures:[e[2]]}).then(function(e){i.queryFeatures().then(function(e){0===e.features.length&&l.view.map.remove(i)})})}),this.mapoverlayersflayer=this.mapoverlayersflayer.filter(function(e){return e[1]!==i.uuid}))},We.prototype.clearMap=function(){this.view.graphics.removeAll(),this.mapoverlayers=[]},We.prototype.setExtentConstrain=function(r,n){var s=this;Le(["esri/geometry/Extent","esri/geometry/geometryEngine","esri/core/watchUtils"]).then(function(e){var i=e[0],l=e[1],t=e[2],a=new i({xmin:r[0],ymin:r[1],xmax:n[0],ymax:n[1],spatialReference:s.view.spatialReference});s.view.extent=a;var o=t.whenTrue(s.view,"stationary",function(){l.contains(a,s.view.extent)||(s.view.extent=a)});s.watchHandles.push(["extentcontrain",o])})},We.prototype.removeExtentConstrain=function(){this.watchHandles.filter(function(e){return"extentcontrain"===e[0]}).forEach(function(e){e[1].remove()}),this.watchHandles=this.watchHandles.filter(function(e){return"extentcontrain"!==e[0]})},We.prototype.setmaskboundary=function(d){var b=this;Le(["esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Polygon","esri/geometry/geometryEngineAsync","esri/geometry/SpatialReference","esri/Color"]).then(function(e){var p=e[0],i=e[1],l=e[2],c=e[3],u=(e[4],e[5]),t=null;"qx_boundary"===d.boundaryType?t=b.view.map.findLayerById("qx_boundary"):"jd_boundary"===d.boundaryType?t=b.view.map.findLayerById("jd_boundary"):"jwh_boundary"===d.boundaryType&&(t=b.view.map.findLayerById("jwh_boundary"));var y=b.view.map.findLayerById("mask_boundary_graphiclayer");if(null==y&&(y=new i({id:"mask_boundary_graphiclayer",title:"遮罩层",listMode:"hide"}),b.view.map.add(y)),y.removeAll(),d.inputgeometry){if(null===(t=b.view.map.findLayerById("qx_boundary")))return;var a=new l({rings:d.inputgeometry,spatialReference:b.view.spatialReference}),o=t.fullExtent;o.spatialReference=b.view.spatialReference;var s=a;s.spatialReference=b.view.spatialReference,c.buffer(s,d.boundarydistance,"meters").then(function(e){c.difference(o,e).then(function(e){var i;i="3D"===b.viewMode?d.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:d.maskColor},size:d.symbol.size,edges:{type:"solid",color:d.maskColor}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:d.maskColor},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:d.maskColor,style:"solid",outline:{color:d.maskColor,width:1}};var l=new p({geometry:e,symbol:i});y.add(l);for(var a=void 0===d.bounarycount?30:d.bounarycount,o=Math.ceil(d.boundarydistance/a),r=new u(d.boundaryColor).toRgba(),t=function(t){c.buffer(s,t*a,"meters").then(function(i){c.buffer(s,(t-1)*a,"meters").then(function(e){c.difference(i,e).then(function(e){var i;r[3]=1/o*t,i="3D"===b.viewMode?d.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:r},size:d.symbol.size,edges:{type:"solid",color:r}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:r},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:r,style:"solid",outline:{color:r,width:1}};var l=new p({geometry:e,symbol:i});y.add(l)})})})},n=1;n<=o;n++)t(n)})})}else{if(null===t)return;var r=t.createQuery();r.where=d.boundaryDefinition,t.queryFeatures(r).then(function(e){if(e.features.length){var i=t.fullExtent;i.spatialReference=b.view.spatialReference;var s=e.features[0].geometry;s.spatialReference=b.view.spatialReference,c.buffer(s,d.boundarydistance,"meters").then(function(e){c.difference(i,e).then(function(e){var i;i="3D"===b.viewMode?d.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:d.maskColor},size:d.symbol.size,edges:{type:"solid",color:d.maskColor}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:d.maskColor},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:d.maskColor,style:"solid",outline:{color:d.maskColor,width:1}};var l=new p({geometry:e,symbol:i});y.add(l);for(var a=void 0===d.bounarycount?30:d.bounarycount,o=Math.ceil(d.boundarydistance/a),r=new u(d.boundaryColor).toRgba(),t=function(t){c.buffer(s,t*a,"meters").then(function(i){c.buffer(s,(t-1)*a,"meters").then(function(e){c.difference(i,e).then(function(e){var i;r[3]=1/o*t,i="3D"===b.viewMode?d.symbol?{type:"polygon-3d",symbolLayers:[{type:"extrude",material:{color:r},size:d.symbol.size,edges:{type:"solid",color:r}}]}:{type:"polygon-3d",symbolLayers:[{type:"fill",material:{color:r},outline:{color:"white",size:"0px"}}]}:{type:"simple-fill",color:r,style:"solid",outline:{color:r,width:1}};var l=new p({geometry:e,symbol:i});y.add(l)})})})},n=1;n<=o;n++)t(n)})})}})}}).catch(function(e){console.error(e)})},We.prototype.addfeatureCluster=function(b){var f=this;Le(["esri/layers/esriClusterLayer","esri/layers/support/LabelClass","esri/Graphic","esri/geometry/Point","esri/symbols/PictureMarkerSymbol"]).then(function(e){var s=e[0],p=e[1],c=e[2],u=e[3];if(e[4],b instanceof Array)b.forEach(function(e){if("marker"===e.overlaytype.toLowerCase()){var i=void 0;i=e.renderer?e.renderer:"3D"===f.viewMode?{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:e.icon.size.width,resource:{href:e.icon.image}}]}}:{type:"simple",symbol:{type:"picture-marker",url:e.icon.image,width:e.icon.size.width,height:e.icon.size.height}};var l=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}];Object.keys(e.attributes).forEach(function(e){l.push({name:e,alias:e,type:"string"})});var t=new s({id:e.uuid,title:e.uuid,objectIdField:"OBJECTID",geometryType:"point",renderer:i,screenSizePerspectiveEnabled:!0,popupEnabled:!1,popupTemplate:!1,visible:e.visible,maxScale:e.maxScale,minScale:e.minScale,fields:l,source:[],spatialReference:f.view.spatialReference});e.elevationInfo&&"3d"===f.view.type&&(t.elevationInfo=e.elevationInfo);var a=e.attributes;a.uuid=e.uuid;var o=new c({geometry:new u({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:f.view.spatialReference}),attributes:a});if(t.source.add(o),f.view.map.add(t),f.mapoverlayersflayer.push([e.uuid,e.uuid,o]),e.label.visible){var r=void 0;if(e.label.labelingInfo)r=e.label.labelingInfo,t.labelingInfo=r;else{r="2D"===f.viewMode?{type:e.label.type,text:e.label.text,color:e.label.color,angle:e.label.angle,backgroundColor:e.label.backgroundColor,borderLineColor:e.label.borderLineColor,borderLineSize:e.label.borderLineSize,kerning:e.label.kerning,lineHeight:e.label.lineHeight,lineWidth:e.label.lineWidth,rotated:e.label.rotated,haloColor:e.label.haloColor,haloSize:e.label.haloSize,xoffset:e.label.xoffset,yoffset:e.label.yoffset,verticalAlignment:e.label.verticalAlignment,horizontalAlignment:e.label.horizontalAlignment,font:{size:e.label.size,family:"Josefin Slab",weight:e.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:e.label.color},size:e.label.size,halo:{color:e.label.haloColor,size:e.label.haloSize}}]};var n=new p({labelExpressionInfo:{expression:"$feature.NAME"},symbol:r,labelPlacement:e.label.placement,minScale:e.label.minScale,maxScale:e.label.maxScale});t.labelingInfo=[n]}}}});else if("group"===b.type){var i=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}];b.datafiled.forEach(function(e){i.push(e)});var l=new s({id:b.uuid,title:b.uuid,visible:b.visible,objectIdField:"objectId",geometryType:"point",screenSizePerspectiveEnabled:!1,popupEnabled:!1,popupTemplate:!1,isCluster:b.style.isCluster,clusterImgSrc:b.style.clusterImgSrc,defaultClusterSym:b.style.defaultClusterSym,maxScale:b.maxScale,minScale:b.minScale,fields:i,source:[],spatialReference:f.view.spatialReference});if(b.elevationInfo&&"3d"===f.view.type&&(l.elevationInfo=b.elevationInfo),f.view.map.add(l),b.overlayers.forEach(function(e){e.attributes.uuid=e.uuid;var i=new c({geometry:new u({x:e.position[0],y:e.position[1],z:void 0===e.position[2]?0:e.position[2],spatialReference:f.view.spatialReference}),attributes:e.attributes});l.source.add(i),f.mapoverlayersflayer.push([b.uuid,e.uuid,i])}),b.label.visible){var t=void 0;if(b.label.labelingInfo)t=b.label.labelingInfo,l.labelingInfo=t;else{t="2D"===f.viewMode?{type:b.label.type,text:b.label.text,color:b.label.color,angle:b.label.angle,backgroundColor:b.label.backgroundColor,borderLineColor:b.label.borderLineColor,borderLineSize:b.label.borderLineSize,kerning:b.label.kerning,lineHeight:b.label.lineHeight,lineWidth:b.label.lineWidth,rotated:b.label.rotated,haloColor:b.label.haloColor,haloSize:b.label.haloSize,xoffset:b.label.xoffset,yoffset:b.label.yoffset,verticalAlignment:b.label.verticalAlignment,horizontalAlignment:b.label.horizontalAlignment,font:{size:b.label.size,family:"Josefin Slab",weight:b.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:b.label.color},size:b.label.size,halo:{color:b.label.haloColor,size:b.label.haloSize}}]};var a=new p({labelExpressionInfo:{expression:"$feature.NAME"},symbol:t,labelPlacement:b.label.placement,minScale:b.label.minScale,maxScale:b.label.maxScale});l.labelingInfo=[a]}}}else if("element"===b.type&&"marker"===b.overlaytype.toLowerCase()){var o=void 0;o=b.renderer?b.renderer:"3D"===f.viewMode?{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:b.icon.size.width,resource:{href:b.icon.image}}]}}:{type:"simple",symbol:{type:"picture-marker",url:b.icon.image,width:b.icon.size.width,height:b.icon.size.height}};var r=[{name:"objectId",alias:"objectId",type:"oid"},{name:"uuid",alias:"唯一标识",type:"string"}];Object.keys(b.attributes).forEach(function(e){r.push({name:e,alias:e,type:"string"})});var n=new s({id:b.uuid,title:b.uuid,objectIdField:"OBJECTID",geometryType:"point",renderer:o,screenSizePerspectiveEnabled:!0,popupEnabled:!1,popupTemplate:!1,visible:b.visible,maxScale:b.maxScale,minScale:b.minScale,fields:r,source:[],spatialReference:f.view.spatialReference});b.elevationInfo&&"3d"===f.view.type&&(n.elevationInfo=b.elevationInfo);var y=b.attributes;y.uuid=b.uuid;var d=new c({geometry:new u({x:b.position[0],y:b.position[1],z:void 0===b.position[2]?0:b.position[2],spatialReference:f.view.spatialReference}),attributes:y});n.source.add(d),f.view.map.add(n),f.mapoverlayersflayer.push([b.uuid,b.uuid,d]),b.label.visible&&(t=void 0,b.label.labelingInfo?(t=b.label.labelingInfo,n.labelingInfo=t):(t="2D"===f.viewMode?{type:b.label.type,text:b.label.text,color:b.label.color,angle:b.label.angle,backgroundColor:b.label.backgroundColor,borderLineColor:b.label.borderLineColor,borderLineSize:b.label.borderLineSize,kerning:b.label.kerning,lineHeight:b.label.lineHeight,lineWidth:b.label.lineWidth,rotated:b.label.rotated,haloColor:b.label.haloColor,haloSize:b.label.haloSize,xoffset:b.label.xoffset,yoffset:b.label.yoffset,verticalAlignment:b.label.verticalAlignment,horizontalAlignment:b.label.horizontalAlignment,font:{size:b.label.size,family:"Josefin Slab",weight:b.label.weight}}:{type:"label-3d",symbolLayers:[{type:"text",material:{color:b.label.color},size:b.label.size,halo:{color:b.label.haloColor,size:b.label.haloSize}}]},a=new p({labelExpressionInfo:{expression:"$feature.NAME"},symbol:t,labelPlacement:b.label.placement,minScale:b.label.minScale,maxScale:b.label.maxScale}),n.labelingInfo=[a]))}})},We.prototype.removefeatureCluster=function(i){var l=this;if(i instanceof Array)i.forEach(function(i){l.mapoverlayersflayer.filter(function(e){return e[1]===i.uuid}).forEach(function(e){var i=l.view.map.findLayerById(e[0]);null!==i&&i.applyEdits({deleteFeatures:[e[2]]}).then(function(e){i.queryFeatures().then(function(e){0===e.features.length&&l.view.map.remove(i)})})}),l.mapoverlayersflayer=l.mapoverlayersflayer.filter(function(e){return e[1]!==i.uuid})});else if("group"===i.type){var e=this.view.map.findLayerById(i.uuid);null!==e&&this.view.map.remove(e),this.mapoverlayersflayer=this.mapoverlayersflayer.filter(function(e){return e[0]!==i.uuid})}else"element"===i.type&&(this.mapoverlayersflayer.filter(function(e){return e[1]===i.uuid}).forEach(function(e){var i=l.view.map.findLayerById(e[0]);null!==i&&i.applyEdits({deleteFeatures:[e[2]]}).then(function(e){i.queryFeatures().then(function(e){0===e.features.length&&l.view.map.remove(i)})})}),this.mapoverlayersflayer=this.mapoverlayersflayer.filter(function(e){return e[1]!==i.uuid}))},We.prototype.init=function(c,u,y){return De(this,void 0,void 0,function(){var i=this;return Ve(this,function(e){return this.maplayers=re.gisService,Le(["82B44794-5CE0-A64A-9047F07CAF08BD2C/08F60FEF-C6FF-A788-344D-1755CB0E3870/xhrutils"]).then(function(e){var p=e[0];return De(i,void 0,void 0,function(){var i,l,t,a,o,r,n,s=this;return Ve(this,function(e){switch(e.label){case 0:return"back"!==re.tokenserver.tokenType?[3,1]:(i=void 0===y.tokenconfigname?re.tokenserver.token_black.tokenconfigname:y.tokenconfigname,l=window.location.host,t=re.tokenserver.token_black.url,p.maptoken_backend(re.proxyConifg.url,t,i,l).then(function(l){return De(s,void 0,void 0,function(){var i;return Ve(this,function(e){switch(e.label){case 0:return this.maptoken=JSON.parse(l.data).token,"3D"!==this.viewMode?[3,2]:[4,Ee(c,re.gisService,re.proxyConifg,this.maptoken,y)];case 1:return i=e.sent(),this.view=i.sceneView,[3,4];case 2:return[4,Te(c,re.gisService,re.proxyConifg,this.maptoken,y)];case 3:i=e.sent(),this.view=i.mapView,e.label=4;case 4:return this.initEvent(),[2]}})})}),[3,7]);case 1:return"free"!==re.tokenserver.tokenType?[3,6]:"3D"!==this.viewMode?[3,3]:[4,Ee(c,re.gisService,re.proxyConifg,"",y)];case 2:return a=e.sent(),this.view=a.sceneView,[3,5];case 3:return[4,Te(c,re.gisService,re.proxyConifg,"",y)];case 4:a=e.sent(),this.view=a.mapView,e.label=5;case 5:return this.initEvent(),[3,7];case 6:o=re.tokenserver.token_front.url,r=re.tokenserver.token_front.user,n=re.tokenserver.token_front.password,p.maptoken_front(o,r,n).then(function(l){return De(s,void 0,void 0,function(){var i;return Ve(this,function(e){switch(e.label){case 0:return this.maptoken=l.token,"3D"!==u?[3,2]:[4,Ee(c,re.gisService,re.proxyConifg,this.maptoken,y)];case 1:return i=e.sent(),this.view=i.sceneView,[3,4];case 2:return[4,Te(c,re.gisService,re.proxyConifg,this.maptoken,y)];case 3:i=e.sent(),this.view=i.mapView,e.label=4;case 4:return this.initEvent(),[2]}})})}),e.label=7;case 7:return[2]}})})}),[2]})})},We.prototype.initEvent=function(){return De(this,void 0,void 0,function(){var l=this;return Ve(this,function(e){return Le(["esri/core/watchUtils"]).then(function(e){var i=e[0];l.view.when(function(){i.whenTrueOnce(l.view,"ready",function(){l.emit(Re.maploaded,l.view)}),i.whenTrue(l.view,"stationary",function(){if(l.view.extent){var e={xmin:l.view.extent.xmin.toFixed(6),ymin:l.view.extent.ymin.toFixed(6),xmax:l.view.extent.xmax.toFixed(6),ymax:l.view.extent.ymax.toFixed(6)};if("2D"===l.viewMode)l.emit(Re.extentchanged,e);else{var i={xmin:l.view.extent.xmin.toFixed(6),ymin:l.view.extent.ymin.toFixed(6),xmax:l.view.extent.xmax.toFixed(6),ymax:l.view.extent.ymax.toFixed(6),zmin:l.view.extent.zmin,zmax:l.view.extent.zmax};l.emit(Re.extentchanged,i)}l.view.center&&("2D"===l.viewMode?l.emit(Re.centerchanged,{x:l.view.center.x.toFixed(6),y:l.view.center.y.toFixed(6)}):l.emit(Re.centerchanged,{x:l.view.center.x.toFixed(6),y:l.view.center.y.toFixed(6),z:l.view.center.z})),l.view.zoom&&l.emit(Re.zoomchanged,l.view.zoom)}}),l.view.popup.watch("visible",function(e){l.emit(Re.popupvisible,e)}),l.view.on("blur",function(e){l.emit(Re.blur,l.view,e)}),l.view.on("click",function(e){l.emit(Re.click,l.view,e)}),l.view.on("double-click",function(e){l.emit(Re.doubleclick,l.view,e)}),l.view.on("drag",function(e){l.emit(Re.drag,l.view,e)}),l.view.on("focus",function(e){l.emit(Re.focus,l.view,e)}),l.view.on("hold",function(e){l.emit(Re.hold,l.view,e)}),l.view.on("key-down",function(e){l.emit(Re.keydown,l.view,e)}),l.view.on("key-up",function(e){l.emit(Re.keyup,l.view,e)}),l.view.on("mouse-wheel",function(e){l.emit(Re.mousewheel,l.view,e)}),l.view.on("pointer-down",function(e){l.emit(Re.pointerdown,l.view,e)}),l.view.on("pointer-enter",function(e){l.emit(Re.pointerenter,l.view,e)}),l.view.on("pointer-leave",function(e){l.emit(Re.pointerleave,l.view,e)}),l.view.on("pointer-move",function(e){l.emit(Re.pointermove,l.view,e)}),l.view.on("pointer-up",function(e){l.emit(Re.pointerup,l.view,e)}),l.view.on("resize",function(e){l.emit(Re.resize,l.view,e)})})}),[2]})})},We);function We(e,i){void 0===i&&(i={});var l=He.call(this)||this;return l.maplayers=null,l.viewMode="2D",l.showBuildingBlock=!1,l.view=null,l.maptoken="",l.mapControl=[],l.mapoverlayers=[],l.mapoverlayersflayer=[],l.watchHandles=[],l.viewMode=void 0===i.viewMode||"2D"===i.viewMode?"2D":"3D",l.zooms=void 0===i.zooms?[0,11]:i.zooms,l.showBuildingBlock=!!i.showBuildingBlock,l.init(e,l.viewMode,i),l}var Ne=function(e){this.type="text",this.color="white",this.visible=!0,this.size=12,this.weight="normal",this.angle=0,this.backgroundColor="red",this.borderLineColor="blue",this.borderLineSize=200,this.haloColor="yellow",this.haloSize=20,this.horizontalAlignment="right",this.verticalAlignment="top",this.kerning=!0,this.lineHeight=25,this.lineWidth=200,this.rotated=!1,this.xoffset=0,this.yoffset=0,this.zoffset=0,this.placement="above-right",this.maxScale=0,this.minScale=0,this.labelingInfo=null,this.text=void 0===e.text?"标注":e.text,this.color=void 0===e.color?"white":e.color,this.visible=void 0===e.visible||e.visible,this.size=void 0===e.size?12:e.size,this.weight=void 0===e.weight?"normal":e.weight,this.angle=void 0===e.angle?0:e.angle,this.backgroundColor=void 0===e.backgroundColor?"red":e.backgroundColor,this.borderLineColor=void 0===e.borderLineColor?"blue":e.borderLineColor,this.borderLineSize=void 0===e.borderLineSize?200:e.borderLineSize,this.haloColor=void 0===e.haloColor?"yellow":e.haloColor,this.haloSize=void 0===e.haloSize?0:e.haloSize,this.horizontalAlignment=void 0===e.horizontalAlignment?"right":e.horizontalAlignment,this.verticalAlignment=void 0===e.verticalAlignment?"top":e.verticalAlignment,this.kerning=void 0===e.kerning||e.kerning,this.lineHeight=void 0===e.lineHeight?25:e.lineHeight,this.lineWidth=void 0===e.lineWidth?200:e.lineWidth,this.rotated=void 0!==e.rotated&&e.rotated,this.xoffset=void 0===e.xoffset?0:e.xoffset,this.yoffset=void 0===e.yoffset?0:e.yoffset,this.zoffset=void 0===e.zoffset?0:e.zoffset,this.placement=void 0===e.placement?"center-right":e.placement,this.maxScale=void 0===e.maxScale?0:e.maxScale,this.minScale=void 0===e.minScale?0:e.minScale,this.labelingInfo=e.labelingInfo},Ge=(Je.prototype.S4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},Je.prototype.get_uuid=function(){return this.S4()+this.S4()+"-"+this.S4()+"-"+this.S4()+"-"+this.S4()+"-"+this.S4()+this.S4()+this.S4()},Je);function Je(){this.uuid=this.get_uuid()}function Ue(e){this.uuid=(new Ge).uuid,this.label=void 0!==e.label?e.label:new Ne({visible:!1}),this.attributes=void 0===e.attributes?{}:e.attributes,this.type="element",this.renderer=e.renderer,this.elevationInfo=e.elevationInfo,this.symbol=e.symbol,this.visible=void 0===e.visible||e.visible,this.maxScale=e.maxScale||0,this.minScale=e.minScale||0}var Ze,qe,Xe=((Ze=function(e,i){return(Ze=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}Ze(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(Ye,qe=Ue),Ye);function Ye(e){var i=qe.call(this,e)||this;return i.overlaytype="polygon",i.paths=e.paths,i.symboltype=void 0===e.symboltype?"simple":e.symboltype,i.fillColor=void 0===e.fillColor?"white":e.fillColor,i.style=void 0===e.style?"solid":e.style,i.strokeColor=void 0===e.strokeColor?"red":e.strokeColor,i.strokestyle=void 0===e.strokestyle?"solid":e.strokestyle,i.strokeWeight=void 0===e.strokeWeight?2:e.strokeWeight,i.url=void 0===e.url?"":e.url,i.picwidth=void 0===e.picwidth?20:e.picwidth,i.picheight=void 0===e.picheight?20:e.picheight,i}var $e,Qe,Ke=(($e=function(e,i){return($e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}$e(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(ei,Qe=Xe),ei);function ei(e){var i=Qe.call(this,e)||this;return i.overlaytype="circle",i.center=e.center,i.radius=e.radius,i.radiusUnit=void 0===e.radiusUnit?"meters":e.radiusUnit,i}function ii(e){this.type="text",this.type=void 0===e.type?"cluster":e.type,this.clusterRadius=void 0===e.clusterRadius?100:e.clusterRadius,this.clusterConfig=void 0===e.clusterConfig?null:e.clusterConfig}function li(e){this.size=e.size,this.image=e.image}var ti,ai,oi=((ti=function(e,i){return(ti=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}ti(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(ri,ai=Ue),ri);function ri(e){var i=ai.call(this,e)||this;return i.overlaytype="Marker",i.icon=e.icon,i.position=e.position,i}function ni(e,i){this.uuid=(new Ge).uuid,this.overlayers=e,this.type="group",this.overlaytype=void 0===i.overlaytype?"marker":i.overlaytype,this.datafiled=void 0===i.datafiled?[]:i.datafiled,this.style=void 0===i.style?[]:i.style,this.label=void 0===i.label?new Ne({visible:!1}):i.label,this.frreduction=void 0===i.frreduction?null:i.frreduction,this.renderer=void 0===i.renderer?null:i.renderer,this.elevationInfo=i.elevationInfo,this.visible=void 0===i.visible||i.visible,this.maxScale=i.maxScale||0,this.minScale=i.minScale||0}var si,pi,ci=((si=function(e,i){return(si=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var l in i)i.hasOwnProperty(l)&&(e[l]=i[l])})(e,i)},function(e,i){function l(){this.constructor=e}si(e,i),e.prototype=null===i?Object.create(i):(l.prototype=i.prototype,new l)})(ui,pi=Ue),ui);function ui(e){var i=pi.call(this,e)||this;return i.overlaytype="Polyline",i.path=e.path,i.cap=void 0===e.cap?"square":e.cap,i.strokeColor=void 0===e.strokeColor?"red":e.strokeColor,i.style=void 0===e.style?"solid":e.style,i.lineJoin=void 0===e.lineJoin?"round":e.lineJoin,i.width=void 0===e.width?5:e.width,i}return{load:Le,Bounds:e,LayerListControl:P,PerformanceInfoControl:J,Zoom:K,Home:_,Compass:x,Fullscreen:M,MeasureArea:H,MeasureLine:F,BasemapToggle:o,BMapGallery:d,BMapGalleryExpand:h,UndergroundSwitch:X,BIMFilterControl:p,Marker:oi,Circle:Ke,Icon:li,Size:function(e,i){this.width=e,this.height=i},Label:Ne,LayerGroup:oe,Layer:te,FeatureReduction:ii,OverlayGroup:ni,LngLat:i,Polyline:ci,Polygon:Xe,MapEvent:Re,Map:Fe}});
//# sourceMappingURL=SMap.min.js.map
